import{_ as Qu}from"./index.fe4cc012.js";import{i as tf,k as ef,q as rf,o as nf,c as af,a as of,y as sf,u as Jo}from"./vendor.ee5d4042.js";var hf=function(){function i(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}return i.prototype.preventDefault=function(){this.defaultPrevented=!0},i.prototype.stopPropagation=function(){this.propagationStopped=!0},i}();function lf(i){i.stopPropagation()}var fe=hf,fr={PROPERTYCHANGE:"propertychange"},uf=function(){function i(){this.disposed=!1}return i.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},i.prototype.disposeInternal=function(){},i}(),Ji=uf;function ff(i,e,t){for(var r,n,a=t||We,o=0,s=i.length,h=!1;o<s;)r=o+(s-o>>1),n=+a(i[r],e),n<0?o=r+1:(s=r,h=!n);return h?o:~o}function We(i,e){return i>e?1:i<e?-1:0}function _a(i,e,t){var r=i.length;if(i[0]<=e)return 0;if(e<=i[r-1])return r-1;var n=void 0;if(t>0){for(n=1;n<r;++n)if(i[n]<e)return n-1}else if(t<0){for(n=1;n<r;++n)if(i[n]<=e)return n}else for(n=1;n<r;++n){if(i[n]==e)return n;if(i[n]<e)return typeof t=="function"?t(e,i[n-1],i[n])>0?n-1:n:i[n-1]-e<e-i[n]?n-1:n}return r-1}function cf(i,e,t){for(;e<t;){var r=i[e];i[e]=i[t],i[t]=r,++e,--t}}function ce(i,e){for(var t=Array.isArray(e)?e:[e],r=t.length,n=0;n<r;n++)i[i.length]=t[n]}function $e(i,e){var t=i.length;if(t!==e.length)return!1;for(var r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}function df(i,e,t){var r=e||We;return i.every(function(n,a){if(a===0)return!0;var o=r(i[a-1],n);return!(o>0||t&&o===0)})}function cr(){return!0}function Qi(){return!1}function Ve(){}function vf(i){var e=!1,t,r,n;return function(){var a=Array.prototype.slice.call(arguments);return(!e||this!==n||!$e(a,r))&&(e=!0,n=this,r=a,t=i.apply(this,arguments)),t}}var vt=typeof Object.assign=="function"?Object.assign:function(i,e){if(i==null)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(i),r=1,n=arguments.length;r<n;++r){var a=arguments[r];if(a!=null)for(var o in a)a.hasOwnProperty(o)&&(t[o]=a[o])}return t};function dr(i){for(var e in i)delete i[e]}var Qo=typeof Object.values=="function"?Object.values:function(i){var e=[];for(var t in i)e.push(i[t]);return e};function vr(i){var e;for(e in i)return!1;return!e}var _f=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),pf=function(i){_f(e,i);function e(t){var r=i.call(this)||this;return r.eventTarget_=t,r.pendingRemovals_=null,r.dispatching_=null,r.listeners_=null,r}return e.prototype.addEventListener=function(t,r){if(!(!t||!r)){var n=this.listeners_||(this.listeners_={}),a=n[t]||(n[t]=[]);a.indexOf(r)===-1&&a.push(r)}},e.prototype.dispatchEvent=function(t){var r=typeof t=="string"?new fe(t):t,n=r.type;r.target||(r.target=this.eventTarget_||this);var a=this.listeners_&&this.listeners_[n],o;if(a){var s=this.dispatching_||(this.dispatching_={}),h=this.pendingRemovals_||(this.pendingRemovals_={});n in s||(s[n]=0,h[n]=0),++s[n];for(var l=0,u=a.length;l<u;++l)if("handleEvent"in a[l]?o=a[l].handleEvent(r):o=a[l].call(this,r),o===!1||r.propagationStopped){o=!1;break}if(--s[n],s[n]===0){var f=h[n];for(delete h[n];f--;)this.removeEventListener(n,Ve);delete s[n]}return o}},e.prototype.disposeInternal=function(){this.listeners_&&dr(this.listeners_)},e.prototype.getListeners=function(t){return this.listeners_&&this.listeners_[t]||void 0},e.prototype.hasListener=function(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1},e.prototype.removeEventListener=function(t,r){var n=this.listeners_&&this.listeners_[t];if(n){var a=n.indexOf(r);a!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[a]=Ve,++this.pendingRemovals_[t]):(n.splice(a,1),n.length===0&&delete this.listeners_[t]))}},e}(Ji),He=pf,D={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function Y(i,e,t,r,n){if(r&&r!==i&&(t=t.bind(r)),n){var a=t;t=function(){i.removeEventListener(e,t),a.apply(this,arguments)}}var o={target:i,type:e,listener:t};return i.addEventListener(e,t),o}function tn(i,e,t,r){return Y(i,e,t,r,!0)}function at(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),dr(i))}var gf=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),en=function(i){gf(e,i);function e(){var t=i.call(this)||this;return t.on=t.onInternal,t.once=t.onceInternal,t.un=t.unInternal,t.revision_=0,t}return e.prototype.changed=function(){++this.revision_,this.dispatchEvent(D.CHANGE)},e.prototype.getRevision=function(){return this.revision_},e.prototype.onInternal=function(t,r){if(Array.isArray(t)){for(var n=t.length,a=new Array(n),o=0;o<n;++o)a[o]=Y(this,t[o],r);return a}else return Y(this,t,r)},e.prototype.onceInternal=function(t,r){var n;if(Array.isArray(t)){var a=t.length;n=new Array(a);for(var o=0;o<a;++o)n[o]=tn(this,t[o],r)}else n=tn(this,t,r);return r.ol_key=n,n},e.prototype.unInternal=function(t,r){var n=r.ol_key;if(n)yf(n);else if(Array.isArray(t))for(var a=0,o=t.length;a<o;++a)this.removeEventListener(t[a],r);else this.removeEventListener(t,r)},e}(He);en.prototype.on;en.prototype.once;en.prototype.un;function yf(i){if(Array.isArray(i))for(var e=0,t=i.length;e<t;++e)at(i[e]);else at(i)}var ts=en;function G(){return function(){throw new Error("Unimplemented abstract method.")}()}var mf=0;function tt(i){return i.ol_uid||(i.ol_uid=String(++mf))}var xf="6.12.0",es=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),rs=function(i){es(e,i);function e(t,r,n){var a=i.call(this,t)||this;return a.key=r,a.oldValue=n,a}return e}(fe),Ef=function(i){es(e,i);function e(t){var r=i.call(this)||this;return r.on,r.once,r.un,tt(r),r.values_=null,t!==void 0&&r.setProperties(t),r}return e.prototype.get=function(t){var r;return this.values_&&this.values_.hasOwnProperty(t)&&(r=this.values_[t]),r},e.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},e.prototype.getProperties=function(){return this.values_&&vt({},this.values_)||{}},e.prototype.hasProperties=function(){return!!this.values_},e.prototype.notify=function(t,r){var n;n="change:"+t,this.dispatchEvent(new rs(n,t,r)),n=fr.PROPERTYCHANGE,this.dispatchEvent(new rs(n,t,r))},e.prototype.addChangeListener=function(t,r){this.addEventListener("change:"+t,r)},e.prototype.removeChangeListener=function(t,r){this.removeEventListener("change:"+t,r)},e.prototype.set=function(t,r,n){var a=this.values_||(this.values_={});if(n)a[t]=r;else{var o=a[t];a[t]=r,o!==r&&this.notify(t,o)}},e.prototype.setProperties=function(t,r){for(var n in t)this.set(n,t[n],r)},e.prototype.applyProperties=function(t){!t.values_||vt(this.values_||(this.values_={}),t.values_)},e.prototype.unset=function(t,r){if(this.values_&&t in this.values_){var n=this.values_[t];delete this.values_[t],vr(this.values_)&&(this.values_=null),r||this.notify(t,n)}},e}(ts),Zt=Ef,rn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},_r=typeof navigator!="undefined"&&typeof navigator.userAgent!="undefined"?navigator.userAgent.toLowerCase():"",Tf=_r.indexOf("firefox")!==-1;_r.indexOf("safari")!==-1&&_r.indexOf("chrom")==-1;var Mf=_r.indexOf("webkit")!==-1&&_r.indexOf("edge")==-1,Cf=_r.indexOf("macintosh")!==-1,is=typeof devicePixelRatio!="undefined"?devicePixelRatio:1,nn=typeof WorkerGlobalScope!="undefined"&&typeof OffscreenCanvas!="undefined"&&self instanceof WorkerGlobalScope,Rf=typeof Image!="undefined"&&Image.prototype.decode,ns=function(){var i=!1;try{var e=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return i}();function jt(i,e,t,r){var n;return t&&t.length?n=t.shift():nn?n=new OffscreenCanvas(i||300,e||300):n=document.createElement("canvas"),i&&(n.width=i),e&&(n.height=e),n.getContext("2d",r)}function an(i,e){var t=e.parentNode;t&&t.replaceChild(i,e)}function pa(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function Of(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function Sf(i,e){for(var t=i.childNodes,r=0;;++r){var n=t[r],a=e[r];if(!n&&!a)break;if(n!==a){if(!n){i.appendChild(a);continue}if(!a){i.removeChild(n),--r;continue}i.insertBefore(a,n)}}}var wf=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),If=function(i){wf(e,i);function e(t){var r=i.call(this)||this,n=t.element;return n&&!t.target&&!n.style.pointerEvents&&(n.style.pointerEvents="auto"),r.element=n||null,r.target_=null,r.map_=null,r.listenerKeys=[],t.render&&(r.render=t.render),t.target&&r.setTarget(t.target),r}return e.prototype.disposeInternal=function(){pa(this.element),i.prototype.disposeInternal.call(this)},e.prototype.getMap=function(){return this.map_},e.prototype.setMap=function(t){this.map_&&pa(this.element);for(var r=0,n=this.listenerKeys.length;r<n;++r)at(this.listenerKeys[r]);if(this.listenerKeys.length=0,this.map_=t,this.map_){var a=this.target_?this.target_:t.getOverlayContainerStopEvent();a.appendChild(this.element),this.render!==Ve&&this.listenerKeys.push(Y(t,rn.POSTRENDER,this.render,this)),t.render()}},e.prototype.render=function(t){},e.prototype.setTarget=function(t){this.target_=typeof t=="string"?document.getElementById(t):t},e}(Zt),Ke=If,on="ol-hidden",Re="ol-unselectable",as="ol-unsupported",pr="ol-control",os="ol-collapsed",Lf=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),ss=["style","variant","weight","size","lineHeight","family"],hs=function(i){var e=i.match(Lf);if(!e)return null;for(var t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},r=0,n=ss.length;r<n;++r){var a=e[r+1];a!==void 0&&(t[ss[r]]=a)}return t.families=t.family.split(/,\s?/),t};function Pf(i){return i===1?"":String(Math.round(i*100)/100)}var Q={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"},bf=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Af=function(i){bf(e,i);function e(t){var r=this,n="v"+xf.split("-")[0],a="Assertion failed. See https://openlayers.org/en/"+n+"/doc/errors/#"+t+" for details.";return r=i.call(this,a)||this,r.code=t,r.name="AssertionError",r.message=a,r}return e}(Error),ls=Af;function z(i,e){if(!i)throw new ls(e)}function X(i,e,t){return Math.min(Math.max(i,e),t)}var Nf=function(){var i;return"cosh"in Math?i=Math.cosh:i=function(e){var t=Math.exp(e);return(t+1/t)/2},i}(),us=function(){var i;return"log2"in Math?i=Math.log2:i=function(e){return Math.log(e)*Math.LOG2E},i}();function fs(i,e,t,r,n,a){var o=n-t,s=a-r;if(o!==0||s!==0){var h=((i-t)*o+(e-r)*s)/(o*o+s*s);h>1?(t=n,r=a):h>0&&(t+=o*h,r+=s*h)}return Ze(i,e,t,r)}function Ze(i,e,t,r){var n=t-i,a=r-e;return n*n+a*a}function Ff(i){for(var e=i.length,t=0;t<e;t++){for(var r=t,n=Math.abs(i[t][t]),a=t+1;a<e;a++){var o=Math.abs(i[a][t]);o>n&&(n=o,r=a)}if(n===0)return null;var s=i[r];i[r]=i[t],i[t]=s;for(var h=t+1;h<e;h++)for(var l=-i[h][t]/i[t][t],u=t;u<e+1;u++)t==u?i[h][u]=0:i[h][u]+=l*i[t][u]}for(var f=new Array(e),c=e-1;c>=0;c--){f[c]=i[c][e]/i[c][c];for(var d=c-1;d>=0;d--)i[d][e]-=i[d][c]*f[c]}return f}function sn(i){return i*Math.PI/180}function qe(i,e){var t=i%e;return t*e<0?t+e:t}function de(i,e,t){return i+t*(e-i)}function cs(i,e){var t=Math.pow(10,e);return Math.round(i*t)/t}function hn(i,e){return Math.floor(cs(i,e))}function ln(i,e){return Math.ceil(cs(i,e))}var Df=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Gf=function(i){Df(e,i);function e(t){var r=i.call(this)||this;r.on,r.once,r.un,r.background_=t.background;var n=vt({},t);return typeof t.properties=="object"&&(delete n.properties,vt(n,t.properties)),n[Q.OPACITY]=t.opacity!==void 0?t.opacity:1,z(typeof n[Q.OPACITY]=="number",64),n[Q.VISIBLE]=t.visible!==void 0?t.visible:!0,n[Q.Z_INDEX]=t.zIndex,n[Q.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,n[Q.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,n[Q.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,n[Q.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,r.className_=n.className!==void 0?t.className:"ol-layer",delete n.className,r.setProperties(n),r.state_=null,r}return e.prototype.getBackground=function(){return this.background_},e.prototype.getClassName=function(){return this.className_},e.prototype.getLayerState=function(t){var r=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return r.opacity=X(Math.round(this.getOpacity()*100)/100,0,1),r.sourceState=this.getSourceState(),r.visible=this.getVisible(),r.extent=this.getExtent(),r.zIndex=n===void 0&&!r.managed?1/0:n,r.maxResolution=this.getMaxResolution(),r.minResolution=Math.max(this.getMinResolution(),0),r.minZoom=this.getMinZoom(),r.maxZoom=this.getMaxZoom(),this.state_=r,r},e.prototype.getLayersArray=function(t){return G()},e.prototype.getLayerStatesArray=function(t){return G()},e.prototype.getExtent=function(){return this.get(Q.EXTENT)},e.prototype.getMaxResolution=function(){return this.get(Q.MAX_RESOLUTION)},e.prototype.getMinResolution=function(){return this.get(Q.MIN_RESOLUTION)},e.prototype.getMinZoom=function(){return this.get(Q.MIN_ZOOM)},e.prototype.getMaxZoom=function(){return this.get(Q.MAX_ZOOM)},e.prototype.getOpacity=function(){return this.get(Q.OPACITY)},e.prototype.getSourceState=function(){return G()},e.prototype.getVisible=function(){return this.get(Q.VISIBLE)},e.prototype.getZIndex=function(){return this.get(Q.Z_INDEX)},e.prototype.setBackground=function(t){this.background_=t,this.changed()},e.prototype.setExtent=function(t){this.set(Q.EXTENT,t)},e.prototype.setMaxResolution=function(t){this.set(Q.MAX_RESOLUTION,t)},e.prototype.setMinResolution=function(t){this.set(Q.MIN_RESOLUTION,t)},e.prototype.setMaxZoom=function(t){this.set(Q.MAX_ZOOM,t)},e.prototype.setMinZoom=function(t){this.set(Q.MIN_ZOOM,t)},e.prototype.setOpacity=function(t){z(typeof t=="number",64),this.set(Q.OPACITY,t)},e.prototype.setVisible=function(t){this.set(Q.VISIBLE,t)},e.prototype.setZIndex=function(t){this.set(Q.Z_INDEX,t)},e.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),i.prototype.disposeInternal.call(this)},e}(Zt),ds=Gf,Lt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Oe={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},Uf=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),kf=function(i){Uf(e,i);function e(t){var r=this,n=vt({},t);delete n.source,r=i.call(this,n)||this,r.on,r.once,r.un,r.mapPrecomposeKey_=null,r.mapRenderKey_=null,r.sourceChangeKey_=null,r.renderer_=null,t.render&&(r.render=t.render),t.map&&r.setMap(t.map),r.addChangeListener(Q.SOURCE,r.handleSourcePropertyChange_);var a=t.source?t.source:null;return r.setSource(a),r}return e.prototype.getLayersArray=function(t){var r=t||[];return r.push(this),r},e.prototype.getLayerStatesArray=function(t){var r=t||[];return r.push(this.getLayerState()),r},e.prototype.getSource=function(){return this.get(Q.SOURCE)||null},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():Oe.UNDEFINED},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(at(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=Y(t,D.CHANGE,this.handleSourceChange_,this)),this.changed()},e.prototype.getFeatures=function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(function(r){return r([])})},e.prototype.render=function(t,r){var n=this.getRenderer();if(n.prepareFrame(t))return n.renderFrame(t,r)},e.prototype.setMapInternal=function(t){this.set(Q.MAP,t)},e.prototype.getMapInternal=function(){return this.get(Q.MAP)},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(at(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(at(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Y(t,Lt.PRECOMPOSE,function(r){var n=r,a=n.frameState.layerStatesArray,o=this.getLayerState(!1);z(!a.some(function(s){return s.layer===o.layer}),67),a.push(o)},this),this.mapRenderKey_=Y(this,D.CHANGE,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(Q.SOURCE,t)},e.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},e.prototype.hasRenderer=function(){return!!this.renderer_},e.prototype.createRenderer=function(){return null},e.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),i.prototype.disposeInternal.call(this)},e}(ds);function un(i,e){if(!i.visible)return!1;var t=e.resolution;if(t<i.minResolution||t>=i.maxResolution)return!1;var r=e.zoom;return r>i.minZoom&&r<=i.maxZoom}var fn=kf,Bf=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Xf=function(i){Bf(e,i);function e(t){var r=this,n=t||{};r=i.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this,r.ulElement_=document.createElement("ul"),r.collapsed_=n.collapsed!==void 0?n.collapsed:!0,r.userCollapsed_=r.collapsed_,r.overrideCollapsible_=n.collapsible!==void 0,r.collapsible_=n.collapsible!==void 0?n.collapsible:!0,r.collapsible_||(r.collapsed_=!1);var a=n.className!==void 0?n.className:"ol-attribution",o=n.tipLabel!==void 0?n.tipLabel:"Attributions",s=n.expandClassName!==void 0?n.expandClassName:a+"-expand",h=n.collapseLabel!==void 0?n.collapseLabel:"\u203A",l=n.collapseClassName!==void 0?n.collapseClassName:a+"-collpase";typeof h=="string"?(r.collapseLabel_=document.createElement("span"),r.collapseLabel_.textContent=h,r.collapseLabel_.className=l):r.collapseLabel_=h;var u=n.label!==void 0?n.label:"i";typeof u=="string"?(r.label_=document.createElement("span"),r.label_.textContent=u,r.label_.className=s):r.label_=u;var f=r.collapsible_&&!r.collapsed_?r.collapseLabel_:r.label_;r.toggleButton_=document.createElement("button"),r.toggleButton_.setAttribute("type","button"),r.toggleButton_.setAttribute("aria-expanded",String(!r.collapsed_)),r.toggleButton_.title=o,r.toggleButton_.appendChild(f),r.toggleButton_.addEventListener(D.CLICK,r.handleClick_.bind(r),!1);var c=a+" "+Re+" "+pr+(r.collapsed_&&r.collapsible_?" "+os:"")+(r.collapsible_?"":" ol-uncollapsible"),d=r.element;return d.className=c,d.appendChild(r.toggleButton_),d.appendChild(r.ulElement_),r.renderedAttributions_=[],r.renderedVisible_=!0,r}return e.prototype.collectSourceAttributions_=function(t){for(var r={},n=[],a=!0,o=t.layerStatesArray,s=0,h=o.length;s<h;++s){var l=o[s];if(!!un(l,t.viewState)){var u=l.layer.getSource();if(!!u){var f=u.getAttributions();if(!!f){var c=f(t);if(!!c)if(a=a&&u.getAttributionsCollapsible()!==!1,Array.isArray(c))for(var d=0,v=c.length;d<v;++d)c[d]in r||(n.push(c[d]),r[c[d]]=!0);else c in r||(n.push(c),r[c]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(a),n},e.prototype.updateElement_=function(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}var r=this.collectSourceAttributions_(t),n=r.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!$e(r,this.renderedAttributions_)){Of(this.ulElement_);for(var a=0,o=r.length;a<o;++a){var s=document.createElement("li");s.innerHTML=r[a],this.ulElement_.appendChild(s)}this.renderedAttributions_=r}},e.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_},e.prototype.handleToggle_=function(){this.element.classList.toggle(os),this.collapsed_?an(this.collapseLabel_,this.label_):an(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e.prototype.render=function(t){this.updateElement_(t.frameState)},e}(Ke),jf=Xf,Pt={ADD:"add",REMOVE:"remove"},vs=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),_s={LENGTH:"length"},cn=function(i){vs(e,i);function e(t,r,n){var a=i.call(this,t)||this;return a.element=r,a.index=n,a}return e}(fe),Yf=function(i){vs(e,i);function e(t,r){var n=i.call(this)||this;n.on,n.once,n.un;var a=r||{};if(n.unique_=!!a.unique,n.array_=t||[],n.unique_)for(var o=0,s=n.array_.length;o<s;++o)n.assertUnique_(n.array_[o],o);return n.updateLength_(),n}return e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var r=0,n=t.length;r<n;++r)this.push(t[r]);return this},e.prototype.forEach=function(t){for(var r=this.array_,n=0,a=r.length;n<a;++n)t(r[n],n,r)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(_s.LENGTH)},e.prototype.insertAt=function(t,r){this.unique_&&this.assertUnique_(r),this.array_.splice(t,0,r),this.updateLength_(),this.dispatchEvent(new cn(Pt.ADD,r,t))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var r=this.getLength();return this.insertAt(r,t),this.getLength()},e.prototype.remove=function(t){for(var r=this.array_,n=0,a=r.length;n<a;++n)if(r[n]===t)return this.removeAt(n)},e.prototype.removeAt=function(t){var r=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new cn(Pt.REMOVE,r,t)),r},e.prototype.setAt=function(t,r){var n=this.getLength();if(t<n){this.unique_&&this.assertUnique_(r,t);var a=this.array_[t];this.array_[t]=r,this.dispatchEvent(new cn(Pt.REMOVE,a,t)),this.dispatchEvent(new cn(Pt.ADD,r,t))}else{for(var o=n;o<t;++o)this.insertAt(o,void 0);this.insertAt(t,r)}},e.prototype.updateLength_=function(){this.set(_s.LENGTH,this.array_.length)},e.prototype.assertUnique_=function(t,r){for(var n=0,a=this.array_.length;n<a;++n)if(this.array_[n]===t&&n!==r)throw new ls(58)},e}(Zt),Ut=Yf;function ps(i){return Math.pow(i,3)}function Je(i){return 1-ps(1-i)}function zf(i){return 3*i*i-2*i*i*i}function Wf(i){return i}var $f=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Vf=function(i){$f(e,i);function e(t){var r=this,n=t||{};r=i.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this;var a=n.className!==void 0?n.className:"ol-rotate",o=n.label!==void 0?n.label:"\u21E7",s=n.compassClassName!==void 0?n.compassClassName:"ol-compass";r.label_=null,typeof o=="string"?(r.label_=document.createElement("span"),r.label_.className=s,r.label_.textContent=o):(r.label_=o,r.label_.classList.add(s));var h=n.tipLabel?n.tipLabel:"Reset rotation",l=document.createElement("button");l.className=a+"-reset",l.setAttribute("type","button"),l.title=h,l.appendChild(r.label_),l.addEventListener(D.CLICK,r.handleClick_.bind(r),!1);var u=a+" "+Re+" "+pr,f=r.element;return f.className=u,f.appendChild(l),r.callResetNorth_=n.resetNorth?n.resetNorth:void 0,r.duration_=n.duration!==void 0?n.duration:250,r.autoHide_=n.autoHide!==void 0?n.autoHide:!0,r.rotation_=void 0,r.autoHide_&&r.element.classList.add(on),r}return e.prototype.handleClick_=function(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()},e.prototype.resetNorth_=function(){var t=this.getMap(),r=t.getView();if(!!r){var n=r.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!=0?r.animate({rotation:0,duration:this.duration_,easing:Je}):r.setRotation(0))}},e.prototype.render=function(t){var r=t.frameState;if(!!r){var n=r.viewState.rotation;if(n!=this.rotation_){var a="rotate("+n+"rad)";if(this.autoHide_){var o=this.element.classList.contains(on);!o&&n===0?this.element.classList.add(on):o&&n!==0&&this.element.classList.remove(on)}this.label_.style.transform=a}this.rotation_=n}},e}(Ke),Hf=Vf,Kf=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Zf=function(i){Kf(e,i);function e(t){var r=this,n=t||{};r=i.call(this,{element:document.createElement("div"),target:n.target})||this;var a=n.className!==void 0?n.className:"ol-zoom",o=n.delta!==void 0?n.delta:1,s=n.zoomInClassName!==void 0?n.zoomInClassName:a+"-in",h=n.zoomOutClassName!==void 0?n.zoomOutClassName:a+"-out",l=n.zoomInLabel!==void 0?n.zoomInLabel:"+",u=n.zoomOutLabel!==void 0?n.zoomOutLabel:"\u2013",f=n.zoomInTipLabel!==void 0?n.zoomInTipLabel:"Zoom in",c=n.zoomOutTipLabel!==void 0?n.zoomOutTipLabel:"Zoom out",d=document.createElement("button");d.className=s,d.setAttribute("type","button"),d.title=f,d.appendChild(typeof l=="string"?document.createTextNode(l):l),d.addEventListener(D.CLICK,r.handleClick_.bind(r,o),!1);var v=document.createElement("button");v.className=h,v.setAttribute("type","button"),v.title=c,v.appendChild(typeof u=="string"?document.createTextNode(u):u),v.addEventListener(D.CLICK,r.handleClick_.bind(r,-o),!1);var _=a+" "+Re+" "+pr,p=r.element;return p.className=_,p.appendChild(d),p.appendChild(v),r.duration_=n.duration!==void 0?n.duration:250,r}return e.prototype.handleClick_=function(t,r){r.preventDefault(),this.zoomByDelta_(t)},e.prototype.zoomByDelta_=function(t){var r=this.getMap(),n=r.getView();if(!!n){var a=n.getZoom();if(a!==void 0){var o=n.getConstrainedZoom(a+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:o,duration:this.duration_,easing:Je})):n.setZoom(o)}}},e}(Ke),qf=Zf,yt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Jf=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),gs=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],ys={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"},Qf=function(i){Jf(e,i);function e(t){var r=this,n=t||{};r=i.call(this,{element:document.createElement("div"),target:n.target})||this,r.on,r.once,r.un,r.cssClassName_=n.className!==void 0?n.className:"ol-full-screen",r.documentListeners_=[],r.activeClassName_=n.activeClassName!==void 0?n.activeClassName.split(" "):[r.cssClassName_+"-true"],r.inactiveClassName_=n.inactiveClassName!==void 0?n.inactiveClassName.split(" "):[r.cssClassName_+"-false"];var a=n.label!==void 0?n.label:"\u2922";r.labelNode_=typeof a=="string"?document.createTextNode(a):a;var o=n.labelActive!==void 0?n.labelActive:"\xD7";r.labelActiveNode_=typeof o=="string"?document.createTextNode(o):o,r.button_=document.createElement("button");var s=n.tipLabel?n.tipLabel:"Toggle full-screen";return r.button_.setAttribute("type","button"),r.button_.title=s,r.button_.appendChild(r.labelNode_),r.button_.addEventListener(D.CLICK,r.handleClick_.bind(r),!1),r.element.className=r.cssClassName_+" "+Re+" "+pr,r.element.appendChild(r.button_),r.keys_=n.keys!==void 0?n.keys:!1,r.source_=n.source,r.isInFullscreen_=!1,r.boundHandleMapTargetChange_=r.handleMapTargetChange_.bind(r),r}return e.prototype.handleClick_=function(t){t.preventDefault(),this.handleFullScreen_()},e.prototype.handleFullScreen_=function(){var t=this.getMap();if(!!t){var r=t.getOwnerDocument();if(!!ms(r))if(xs(r))ec(r);else{var n=void 0;this.source_?n=typeof this.source_=="string"?r.getElementById(this.source_):this.source_:n=t.getTargetElement(),this.keys_?tc(n):Es(n)}}},e.prototype.handleFullScreenChange_=function(){var t=this.getMap();if(!!t){var r=this.isInFullscreen_;this.isInFullscreen_=xs(t.getOwnerDocument()),r!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(an(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(ys.ENTERFULLSCREEN)):(an(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(ys.LEAVEFULLSCREEN)),t.updateSize())}},e.prototype.setClassName_=function(t,r){var n,a,o,s=this.activeClassName_,h=this.inactiveClassName_,l=r?s:h;(n=t.classList).remove.apply(n,s),(a=t.classList).remove.apply(a,h),(o=t.classList).add.apply(o,l)},e.prototype.setMap=function(t){var r=this.getMap();r&&r.removeChangeListener(yt.TARGET,this.boundHandleMapTargetChange_),i.prototype.setMap.call(this,t),this.handleMapTargetChange_(),t&&t.addChangeListener(yt.TARGET,this.boundHandleMapTargetChange_)},e.prototype.handleMapTargetChange_=function(){for(var t=this.documentListeners_,r=0,n=t.length;r<n;++r)at(t[r]);t.length=0;var a=this.getMap();if(a){var o=a.getOwnerDocument();ms(o)?this.element.classList.remove(as):this.element.classList.add(as);for(var r=0,n=gs.length;r<n;++r)t.push(Y(o,gs[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}},e}(Ke);function ms(i){var e=i.body;return!!(e.webkitRequestFullscreen||e.msRequestFullscreen&&i.msFullscreenEnabled||e.requestFullscreen&&i.fullscreenEnabled)}function xs(i){return!!(i.webkitIsFullScreen||i.msFullscreenElement||i.fullscreenElement)}function Es(i){i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen()}function tc(i){i.webkitRequestFullscreen?i.webkitRequestFullscreen():Es(i)}function ec(i){i.exitFullscreen?i.exitFullscreen():i.msExitFullscreen?i.msExitFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()}var rc=Qf,qt={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},gr={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},Jt={};Jt[gr.RADIANS]=6370997/(2*Math.PI);Jt[gr.DEGREES]=2*Math.PI*6370997/360;Jt[gr.FEET]=.3048;Jt[gr.METERS]=1;Jt[gr.USFEET]=1200/3937;var Qt=gr,ic=function(){function i(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}return i.prototype.canWrapX=function(){return this.canWrapX_},i.prototype.getCode=function(){return this.code_},i.prototype.getExtent=function(){return this.extent_},i.prototype.getUnits=function(){return this.units_},i.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||Jt[this.units_]},i.prototype.getWorldExtent=function(){return this.worldExtent_},i.prototype.getAxisOrientation=function(){return this.axisOrientation_},i.prototype.isGlobal=function(){return this.global_},i.prototype.setGlobal=function(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)},i.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},i.prototype.setDefaultTileGrid=function(e){this.defaultTileGrid_=e},i.prototype.setExtent=function(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)},i.prototype.setWorldExtent=function(e){this.worldExtent_=e},i.prototype.setGetPointResolution=function(e){this.getPointResolutionFunc_=e},i.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},i}(),ga=ic,nc=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),qr=6378137,yr=Math.PI*qr,ac=[-yr,-yr,yr,yr],oc=[-180,-85,180,85],dn=qr*Math.log(Math.tan(Math.PI/2)),mr=function(i){nc(e,i);function e(t){return i.call(this,{code:t,units:Qt.METERS,extent:ac,global:!0,worldExtent:oc,getPointResolution:function(r,n){return r/Nf(n[1]/qr)}})||this}return e}(ga),Ts=[new mr("EPSG:3857"),new mr("EPSG:102100"),new mr("EPSG:102113"),new mr("EPSG:900913"),new mr("http://www.opengis.net/def/crs/EPSG/0/3857"),new mr("http://www.opengis.net/gml/srs/epsg.xml#3857")];function sc(i,e,t){var r=i.length,n=t>1?t:2,a=e;a===void 0&&(n>2?a=i.slice():a=new Array(r));for(var o=0;o<r;o+=n){a[o]=yr*i[o]/180;var s=qr*Math.log(Math.tan(Math.PI*(+i[o+1]+90)/360));s>dn?s=dn:s<-dn&&(s=-dn),a[o+1]=s}return a}function hc(i,e,t){var r=i.length,n=t>1?t:2,a=e;a===void 0&&(n>2?a=i.slice():a=new Array(r));for(var o=0;o<r;o+=n)a[o]=180*i[o]/yr,a[o+1]=360*Math.atan(Math.exp(i[o+1]/qr))/Math.PI-90;return a}var lc=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),uc=6378137,Ms=[-180,-90,180,90],fc=Math.PI*uc/180,Qe=function(i){lc(e,i);function e(t,r){return i.call(this,{code:t,units:Qt.DEGREES,extent:Ms,axisOrientation:r,global:!0,metersPerUnit:fc,worldExtent:Ms})||this}return e}(ga),Cs=[new Qe("CRS:84"),new Qe("EPSG:4326","neu"),new Qe("urn:ogc:def:crs:OGC:1.3:CRS84"),new Qe("urn:ogc:def:crs:OGC:2:84"),new Qe("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Qe("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Qe("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],ya={};function cc(i){return ya[i]||ya[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function dc(i,e){ya[i]=e}var xr={};function Er(i,e,t){var r=i.getCode(),n=e.getCode();r in xr||(xr[r]={}),xr[r][n]=t}function Rs(i,e){var t;return i in xr&&e in xr[i]&&(t=xr[i][e]),t}var Jr={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},mt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Os(i){for(var e=$t(),t=0,r=i.length;t<r;++t)ei(e,i[t]);return e}function vc(i,e,t){var r=Math.min.apply(null,i),n=Math.min.apply(null,e),a=Math.max.apply(null,i),o=Math.max.apply(null,e);return te(r,n,a,o,t)}function ma(i,e,t){return t?(t[0]=i[0]-e,t[1]=i[1]-e,t[2]=i[2]+e,t[3]=i[3]+e,t):[i[0]-e,i[1]-e,i[2]+e,i[3]+e]}function Ss(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i.slice()}function tr(i,e,t){var r,n;return e<i[0]?r=i[0]-e:i[2]<e?r=e-i[2]:r=0,t<i[1]?n=i[1]-t:i[3]<t?n=t-i[3]:n=0,r*r+n*n}function ve(i,e){return xa(i,e[0],e[1])}function Se(i,e){return i[0]<=e[0]&&e[2]<=i[2]&&i[1]<=e[1]&&e[3]<=i[3]}function xa(i,e,t){return i[0]<=e&&e<=i[2]&&i[1]<=t&&t<=i[3]}function Ea(i,e){var t=i[0],r=i[1],n=i[2],a=i[3],o=e[0],s=e[1],h=mt.UNKNOWN;return o<t?h=h|mt.LEFT:o>n&&(h=h|mt.RIGHT),s<r?h=h|mt.BELOW:s>a&&(h=h|mt.ABOVE),h===mt.UNKNOWN&&(h=mt.INTERSECTING),h}function $t(){return[1/0,1/0,-1/0,-1/0]}function te(i,e,t,r,n){return n?(n[0]=i,n[1]=e,n[2]=t,n[3]=r,n):[i,e,t,r]}function Qr(i){return te(1/0,1/0,-1/0,-1/0,i)}function _c(i,e){var t=i[0],r=i[1];return te(t,r,t,r,e)}function ws(i,e,t,r,n){var a=Qr(n);return Ls(a,i,e,t,r)}function ti(i,e){return i[0]==e[0]&&i[2]==e[2]&&i[1]==e[1]&&i[3]==e[3]}function pc(i,e,t){return Math.abs(i[0]-e[0])<t&&Math.abs(i[2]-e[2])<t&&Math.abs(i[1]-e[1])<t&&Math.abs(i[3]-e[3])<t}function Is(i,e){return e[0]<i[0]&&(i[0]=e[0]),e[2]>i[2]&&(i[2]=e[2]),e[1]<i[1]&&(i[1]=e[1]),e[3]>i[3]&&(i[3]=e[3]),i}function ei(i,e){e[0]<i[0]&&(i[0]=e[0]),e[0]>i[2]&&(i[2]=e[0]),e[1]<i[1]&&(i[1]=e[1]),e[1]>i[3]&&(i[3]=e[1])}function Ls(i,e,t,r,n){for(;t<r;t+=n)gc(i,e[t],e[t+1]);return i}function gc(i,e,t){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}function Ps(i,e){var t;return t=e(vn(i)),t||(t=e(_n(i)),t)||(t=e(pn(i)),t)||(t=e(Tr(i)),t)?t:!1}function Ta(i){var e=0;return ri(i)||(e=it(i)*Yt(i)),e}function vn(i){return[i[0],i[1]]}function _n(i){return[i[2],i[1]]}function ee(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function yc(i,e){var t;return e===Jr.BOTTOM_LEFT?t=vn(i):e===Jr.BOTTOM_RIGHT?t=_n(i):e===Jr.TOP_LEFT?t=Tr(i):e===Jr.TOP_RIGHT?t=pn(i):z(!1,13),t}function Ma(i,e,t,r,n){var a=e*r[0]/2,o=e*r[1]/2,s=Math.cos(t),h=Math.sin(t),l=a*s,u=a*h,f=o*s,c=o*h,d=i[0],v=i[1],_=d-l+c,p=d-l-c,y=d+l-c,g=d+l+c,m=v-u-f,x=v-u+f,E=v+u+f,T=v+u-f;return te(Math.min(_,p,y,g),Math.min(m,x,E,T),Math.max(_,p,y,g),Math.max(m,x,E,T),n)}function Yt(i){return i[3]-i[1]}function er(i,e,t){var r=t||$t();return Rt(i,e)?(i[0]>e[0]?r[0]=i[0]:r[0]=e[0],i[1]>e[1]?r[1]=i[1]:r[1]=e[1],i[2]<e[2]?r[2]=i[2]:r[2]=e[2],i[3]<e[3]?r[3]=i[3]:r[3]=e[3]):Qr(r),r}function Tr(i){return[i[0],i[3]]}function pn(i){return[i[2],i[3]]}function it(i){return i[2]-i[0]}function Rt(i,e){return i[0]<=e[2]&&i[2]>=e[0]&&i[1]<=e[3]&&i[3]>=e[1]}function ri(i){return i[2]<i[0]||i[3]<i[1]}function mc(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i}function xc(i,e,t){var r=!1,n=Ea(i,e),a=Ea(i,t);if(n===mt.INTERSECTING||a===mt.INTERSECTING)r=!0;else{var o=i[0],s=i[1],h=i[2],l=i[3],u=e[0],f=e[1],c=t[0],d=t[1],v=(d-f)/(c-u),_=void 0,p=void 0;!!(a&mt.ABOVE)&&!(n&mt.ABOVE)&&(_=c-(d-l)/v,r=_>=o&&_<=h),!r&&!!(a&mt.RIGHT)&&!(n&mt.RIGHT)&&(p=d-(c-h)*v,r=p>=s&&p<=l),!r&&!!(a&mt.BELOW)&&!(n&mt.BELOW)&&(_=c-(d-s)/v,r=_>=o&&_<=h),!r&&!!(a&mt.LEFT)&&!(n&mt.LEFT)&&(p=d-(c-o)*v,r=p>=s&&p<=l)}return r}function bs(i,e,t,r){var n=[];if(r>1)for(var a=i[2]-i[0],o=i[3]-i[1],s=0;s<r;++s)n.push(i[0]+a*s/r,i[1],i[2],i[1]+o*s/r,i[2]-a*s/r,i[3],i[0],i[3]-o*s/r);else n=[i[0],i[1],i[2],i[1],i[2],i[3],i[0],i[3]];e(n,n,2);for(var h=[],l=[],s=0,u=n.length;s<u;s+=2)h.push(n[s]),l.push(n[s+1]);return vc(h,l,t)}function As(i,e){var t=e.getExtent(),r=ee(i);if(e.canWrapX()&&(r[0]<t[0]||r[0]>=t[2])){var n=it(t),a=Math.floor((r[0]-t[0])/n),o=a*n;i[0]-=o,i[2]-=o}return i}var A={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Ec=63710088e-1;function Ns(i,e,t){var r=t||Ec,n=sn(i[1]),a=sn(e[1]),o=(a-n)/2,s=sn(e[0]-i[0])/2,h=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(n)*Math.cos(a);return 2*r*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))}function Fs(i,e,t){var r=t!==void 0?i.toFixed(t):""+i,n=r.indexOf(".");return n=n===-1?r.length:n,n>e?r:new Array(1+e-n).join("0")+r}function Tc(i,e){return i[0]+=+e[0],i[1]+=+e[1],i}function Ds(i,e,t){var r=qe(e+180,360)-180,n=Math.abs(3600*r),a=t||0,o=Math.pow(10,a),s=Math.floor(n/3600),h=Math.floor((n-s*3600)/60),l=n-s*3600-h*60;return l=Math.ceil(l*o)/o,l>=60&&(l=0,h+=1),h>=60&&(h=0,s+=1),s+"\xB0 "+Fs(h,2)+"\u2032 "+Fs(l,2,a)+"\u2033"+(r==0?"":" "+i.charAt(r<0?1:0))}function Ca(i,e){for(var t=!0,r=i.length-1;r>=0;--r)if(i[r]!=e[r]){t=!1;break}return t}function Ra(i,e){var t=Math.cos(e),r=Math.sin(e),n=i[0]*t-i[1]*r,a=i[1]*t+i[0]*r;return i[0]=n,i[1]=a,i}function Mc(i,e){return i[0]*=e,i[1]*=e,i}function Gs(i,e){if(e.canWrapX()){var t=it(e.getExtent()),r=Us(i,e,t);r&&(i[0]-=r*t)}return i}function Us(i,e,t){var r=e.getExtent(),n=0;if(e.canWrapX()&&(i[0]<r[0]||i[0]>r[2])){var a=t||it(r);n=Math.floor((i[0]-r[0])/a)}return n}function Oa(i,e,t){var r;if(e!==void 0){for(var n=0,a=i.length;n<a;++n)e[n]=i[n];r=e}else r=i.slice();return r}function Sa(i,e,t){if(e!==void 0&&i!==e){for(var r=0,n=i.length;r<n;++r)e[r]=i[r];i=e}return i}function ks(i){dc(i.getCode(),i),Er(i,i,Oa)}function Cc(i){i.forEach(ks)}function nt(i){return typeof i=="string"?cc(i):i||null}function Bs(i,e,t,r){i=nt(i);var n,a=i.getPointResolutionFunc();if(a){if(n=a(e,t),r&&r!==i.getUnits()){var o=i.getMetersPerUnit();o&&(n=n*o/Jt[r])}}else{var s=i.getUnits();if(s==Qt.DEGREES&&!r||r==Qt.DEGREES)n=e;else{var h=ii(i,nt("EPSG:4326"));if(h===Sa&&s!==Qt.DEGREES)n=e*i.getMetersPerUnit();else{var l=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];l=h(l,l,2);var u=Ns(l.slice(0,2),l.slice(2,4)),f=Ns(l.slice(4,6),l.slice(6,8));n=(u+f)/2}var o=r?Jt[r]:i.getMetersPerUnit();o!==void 0&&(n/=o)}}return n}function wa(i){Cc(i),i.forEach(function(e){i.forEach(function(t){e!==t&&Er(e,t,Oa)})})}function Rc(i,e,t,r){i.forEach(function(n){e.forEach(function(a){Er(n,a,t),Er(a,n,r)})})}function Ia(i,e){return i?typeof i=="string"?nt(i):i:nt(e)}function Xs(i){return function(e,t,r){for(var n=e.length,a=r!==void 0?r:2,o=t!==void 0?t:new Array(n),s=0;s<n;s+=a){var h=i([e[s],e[s+1]]);o[s]=h[0],o[s+1]=h[1];for(var l=a-1;l>=2;--l)o[s+l]=e[s+l]}return o}}function Oc(i,e,t,r){var n=nt(i),a=nt(e);Er(n,a,Xs(t)),Er(a,n,Xs(r))}function we(i,e){if(i===e)return!0;var t=i.getUnits()===e.getUnits();if(i.getCode()===e.getCode())return t;var r=ii(i,e);return r===Oa&&t}function ii(i,e){var t=i.getCode(),r=e.getCode(),n=Rs(t,r);return n||(n=Sa),n}function Ie(i,e){var t=nt(i),r=nt(e);return ii(t,r)}function js(i,e,t){var r=Ie(e,t);return r(i,void 0,i.length)}var Sc=null;function Ys(){return Sc}function La(i,e){return i}function _e(i,e){return i}function zs(i,e){return i}function Mr(i,e){return i}function Ws(i,e,t){return function(r){var n=r[0],a=r[1],o,s;if(i.canWrapX()){var h=i.getExtent(),l=it(h);s=Us(r,i,l),s&&(n=n-s*l),n=X(n,h[0],h[2]),a=X(a,h[1],h[3]),o=t([n,a])}else o=t(r);return s&&e.canWrapX()&&(o[0]+=s*it(e.getExtent())),o}}function wc(){wa(Ts),wa(Cs),Rc(Cs,Ts,sc,hc)}wc();var Ic=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Pa="projection",$s="coordinateFormat",Lc=function(i){Ic(e,i);function e(t){var r=this,n=t||{},a=document.createElement("div");a.className=n.className!==void 0?n.className:"ol-mouse-position",r=i.call(this,{element:a,render:n.render,target:n.target})||this,r.on,r.once,r.un,r.addChangeListener(Pa,r.handleProjectionChanged_),n.coordinateFormat&&r.setCoordinateFormat(n.coordinateFormat),n.projection&&r.setProjection(n.projection);var o=!0,s="&#160;";return"undefinedHTML"in n?(n.undefinedHTML!==void 0&&(s=n.undefinedHTML),o=!!s):"placeholder"in n&&(n.placeholder===!1?o=!1:s=String(n.placeholder)),r.placeholder_=s,r.renderOnMouseOut_=o,r.renderedHTML_=a.innerHTML,r.mapProjection_=null,r.transform_=null,r}return e.prototype.handleProjectionChanged_=function(){this.transform_=null},e.prototype.getCoordinateFormat=function(){return this.get($s)},e.prototype.getProjection=function(){return this.get(Pa)},e.prototype.handleMouseMove=function(t){var r=this.getMap();this.updateHTML_(r.getEventPixel(t))},e.prototype.handleMouseOut=function(t){this.updateHTML_(null)},e.prototype.setMap=function(t){if(i.prototype.setMap.call(this,t),t){var r=t.getViewport();this.listenerKeys.push(Y(r,qt.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(Y(r,qt.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}},e.prototype.setCoordinateFormat=function(t){this.set($s,t)},e.prototype.setProjection=function(t){this.set(Pa,nt(t))},e.prototype.updateHTML_=function(t){var r=this.placeholder_;if(t&&this.mapProjection_){if(!this.transform_){var n=this.getProjection();n?this.transform_=ii(this.mapProjection_,n):this.transform_=Sa}var a=this.getMap(),o=a.getCoordinateFromPixelInternal(t);if(o){var s=Ys();s&&(this.transform_=ii(this.mapProjection_,s)),this.transform_(o,o);var h=this.getCoordinateFormat();h?r=h(o):r=o.toString()}}(!this.renderedHTML_||r!==this.renderedHTML_)&&(this.element.innerHTML=r,this.renderedHTML_=r)},e.prototype.render=function(t){var r=t.frameState;r?this.mapProjection_!=r.viewState.projection&&(this.mapProjection_=r.viewState.projection,this.transform_=null):this.mapProjection_=null},e}(Ke),Pc=Lc,Vs=new Array(6);function bt(){return[1,0,0,1,0,0]}function ba(i){return gn(i,1,0,0,1,0,0)}function Aa(i,e){var t=i[0],r=i[1],n=i[2],a=i[3],o=i[4],s=i[5],h=e[0],l=e[1],u=e[2],f=e[3],c=e[4],d=e[5];return i[0]=t*h+n*l,i[1]=r*h+a*l,i[2]=t*u+n*f,i[3]=r*u+a*f,i[4]=t*c+n*d+o,i[5]=r*c+a*d+s,i}function gn(i,e,t,r,n,a,o){return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i[4]=a,i[5]=o,i}function bc(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i}function pt(i,e){var t=e[0],r=e[1];return e[0]=i[0]*t+i[2]*r+i[4],e[1]=i[1]*t+i[3]*r+i[5],e}function Ac(i,e){var t=Math.cos(e),r=Math.sin(e);return Aa(i,gn(Vs,t,r,-r,t,0,0))}function Nc(i,e,t){return Aa(i,gn(Vs,e,0,0,t,0,0))}function Fc(i,e,t){return gn(i,e,0,0,t,0,0)}function re(i,e,t,r,n,a,o,s){var h=Math.sin(a),l=Math.cos(a);return i[0]=r*l,i[1]=n*h,i[2]=-r*h,i[3]=n*l,i[4]=o*r*l-s*r*h+e,i[5]=o*n*h+s*n*l+t,i}function Hs(i,e){var t=Dc(e);z(t!==0,32);var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],h=e[5];return i[0]=o/t,i[1]=-n/t,i[2]=-a/t,i[3]=r/t,i[4]=(a*h-o*s)/t,i[5]=-(r*h-n*s)/t,i}function Dc(i){return i[0]*i[3]-i[1]*i[2]}var Ks;function Gc(i){var e="matrix("+i.join(", ")+")";if(nn)return e;var t=Ks||(Ks=document.createElement("div"));return t.style.transform=e,t.style.transform}var Zs=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,qs=/^([a-z]*)$|^hsla?\(.*\)$/i;function Js(i){return typeof i=="string"?i:rh(i)}function Qs(i){var e=document.createElement("div");if(e.style.color=i,e.style.color!==""){document.body.appendChild(e);var t=getComputedStyle(e).color;return document.body.removeChild(e),t}else return""}var th=function(){var i=1024,e={},t=0;return function(r){var n;if(e.hasOwnProperty(r))n=e[r];else{if(t>=i){var a=0;for(var o in e)(a++&3)==0&&(delete e[o],--t)}n=Uc(r),e[r]=n,++t}return n}}();function ni(i){return Array.isArray(i)?i:th(i)}function Uc(i){var e,t,r,n,a;if(qs.exec(i)&&(i=Qs(i)),Zs.exec(i)){var o=i.length-1,s=void 0;o<=4?s=1:s=2;var h=o===4||o===8;e=parseInt(i.substr(1+0*s,s),16),t=parseInt(i.substr(1+1*s,s),16),r=parseInt(i.substr(1+2*s,s),16),h?n=parseInt(i.substr(1+3*s,s),16):n=255,s==1&&(e=(e<<4)+e,t=(t<<4)+t,r=(r<<4)+r,h&&(n=(n<<4)+n)),a=[e,t,r,n/255]}else i.indexOf("rgba(")==0?(a=i.slice(5,-1).split(",").map(Number),eh(a)):i.indexOf("rgb(")==0?(a=i.slice(4,-1).split(",").map(Number),a.push(1),eh(a)):z(!1,14);return a}function eh(i){return i[0]=X(i[0]+.5|0,0,255),i[1]=X(i[1]+.5|0,0,255),i[2]=X(i[2]+.5|0,0,255),i[3]=X(i[3],0,1),i}function rh(i){var e=i[0];e!=(e|0)&&(e=e+.5|0);var t=i[1];t!=(t|0)&&(t=t+.5|0);var r=i[2];r!=(r|0)&&(r=r+.5|0);var n=i[3]===void 0?1:Math.round(i[3]*100)/100;return"rgba("+e+","+t+","+r+","+n+")"}function kc(i){return qs.test(i)&&(i=Qs(i)),Zs.test(i)||i.indexOf("rgba(")===0||i.indexOf("rgb(")===0}var Bc=function(){function i(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return i.prototype.clear=function(){this.cache_={},this.cacheSize_=0},i.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},i.prototype.expire=function(){if(this.canExpireCache()){var e=0;for(var t in this.cache_){var r=this.cache_[t];(e++&3)==0&&!r.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}},i.prototype.get=function(e,t,r){var n=ih(e,t,r);return n in this.cache_?this.cache_[n]:null},i.prototype.set=function(e,t,r,n){var a=ih(e,t,r);this.cache_[a]=n,++this.cacheSize_},i.prototype.setSize=function(e){this.maxCacheSize_=e,this.expire()},i}();function ih(i,e,t){var r=t?Js(t):"null";return e+":"+i+":"+r}var yn=new Bc,Xc=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),jc=function(i){Xc(e,i);function e(t){var r=i.call(this)||this;return r.map_=t,r}return e.prototype.dispatchRenderEvent=function(t,r){G()},e.prototype.calculateMatrices2D=function(t){var r=t.viewState,n=t.coordinateToPixelTransform,a=t.pixelToCoordinateTransform;re(n,t.size[0]/2,t.size[1]/2,1/r.resolution,-1/r.resolution,-r.rotation,-r.center[0],-r.center[1]),Hs(a,n)},e.prototype.forEachFeatureAtCoordinate=function(t,r,n,a,o,s,h,l){var u,f=r.viewState;function c($,H,V,K){return o.call(s,H,$?V:null,K)}var d=f.projection,v=Gs(t.slice(),d),_=[[0,0]];if(d.canWrapX()&&a){var p=d.getExtent(),y=it(p);_.push([-y,0],[y,0])}for(var g=r.layerStatesArray,m=g.length,x=[],E=[],T=0;T<_.length;T++)for(var M=m-1;M>=0;--M){var C=g[M],O=C.layer;if(O.hasRenderer()&&un(C,f)&&h.call(l,O)){var P=O.getRenderer(),I=O.getSource();if(P&&I){var F=I.getWrapX()?v:t,B=c.bind(null,C.managed);E[0]=F[0]+_[T][0],E[1]=F[1]+_[T][1],u=P.forEachFeatureAtCoordinate(E,r,n,B,x)}if(u)return u}}if(x.length!==0){var Z=1/x.length;return x.forEach(function($,H){return $.distanceSq+=H*Z}),x.sort(function($,H){return $.distanceSq-H.distanceSq}),x.some(function($){return u=$.callback($.feature,$.layer,$.geometry)}),u}},e.prototype.forEachLayerAtPixel=function(t,r,n,a,o){return G()},e.prototype.hasFeatureAtCoordinate=function(t,r,n,a,o,s){var h=this.forEachFeatureAtCoordinate(t,r,n,a,cr,this,o,s);return h!==void 0},e.prototype.getMap=function(){return this.map_},e.prototype.renderFrame=function(t){G()},e.prototype.scheduleExpireIconCache=function(t){yn.canExpireCache()&&t.postRenderFunctions.push(Yc)},e}(Ji);function Yc(i,e){yn.expire()}var zc=jc,Wc=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),$c=function(i){Wc(e,i);function e(t,r,n,a){var o=i.call(this,t)||this;return o.inversePixelTransform=r,o.frameState=n,o.context=a,o}return e}(fe),ai=$c,nh="10px sans-serif",pe="#000",mn="round",oi=[],si=0,Cr="round",hi=10,li="#000",ui="center",xn="middle",rr=[0,0,0,0],fi=1,ge=new Zt,Vc=new He;Vc.setSize=function(){console.warn("labelCache is deprecated.")};var Rr=null,Na,Fa={},Hc=function(){var i=100,e="32px ",t=["monospace","serif"],r=t.length,n="wmytzilWMYTZIL@#/&?$%10\uF013",a,o;function s(l,u,f){for(var c=!0,d=0;d<r;++d){var v=t[d];if(o=En(l+" "+u+" "+e+v,n),f!=v){var _=En(l+" "+u+" "+e+f+","+v,n);c=c&&_!=o}}return!!c}function h(){for(var l=!0,u=ge.getKeys(),f=0,c=u.length;f<c;++f){var d=u[f];ge.get(d)<i&&(s.apply(this,d.split(`
`))?(dr(Fa),Rr=null,Na=void 0,ge.set(d,i)):(ge.set(d,ge.get(d)+1,!0),l=!1))}l&&(clearInterval(a),a=void 0)}return function(l){var u=hs(l);if(!!u)for(var f=u.families,c=0,d=f.length;c<d;++c){var v=f[c],_=u.style+`
`+u.weight+`
`+v;ge.get(_)===void 0&&(ge.set(_,i,!0),s(u.style,u.weight,v)||(ge.set(_,0,!0),a===void 0&&(a=setInterval(h,32))))}}}(),Kc=function(){var i;return function(e){var t=Fa[e];if(t==null){if(nn){var r=hs(e),n=ah(e,"\u017Dg"),a=isNaN(Number(r.lineHeight))?1.2:Number(r.lineHeight);t=a*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=e,document.body.appendChild(i),t=i.offsetHeight,document.body.removeChild(i);Fa[e]=t}return t}}();function ah(i,e){return Rr||(Rr=jt(1,1)),i!=Na&&(Rr.font=i,Na=Rr.font),Rr.measureText(e)}function En(i,e){return ah(i,e).width}function oh(i,e,t){if(e in t)return t[e];var r=En(i,e);return t[e]=r,r}function Zc(i,e,t){for(var r=e.length,n=0,a=0;a<r;++a){var o=En(i,e[a]);n=Math.max(n,o),t.push(o)}return n}function qc(i,e,t,r,n,a,o,s,h,l,u){i.save(),t!==1&&(i.globalAlpha*=t),e&&i.setTransform.apply(i,e),r.contextInstructions?(i.translate(h,l),i.scale(u[0],u[1]),Jc(r,i)):u[0]<0||u[1]<0?(i.translate(h,l),i.scale(u[0],u[1]),i.drawImage(r,n,a,o,s,0,0,o,s)):i.drawImage(r,n,a,o,s,h,l,o*u[0],s*u[1]),i.restore()}function Jc(i,e){for(var t=i.contextInstructions,r=0,n=t.length;r<n;r+=2)Array.isArray(t[r+1])?e[t[r]].apply(e,t[r+1]):e[t[r]]=t[r+1]}var Qc=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),td=function(i){Qc(e,i);function e(t){var r=i.call(this,t)||this;r.fontChangeListenerKey_=Y(ge,fr.PROPERTYCHANGE,t.redrawText.bind(t)),r.element_=document.createElement("div");var n=r.element_.style;n.position="absolute",n.width="100%",n.height="100%",n.zIndex="0",r.element_.className=Re+" ol-layers";var a=t.getViewport();return a.insertBefore(r.element_,a.firstChild||null),r.children_=[],r.renderedVisible_=!0,r}return e.prototype.dispatchRenderEvent=function(t,r){var n=this.getMap();if(n.hasListener(t)){var a=new ai(t,void 0,r);n.dispatchEvent(a)}},e.prototype.disposeInternal=function(){at(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),i.prototype.disposeInternal.call(this)},e.prototype.renderFrame=function(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Lt.PRECOMPOSE,t);var r=t.layerStatesArray.sort(function(c,d){return c.zIndex-d.zIndex}),n=t.viewState;this.children_.length=0;for(var a=[],o=null,s=0,h=r.length;s<h;++s){var l=r[s];if(t.layerIndex=s,!(!un(l,n)||l.sourceState!=Oe.READY&&l.sourceState!=Oe.UNDEFINED)){var u=l.layer,f=u.render(t,o);!f||(f!==o&&(this.children_.push(f),o=f),"getDeclutter"in u&&a.push(u))}}for(var s=a.length-1;s>=0;--s)a[s].renderDeclutter(t);Sf(this.element_,this.children_),this.dispatchRenderEvent(Lt.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)},e.prototype.forEachLayerAtPixel=function(t,r,n,a,o){for(var s=r.viewState,h=r.layerStatesArray,l=h.length,u=l-1;u>=0;--u){var f=h[u],c=f.layer;if(c.hasRenderer()&&un(f,s)&&o(c)){var d=c.getRenderer(),v=d.getDataAtPixel(t,r,n);if(v){var _=a(c,v);if(_)return _}}}},e}(zc),ed=td,sh=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Le=function(i){sh(e,i);function e(t,r){var n=i.call(this,t)||this;return n.layer=r,n}return e}(fe),Da={LAYERS:"layers"},rd=function(i){sh(e,i);function e(t){var r=this,n=t||{},a=vt({},n);delete a.layers;var o=n.layers;return r=i.call(this,a)||this,r.on,r.once,r.un,r.layersListenerKeys_=[],r.listenerKeys_={},r.addChangeListener(Da.LAYERS,r.handleLayersChanged_),o?Array.isArray(o)?o=new Ut(o.slice(),{unique:!0}):z(typeof o.getArray=="function",43):o=new Ut(void 0,{unique:!0}),r.setLayers(o),r}return e.prototype.handleLayerChange_=function(){this.changed()},e.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(at),this.layersListenerKeys_.length=0;var t=this.getLayers();this.layersListenerKeys_.push(Y(t,Pt.ADD,this.handleLayersAdd_,this),Y(t,Pt.REMOVE,this.handleLayersRemove_,this));for(var r in this.listenerKeys_)this.listenerKeys_[r].forEach(at);dr(this.listenerKeys_);for(var n=t.getArray(),a=0,o=n.length;a<o;a++){var s=n[a];this.registerLayerListeners_(s),this.dispatchEvent(new Le("addlayer",s))}this.changed()},e.prototype.registerLayerListeners_=function(t){var r=[Y(t,fr.PROPERTYCHANGE,this.handleLayerChange_,this),Y(t,D.CHANGE,this.handleLayerChange_,this)];t instanceof e&&r.push(Y(t,"addlayer",this.handleLayerGroupAdd_,this),Y(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[tt(t)]=r},e.prototype.handleLayerGroupAdd_=function(t){this.dispatchEvent(new Le("addlayer",t.layer))},e.prototype.handleLayerGroupRemove_=function(t){this.dispatchEvent(new Le("removelayer",t.layer))},e.prototype.handleLayersAdd_=function(t){var r=t.element;this.registerLayerListeners_(r),this.dispatchEvent(new Le("addlayer",r)),this.changed()},e.prototype.handleLayersRemove_=function(t){var r=t.element,n=tt(r);this.listenerKeys_[n].forEach(at),delete this.listenerKeys_[n],this.dispatchEvent(new Le("removelayer",r)),this.changed()},e.prototype.getLayers=function(){return this.get(Da.LAYERS)},e.prototype.setLayers=function(t){var r=this.getLayers();if(r)for(var n=r.getArray(),a=0,o=n.length;a<o;++a)this.dispatchEvent(new Le("removelayer",n[a]));this.set(Da.LAYERS,t)},e.prototype.getLayersArray=function(t){var r=t!==void 0?t:[];return this.getLayers().forEach(function(n){n.getLayersArray(r)}),r},e.prototype.getLayerStatesArray=function(t){var r=t!==void 0?t:[],n=r.length;this.getLayers().forEach(function(u){u.getLayerStatesArray(r)});var a=this.getLayerState(),o=a.zIndex;!t&&a.zIndex===void 0&&(o=0);for(var s=n,h=r.length;s<h;s++){var l=r[s];l.opacity*=a.opacity,l.visible=l.visible&&a.visible,l.maxResolution=Math.min(l.maxResolution,a.maxResolution),l.minResolution=Math.max(l.minResolution,a.minResolution),l.minZoom=Math.max(l.minZoom,a.minZoom),l.maxZoom=Math.min(l.maxZoom,a.maxZoom),a.extent!==void 0&&(l.extent!==void 0?l.extent=er(l.extent,a.extent):l.extent=a.extent),l.zIndex===void 0&&(l.zIndex=o)}return r},e.prototype.getSourceState=function(){return Oe.READY},e}(ds),Tn=rd,id=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),nd=function(i){id(e,i);function e(t,r,n){var a=i.call(this,t)||this;return a.map=r,a.frameState=n!==void 0?n:null,a}return e}(fe),Mn=nd,ad=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),od=function(i){ad(e,i);function e(t,r,n,a,o){var s=i.call(this,t,r,o)||this;return s.originalEvent=n,s.pixel_=null,s.coordinate_=null,s.dragging=a!==void 0?a:!1,s}return Object.defineProperty(e.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(t){this.pixel_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(t){this.coordinate_=t},enumerable:!1,configurable:!0}),e.prototype.preventDefault=function(){i.prototype.preventDefault.call(this),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){i.prototype.stopPropagation.call(this),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()},e}(Mn),Pe=od,st={SINGLECLICK:"singleclick",CLICK:D.CLICK,DBLCLICK:D.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},sd=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),hd=function(i){sd(e,i);function e(t,r){var n=i.call(this,t)||this;n.map_=t,n.clickTimeoutId_,n.emulateClicks_=!1,n.dragging_=!1,n.dragListenerKeys_=[],n.moveTolerance_=r===void 0?1:r,n.down_=null;var a=n.map_.getViewport();return n.activePointers_=0,n.trackedTouches_={},n.element_=a,n.pointerdownListenerKey_=Y(a,qt.POINTERDOWN,n.handlePointerDown_,n),n.originalPointerMoveEvent_,n.relayedListenerKey_=Y(a,qt.POINTERMOVE,n.relayEvent_,n),n.boundHandleTouchMove_=n.handleTouchMove_.bind(n),n.element_.addEventListener(D.TOUCHMOVE,n.boundHandleTouchMove_,ns?{passive:!1}:!1),n}return e.prototype.emulateClick_=function(t){var r=new Pe(st.CLICK,this.map_,t);this.dispatchEvent(r),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,r=new Pe(st.DBLCLICK,this.map_,t),this.dispatchEvent(r)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var n=new Pe(st.SINGLECLICK,this.map_,t);this.dispatchEvent(n)}.bind(this),250)},e.prototype.updateActivePointers_=function(t){var r=t;r.type==st.POINTERUP||r.type==st.POINTERCANCEL?delete this.trackedTouches_[r.pointerId]:r.type==st.POINTERDOWN&&(this.trackedTouches_[r.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},e.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var r=new Pe(st.POINTERUP,this.map_,t);this.dispatchEvent(r),this.emulateClicks_&&!r.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_===0&&(this.dragListenerKeys_.forEach(at),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},e.prototype.isMouseActionButton_=function(t){return t.button===0},e.prototype.handlePointerDown_=function(t){this.emulateClicks_=this.activePointers_===0,this.updateActivePointers_(t);var r=new Pe(st.POINTERDOWN,this.map_,t);this.dispatchEvent(r),this.down_={};for(var n in t){var a=t[n];this.down_[n]=typeof a=="function"?Ve:a}if(this.dragListenerKeys_.length===0){var o=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Y(o,st.POINTERMOVE,this.handlePointerMove_,this),Y(o,st.POINTERUP,this.handlePointerUp_,this),Y(this.element_,st.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==o&&this.dragListenerKeys_.push(Y(this.element_.getRootNode(),st.POINTERUP,this.handlePointerUp_,this))}},e.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var r=new Pe(st.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(r)}},e.prototype.relayEvent_=function(t){this.originalPointerMoveEvent_=t;var r=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Pe(t.type,this.map_,t,r))},e.prototype.handleTouchMove_=function(t){var r=this.originalPointerMoveEvent_;(!r||r.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()},e.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},e.prototype.disposeInternal=function(){this.relayedListenerKey_&&(at(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(D.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(at(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(at),this.dragListenerKeys_.length=0,this.element_=null,i.prototype.disposeInternal.call(this)},e}(He),ld=hd,Cn=1/0,ud=function(){function i(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return i.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,dr(this.queuedElements_)},i.prototype.dequeue=function(){var e=this.elements_,t=this.priorities_,r=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));var n=this.keyFunction_(r);return delete this.queuedElements_[n],r},i.prototype.enqueue=function(e){z(!(this.keyFunction_(e)in this.queuedElements_),31);var t=this.priorityFunction_(e);return t!=Cn?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1},i.prototype.getCount=function(){return this.elements_.length},i.prototype.getLeftChildIndex_=function(e){return e*2+1},i.prototype.getRightChildIndex_=function(e){return e*2+2},i.prototype.getParentIndex_=function(e){return e-1>>1},i.prototype.heapify_=function(){var e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)},i.prototype.isEmpty=function(){return this.elements_.length===0},i.prototype.isKeyQueued=function(e){return e in this.queuedElements_},i.prototype.isQueued=function(e){return this.isKeyQueued(this.keyFunction_(e))},i.prototype.siftUp_=function(e){for(var t=this.elements_,r=this.priorities_,n=t.length,a=t[e],o=r[e],s=e;e<n>>1;){var h=this.getLeftChildIndex_(e),l=this.getRightChildIndex_(e),u=l<n&&r[l]<r[h]?l:h;t[e]=t[u],r[e]=r[u],e=u}t[e]=a,r[e]=o,this.siftDown_(s,e)},i.prototype.siftDown_=function(e,t){for(var r=this.elements_,n=this.priorities_,a=r[t],o=n[t];t>e;){var s=this.getParentIndex_(t);if(n[s]>o)r[t]=r[s],n[t]=n[s],t=s;else break}r[t]=a,n[t]=o},i.prototype.reprioritize=function(){var e=this.priorityFunction_,t=this.elements_,r=this.priorities_,n=0,a=t.length,o,s,h;for(s=0;s<a;++s)o=t[s],h=e(o),h==Cn?delete this.queuedElements_[this.keyFunction_(o)]:(r[n]=h,t[n++]=o);t.length=n,r.length=n,this.heapify_()},i}(),fd=ud,k={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},cd=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),dd=function(i){cd(e,i);function e(t,r){var n=i.call(this,function(a){return t.apply(null,a)},function(a){return a[0].getKey()})||this;return n.boundHandleTileChange_=n.handleTileChange.bind(n),n.tileChangeCallback_=r,n.tilesLoading_=0,n.tilesLoadingKeys_={},n}return e.prototype.enqueue=function(t){var r=i.prototype.enqueue.call(this,t);if(r){var n=t[0];n.addEventListener(D.CHANGE,this.boundHandleTileChange_)}return r},e.prototype.getTilesLoading=function(){return this.tilesLoading_},e.prototype.handleTileChange=function(t){var r=t.target,n=r.getState();if(n===k.LOADED||n===k.ERROR||n===k.EMPTY){r.removeEventListener(D.CHANGE,this.boundHandleTileChange_);var a=r.getKey();a in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[a],--this.tilesLoading_),this.tileChangeCallback_()}},e.prototype.loadMoreTiles=function(t,r){for(var n=0,a,o,s;this.tilesLoading_<t&&n<r&&this.getCount()>0;)o=this.dequeue()[0],s=o.getKey(),a=o.getState(),a===k.IDLE&&!(s in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++n,o.load())},e}(fd),vd=dd;function _d(i,e,t,r,n){if(!i||!(t in i.wantedTiles)||!i.wantedTiles[t][e.getKey()])return Cn;var a=i.viewState.center,o=r[0]-a[0],s=r[1]-a[1];return 65536*Math.log(n)+Math.sqrt(o*o+s*s)/n}var Mt={ANIMATING:0,INTERACTING:1},Vt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},pd=42,Ga=256;function hh(i,e,t){return function(r,n,a,o,s){if(r){var h=e?0:a[0]*n,l=e?0:a[1]*n,u=s?s[0]:0,f=s?s[1]:0,c=i[0]+h/2+u,d=i[2]-h/2+u,v=i[1]+l/2+f,_=i[3]-l/2+f;c>d&&(c=(d+c)/2,d=c),v>_&&(v=(_+v)/2,_=v);var p=X(r[0],c,d),y=X(r[1],v,_),g=30*n;return o&&t&&(p+=-g*Math.log(1+Math.max(0,c-r[0])/g)+g*Math.log(1+Math.max(0,r[0]-d)/g),y+=-g*Math.log(1+Math.max(0,v-r[1])/g)+g*Math.log(1+Math.max(0,r[1]-_)/g)),[p,y]}else return}}function gd(i){return i}function Ua(i,e,t,r){var n=it(e)/t[0],a=Yt(e)/t[1];return r?Math.min(i,Math.max(n,a)):Math.min(i,Math.min(n,a))}function ka(i,e,t){var r=Math.min(i,e),n=50;return r*=Math.log(1+n*Math.max(0,i/e-1))/n+1,t&&(r=Math.max(r,t),r/=Math.log(1+n*Math.max(0,t/i-1))/n+1),X(r,t/2,e*2)}function yd(i,e,t,r){return function(n,a,o,s){if(n!==void 0){var h=i[0],l=i[i.length-1],u=t?Ua(h,t,o,r):h;if(s){var f=e!==void 0?e:!0;return f?ka(n,u,l):X(n,l,u)}var c=Math.min(u,n),d=Math.floor(_a(i,c,a));return i[d]>u&&d<i.length-1?i[d+1]:i[d]}else return}}function md(i,e,t,r,n,a){return function(o,s,h,l){if(o!==void 0){var u=n?Ua(e,n,h,a):e,f=t!==void 0?t:0;if(l){var c=r!==void 0?r:!0;return c?ka(o,u,f):X(o,f,u)}var d=1e-9,v=Math.ceil(Math.log(e/u)/Math.log(i)-d),_=-s*(.5-d)+.5,p=Math.min(u,o),y=Math.floor(Math.log(e/p)/Math.log(i)+_),g=Math.max(v,y),m=e/Math.pow(i,g);return X(m,f,u)}else return}}function lh(i,e,t,r,n){return function(a,o,s,h){if(a!==void 0){var l=r?Ua(i,r,s,n):i,u=t!==void 0?t:!0;return!u||!h?X(a,e,l):ka(a,l,e)}else return}}function Ba(i){if(i!==void 0)return 0}function uh(i){if(i!==void 0)return i}function xd(i){var e=2*Math.PI/i;return function(t,r){if(r)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function Ed(i){var e=i||sn(5);return function(t,r){if(r)return t;if(t!==void 0)return Math.abs(t)<=e?0:t}}var ht={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function ir(i,e,t,r,n,a){for(var o=a||[],s=0,h=e;h<t;h+=r){var l=i[h],u=i[h+1];o[s++]=n[0]*l+n[2]*u+n[4],o[s++]=n[1]*l+n[3]*u+n[5]}return a&&o.length!=s&&(o.length=s),o}function fh(i,e,t,r,n,a,o){for(var s=o||[],h=Math.cos(n),l=Math.sin(n),u=a[0],f=a[1],c=0,d=e;d<t;d+=r){var v=i[d]-u,_=i[d+1]-f;s[c++]=u+v*h-_*l,s[c++]=f+v*l+_*h;for(var p=d+2;p<d+r;++p)s[c++]=i[p]}return o&&s.length!=c&&(s.length=c),s}function Td(i,e,t,r,n,a,o,s){for(var h=s||[],l=o[0],u=o[1],f=0,c=e;c<t;c+=r){var d=i[c]-l,v=i[c+1]-u;h[f++]=l+n*d,h[f++]=u+a*v;for(var _=c+2;_<c+r;++_)h[f++]=i[_]}return s&&h.length!=f&&(h.length=f),h}function Md(i,e,t,r,n,a,o){for(var s=o||[],h=0,l=e;l<t;l+=r){s[h++]=i[l]+n,s[h++]=i[l+1]+a;for(var u=l+2;u<l+r;++u)s[h++]=i[u]}return o&&s.length!=h&&(s.length=h),s}var Cd=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ch=bt(),Rd=function(i){Cd(e,i);function e(){var t=i.call(this)||this;return t.extent_=$t(),t.extentRevision_=-1,t.simplifiedGeometryMaxMinSquaredTolerance=0,t.simplifiedGeometryRevision=0,t.simplifyTransformedInternal=vf(function(r,n,a){if(!a)return this.getSimplifiedGeometry(n);var o=this.clone();return o.applyTransform(a),o.getSimplifiedGeometry(n)}),t}return e.prototype.simplifyTransformed=function(t,r){return this.simplifyTransformedInternal(this.getRevision(),t,r)},e.prototype.clone=function(){return G()},e.prototype.closestPointXY=function(t,r,n,a){return G()},e.prototype.containsXY=function(t,r){var n=this.getClosestPoint([t,r]);return n[0]===t&&n[1]===r},e.prototype.getClosestPoint=function(t,r){var n=r||[NaN,NaN];return this.closestPointXY(t[0],t[1],n,1/0),n},e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},e.prototype.computeExtent=function(t){return G()},e.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){var r=this.computeExtent(this.extent_);(isNaN(r[0])||isNaN(r[1]))&&Qr(r),this.extentRevision_=this.getRevision()}return mc(this.extent_,t)},e.prototype.rotate=function(t,r){G()},e.prototype.scale=function(t,r,n){G()},e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},e.prototype.getSimplifiedGeometry=function(t){return G()},e.prototype.getType=function(){return G()},e.prototype.applyTransform=function(t){G()},e.prototype.intersectsExtent=function(t){return G()},e.prototype.translate=function(t,r){G()},e.prototype.transform=function(t,r){var n=nt(t),a=n.getUnits()==Qt.TILE_PIXELS?function(o,s,h){var l=n.getExtent(),u=n.getWorldExtent(),f=Yt(u)/Yt(l);return re(ch,u[0],u[3],f,-f,0,0,0),ir(o,0,o.length,h,ch,s),Ie(n,r)(o,s,h)}:Ie(n,r);return this.applyTransform(a),this},e}(Zt),dh=Rd,Od=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Sd=function(i){Od(e,i);function e(){var t=i.call(this)||this;return t.layout=ht.XY,t.stride=2,t.flatCoordinates=null,t}return e.prototype.computeExtent=function(t){return ws(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinates=function(){return G()},e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.prototype.getLayout=function(){return this.layout},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var r=this.getSimplifiedGeometryInternal(t),n=r.getFlatCoordinates();return n.length<this.flatCoordinates.length?r:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.prototype.getSimplifiedGeometryInternal=function(t){return this},e.prototype.getStride=function(){return this.stride},e.prototype.setFlatCoordinates=function(t,r){this.stride=vh(t),this.layout=t,this.flatCoordinates=r},e.prototype.setCoordinates=function(t,r){G()},e.prototype.setLayout=function(t,r,n){var a;if(t)a=vh(t);else{for(var o=0;o<n;++o)if(r.length===0){this.layout=ht.XY,this.stride=2;return}else r=r[0];a=r.length,t=wd(a)}this.layout=t,this.stride=a},e.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.prototype.rotate=function(t,r){var n=this.getFlatCoordinates();if(n){var a=this.getStride();fh(n,0,n.length,a,t,r,n),this.changed()}},e.prototype.scale=function(t,r,n){var a=r;a===void 0&&(a=t);var o=n;o||(o=ee(this.getExtent()));var s=this.getFlatCoordinates();if(s){var h=this.getStride();Td(s,0,s.length,h,t,a,o,s),this.changed()}},e.prototype.translate=function(t,r){var n=this.getFlatCoordinates();if(n){var a=this.getStride();Md(n,0,n.length,a,t,r,n),this.changed()}},e}(dh);function wd(i){var e;return i==2?e=ht.XY:i==3?e=ht.XYZ:i==4&&(e=ht.XYZM),e}function vh(i){var e;return i==ht.XY?e=2:i==ht.XYZ||i==ht.XYM?e=3:i==ht.XYZM&&(e=4),e}function Id(i,e,t){var r=i.getFlatCoordinates();if(r){var n=i.getStride();return ir(r,0,r.length,n,e,t)}else return null}var nr=Sd;function _h(i,e,t,r,n,a,o){var s=i[e],h=i[e+1],l=i[t]-s,u=i[t+1]-h,f;if(l===0&&u===0)f=e;else{var c=((n-s)*l+(a-h)*u)/(l*l+u*u);if(c>1)f=t;else if(c>0){for(var d=0;d<r;++d)o[d]=de(i[e+d],i[t+d],c);o.length=r;return}else f=e}for(var d=0;d<r;++d)o[d]=i[f+d];o.length=r}function Xa(i,e,t,r,n){var a=i[e],o=i[e+1];for(e+=r;e<t;e+=r){var s=i[e],h=i[e+1],l=Ze(a,o,s,h);l>n&&(n=l),a=s,o=h}return n}function ja(i,e,t,r,n){for(var a=0,o=t.length;a<o;++a){var s=t[a];n=Xa(i,e,s,r,n),e=s}return n}function Ld(i,e,t,r,n){for(var a=0,o=t.length;a<o;++a){var s=t[a];n=ja(i,e,s,r,n),e=s[s.length-1]}return n}function Ya(i,e,t,r,n,a,o,s,h,l,u){if(e==t)return l;var f,c;if(n===0)if(c=Ze(o,s,i[e],i[e+1]),c<l){for(f=0;f<r;++f)h[f]=i[e+f];return h.length=r,c}else return l;for(var d=u||[NaN,NaN],v=e+r;v<t;)if(_h(i,v-r,v,r,o,s,d),c=Ze(o,s,d[0],d[1]),c<l){for(l=c,f=0;f<r;++f)h[f]=d[f];h.length=r,v+=r}else v+=r*Math.max((Math.sqrt(c)-Math.sqrt(l))/n|0,1);if(a&&(_h(i,t-r,e,r,o,s,d),c=Ze(o,s,d[0],d[1]),c<l)){for(l=c,f=0;f<r;++f)h[f]=d[f];h.length=r}return l}function za(i,e,t,r,n,a,o,s,h,l,u){for(var f=u||[NaN,NaN],c=0,d=t.length;c<d;++c){var v=t[c];l=Ya(i,e,v,r,n,a,o,s,h,l,f),e=v}return l}function Pd(i,e,t,r,n,a,o,s,h,l,u){for(var f=u||[NaN,NaN],c=0,d=t.length;c<d;++c){var v=t[c];l=za(i,e,v,r,n,a,o,s,h,l,f),e=v[v.length-1]}return l}function bd(i,e,t,r){for(var n=0,a=t.length;n<a;++n)i[e++]=t[n];return e}function Rn(i,e,t,r){for(var n=0,a=t.length;n<a;++n)for(var o=t[n],s=0;s<r;++s)i[e++]=o[s];return e}function Wa(i,e,t,r,n){for(var a=n||[],o=0,s=0,h=t.length;s<h;++s){var l=Rn(i,e,t[s],r);a[o++]=l,e=l}return a.length=o,a}function Ad(i,e,t,r,n){for(var a=n||[],o=0,s=0,h=t.length;s<h;++s){var l=Wa(i,e,t[s],r,a[o]);a[o++]=l,e=l[l.length-1]}return a.length=o,a}function $a(i,e,t,r,n,a,o){var s=(t-e)/r;if(s<3){for(;e<t;e+=r)a[o++]=i[e],a[o++]=i[e+1];return o}var h=new Array(s);h[0]=1,h[s-1]=1;for(var l=[e,t-r],u=0;l.length>0;){for(var f=l.pop(),c=l.pop(),d=0,v=i[c],_=i[c+1],p=i[f],y=i[f+1],g=c+r;g<f;g+=r){var m=i[g],x=i[g+1],E=fs(m,x,v,_,p,y);E>d&&(u=g,d=E)}d>n&&(h[(u-e)/r]=1,c+r<u&&l.push(c,u),u+r<f&&l.push(u,f))}for(var g=0;g<s;++g)h[g]&&(a[o++]=i[e+g*r],a[o++]=i[e+g*r+1]);return o}function Nd(i,e,t,r,n,a,o,s){for(var h=0,l=t.length;h<l;++h){var u=t[h];o=$a(i,e,u,r,n,a,o),s.push(o),e=u}return o}function ar(i,e){return e*Math.round(i/e)}function Fd(i,e,t,r,n,a,o){if(e==t)return o;var s=ar(i[e],n),h=ar(i[e+1],n);e+=r,a[o++]=s,a[o++]=h;var l,u;do if(l=ar(i[e],n),u=ar(i[e+1],n),e+=r,e==t)return a[o++]=l,a[o++]=u,o;while(l==s&&u==h);for(;e<t;){var f=ar(i[e],n),c=ar(i[e+1],n);if(e+=r,!(f==l&&c==u)){var d=l-s,v=u-h,_=f-s,p=c-h;if(d*p==v*_&&(d<0&&_<d||d==_||d>0&&_>d)&&(v<0&&p<v||v==p||v>0&&p>v)){l=f,u=c;continue}a[o++]=l,a[o++]=u,s=l,h=u,l=f,u=c}}return a[o++]=l,a[o++]=u,o}function ph(i,e,t,r,n,a,o,s){for(var h=0,l=t.length;h<l;++h){var u=t[h];o=Fd(i,e,u,r,n,a,o),s.push(o),e=u}return o}function Dd(i,e,t,r,n,a,o,s){for(var h=0,l=t.length;h<l;++h){var u=t[h],f=[];o=ph(i,e,u,r,n,a,o,f),s.push(f),e=u[u.length-1]}return o}function be(i,e,t,r,n){for(var a=n!==void 0?n:[],o=0,s=e;s<t;s+=r)a[o++]=i.slice(s,s+r);return a.length=o,a}function ci(i,e,t,r,n){for(var a=n!==void 0?n:[],o=0,s=0,h=t.length;s<h;++s){var l=t[s];a[o++]=be(i,e,l,r,a[o]),e=l}return a.length=o,a}function Va(i,e,t,r,n){for(var a=n!==void 0?n:[],o=0,s=0,h=t.length;s<h;++s){var l=t[s];a[o++]=ci(i,e,l,r,a[o]),e=l[l.length-1]}return a.length=o,a}function gh(i,e,t,r){for(var n=0,a=i[t-r],o=i[t-r+1];e<t;e+=r){var s=i[e],h=i[e+1];n+=o*s-a*h,a=s,o=h}return n/2}function yh(i,e,t,r){for(var n=0,a=0,o=t.length;a<o;++a){var s=t[a];n+=gh(i,e,s,r),e=s}return n}function Gd(i,e,t,r){for(var n=0,a=0,o=t.length;a<o;++a){var s=t[a];n+=yh(i,e,s,r),e=s[s.length-1]}return n}var Ud=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),kd=function(i){Ud(e,i);function e(t,r){var n=i.call(this)||this;return n.maxDelta_=-1,n.maxDeltaRevision_=-1,r!==void 0&&!Array.isArray(t[0])?n.setFlatCoordinates(r,t):n.setCoordinates(t,r),n}return e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,r,n,a){return a<tr(this.getExtent(),t,r)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ya(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,r,n,a))},e.prototype.getArea=function(){return gh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return be(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[];return r.length=$a(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,ht.XY)},e.prototype.getType=function(){return A.LINEAR_RING},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,r){this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Rn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(nr),mh=kd,Bd=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Xd=function(i){Bd(e,i);function e(t,r){var n=i.call(this)||this;return n.setCoordinates(t,r),n}return e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,r,n,a){var o=this.flatCoordinates,s=Ze(t,r,o[0],o[1]);if(s<a){for(var h=this.stride,l=0;l<h;++l)n[l]=o[l];return n.length=h,s}else return a},e.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.prototype.computeExtent=function(t){return _c(this.flatCoordinates,t)},e.prototype.getType=function(){return A.POINT},e.prototype.intersectsExtent=function(t){return xa(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.prototype.setCoordinates=function(t,r){this.setLayout(r,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=bd(this.flatCoordinates,0,t,this.stride),this.changed()},e}(nr),Or=Xd;function jd(i,e,t,r,n){var a=Ps(n,function(o){return!or(i,e,t,r,o[0],o[1])});return!a}function or(i,e,t,r,n,a){for(var o=0,s=i[t-r],h=i[t-r+1];e<t;e+=r){var l=i[e],u=i[e+1];h<=a?u>a&&(l-s)*(a-h)-(n-s)*(u-h)>0&&o++:u<=a&&(l-s)*(a-h)-(n-s)*(u-h)<0&&o--,s=l,h=u}return o!==0}function Ha(i,e,t,r,n,a){if(t.length===0||!or(i,e,t[0],r,n,a))return!1;for(var o=1,s=t.length;o<s;++o)if(or(i,t[o-1],t[o],r,n,a))return!1;return!0}function Yd(i,e,t,r,n,a){if(t.length===0)return!1;for(var o=0,s=t.length;o<s;++o){var h=t[o];if(Ha(i,e,h,r,n,a))return!0;e=h[h.length-1]}return!1}function xh(i,e,t,r,n,a,o){for(var s,h,l,u,f,c,d,v=n[a+1],_=[],p=0,y=t.length;p<y;++p){var g=t[p];for(u=i[g-r],c=i[g-r+1],s=e;s<g;s+=r)f=i[s],d=i[s+1],(v<=c&&d<=v||c<=v&&v<=d)&&(l=(v-c)/(d-c)*(f-u)+u,_.push(l)),u=f,c=d}var m=NaN,x=-1/0;for(_.sort(We),u=_[0],s=1,h=_.length;s<h;++s){f=_[s];var E=Math.abs(f-u);E>x&&(l=(u+f)/2,Ha(i,e,t,r,l,v)&&(m=l,x=E)),u=f}return isNaN(m)&&(m=n[a]),o?(o.push(m,v,x),o):[m,v,x]}function zd(i,e,t,r,n){for(var a=[],o=0,s=t.length;o<s;++o){var h=t[o];a=xh(i,e,h,r,n,2*o,a),e=h[h.length-1]}return a}function Eh(i,e,t,r,n){var a;for(e+=r;e<t;e+=r)if(a=n(i.slice(e-r,e),i.slice(e,e+r)),a)return a;return!1}function On(i,e,t,r,n){var a=Ls($t(),i,e,t,r);return Rt(n,a)?Se(n,a)||a[0]>=n[0]&&a[2]<=n[2]||a[1]>=n[1]&&a[3]<=n[3]?!0:Eh(i,e,t,r,function(o,s){return xc(n,o,s)}):!1}function Wd(i,e,t,r,n){for(var a=0,o=t.length;a<o;++a){if(On(i,e,t[a],r,n))return!0;e=t[a]}return!1}function $d(i,e,t,r,n){return!!(On(i,e,t,r,n)||or(i,e,t,r,n[0],n[1])||or(i,e,t,r,n[0],n[3])||or(i,e,t,r,n[2],n[1])||or(i,e,t,r,n[2],n[3]))}function Th(i,e,t,r,n){if(!$d(i,e,t[0],r,n))return!1;if(t.length===1)return!0;for(var a=1,o=t.length;a<o;++a)if(jd(i,t[a-1],t[a],r,n)&&!On(i,t[a-1],t[a],r,n))return!1;return!0}function Vd(i,e,t,r,n){for(var a=0,o=t.length;a<o;++a){var s=t[a];if(Th(i,e,s,r,n))return!0;e=s[s.length-1]}return!1}function Hd(i,e,t,r){for(;e<t-r;){for(var n=0;n<r;++n){var a=i[e+n];i[e+n]=i[t-r+n],i[t-r+n]=a}e+=r,t-=r}}function Mh(i,e,t,r){for(var n=0,a=i[t-r],o=i[t-r+1];e<t;e+=r){var s=i[e],h=i[e+1];n+=(s-a)*(h+o),a=s,o=h}return n===0?void 0:n>0}function Ch(i,e,t,r,n){for(var a=n!==void 0?n:!1,o=0,s=t.length;o<s;++o){var h=t[o],l=Mh(i,e,h,r);if(o===0){if(a&&l||!a&&!l)return!1}else if(a&&!l||!a&&l)return!1;e=h}return!0}function Kd(i,e,t,r,n){for(var a=0,o=t.length;a<o;++a){var s=t[a];if(!Ch(i,e,s,r,n))return!1;s.length&&(e=s[s.length-1])}return!0}function Ka(i,e,t,r,n){for(var a=n!==void 0?n:!1,o=0,s=t.length;o<s;++o){var h=t[o],l=Mh(i,e,h,r),u=o===0?a&&l||!a&&!l:a&&!l||!a&&l;u&&Hd(i,e,h,r),e=h}return e}function Rh(i,e,t,r,n){for(var a=0,o=t.length;a<o;++a)e=Ka(i,e,t[a],r,n);return e}var Zd=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Oh=function(i){Zd(e,i);function e(t,r,n){var a=i.call(this)||this;return a.ends_=[],a.flatInteriorPointRevision_=-1,a.flatInteriorPoint_=null,a.maxDelta_=-1,a.maxDeltaRevision_=-1,a.orientedRevision_=-1,a.orientedFlatCoordinates_=null,r!==void 0&&n?(a.setFlatCoordinates(r,t),a.ends_=n):a.setCoordinates(t,r),a}return e.prototype.appendLinearRing=function(t){this.flatCoordinates?ce(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,r,n,a){return a<tr(this.getExtent(),t,r)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ja(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),za(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,r,n,a))},e.prototype.containsXY=function(t,r){return Ha(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,r)},e.prototype.getArea=function(){return yh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var r;return t!==void 0?(r=this.getOrientedFlatCoordinates().slice(),Ka(r,0,this.ends_,this.stride,t)):r=this.flatCoordinates,ci(r,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=ee(this.getExtent());this.flatInteriorPoint_=xh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new Or(this.getFlatInteriorPoint(),ht.XYM)},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new mh(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,r=this.flatCoordinates,n=this.ends_,a=[],o=0,s=0,h=n.length;s<h;++s){var l=n[s],u=new mh(r.slice(o,l),t);a.push(u),o=l}return a},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Ch(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ka(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=ph(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),r,0,n),new e(r,ht.XY,n)},e.prototype.getType=function(){return A.POLYGON},e.prototype.intersectsExtent=function(t){return Th(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,r){this.setLayout(r,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=Wa(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()},e}(nr),Sn=Oh;function Za(i){var e=i[0],t=i[1],r=i[2],n=i[3],a=[e,t,e,n,r,n,r,t,e,t];return new Oh(a,ht.XY,[a.length])}var qd=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),qa=0,Jd=function(i){qd(e,i);function e(t){var r=i.call(this)||this;r.on,r.once,r.un;var n=vt({},t);return r.hints_=[0,0],r.animations_=[],r.updateAnimationKey_,r.projection_=Ia(n.projection,"EPSG:3857"),r.viewportSize_=[100,100],r.targetCenter_=null,r.targetResolution_,r.targetRotation_,r.nextCenter_=null,r.nextResolution_,r.nextRotation_,r.cancelAnchor_=void 0,n.center&&(n.center=_e(n.center,r.projection_)),n.extent&&(n.extent=Mr(n.extent,r.projection_)),r.applyOptions_(n),r}return e.prototype.applyOptions_=function(t){var r=vt({},t);for(var n in Vt)delete r[n];this.setProperties(r,!0);var a=tv(t);this.maxResolution_=a.maxResolution,this.minResolution_=a.minResolution,this.zoomFactor_=a.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=a.minZoom;var o=Qd(t),s=a.constraint,h=ev(t);this.constraints_={center:o,resolution:s,rotation:h},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)},Object.defineProperty(e.prototype,"padding",{get:function(){return this.padding_},set:function(t){var r=this.padding_;this.padding_=t;var n=this.getCenter();if(n){var a=t||[0,0,0,0];r=r||[0,0,0,0];var o=this.getResolution(),s=o/2*(a[3]-r[3]+r[1]-a[1]),h=o/2*(a[0]-r[0]+r[2]-a[2]);this.setCenterInternal([n[0]+s,n[1]-h])}},enumerable:!1,configurable:!0}),e.prototype.getUpdatedOptions_=function(t){var r=this.getProperties();return r.resolution!==void 0?r.resolution=this.getResolution():r.zoom=this.getZoom(),r.center=this.getCenterInternal(),r.rotation=this.getRotation(),vt({},r,t)},e.prototype.animate=function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var r=new Array(arguments.length),n=0;n<r.length;++n){var a=arguments[n];a.center&&(a=vt({},a),a.center=_e(a.center,this.getProjection())),a.anchor&&(a=vt({},a),a.anchor=_e(a.anchor,this.getProjection())),r[n]=a}this.animateInternal.apply(this,r)},e.prototype.animateInternal=function(t){var r=arguments.length,n;r>1&&typeof arguments[r-1]=="function"&&(n=arguments[r-1],--r);for(var a=0;a<r&&!this.isDef();++a){var o=arguments[a];o.center&&this.setCenterInternal(o.center),o.zoom!==void 0?this.setZoom(o.zoom):o.resolution&&this.setResolution(o.resolution),o.rotation!==void 0&&this.setRotation(o.rotation)}if(a===r){n&&wn(n,!0);return}for(var s=Date.now(),h=this.targetCenter_.slice(),l=this.targetResolution_,u=this.targetRotation_,f=[];a<r;++a){var c=arguments[a],d={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||zf,callback:n};if(c.center&&(d.sourceCenter=h,d.targetCenter=c.center.slice(),h=d.targetCenter),c.zoom!==void 0?(d.sourceResolution=l,d.targetResolution=this.getResolutionForZoom(c.zoom),l=d.targetResolution):c.resolution&&(d.sourceResolution=l,d.targetResolution=c.resolution,l=d.targetResolution),c.rotation!==void 0){d.sourceRotation=u;var v=qe(c.rotation-u+Math.PI,2*Math.PI)-Math.PI;d.targetRotation=u+v,u=d.targetRotation}rv(d)?d.complete=!0:s+=d.duration,f.push(d)}this.animations_.push(f),this.setHint(Mt.ANIMATING,1),this.updateAnimations_()},e.prototype.getAnimating=function(){return this.hints_[Mt.ANIMATING]>0},e.prototype.getInteracting=function(){return this.hints_[Mt.INTERACTING]>0},e.prototype.cancelAnimations=function(){this.setHint(Mt.ANIMATING,-this.hints_[Mt.ANIMATING]);for(var t,r=0,n=this.animations_.length;r<n;++r){var a=this.animations_[r];if(a[0].callback&&wn(a[0].callback,!1),!t)for(var o=0,s=a.length;o<s;++o){var h=a[o];if(!h.complete){t=h.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN},e.prototype.updateAnimations_=function(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!!this.getAnimating()){for(var t=Date.now(),r=!1,n=this.animations_.length-1;n>=0;--n){for(var a=this.animations_[n],o=!0,s=0,h=a.length;s<h;++s){var l=a[s];if(!l.complete){var u=t-l.start,f=l.duration>0?u/l.duration:1;f>=1?(l.complete=!0,f=1):o=!1;var c=l.easing(f);if(l.sourceCenter){var d=l.sourceCenter[0],v=l.sourceCenter[1],_=l.targetCenter[0],p=l.targetCenter[1];this.nextCenter_=l.targetCenter;var y=d+c*(_-d),g=v+c*(p-v);this.targetCenter_=[y,g]}if(l.sourceResolution&&l.targetResolution){var m=c===1?l.targetResolution:l.sourceResolution+c*(l.targetResolution-l.sourceResolution);if(l.anchor){var x=this.getViewportSize_(this.getRotation()),E=this.constraints_.resolution(m,0,x,!0);this.targetCenter_=this.calculateCenterZoom(E,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=m,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){var T=c===1?qe(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+c*(l.targetRotation-l.sourceRotation);if(l.anchor){var M=this.constraints_.rotation(T,!0);this.targetCenter_=this.calculateCenterRotate(M,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=T}if(this.applyTargetState_(!0),r=!0,!l.complete)break}}if(o){this.animations_[n]=null,this.setHint(Mt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;var C=a[0].callback;C&&wn(C,!0)}}this.animations_=this.animations_.filter(Boolean),r&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},e.prototype.calculateCenterRotate=function(t,r){var n,a=this.getCenterInternal();return a!==void 0&&(n=[a[0]-r[0],a[1]-r[1]],Ra(n,t-this.getRotation()),Tc(n,r)),n},e.prototype.calculateCenterZoom=function(t,r){var n,a=this.getCenterInternal(),o=this.getResolution();if(a!==void 0&&o!==void 0){var s=r[0]-t*(r[0]-a[0])/o,h=r[1]-t*(r[1]-a[1])/o;n=[s,h]}return n},e.prototype.getViewportSize_=function(t){var r=this.viewportSize_;if(t){var n=r[0],a=r[1];return[Math.abs(n*Math.cos(t))+Math.abs(a*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(a*Math.cos(t))]}else return r},e.prototype.setViewportSize=function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},e.prototype.getCenter=function(){var t=this.getCenterInternal();return t&&La(t,this.getProjection())},e.prototype.getCenterInternal=function(){return this.get(Vt.CENTER)},e.prototype.getConstraints=function(){return this.constraints_},e.prototype.getConstrainResolution=function(){return this.get("constrainResolution")},e.prototype.getHints=function(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},e.prototype.calculateExtent=function(t){var r=this.calculateExtentInternal(t);return zs(r,this.getProjection())},e.prototype.calculateExtentInternal=function(t){var r=t||this.getViewportSizeMinusPadding_(),n=this.getCenterInternal();z(n,1);var a=this.getResolution();z(a!==void 0,2);var o=this.getRotation();return z(o!==void 0,3),Ma(n,a,o,r)},e.prototype.getMaxResolution=function(){return this.maxResolution_},e.prototype.getMinResolution=function(){return this.minResolution_},e.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},e.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},e.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},e.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},e.prototype.setConstrainResolution=function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolution=function(){return this.get(Vt.RESOLUTION)},e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.getResolutionForExtent=function(t,r){return this.getResolutionForExtentInternal(Mr(t,this.getProjection()),r)},e.prototype.getResolutionForExtentInternal=function(t,r){var n=r||this.getViewportSizeMinusPadding_(),a=it(t)/n[0],o=Yt(t)/n[1];return Math.max(a,o)},e.prototype.getResolutionForValueFunction=function(t){var r=t||2,n=this.getConstrainedResolution(this.maxResolution_),a=this.minResolution_,o=Math.log(n/a)/Math.log(r);return function(s){var h=n/Math.pow(r,s*o);return h}},e.prototype.getRotation=function(){return this.get(Vt.ROTATION)},e.prototype.getValueForResolutionFunction=function(t){var r=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),a=this.minResolution_,o=Math.log(n/a)/r;return function(s){var h=Math.log(n/s)/r/o;return h}},e.prototype.getViewportSizeMinusPadding_=function(t){var r=this.getViewportSize_(t),n=this.padding_;return n&&(r=[r[0]-n[1]-n[3],r[1]-n[0]-n[2]]),r},e.prototype.getState=function(){var t=this.getProjection(),r=this.getResolution(),n=this.getRotation(),a=this.getCenterInternal(),o=this.padding_;if(o){var s=this.getViewportSizeMinusPadding_();a=Ja(a,this.getViewportSize_(),[s[0]/2+o[3],s[1]/2+o[0]],r,n)}return{center:a.slice(0),projection:t!==void 0?t:null,resolution:r,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}},e.prototype.getZoom=function(){var t,r=this.getResolution();return r!==void 0&&(t=this.getZoomForResolution(r)),t},e.prototype.getZoomForResolution=function(t){var r=this.minZoom_||0,n,a;if(this.resolutions_){var o=_a(this.resolutions_,t,1);r=o,n=this.resolutions_[o],o==this.resolutions_.length-1?a=2:a=n/this.resolutions_[o+1]}else n=this.maxResolution_,a=this.zoomFactor_;return r+Math.log(n/t)/Math.log(a)},e.prototype.getResolutionForZoom=function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var r=X(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[r]/this.resolutions_[r+1];return this.resolutions_[r]/Math.pow(n,X(t-r,0,1))}else return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)},e.prototype.fit=function(t,r){var n;if(z(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function",24),Array.isArray(t)){z(!ri(t),25);var a=Mr(t,this.getProjection());n=Za(a)}else if(t.getType()===A.CIRCLE){var a=Mr(t.getExtent(),this.getProjection());n=Za(a),n.rotate(this.getRotation(),ee(a))}else{var o=Ys();o?n=t.clone().transform(o,this.getProjection()):n=t}this.fitInternal(n,r)},e.prototype.rotatedExtentForGeometry=function(t){for(var r=this.getRotation(),n=Math.cos(r),a=Math.sin(-r),o=t.getFlatCoordinates(),s=t.getStride(),h=1/0,l=1/0,u=-1/0,f=-1/0,c=0,d=o.length;c<d;c+=s){var v=o[c]*n-o[c+1]*a,_=o[c]*a+o[c+1]*n;h=Math.min(h,v),l=Math.min(l,_),u=Math.max(u,v),f=Math.max(f,_)}return[h,l,u,f]},e.prototype.fitInternal=function(t,r){var n=r||{},a=n.size;a||(a=this.getViewportSizeMinusPadding_());var o=n.padding!==void 0?n.padding:[0,0,0,0],s=n.nearest!==void 0?n.nearest:!1,h;n.minResolution!==void 0?h=n.minResolution:n.maxZoom!==void 0?h=this.getResolutionForZoom(n.maxZoom):h=0;var l=this.rotatedExtentForGeometry(t),u=this.getResolutionForExtentInternal(l,[a[0]-o[1]-o[3],a[1]-o[0]-o[2]]);u=isNaN(u)?h:Math.max(u,h),u=this.getConstrainedResolution(u,s?0:1);var f=this.getRotation(),c=Math.sin(f),d=Math.cos(f),v=ee(l);v[0]+=(o[1]-o[3])/2*u,v[1]+=(o[0]-o[2])/2*u;var _=v[0]*d-v[1]*c,p=v[1]*d+v[0]*c,y=this.getConstrainedCenter([_,p],u),g=n.callback?n.callback:Ve;n.duration!==void 0?this.animateInternal({resolution:u,center:y,duration:n.duration,easing:n.easing},g):(this.targetResolution_=u,this.targetCenter_=y,this.applyTargetState_(!1,!0),wn(g,!0))},e.prototype.centerOn=function(t,r,n){this.centerOnInternal(_e(t,this.getProjection()),r,n)},e.prototype.centerOnInternal=function(t,r,n){this.setCenterInternal(Ja(t,r,n,this.getResolution(),this.getRotation()))},e.prototype.calculateCenterShift=function(t,r,n,a){var o,s=this.padding_;if(s&&t){var h=this.getViewportSizeMinusPadding_(-n),l=Ja(t,a,[h[0]/2+s[3],h[1]/2+s[0]],r,n);o=[t[0]-l[0],t[1]-l[1]]}return o},e.prototype.isDef=function(){return!!this.getCenterInternal()&&this.getResolution()!==void 0},e.prototype.adjustCenter=function(t){var r=La(this.targetCenter_,this.getProjection());this.setCenter([r[0]+t[0],r[1]+t[1]])},e.prototype.adjustCenterInternal=function(t){var r=this.targetCenter_;this.setCenterInternal([r[0]+t[0],r[1]+t[1]])},e.prototype.adjustResolution=function(t,r){var n=r&&_e(r,this.getProjection());this.adjustResolutionInternal(t,n)},e.prototype.adjustResolutionInternal=function(t,r){var n=this.getAnimating()||this.getInteracting(),a=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*t,0,a,n);r&&(this.targetCenter_=this.calculateCenterZoom(o,r)),this.targetResolution_*=t,this.applyTargetState_()},e.prototype.adjustZoom=function(t,r){this.adjustResolution(Math.pow(this.zoomFactor_,-t),r)},e.prototype.adjustRotation=function(t,r){r&&(r=_e(r,this.getProjection())),this.adjustRotationInternal(t,r)},e.prototype.adjustRotationInternal=function(t,r){var n=this.getAnimating()||this.getInteracting(),a=this.constraints_.rotation(this.targetRotation_+t,n);r&&(this.targetCenter_=this.calculateCenterRotate(a,r)),this.targetRotation_+=t,this.applyTargetState_()},e.prototype.setCenter=function(t){this.setCenterInternal(_e(t,this.getProjection()))},e.prototype.setCenterInternal=function(t){this.targetCenter_=t,this.applyTargetState_()},e.prototype.setHint=function(t,r){return this.hints_[t]+=r,this.changed(),this.hints_[t]},e.prototype.setResolution=function(t){this.targetResolution_=t,this.applyTargetState_()},e.prototype.setRotation=function(t){this.targetRotation_=t,this.applyTargetState_()},e.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},e.prototype.applyTargetState_=function(t,r){var n=this.getAnimating()||this.getInteracting()||r,a=this.constraints_.rotation(this.targetRotation_,n),o=this.getViewportSize_(a),s=this.constraints_.resolution(this.targetResolution_,0,o,n),h=this.constraints_.center(this.targetCenter_,s,o,n,this.calculateCenterShift(this.targetCenter_,s,a,o));this.get(Vt.ROTATION)!==a&&this.set(Vt.ROTATION,a),this.get(Vt.RESOLUTION)!==s&&(this.set(Vt.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),(!h||!this.get(Vt.CENTER)||!Ca(this.get(Vt.CENTER),h))&&this.set(Vt.CENTER,h),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0},e.prototype.resolveConstraints=function(t,r,n){var a=t!==void 0?t:200,o=r||0,s=this.constraints_.rotation(this.targetRotation_),h=this.getViewportSize_(s),l=this.constraints_.resolution(this.targetResolution_,o,h),u=this.constraints_.center(this.targetCenter_,l,h,!1,this.calculateCenterShift(this.targetCenter_,l,s,h));if(a===0&&!this.cancelAnchor_){this.targetResolution_=l,this.targetRotation_=s,this.targetCenter_=u,this.applyTargetState_();return}var f=n||(a===0?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,(this.getResolution()!==l||this.getRotation()!==s||!this.getCenterInternal()||!Ca(this.getCenterInternal(),u))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:u,resolution:l,duration:a,easing:Je,anchor:f}))},e.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(Mt.INTERACTING,1)},e.prototype.endInteraction=function(t,r,n){var a=n&&_e(n,this.getProjection());this.endInteractionInternal(t,r,a)},e.prototype.endInteractionInternal=function(t,r,n){this.setHint(Mt.INTERACTING,-1),this.resolveConstraints(t,r,n)},e.prototype.getConstrainedCenter=function(t,r){var n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,r||this.getResolution(),n)},e.prototype.getConstrainedZoom=function(t,r){var n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,r))},e.prototype.getConstrainedResolution=function(t,r){var n=r||0,a=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,n,a)},e}(Zt);function wn(i,e){setTimeout(function(){i(e)},0)}function Qd(i){if(i.extent!==void 0){var e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return hh(i.extent,i.constrainOnlyCenter,e)}var t=Ia(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){var r=t.getExtent().slice();return r[0]=-1/0,r[2]=1/0,hh(r,!1,!1)}return gd}function tv(i){var e,t,r,n=28,a=2,o=i.minZoom!==void 0?i.minZoom:qa,s=i.maxZoom!==void 0?i.maxZoom:n,h=i.zoomFactor!==void 0?i.zoomFactor:a,l=i.multiWorld!==void 0?i.multiWorld:!1,u=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,f=i.showFullExtent!==void 0?i.showFullExtent:!1,c=Ia(i.projection,"EPSG:3857"),d=c.getExtent(),v=i.constrainOnlyCenter,_=i.extent;if(!l&&!_&&c.isGlobal()&&(v=!1,_=d),i.resolutions!==void 0){var p=i.resolutions;t=p[o],r=p[s]!==void 0?p[s]:p[p.length-1],i.constrainResolution?e=yd(p,u,!v&&_,f):e=lh(t,r,u,!v&&_,f)}else{var y=d?Math.max(it(d),Yt(d)):360*Jt[Qt.DEGREES]/c.getMetersPerUnit(),g=y/Ga/Math.pow(a,qa),m=g/Math.pow(a,n-qa);t=i.maxResolution,t!==void 0?o=0:t=g/Math.pow(h,o),r=i.minResolution,r===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?r=t/Math.pow(h,s):r=g/Math.pow(h,s):r=m),s=o+Math.floor(Math.log(t/r)/Math.log(h)),r=t/Math.pow(h,s-o),i.constrainResolution?e=md(h,t,r,u,!v&&_,f):e=lh(t,r,u,!v&&_,f)}return{constraint:e,maxResolution:t,minResolution:r,minZoom:o,zoomFactor:h}}function ev(i){var e=i.enableRotation!==void 0?i.enableRotation:!0;if(e){var t=i.constrainRotation;return t===void 0||t===!0?Ed():t===!1?uh:typeof t=="number"?xd(t):uh}else return Ba}function rv(i){return!(i.sourceCenter&&i.targetCenter&&!Ca(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function Ja(i,e,t,r,n){var a=Math.cos(-n),o=Math.sin(-n),s=i[0]*a-i[1]*o,h=i[1]*a+i[0]*o;s+=(e[0]/2-t[0])*r,h+=(t[1]-e[1]/2)*r,o=-o;var l=s*a-h*o,u=h*a+s*o;return[l,u]}var Ae=Jd;function Sh(i){return i[0]>0&&i[1]>0}function iv(i,e,t){return t===void 0&&(t=[0,0]),t[0]=i[0]*e+.5|0,t[1]=i[1]*e+.5|0,t}function At(i,e){return Array.isArray(i)?i:(e===void 0?e=[i,i]:(e[0]=i,e[1]=i),e)}var nv=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function wh(i){if(i instanceof fn){i.setMapInternal(null);return}i instanceof Tn&&i.getLayers().forEach(wh)}function Ih(i,e){if(i instanceof fn){i.setMapInternal(e);return}if(i instanceof Tn)for(var t=i.getLayers().getArray(),r=0,n=t.length;r<n;++r)Ih(t[r],e)}var av=function(i){nv(e,i);function e(t){var r=i.call(this)||this;r.on,r.once,r.un;var n=ov(t);r.renderComplete_,r.boundHandleBrowserEvent_=r.handleBrowserEvent.bind(r),r.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,r.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:is,r.postRenderTimeoutHandle_,r.animationDelayKey_,r.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(r),r.coordinateToPixelTransform_=bt(),r.pixelToCoordinateTransform_=bt(),r.frameIndex_=0,r.frameState_=null,r.previousExtent_=null,r.viewPropertyListenerKey_=null,r.viewChangeListenerKey_=null,r.layerGroupPropertyListenerKeys_=null,r.viewport_=document.createElement("div"),r.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),r.viewport_.style.position="relative",r.viewport_.style.overflow="hidden",r.viewport_.style.width="100%",r.viewport_.style.height="100%",r.overlayContainer_=document.createElement("div"),r.overlayContainer_.style.position="absolute",r.overlayContainer_.style.zIndex="0",r.overlayContainer_.style.width="100%",r.overlayContainer_.style.height="100%",r.overlayContainer_.style.pointerEvents="none",r.overlayContainer_.className="ol-overlaycontainer",r.viewport_.appendChild(r.overlayContainer_),r.overlayContainerStopEvent_=document.createElement("div"),r.overlayContainerStopEvent_.style.position="absolute",r.overlayContainerStopEvent_.style.zIndex="0",r.overlayContainerStopEvent_.style.width="100%",r.overlayContainerStopEvent_.style.height="100%",r.overlayContainerStopEvent_.style.pointerEvents="none",r.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",r.viewport_.appendChild(r.overlayContainerStopEvent_),r.mapBrowserEventHandler_=null,r.moveTolerance_=t.moveTolerance,r.keyboardEventTarget_=n.keyboardEventTarget,r.targetChangeHandlerKeys_=null,r.controls=n.controls||new Ut,r.interactions=n.interactions||new Ut,r.overlays_=n.overlays,r.overlayIdIndex_={},r.renderer_=null,r.postRenderFunctions_=[],r.tileQueue_=new vd(r.getTilePriority.bind(r),r.handleTileChange_.bind(r)),r.addChangeListener(yt.LAYERGROUP,r.handleLayerGroupChanged_),r.addChangeListener(yt.VIEW,r.handleViewChanged_),r.addChangeListener(yt.SIZE,r.handleSizeChanged_),r.addChangeListener(yt.TARGET,r.handleTargetChanged_),r.setProperties(n.values);var a=r;return t.view&&!(t.view instanceof Ae)&&t.view.then(function(o){a.setView(new Ae(o))}),r.controls.addEventListener(Pt.ADD,function(o){o.element.setMap(this)}.bind(r)),r.controls.addEventListener(Pt.REMOVE,function(o){o.element.setMap(null)}.bind(r)),r.interactions.addEventListener(Pt.ADD,function(o){o.element.setMap(this)}.bind(r)),r.interactions.addEventListener(Pt.REMOVE,function(o){o.element.setMap(null)}.bind(r)),r.overlays_.addEventListener(Pt.ADD,function(o){this.addOverlayInternal_(o.element)}.bind(r)),r.overlays_.addEventListener(Pt.REMOVE,function(o){var s=o.element,h=s.getId();h!==void 0&&delete this.overlayIdIndex_[h.toString()],o.element.setMap(null)}.bind(r)),r.controls.forEach(function(o){o.setMap(this)}.bind(r)),r.interactions.forEach(function(o){o.setMap(this)}.bind(r)),r.overlays_.forEach(r.addOverlayInternal_.bind(r)),r}return e.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},e.prototype.addControl=function(t){this.getControls().push(t)},e.prototype.addInteraction=function(t){this.getInteractions().push(t)},e.prototype.addLayer=function(t){var r=this.getLayerGroup().getLayers();r.push(t)},e.prototype.handleLayerAdd_=function(t){Ih(t.layer,this)},e.prototype.addOverlay=function(t){this.getOverlays().push(t)},e.prototype.addOverlayInternal_=function(t){var r=t.getId();r!==void 0&&(this.overlayIdIndex_[r.toString()]=t),t.setMap(this)},e.prototype.disposeInternal=function(){this.setTarget(null),i.prototype.disposeInternal.call(this)},e.prototype.forEachFeatureAtPixel=function(t,r,n){if(!!this.frameState_){var a=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};var o=n.hitTolerance!==void 0?n.hitTolerance:0,s=n.layerFilter!==void 0?n.layerFilter:cr,h=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(a,this.frameState_,o,h,r,null,s,null)}},e.prototype.getFeaturesAtPixel=function(t,r){var n=[];return this.forEachFeatureAtPixel(t,function(a){n.push(a)},r),n},e.prototype.getAllLayers=function(){var t=[];function r(n){n.forEach(function(a){a instanceof Tn?r(a.getLayers()):t.push(a)})}return r(this.getLayers()),t},e.prototype.forEachLayerAtPixel=function(t,r,n){if(!!this.frameState_){var a=n||{},o=a.hitTolerance!==void 0?a.hitTolerance:0,s=a.layerFilter||cr;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,o,r,s)}},e.prototype.hasFeatureAtPixel=function(t,r){if(!this.frameState_)return!1;var n=this.getCoordinateFromPixelInternal(t);r=r!==void 0?r:{};var a=r.layerFilter!==void 0?r.layerFilter:cr,o=r.hitTolerance!==void 0?r.hitTolerance:0,s=r.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,o,s,a,null)},e.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},e.prototype.getEventCoordinateInternal=function(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))},e.prototype.getEventPixel=function(t){var r=this.viewport_.getBoundingClientRect(),n="changedTouches"in t?t.changedTouches[0]:t;return[n.clientX-r.left,n.clientY-r.top]},e.prototype.getTarget=function(){return this.get(yt.TARGET)},e.prototype.getTargetElement=function(){var t=this.getTarget();return t!==void 0?typeof t=="string"?document.getElementById(t):t:null},e.prototype.getCoordinateFromPixel=function(t){return La(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())},e.prototype.getCoordinateFromPixelInternal=function(t){var r=this.frameState_;return r?pt(r.pixelToCoordinateTransform,t.slice()):null},e.prototype.getControls=function(){return this.controls},e.prototype.getOverlays=function(){return this.overlays_},e.prototype.getOverlayById=function(t){var r=this.overlayIdIndex_[t.toString()];return r!==void 0?r:null},e.prototype.getInteractions=function(){return this.interactions},e.prototype.getLayerGroup=function(){return this.get(yt.LAYERGROUP)},e.prototype.setLayers=function(t){var r=this.getLayerGroup();if(t instanceof Ut){r.setLayers(t);return}var n=r.getLayers();n.clear(),n.extend(t)},e.prototype.getLayers=function(){var t=this.getLayerGroup().getLayers();return t},e.prototype.getLoading=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),r=0,n=t.length;r<n;++r){var a=t[r].layer,o=a.getSource();if(o&&o.loading)return!0}return!1},e.prototype.getPixelFromCoordinate=function(t){var r=_e(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(r)},e.prototype.getPixelFromCoordinateInternal=function(t){var r=this.frameState_;return r?pt(r.coordinateToPixelTransform,t.slice(0,2)):null},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.getSize=function(){return this.get(yt.SIZE)},e.prototype.getView=function(){return this.get(yt.VIEW)},e.prototype.getViewport=function(){return this.viewport_},e.prototype.getOverlayContainer=function(){return this.overlayContainer_},e.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},e.prototype.getOwnerDocument=function(){var t=this.getTargetElement();return t?t.ownerDocument:document},e.prototype.getTilePriority=function(t,r,n,a){return _d(this.frameState_,t,r,n,a)},e.prototype.handleBrowserEvent=function(t,r){var n=r||t.type,a=new Pe(n,this,t);this.handleMapBrowserEvent(a)},e.prototype.handleMapBrowserEvent=function(t){if(!!this.frameState_){var r=t.originalEvent,n=r.type;if(n===qt.POINTERDOWN||n===D.WHEEL||n===D.KEYDOWN){var a=this.getOwnerDocument(),o=this.viewport_.getRootNode?this.viewport_.getRootNode():a,s=r.target;if(this.overlayContainerStopEvent_.contains(s)||!(o===a?a.documentElement:o).contains(s))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1)for(var h=this.getInteractions().getArray().slice(),l=h.length-1;l>=0;l--){var u=h[l];if(!(u.getMap()!==this||!u.getActive()||!this.getTargetElement())){var f=u.handleEvent(t);if(!f||t.propagationStopped)break}}}},e.prototype.handlePostRender=function(){var t=this.frameState_,r=this.tileQueue_;if(!r.isEmpty()){var n=this.maxTilesLoading_,a=n;if(t){var o=t.viewHints;if(o[Mt.ANIMATING]||o[Mt.INTERACTING]){var s=Date.now()-t.time>8;n=s?0:8,a=s?0:2}}r.getTilesLoading()<n&&(r.reprioritize(),r.loadMoreTiles(n,a))}t&&this.hasListener(Lt.RENDERCOMPLETE)&&!t.animate&&this.renderComplete_&&this.renderer_.dispatchRenderEvent(Lt.RENDERCOMPLETE,t);for(var h=this.postRenderFunctions_,l=0,u=h.length;l<u;++l)h[l](this,t);h.length=0},e.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},e.prototype.handleTargetChanged_=function(){if(this.mapBrowserEventHandler_){for(var t=0,r=this.targetChangeHandlerKeys_.length;t<r;++t)at(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(D.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(D.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,pa(this.viewport_)}var n=this.getTargetElement();if(!n)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{n.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new ld(this,this.moveTolerance_);for(var a in st)this.mapBrowserEventHandler_.addEventListener(st[a],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(D.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(D.WHEEL,this.boundHandleBrowserEvent_,ns?{passive:!1}:!1);var o=this.getOwnerDocument().defaultView,s=this.keyboardEventTarget_?this.keyboardEventTarget_:n;this.targetChangeHandlerKeys_=[Y(s,D.KEYDOWN,this.handleBrowserEvent,this),Y(s,D.KEYPRESS,this.handleBrowserEvent,this),Y(o,D.RESIZE,this.updateSize,this)]}this.updateSize()},e.prototype.handleTileChange_=function(){this.render()},e.prototype.handleViewPropertyChanged_=function(){this.render()},e.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(at(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(at(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=Y(t,fr.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Y(t,D.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()},e.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(at),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Le("addlayer",t)),this.layerGroupPropertyListenerKeys_=[Y(t,fr.PROPERTYCHANGE,this.render,this),Y(t,D.CHANGE,this.render,this),Y(t,"addlayer",this.handleLayerAdd_,this),Y(t,"removelayer",this.handleLayerRemove_,this)]),this.render()},e.prototype.isRendered=function(){return!!this.frameState_},e.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},e.prototype.redrawText=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),r=0,n=t.length;r<n;++r){var a=t[r].layer;a.hasRenderer()&&a.getRenderer().handleFontsChanged()}},e.prototype.render=function(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},e.prototype.removeControl=function(t){return this.getControls().remove(t)},e.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},e.prototype.removeLayer=function(t){var r=this.getLayerGroup().getLayers();return r.remove(t)},e.prototype.handleLayerRemove_=function(t){wh(t.layer)},e.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},e.prototype.renderFrame_=function(t){var r=this,n=this.getSize(),a=this.getView(),o=this.frameState_,s=null;if(n!==void 0&&Sh(n)&&a&&a.isDef()){var h=a.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=a.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Ma(l.center,l.resolution,l.rotation,n),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:n,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:l,viewHints:h,wantedTiles:{},mapId:tt(this),renderTargets:{}},l.nextCenter&&l.nextResolution){var u=isNaN(l.nextRotation)?l.rotation:l.nextRotation;s.nextExtent=Ma(l.nextCenter,l.nextResolution,u,n)}}if(this.frameState_=s,this.renderer_.renderFrame(s),s){if(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),o){var f=!this.previousExtent_||!ri(this.previousExtent_)&&!ti(s.extent,this.previousExtent_);f&&(this.dispatchEvent(new Mn(rn.MOVESTART,this,o)),this.previousExtent_=Qr(this.previousExtent_))}var c=this.previousExtent_&&!s.viewHints[Mt.ANIMATING]&&!s.viewHints[Mt.INTERACTING]&&!ti(s.extent,this.previousExtent_);c&&(this.dispatchEvent(new Mn(rn.MOVEEND,this,s)),Ss(s.extent,this.previousExtent_))}this.dispatchEvent(new Mn(rn.POSTRENDER,this,s)),this.renderComplete_=!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoading(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(function(){r.postRenderTimeoutHandle_=void 0,r.handlePostRender()},0))},e.prototype.setLayerGroup=function(t){var r=this.getLayerGroup();r&&this.handleLayerRemove_(new Le("removelayer",r)),this.set(yt.LAYERGROUP,t)},e.prototype.setSize=function(t){this.set(yt.SIZE,t)},e.prototype.setTarget=function(t){this.set(yt.TARGET,t)},e.prototype.setView=function(t){if(!t||t instanceof Ae){this.set(yt.VIEW,t);return}this.set(yt.VIEW,new Ae);var r=this;t.then(function(n){r.setView(new Ae(n))})},e.prototype.updateSize=function(){var t=this.getTargetElement(),r=void 0;if(t){var n=getComputedStyle(t),a=t.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),o=t.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(a)&&!isNaN(o)&&(r=[a,o],!Sh(r)&&!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(r),this.updateViewportSize_()},e.prototype.updateViewportSize_=function(){var t=this.getView();if(t){var r=void 0,n=getComputedStyle(this.viewport_);n.width&&n.height&&(r=[parseInt(n.width,10),parseInt(n.height,10)]),t.setViewportSize(r)}},e}(Zt);function ov(i){var e=null;i.keyboardEventTarget!==void 0&&(e=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);var t={},r=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new Tn({layers:i.layers});t[yt.LAYERGROUP]=r,t[yt.TARGET]=i.target,t[yt.VIEW]=i.view instanceof Ae?i.view:new Ae;var n;i.controls!==void 0&&(Array.isArray(i.controls)?n=new Ut(i.controls.slice()):(z(typeof i.controls.getArray=="function",47),n=i.controls));var a;i.interactions!==void 0&&(Array.isArray(i.interactions)?a=new Ut(i.interactions.slice()):(z(typeof i.interactions.getArray=="function",48),a=i.interactions));var o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new Ut(i.overlays.slice()):(z(typeof i.overlays.getArray=="function",49),o=i.overlays):o=new Ut,{controls:n,interactions:a,keyboardEventTarget:e,overlays:o,values:t}}var sv=av,hv=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),di={VERTICAL:0,HORIZONTAL:1},lv=function(i){hv(e,i);function e(t){var r=this,n=t||{};r=i.call(this,{element:document.createElement("div"),render:n.render})||this,r.dragListenerKeys_=[],r.currentResolution_=void 0,r.direction_=di.VERTICAL,r.dragging_,r.heightLimit_=0,r.widthLimit_=0,r.startX_,r.startY_,r.thumbSize_=null,r.sliderInitialized_=!1,r.duration_=n.duration!==void 0?n.duration:200;var a=n.className!==void 0?n.className:"ol-zoomslider",o=document.createElement("button");o.setAttribute("type","button"),o.className=a+"-thumb "+Re;var s=r.element;return s.className=a+" "+Re+" "+pr,s.appendChild(o),s.addEventListener(qt.POINTERDOWN,r.handleDraggerStart_.bind(r),!1),s.addEventListener(qt.POINTERMOVE,r.handleDraggerDrag_.bind(r),!1),s.addEventListener(qt.POINTERUP,r.handleDraggerEnd_.bind(r),!1),s.addEventListener(D.CLICK,r.handleContainerClick_.bind(r),!1),o.addEventListener(D.CLICK,lf,!1),r}return e.prototype.setMap=function(t){i.prototype.setMap.call(this,t),t&&t.render()},e.prototype.initSlider_=function(){var t=this.element,r=t.offsetWidth,n=t.offsetHeight;if(r===0&&n===0)return this.sliderInitialized_=!1;var a=getComputedStyle(t);r-=parseFloat(a.paddingRight)+parseFloat(a.paddingLeft),n-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom);var o=t.firstElementChild,s=getComputedStyle(o),h=o.offsetWidth+parseFloat(s.marginRight)+parseFloat(s.marginLeft),l=o.offsetHeight+parseFloat(s.marginTop)+parseFloat(s.marginBottom);return this.thumbSize_=[h,l],r>n?(this.direction_=di.HORIZONTAL,this.widthLimit_=r-h):(this.direction_=di.VERTICAL,this.heightLimit_=n-l),this.sliderInitialized_=!0},e.prototype.handleContainerClick_=function(t){var r=this.getMap().getView(),n=this.getRelativePosition_(t.offsetX-this.thumbSize_[0]/2,t.offsetY-this.thumbSize_[1]/2),a=this.getResolutionForPosition_(n),o=r.getConstrainedZoom(r.getZoomForResolution(a));r.animateInternal({zoom:o,duration:this.duration_,easing:Je})},e.prototype.handleDraggerStart_=function(t){if(!this.dragging_&&t.target===this.element.firstElementChild){var r=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=t.clientX-parseFloat(r.style.left),this.startY_=t.clientY-parseFloat(r.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){var n=this.handleDraggerDrag_,a=this.handleDraggerEnd_,o=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(Y(o,qt.POINTERMOVE,n,this),Y(o,qt.POINTERUP,a,this))}}},e.prototype.handleDraggerDrag_=function(t){if(this.dragging_){var r=t.clientX-this.startX_,n=t.clientY-this.startY_,a=this.getRelativePosition_(r,n);this.currentResolution_=this.getResolutionForPosition_(a),this.getMap().getView().setResolution(this.currentResolution_)}},e.prototype.handleDraggerEnd_=function(t){if(this.dragging_){var r=this.getMap().getView();r.endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(at),this.dragListenerKeys_.length=0}},e.prototype.setThumbPosition_=function(t){var r=this.getPositionForResolution_(t),n=this.element.firstElementChild;this.direction_==di.HORIZONTAL?n.style.left=this.widthLimit_*r+"px":n.style.top=this.heightLimit_*r+"px"},e.prototype.getRelativePosition_=function(t,r){var n;return this.direction_===di.HORIZONTAL?n=t/this.widthLimit_:n=r/this.heightLimit_,X(n,0,1)},e.prototype.getResolutionForPosition_=function(t){var r=this.getMap().getView().getResolutionForValueFunction();return r(1-t)},e.prototype.getPositionForResolution_=function(t){var r=this.getMap().getView().getValueForResolutionFunction();return X(1-r(t),0,1)},e.prototype.render=function(t){if(!!t.frameState&&!(!this.sliderInitialized_&&!this.initSlider_())){var r=t.frameState.viewState.resolution;this.currentResolution_=r,this.setThumbPosition_(r)}},e}(Ke),uv=lv,fv=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),cv=function(i){fv(e,i);function e(t){var r=this,n=t||{};r=i.call(this,{element:document.createElement("div"),target:n.target})||this,r.extent=n.extent?n.extent:null;var a=n.className!==void 0?n.className:"ol-zoom-extent",o=n.label!==void 0?n.label:"E",s=n.tipLabel!==void 0?n.tipLabel:"Fit to extent",h=document.createElement("button");h.setAttribute("type","button"),h.title=s,h.appendChild(typeof o=="string"?document.createTextNode(o):o),h.addEventListener(D.CLICK,r.handleClick_.bind(r),!1);var l=a+" "+Re+" "+pr,u=r.element;return u.className=l,u.appendChild(h),r}return e.prototype.handleClick_=function(t){t.preventDefault(),this.handleZoomToExtent()},e.prototype.handleZoomToExtent=function(){var t=this.getMap(),r=t.getView(),n=this.extent?this.extent:r.getProjection().getExtent();r.fitInternal(Za(n))},e}(Ke),dv=cv;function Lh(i){var e=i||{},t=new Ut,r=e.zoom!==void 0?e.zoom:!0;r&&t.push(new qf(e.zoomOptions));var n=e.rotate!==void 0?e.rotate:!0;n&&t.push(new Hf(e.rotateOptions));var a=e.attribution!==void 0?e.attribution:!0;return a&&t.push(new jf(e.attributionOptions)),t}var vv=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),_v=function(i){vv(e,i);function e(t){var r=i.call(this)||this;if(r.on,r.once,r.un,r.id_=void 0,r.geometryName_="geometry",r.style_=null,r.styleFunction_=void 0,r.geometryChangeKey_=null,r.addChangeListener(r.geometryName_,r.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){var n=t;r.setGeometry(n)}else{var a=t;r.setProperties(a)}return r}return e.prototype.clone=function(){var t=new e(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var r=this.getGeometry();r&&t.setGeometry(r.clone());var n=this.getStyle();return n&&t.setStyle(n),t},e.prototype.getGeometry=function(){return this.get(this.geometryName_)},e.prototype.getId=function(){return this.id_},e.prototype.getGeometryName=function(){return this.geometryName_},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.handleGeometryChange_=function(){this.changed()},e.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(at(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=Y(t,D.CHANGE,this.handleGeometryChange_,this)),this.changed()},e.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},e.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?pv(t):void 0,this.changed()},e.prototype.setId=function(t){this.id_=t,this.changed()},e.prototype.setGeometryName=function(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},e}(Zt);function pv(i){if(typeof i=="function")return i;var e;if(Array.isArray(i))e=i;else{z(typeof i.getZIndex=="function",41);var t=i;e=[t]}return function(){return e}}var Ph=_v,gv=function(){function i(e){var t=e||{};this.color_=t.color!==void 0?t.color:null}return i.prototype.clone=function(){var e=this.getColor();return new i({color:Array.isArray(e)?e.slice():e||void 0})},i.prototype.getColor=function(){return this.color_},i.prototype.setColor=function(e){this.color_=e},i}(),vi=gv;function bh(i,e,t,r,n,a,o){var s,h,l=(t-e)/r;if(l===1)s=e;else if(l===2)s=e,h=n;else if(l!==0){for(var u=i[e],f=i[e+1],c=0,d=[0],v=e+r;v<t;v+=r){var _=i[v],p=i[v+1];c+=Math.sqrt((_-u)*(_-u)+(p-f)*(p-f)),d.push(c),u=_,f=p}var y=n*c,g=ff(d,y);g<0?(h=(y-d[-g-2])/(d[-g-1]-d[-g-2]),s=e+(-g-2)*r):s=e+g*r}for(var m=o>1?o:2,x=a||new Array(m),v=0;v<m;++v)x[v]=s===void 0?NaN:h===void 0?i[s+v]:de(i[s+v],i[s+r+v],h);return x}function Qa(i,e,t,r,n,a){if(t==e)return null;var o;if(n<i[e+r-1])return a?(o=i.slice(e,e+r),o[r-1]=n,o):null;if(i[t-1]<n)return a?(o=i.slice(t-r,t),o[r-1]=n,o):null;if(n==i[e+r-1])return i.slice(e,e+r);for(var s=e/r,h=t/r;s<h;){var l=s+h>>1;n<i[(l+1)*r-1]?h=l:s=l+1}var u=i[s*r-1];if(n==u)return i.slice((s-1)*r,(s-1)*r+r);var f=i[(s+1)*r-1],c=(n-u)/(f-u);o=[];for(var d=0;d<r-1;++d)o.push(de(i[(s-1)*r+d],i[s*r+d],c));return o.push(n),o}function yv(i,e,t,r,n,a,o){if(o)return Qa(i,e,t[t.length-1],r,n,a);var s;if(n<i[r-1])return a?(s=i.slice(0,r),s[r-1]=n,s):null;if(i[i.length-1]<n)return a?(s=i.slice(i.length-r),s[r-1]=n,s):null;for(var h=0,l=t.length;h<l;++h){var u=t[h];if(e!=u){if(n<i[e+r-1])return null;if(n<=i[u-1])return Qa(i,e,u,r,n,!1);e=u}}return null}function Ah(i,e,t,r){for(var n=i[e],a=i[e+1],o=0,s=e+r;s<t;s+=r){var h=i[s],l=i[s+1];o+=Math.sqrt((h-n)*(h-n)+(l-a)*(l-a)),n=h,a=l}return o}var mv=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),xv=function(i){mv(e,i);function e(t,r){var n=i.call(this)||this;return n.flatMidpoint_=null,n.flatMidpointRevision_=-1,n.maxDelta_=-1,n.maxDeltaRevision_=-1,r!==void 0&&!Array.isArray(t[0])?n.setFlatCoordinates(r,t):n.setCoordinates(t,r),n}return e.prototype.appendCoordinate=function(t){this.flatCoordinates?ce(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,r,n,a){return a<tr(this.getExtent(),t,r)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ya(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,r,n,a))},e.prototype.forEachSegment=function(t){return Eh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,r){if(this.layout!=ht.XYM&&this.layout!=ht.XYZM)return null;var n=r!==void 0?r:!1;return Qa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n)},e.prototype.getCoordinates=function(){return be(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,r){return bh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,this.stride)},e.prototype.getLength=function(){return Ah(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[];return r.length=$a(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,ht.XY)},e.prototype.getType=function(){return A.LINE_STRING},e.prototype.intersectsExtent=function(t){return On(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,r){this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Rn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(nr),_i=xv,Ev=function(){function i(e){var t=e||{};this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}return i.prototype.clone=function(){var e=this.getColor();return new i({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},i.prototype.getColor=function(){return this.color_},i.prototype.getLineCap=function(){return this.lineCap_},i.prototype.getLineDash=function(){return this.lineDash_},i.prototype.getLineDashOffset=function(){return this.lineDashOffset_},i.prototype.getLineJoin=function(){return this.lineJoin_},i.prototype.getMiterLimit=function(){return this.miterLimit_},i.prototype.getWidth=function(){return this.width_},i.prototype.setColor=function(e){this.color_=e},i.prototype.setLineCap=function(e){this.lineCap_=e},i.prototype.setLineDash=function(e){this.lineDash_=e},i.prototype.setLineDashOffset=function(e){this.lineDashOffset_=e},i.prototype.setLineJoin=function(e){this.lineJoin_=e},i.prototype.setMiterLimit=function(e){this.miterLimit_=e},i.prototype.setWidth=function(e){this.width_=e},i}(),Sr=Ev,ot={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},Tv=function(){function i(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=At(e.scale),this.displacement_=e.displacement}return i.prototype.clone=function(){var e=this.getScale();return new i({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},i.prototype.getOpacity=function(){return this.opacity_},i.prototype.getRotateWithView=function(){return this.rotateWithView_},i.prototype.getRotation=function(){return this.rotation_},i.prototype.getScale=function(){return this.scale_},i.prototype.getScaleArray=function(){return this.scaleArray_},i.prototype.getDisplacement=function(){return this.displacement_},i.prototype.getAnchor=function(){return G()},i.prototype.getImage=function(e){return G()},i.prototype.getHitDetectionImage=function(){return G()},i.prototype.getPixelRatio=function(e){return 1},i.prototype.getImageState=function(){return G()},i.prototype.getImageSize=function(){return G()},i.prototype.getOrigin=function(){return G()},i.prototype.getSize=function(){return G()},i.prototype.setDisplacement=function(e){this.displacement_=e},i.prototype.setOpacity=function(e){this.opacity_=e},i.prototype.setRotateWithView=function(e){this.rotateWithView_=e},i.prototype.setRotation=function(e){this.rotation_=e},i.prototype.setScale=function(e){this.scale_=e,this.scaleArray_=At(e)},i.prototype.listenImageChange=function(e){G()},i.prototype.load=function(){G()},i.prototype.unlistenImageChange=function(e){G()},i}(),Nh=Tv;function ie(i){return Array.isArray(i)?rh(i):i}var Mv=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Cv=function(i){Mv(e,i);function e(t){var r=this,n=t.rotateWithView!==void 0?t.rotateWithView:!1;return r=i.call(this,{opacity:1,rotateWithView:n,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0]})||this,r.canvas_=void 0,r.hitDetectionCanvas_=null,r.fill_=t.fill!==void 0?t.fill:null,r.origin_=[0,0],r.points_=t.points,r.radius_=t.radius!==void 0?t.radius:t.radius1,r.radius2_=t.radius2,r.angle_=t.angle!==void 0?t.angle:0,r.stroke_=t.stroke!==void 0?t.stroke:null,r.size_=null,r.renderOptions_=null,r.render(),r}return e.prototype.clone=function(){var t=this.getScale(),r=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice()});return r.setOpacity(this.getOpacity()),r},e.prototype.getAnchor=function(){var t=this.size_;if(!t)return null;var r=this.getDisplacement();return[t[0]/2-r[0],t[1]/2+r[1]]},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},e.prototype.getImage=function(t){var r=this.canvas_[t];if(!r){var n=this.renderOptions_,a=jt(n.size*t,n.size*t);this.draw_(n,a,t),r=a.canvas,this.canvas_[t]=r}return r},e.prototype.getPixelRatio=function(t){return t},e.prototype.getImageSize=function(){return this.size_},e.prototype.getImageState=function(){return ot.LOADED},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.listenImageChange=function(t){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t){},e.prototype.calculateLineJoinSize_=function(t,r,n){if(r===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return r;var a=this.radius_,o=this.radius2_===void 0?a:this.radius2_;if(a<o){var s=a;a=o,o=s}var h=this.radius2_===void 0?this.points_:this.points_*2,l=2*Math.PI/h,u=o*Math.sin(l),f=Math.sqrt(o*o-u*u),c=a-f,d=Math.sqrt(u*u+c*c),v=d/u;if(t==="miter"&&v<=n)return v*r;var _=r/2/v,p=r/2*(c/d),y=Math.sqrt((a+_)*(a+_)+p*p),g=y-a;if(this.radius2_===void 0||t==="bevel")return g*2;var m=a*Math.sin(l),x=Math.sqrt(a*a-m*m),E=o-x,T=Math.sqrt(m*m+E*E),M=T/m;if(M<=n){var C=M*r/2-o-a;return 2*Math.max(g,C)}return g*2},e.prototype.createRenderOptions=function(){var t=Cr,r=0,n=null,a=0,o,s=0;this.stroke_&&(o=this.stroke_.getColor(),o===null&&(o=li),o=ie(o),s=this.stroke_.getWidth(),s===void 0&&(s=fi),n=this.stroke_.getLineDash(),a=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=Cr),r=this.stroke_.getMiterLimit(),r===void 0&&(r=hi));var h=this.calculateLineJoinSize_(t,s,r),l=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*l+h);return{strokeStyle:o,strokeWidth:s,size:u,lineDash:n,lineDashOffset:a,lineJoin:t,miterLimit:r}},e.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]},e.prototype.draw_=function(t,r,n){if(r.scale(n,n),r.translate(t.size/2,t.size/2),this.createPath_(r),this.fill_){var a=this.fill_.getColor();a===null&&(a=pe),r.fillStyle=ie(a),r.fill()}this.stroke_&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.strokeWidth,r.setLineDash&&t.lineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit,r.stroke())},e.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var r=this.fill_.getColor(),n=0;if(typeof r=="string"&&(r=ni(r)),r===null?n=1:Array.isArray(r)&&(n=r.length===4?r[3]:1),n===0){var a=jt(t.size,t.size);this.hitDetectionCanvas_=a.canvas,this.drawHitDetectionCanvas_(t,a)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},e.prototype.createPath_=function(t){var r=this.points_,n=this.radius_;if(r===1/0)t.arc(0,0,n,0,2*Math.PI);else{var a=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(r*=2);for(var o=this.angle_-Math.PI/2,s=2*Math.PI/r,h=0;h<r;h++){var l=o+h*s,u=h%2==0?n:a;t.lineTo(u*Math.cos(l),u*Math.sin(l))}t.closePath()}},e.prototype.drawHitDetectionCanvas_=function(t,r){r.translate(t.size/2,t.size/2),this.createPath_(r),r.fillStyle=pe,r.fill(),this.stroke_&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.strokeWidth,t.lineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit,r.stroke())},e}(Nh),Rv=Cv,Ov=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Sv=function(i){Ov(e,i);function e(t){var r=this,n=t||{};return r=i.call(this,{points:1/0,fill:n.fill,radius:n.radius,stroke:n.stroke,scale:n.scale!==void 0?n.scale:1,rotation:n.rotation!==void 0?n.rotation:0,rotateWithView:n.rotateWithView!==void 0?n.rotateWithView:!1,displacement:n.displacement!==void 0?n.displacement:[0,0]})||this,r}return e.prototype.clone=function(){var t=this.getScale(),r=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return r.setOpacity(this.getOpacity()),r},e.prototype.setRadius=function(t){this.radius_=t,this.render()},e}(Rv),wv=Sv,Fh=function(){function i(e){var t=e||{};this.geometry_=null,this.geometryFunction_=Dh,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}return i.prototype.clone=function(){var e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new i({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},i.prototype.getRenderer=function(){return this.renderer_},i.prototype.setRenderer=function(e){this.renderer_=e},i.prototype.setHitDetectionRenderer=function(e){this.hitDetectionRenderer_=e},i.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},i.prototype.getGeometry=function(){return this.geometry_},i.prototype.getGeometryFunction=function(){return this.geometryFunction_},i.prototype.getFill=function(){return this.fill_},i.prototype.setFill=function(e){this.fill_=e},i.prototype.getImage=function(){return this.image_},i.prototype.setImage=function(e){this.image_=e},i.prototype.getStroke=function(){return this.stroke_},i.prototype.setStroke=function(e){this.stroke_=e},i.prototype.getText=function(){return this.text_},i.prototype.setText=function(e){this.text_=e},i.prototype.getZIndex=function(){return this.zIndex_},i.prototype.setGeometry=function(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Dh,this.geometry_=e},i.prototype.setZIndex=function(e){this.zIndex_=e},i}();function Iv(i){var e;if(typeof i=="function")e=i;else{var t;if(Array.isArray(i))t=i;else{z(typeof i.getZIndex=="function",41);var r=i;t=[r]}e=function(){return t}}return e}var to=null;function Lv(i,e){if(!to){var t=new vi({color:"rgba(255,255,255,0.4)"}),r=new Sr({color:"#3399CC",width:1.25});to=[new Fh({image:new wv({fill:t,stroke:r,radius:5}),fill:t,stroke:r})]}return to}function Dh(i){return i.getGeometry()}var pi=Fh,Gh={POINT:"point",LINE:"line"},Pv="#333",bv=function(){function i(e){var t=e||{};this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=At(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new vi({color:Pv}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:Gh.POINT,this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding}return i.prototype.clone=function(){var e=this.getScale();return new i({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()})},i.prototype.getOverflow=function(){return this.overflow_},i.prototype.getFont=function(){return this.font_},i.prototype.getMaxAngle=function(){return this.maxAngle_},i.prototype.getPlacement=function(){return this.placement_},i.prototype.getOffsetX=function(){return this.offsetX_},i.prototype.getOffsetY=function(){return this.offsetY_},i.prototype.getFill=function(){return this.fill_},i.prototype.getRotateWithView=function(){return this.rotateWithView_},i.prototype.getRotation=function(){return this.rotation_},i.prototype.getScale=function(){return this.scale_},i.prototype.getScaleArray=function(){return this.scaleArray_},i.prototype.getStroke=function(){return this.stroke_},i.prototype.getText=function(){return this.text_},i.prototype.getTextAlign=function(){return this.textAlign_},i.prototype.getTextBaseline=function(){return this.textBaseline_},i.prototype.getBackgroundFill=function(){return this.backgroundFill_},i.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},i.prototype.getPadding=function(){return this.padding_},i.prototype.setOverflow=function(e){this.overflow_=e},i.prototype.setFont=function(e){this.font_=e},i.prototype.setMaxAngle=function(e){this.maxAngle_=e},i.prototype.setOffsetX=function(e){this.offsetX_=e},i.prototype.setOffsetY=function(e){this.offsetY_=e},i.prototype.setPlacement=function(e){this.placement_=e},i.prototype.setRotateWithView=function(e){this.rotateWithView_=e},i.prototype.setFill=function(e){this.fill_=e},i.prototype.setRotation=function(e){this.rotation_=e},i.prototype.setScale=function(e){this.scale_=e,this.scaleArray_=At(e!==void 0?e:1)},i.prototype.setStroke=function(e){this.stroke_=e},i.prototype.setText=function(e){this.text_=e},i.prototype.setTextAlign=function(e){this.textAlign_=e},i.prototype.setTextBaseline=function(e){this.textBaseline_=e},i.prototype.setBackgroundFill=function(e){this.backgroundFill_=e},i.prototype.setBackgroundStroke=function(e){this.backgroundStroke_=e},i.prototype.setPadding=function(e){this.padding_=e},i}(),Uh=bv;function Av(i,e,t,r,n){kh(i,e,t||0,r||i.length-1,n||Nv)}function kh(i,e,t,r,n){for(;r>t;){if(r-t>600){var a=r-t+1,o=e-t+1,s=Math.log(a),h=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*h*(a-h)/a)*(o-a/2<0?-1:1),u=Math.max(t,Math.floor(e-o*h/a+l)),f=Math.min(r,Math.floor(e+(a-o)*h/a+l));kh(i,e,u,f,n)}var c=i[e],d=t,v=r;for(gi(i,t,e),n(i[r],c)>0&&gi(i,t,r);d<v;){for(gi(i,d,v),d++,v--;n(i[d],c)<0;)d++;for(;n(i[v],c)>0;)v--}n(i[t],c)===0?gi(i,t,v):(v++,gi(i,v,r)),v<=e&&(t=v+1),e<=v&&(r=v-1)}}function gi(i,e,t){var r=i[e];i[e]=i[t],i[t]=r}function Nv(i,e){return i<e?-1:i>e?1:0}class Bh{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const r=[];if(!Ln(e,t))return r;const n=this.toBBox,a=[];for(;t;){for(let o=0;o<t.children.length;o++){const s=t.children[o],h=t.leaf?n(s):s;Ln(e,h)&&(t.leaf?r.push(s):ro(e,h)?this._all(s,r):a.push(s))}t=a.pop()}return r}collides(e){let t=this.data;if(!Ln(e,t))return!1;const r=[];for(;t;){for(let n=0;n<t.children.length;n++){const a=t.children[n],o=t.leaf?this.toBBox(a):a;if(Ln(e,o)){if(t.leaf||ro(e,o))return!0;r.push(a)}}t=r.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let r=0;r<e.length;r++)this.insert(e[r]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const r=this.data;this.data=t,t=r}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Ir([]),this}remove(e,t){if(!e)return this;let r=this.data;const n=this.toBBox(e),a=[],o=[];let s,h,l;for(;r||a.length;){if(r||(r=a.pop(),h=a[a.length-1],s=o.pop(),l=!0),r.leaf){const u=Fv(e,r.children,t);if(u!==-1)return r.children.splice(u,1),a.push(r),this._condense(a),this}!l&&!r.leaf&&ro(r,n)?(a.push(r),o.push(s),s=0,h=r,r=r.children[0]):h?(s++,r=h.children[s],l=!1):r=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const r=[];for(;e;)e.leaf?t.push(...e.children):r.push(...e.children),e=r.pop();return t}_build(e,t,r,n){const a=r-t+1;let o=this._maxEntries,s;if(a<=o)return s=Ir(e.slice(t,r+1)),wr(s,this.toBBox),s;n||(n=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,n-1))),s=Ir([]),s.leaf=!1,s.height=n;const h=Math.ceil(a/o),l=h*Math.ceil(Math.sqrt(o));Xh(e,t,r,l,this.compareMinX);for(let u=t;u<=r;u+=l){const f=Math.min(u+l-1,r);Xh(e,u,f,h,this.compareMinY);for(let c=u;c<=f;c+=h){const d=Math.min(c+h-1,f);s.children.push(this._build(e,c,d,n-1))}}return wr(s,this.toBBox),s}_chooseSubtree(e,t,r,n){for(;n.push(t),!(t.leaf||n.length-1===r);){let a=1/0,o=1/0,s;for(let h=0;h<t.children.length;h++){const l=t.children[h],u=eo(l),f=Uv(e,l)-u;f<o?(o=f,a=u<a?u:a,s=l):f===o&&u<a&&(a=u,s=l)}t=s||t.children[0]}return t}_insert(e,t,r){const n=r?e:this.toBBox(e),a=[],o=this._chooseSubtree(n,this.data,t,a);for(o.children.push(e),mi(o,n);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(n,a,t)}_split(e,t){const r=e[t],n=r.children.length,a=this._minEntries;this._chooseSplitAxis(r,a,n);const o=this._chooseSplitIndex(r,a,n),s=Ir(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,wr(r,this.toBBox),wr(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(r,s)}_splitRoot(e,t){this.data=Ir([e,t]),this.data.height=e.height+1,this.data.leaf=!1,wr(this.data,this.toBBox)}_chooseSplitIndex(e,t,r){let n,a=1/0,o=1/0;for(let s=t;s<=r-t;s++){const h=yi(e,0,s,this.toBBox),l=yi(e,s,r,this.toBBox),u=kv(h,l),f=eo(h)+eo(l);u<a?(a=u,n=s,o=f<o?f:o):u===a&&f<o&&(o=f,n=s)}return n||r-t}_chooseSplitAxis(e,t,r){const n=e.leaf?this.compareMinX:Dv,a=e.leaf?this.compareMinY:Gv,o=this._allDistMargin(e,t,r,n),s=this._allDistMargin(e,t,r,a);o<s&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);const a=this.toBBox,o=yi(e,0,t,a),s=yi(e,r-t,r,a);let h=In(o)+In(s);for(let l=t;l<r-t;l++){const u=e.children[l];mi(o,e.leaf?a(u):u),h+=In(o)}for(let l=r-t-1;l>=t;l--){const u=e.children[l];mi(s,e.leaf?a(u):u),h+=In(s)}return h}_adjustParentBBoxes(e,t,r){for(let n=r;n>=0;n--)mi(t[n],e)}_condense(e){for(let t=e.length-1,r;t>=0;t--)e[t].children.length===0?t>0?(r=e[t-1].children,r.splice(r.indexOf(e[t]),1)):this.clear():wr(e[t],this.toBBox)}}function Fv(i,e,t){if(!t)return e.indexOf(i);for(let r=0;r<e.length;r++)if(t(i,e[r]))return r;return-1}function wr(i,e){yi(i,0,i.children.length,e,i)}function yi(i,e,t,r,n){n||(n=Ir(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let a=e;a<t;a++){const o=i.children[a];mi(n,i.leaf?r(o):o)}return n}function mi(i,e){return i.minX=Math.min(i.minX,e.minX),i.minY=Math.min(i.minY,e.minY),i.maxX=Math.max(i.maxX,e.maxX),i.maxY=Math.max(i.maxY,e.maxY),i}function Dv(i,e){return i.minX-e.minX}function Gv(i,e){return i.minY-e.minY}function eo(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function In(i){return i.maxX-i.minX+(i.maxY-i.minY)}function Uv(i,e){return(Math.max(e.maxX,i.maxX)-Math.min(e.minX,i.minX))*(Math.max(e.maxY,i.maxY)-Math.min(e.minY,i.minY))}function kv(i,e){const t=Math.max(i.minX,e.minX),r=Math.max(i.minY,e.minY),n=Math.min(i.maxX,e.maxX),a=Math.min(i.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,a-r)}function ro(i,e){return i.minX<=e.minX&&i.minY<=e.minY&&e.maxX<=i.maxX&&e.maxY<=i.maxY}function Ln(i,e){return e.minX<=i.maxX&&e.minY<=i.maxY&&e.maxX>=i.minX&&e.maxY>=i.minY}function Ir(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Xh(i,e,t,r,n){const a=[e,t];for(;a.length;){if(t=a.pop(),e=a.pop(),t-e<=r)continue;const o=e+Math.ceil((t-e)/r/2)*r;Av(i,o,e,t,n),a.push(e,o,o,t)}}var Bv=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),jh={RENDER_ORDER:"renderOrder"},Xv=function(i){Bv(e,i);function e(t){var r=this,n=t||{},a=vt({},n);return delete a.style,delete a.renderBuffer,delete a.updateWhileAnimating,delete a.updateWhileInteracting,r=i.call(this,a)||this,r.declutter_=n.declutter!==void 0?n.declutter:!1,r.renderBuffer_=n.renderBuffer!==void 0?n.renderBuffer:100,r.style_=null,r.styleFunction_=void 0,r.setStyle(n.style),r.updateWhileAnimating_=n.updateWhileAnimating!==void 0?n.updateWhileAnimating:!1,r.updateWhileInteracting_=n.updateWhileInteracting!==void 0?n.updateWhileInteracting:!1,r}return e.prototype.getDeclutter=function(){return this.declutter_},e.prototype.getFeatures=function(t){return i.prototype.getFeatures.call(this,t)},e.prototype.getRenderBuffer=function(){return this.renderBuffer_},e.prototype.getRenderOrder=function(){return this.get(jh.RENDER_ORDER)},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},e.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},e.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new Bh(9)),this.getRenderer().renderDeclutter(t)},e.prototype.setRenderOrder=function(t){this.set(jh.RENDER_ORDER,t)},e.prototype.setStyle=function(t){this.style_=t!==void 0?t:Lv,this.styleFunction_=t===null?void 0:Iv(this.style_),this.changed()},e}(fn),jv=Xv,xi={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Pn=[xi.FILL],Ne=[xi.STROKE],sr=[xi.BEGIN_PATH],Yh=[xi.CLOSE_PATH],U=xi,Yv=function(){function i(){}return i.prototype.drawCustom=function(e,t,r,n){},i.prototype.drawGeometry=function(e){},i.prototype.setStyle=function(e){},i.prototype.drawCircle=function(e,t){},i.prototype.drawFeature=function(e,t){},i.prototype.drawGeometryCollection=function(e,t){},i.prototype.drawLineString=function(e,t){},i.prototype.drawMultiLineString=function(e,t){},i.prototype.drawMultiPoint=function(e,t){},i.prototype.drawMultiPolygon=function(e,t){},i.prototype.drawPoint=function(e,t){},i.prototype.drawPolygon=function(e,t){},i.prototype.drawText=function(e,t){},i.prototype.setFillStrokeStyle=function(e,t){},i.prototype.setImageStyle=function(e,t){},i.prototype.setTextStyle=function(e,t){},i}(),zh=Yv,zv=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Wv=function(i){zv(e,i);function e(t,r,n,a){var o=i.call(this)||this;return o.tolerance=t,o.maxExtent=r,o.pixelRatio=a,o.maxLineWidth=0,o.resolution=n,o.beginGeometryInstruction1_=null,o.beginGeometryInstruction2_=null,o.bufferedMaxExtent_=null,o.instructions=[],o.coordinates=[],o.tmpCoordinate_=[],o.hitDetectionInstructions=[],o.state={},o}return e.prototype.applyPixelRatio=function(t){var r=this.pixelRatio;return r==1?t:t.map(function(n){return n*r})},e.prototype.appendFlatPointCoordinates=function(t,r){for(var n=this.getBufferedMaxExtent(),a=this.tmpCoordinate_,o=this.coordinates,s=o.length,h=0,l=t.length;h<l;h+=r)a[0]=t[h],a[1]=t[h+1],ve(n,a)&&(o[s++]=a[0],o[s++]=a[1]);return s},e.prototype.appendFlatLineCoordinates=function(t,r,n,a,o,s){var h=this.coordinates,l=h.length,u=this.getBufferedMaxExtent();s&&(r+=a);var f=t[r],c=t[r+1],d=this.tmpCoordinate_,v=!0,_,p,y;for(_=r+a;_<n;_+=a)d[0]=t[_],d[1]=t[_+1],y=Ea(u,d),y!==p?(v&&(h[l++]=f,h[l++]=c,v=!1),h[l++]=d[0],h[l++]=d[1]):y===mt.INTERSECTING?(h[l++]=d[0],h[l++]=d[1],v=!1):v=!0,f=d[0],c=d[1],p=y;return(o&&v||_===r+a)&&(h[l++]=f,h[l++]=c),l},e.prototype.drawCustomCoordinates_=function(t,r,n,a,o){for(var s=0,h=n.length;s<h;++s){var l=n[s],u=this.appendFlatLineCoordinates(t,r,l,a,!1,!1);o.push(u),r=l}return r},e.prototype.drawCustom=function(t,r,n,a){this.beginGeometry(t,r);var o=t.getType(),s=t.getStride(),h=this.coordinates.length,l,u,f,c,d;switch(o){case A.MULTI_POLYGON:l=t.getOrientedFlatCoordinates(),c=[];var v=t.getEndss();d=0;for(var _=0,p=v.length;_<p;++_){var y=[];d=this.drawCustomCoordinates_(l,d,v[_],s,y),c.push(y)}this.instructions.push([U.CUSTOM,h,c,t,n,Va]),this.hitDetectionInstructions.push([U.CUSTOM,h,c,t,a||n,Va]);break;case A.POLYGON:case A.MULTI_LINE_STRING:f=[],l=o==A.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(l,0,t.getEnds(),s,f),this.instructions.push([U.CUSTOM,h,f,t,n,ci]),this.hitDetectionInstructions.push([U.CUSTOM,h,f,t,a||n,ci]);break;case A.LINE_STRING:case A.CIRCLE:l=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(l,0,l.length,s,!1,!1),this.instructions.push([U.CUSTOM,h,u,t,n,be]),this.hitDetectionInstructions.push([U.CUSTOM,h,u,t,a||n,be]);break;case A.MULTI_POINT:l=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(l,s),u>h&&(this.instructions.push([U.CUSTOM,h,u,t,n,be]),this.hitDetectionInstructions.push([U.CUSTOM,h,u,t,a||n,be]));break;case A.POINT:l=t.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),u=this.coordinates.length,this.instructions.push([U.CUSTOM,h,u,t,n]),this.hitDetectionInstructions.push([U.CUSTOM,h,u,t,a||n]);break}this.endGeometry(r)},e.prototype.beginGeometry=function(t,r){this.beginGeometryInstruction1_=[U.BEGIN_GEOMETRY,r,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[U.BEGIN_GEOMETRY,r,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},e.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();var r,n=t.length,a,o,s=-1;for(r=0;r<n;++r)a=t[r],o=a[0],o==U.END_GEOMETRY?s=r:o==U.BEGIN_GEOMETRY&&(a[2]=r,cf(this.hitDetectionInstructions,s,r),s=-1)},e.prototype.setFillStrokeStyle=function(t,r){var n=this.state;if(t){var a=t.getColor();n.fillStyle=ie(a||pe)}else n.fillStyle=void 0;if(r){var o=r.getColor();n.strokeStyle=ie(o||li);var s=r.getLineCap();n.lineCap=s!==void 0?s:mn;var h=r.getLineDash();n.lineDash=h?h.slice():oi;var l=r.getLineDashOffset();n.lineDashOffset=l||si;var u=r.getLineJoin();n.lineJoin=u!==void 0?u:Cr;var f=r.getWidth();n.lineWidth=f!==void 0?f:fi;var c=r.getMiterLimit();n.miterLimit=c!==void 0?c:hi,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0},e.prototype.createFill=function(t){var r=t.fillStyle,n=[U.SET_FILL_STYLE,r];return typeof r!="string"&&n.push(!0),n},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[U.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,r){var n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(r.call(this,t)),t.currentFillStyle=n)},e.prototype.updateStrokeStyle=function(t,r){var n=t.strokeStyle,a=t.lineCap,o=t.lineDash,s=t.lineDashOffset,h=t.lineJoin,l=t.lineWidth,u=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=a||o!=t.currentLineDash&&!$e(t.currentLineDash,o)||t.currentLineDashOffset!=s||t.currentLineJoin!=h||t.currentLineWidth!=l||t.currentMiterLimit!=u)&&(n!==void 0&&r.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=a,t.currentLineDash=o,t.currentLineDashOffset=s,t.currentLineJoin=h,t.currentLineWidth=l,t.currentMiterLimit=u)},e.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var r=[U.END_GEOMETRY,t];this.instructions.push(r),this.hitDetectionInstructions.push(r)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Ss(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;ma(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(zh),Ei=Wv,$v=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Vv=function(i){$v(e,i);function e(t,r,n,a){var o=i.call(this,t,r,n,a)||this;return o.hitDetectionImage_=null,o.image_=null,o.imagePixelRatio_=void 0,o.anchorX_=void 0,o.anchorY_=void 0,o.height_=void 0,o.opacity_=void 0,o.originX_=void 0,o.originY_=void 0,o.rotateWithView_=void 0,o.rotation_=void 0,o.scale_=void 0,o.width_=void 0,o.declutterImageWithText_=void 0,o}return e.prototype.drawPoint=function(t,r){if(!!this.image_){this.beginGeometry(t,r);var n=t.getFlatCoordinates(),a=t.getStride(),o=this.coordinates.length,s=this.appendFlatPointCoordinates(n,a);this.instructions.push([U.DRAW_IMAGE,o,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([U.DRAW_IMAGE,o,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(r)}},e.prototype.drawMultiPoint=function(t,r){if(!!this.image_){this.beginGeometry(t,r);var n=t.getFlatCoordinates(),a=t.getStride(),o=this.coordinates.length,s=this.appendFlatPointCoordinates(n,a);this.instructions.push([U.DRAW_IMAGE,o,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([U.DRAW_IMAGE,o,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(r)}},e.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,i.prototype.finish.call(this)},e.prototype.setImageStyle=function(t,r){var n=t.getAnchor(),a=t.getSize(),o=t.getHitDetectionImage(),s=t.getImage(this.pixelRatio),h=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=o,this.image_=s,this.height_=a[1],this.opacity_=t.getOpacity(),this.originX_=h[0]*this.imagePixelRatio_,this.originY_=h[1]*this.imagePixelRatio_,this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=a[0],this.declutterImageWithText_=r},e}(Ei),Hv=Vv,Kv=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Zv=function(i){Kv(e,i);function e(t,r,n,a){return i.call(this,t,r,n,a)||this}return e.prototype.drawFlatCoordinates_=function(t,r,n,a){var o=this.coordinates.length,s=this.appendFlatLineCoordinates(t,r,n,a,!1,!1),h=[U.MOVE_TO_LINE_TO,o,s];return this.instructions.push(h),this.hitDetectionInstructions.push(h),n},e.prototype.drawLineString=function(t,r){var n=this.state,a=n.strokeStyle,o=n.lineWidth;if(!(a===void 0||o===void 0)){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,r),this.hitDetectionInstructions.push([U.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,oi,si],sr);var s=t.getFlatCoordinates(),h=t.getStride();this.drawFlatCoordinates_(s,0,s.length,h),this.hitDetectionInstructions.push(Ne),this.endGeometry(r)}},e.prototype.drawMultiLineString=function(t,r){var n=this.state,a=n.strokeStyle,o=n.lineWidth;if(!(a===void 0||o===void 0)){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,r),this.hitDetectionInstructions.push([U.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],sr);for(var s=t.getEnds(),h=t.getFlatCoordinates(),l=t.getStride(),u=0,f=0,c=s.length;f<c;++f)u=this.drawFlatCoordinates_(h,u,s[f],l);this.hitDetectionInstructions.push(Ne),this.endGeometry(r)}},e.prototype.finish=function(){var t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Ne),this.reverseHitDetectionInstructions(),this.state=null,i.prototype.finish.call(this)},e.prototype.applyStroke=function(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Ne),t.lastStroke=this.coordinates.length),t.lastStroke=0,i.prototype.applyStroke.call(this,t),this.instructions.push(sr)},e}(Ei),qv=Zv,Jv=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Qv=function(i){Jv(e,i);function e(t,r,n,a){return i.call(this,t,r,n,a)||this}return e.prototype.drawFlatCoordinatess_=function(t,r,n,a){var o=this.state,s=o.fillStyle!==void 0,h=o.strokeStyle!==void 0,l=n.length;this.instructions.push(sr),this.hitDetectionInstructions.push(sr);for(var u=0;u<l;++u){var f=n[u],c=this.coordinates.length,d=this.appendFlatLineCoordinates(t,r,f,a,!0,!h),v=[U.MOVE_TO_LINE_TO,c,d];this.instructions.push(v),this.hitDetectionInstructions.push(v),h&&(this.instructions.push(Yh),this.hitDetectionInstructions.push(Yh)),r=f}return s&&(this.instructions.push(Pn),this.hitDetectionInstructions.push(Pn)),h&&(this.instructions.push(Ne),this.hitDetectionInstructions.push(Ne)),r},e.prototype.drawCircle=function(t,r){var n=this.state,a=n.fillStyle,o=n.strokeStyle;if(!(a===void 0&&o===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,r),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([U.SET_FILL_STYLE,pe]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([U.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var s=t.getFlatCoordinates(),h=t.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(s,0,s.length,h,!1,!1);var u=[U.CIRCLE,l];this.instructions.push(sr,u),this.hitDetectionInstructions.push(sr,u),n.fillStyle!==void 0&&(this.instructions.push(Pn),this.hitDetectionInstructions.push(Pn)),n.strokeStyle!==void 0&&(this.instructions.push(Ne),this.hitDetectionInstructions.push(Ne)),this.endGeometry(r)}},e.prototype.drawPolygon=function(t,r){var n=this.state,a=n.fillStyle,o=n.strokeStyle;if(!(a===void 0&&o===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,r),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([U.SET_FILL_STYLE,pe]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([U.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var s=t.getEnds(),h=t.getOrientedFlatCoordinates(),l=t.getStride();this.drawFlatCoordinatess_(h,0,s,l),this.endGeometry(r)}},e.prototype.drawMultiPolygon=function(t,r){var n=this.state,a=n.fillStyle,o=n.strokeStyle;if(!(a===void 0&&o===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,r),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([U.SET_FILL_STYLE,pe]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([U.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);for(var s=t.getEndss(),h=t.getOrientedFlatCoordinates(),l=t.getStride(),u=0,f=0,c=s.length;f<c;++f)u=this.drawFlatCoordinatess_(h,u,s[f],l);this.endGeometry(r)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(t!==0)for(var r=this.coordinates,n=0,a=r.length;n<a;++n)r[n]=ar(r[n],t);return i.prototype.finish.call(this)},e.prototype.setFillStrokeStyles_=function(){var t=this.state,r=t.fillStyle;r!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)},e}(Ei),Wh=Qv;function t_(i,e,t,r,n){var a=t,o=t,s=0,h=0,l=t,u,f,c,d,v,_,p,y,g,m;for(f=t;f<r;f+=n){var x=e[f],E=e[f+1];v!==void 0&&(g=x-v,m=E-_,d=Math.sqrt(g*g+m*m),p!==void 0&&(h+=c,u=Math.acos((p*g+y*m)/(c*d)),u>i&&(h>s&&(s=h,a=l,o=f),h=0,l=f-n)),c=d,p=g,y=m),v=x,_=E}return h+=d,h>s?[l,f]:[a,o]}var e_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),bn={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},r_=function(i){e_(e,i);function e(t,r,n,a){var o=i.call(this,t,r,n,a)||this;return o.labels_=null,o.text_="",o.textOffsetX_=0,o.textOffsetY_=0,o.textRotateWithView_=void 0,o.textRotation_=0,o.textFillState_=null,o.fillStates={},o.textStrokeState_=null,o.strokeStates={},o.textState_={},o.textStates={},o.textKey_="",o.fillKey_="",o.strokeKey_="",o.declutterImageWithText_=void 0,o}return e.prototype.finish=function(){var t=i.prototype.finish.call(this);return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t},e.prototype.drawText=function(t,r){var n=this.textFillState_,a=this.textStrokeState_,o=this.textState_;if(!(this.text_===""||!o||!n&&!a)){var s=this.coordinates,h=s.length,l=t.getType(),u=null,f=t.getStride();if(o.placement===Gh.LINE&&(l==A.LINE_STRING||l==A.MULTI_LINE_STRING||l==A.POLYGON||l==A.MULTI_POLYGON)){if(!Rt(this.getBufferedMaxExtent(),t.getExtent()))return;var c=void 0;if(u=t.getFlatCoordinates(),l==A.LINE_STRING)c=[u.length];else if(l==A.MULTI_LINE_STRING)c=t.getEnds();else if(l==A.POLYGON)c=t.getEnds().slice(0,1);else if(l==A.MULTI_POLYGON){var d=t.getEndss();c=[];for(var v=0,_=d.length;v<_;++v)c.push(d[v][0])}this.beginGeometry(t,r);for(var p=o.textAlign,y=0,g=void 0,m=0,x=c.length;m<x;++m){if(p==null){var E=t_(o.maxAngle,u,y,c[m],f);y=E[0],g=E[1]}else g=c[m];for(var v=y;v<g;v+=f)s.push(u[v],u[v+1]);var T=s.length;y=c[m],this.drawChars_(h,T),h=T}this.endGeometry(r)}else{var M=o.overflow?null:[];switch(l){case A.POINT:case A.MULTI_POINT:u=t.getFlatCoordinates();break;case A.LINE_STRING:u=t.getFlatMidpoint();break;case A.CIRCLE:u=t.getCenter();break;case A.MULTI_LINE_STRING:u=t.getFlatMidpoints(),f=2;break;case A.POLYGON:u=t.getFlatInteriorPoint(),o.overflow||M.push(u[2]/this.resolution),f=3;break;case A.MULTI_POLYGON:var C=t.getFlatInteriorPoints();u=[];for(var v=0,_=C.length;v<_;v+=3)o.overflow||M.push(C[v+2]/this.resolution),u.push(C[v],C[v+1]);if(u.length===0)return;f=2;break}var T=this.appendFlatPointCoordinates(u,f);if(T===h)return;if(M&&(T-h)/2!=u.length/f){var O=h/2;M=M.filter(function(K,q){var J=s[(O+q)*2]===u[q*f]&&s[(O+q)*2+1]===u[q*f+1];return J||--O,J})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,r);var P=o.padding;if(P!=rr&&(o.scale[0]<0||o.scale[1]<0)){var I=o.padding[0],F=o.padding[1],B=o.padding[2],Z=o.padding[3];o.scale[0]<0&&(F=-F,Z=-Z),o.scale[1]<0&&(I=-I,B=-B),P=[I,F,B,Z]}var $=this.pixelRatio;this.instructions.push([U.DRAW_IMAGE,h,T,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,P==rr?rr:P.map(function(K){return K*$}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,M]);var H=1/$;this.hitDetectionInstructions.push([U.DRAW_IMAGE,h,T,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[H,H],NaN,this.declutterImageWithText_,P,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,M]),this.endGeometry(r)}}},e.prototype.saveTextStates_=function(){var t=this.textStrokeState_,r=this.textState_,n=this.textFillState_,a=this.strokeKey_;t&&(a in this.strokeStates||(this.strokeStates[a]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var o=this.textKey_;o in this.textStates||(this.textStates[o]={font:r.font,textAlign:r.textAlign||ui,textBaseline:r.textBaseline||xn,scale:r.scale});var s=this.fillKey_;n&&(s in this.fillStates||(this.fillStates[s]={fillStyle:n.fillStyle}))},e.prototype.drawChars_=function(t,r){var n=this.textStrokeState_,a=this.textState_,o=this.strokeKey_,s=this.textKey_,h=this.fillKey_;this.saveTextStates_();var l=this.pixelRatio,u=bn[a.textBaseline],f=this.textOffsetY_*l,c=this.text_,d=n?n.lineWidth*Math.abs(a.scale[0])/2:0;this.instructions.push([U.DRAW_CHARS,t,r,u,a.overflow,h,a.maxAngle,l,f,o,d*l,c,s,1]),this.hitDetectionInstructions.push([U.DRAW_CHARS,t,r,u,a.overflow,h,a.maxAngle,1,f,o,d,c,s,1/l])},e.prototype.setTextStyle=function(t,r){var n,a,o;if(!t)this.text_="";else{var s=t.getFill();s?(a=this.textFillState_,a||(a={},this.textFillState_=a),a.fillStyle=ie(s.getColor()||pe)):(a=null,this.textFillState_=a);var h=t.getStroke();if(!h)o=null,this.textStrokeState_=o;else{o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);var l=h.getLineDash(),u=h.getLineDashOffset(),f=h.getWidth(),c=h.getMiterLimit();o.lineCap=h.getLineCap()||mn,o.lineDash=l?l.slice():oi,o.lineDashOffset=u===void 0?si:u,o.lineJoin=h.getLineJoin()||Cr,o.lineWidth=f===void 0?fi:f,o.miterLimit=c===void 0?hi:c,o.strokeStyle=ie(h.getColor()||li)}n=this.textState_;var d=t.getFont()||nh;Hc(d);var v=t.getScaleArray();n.overflow=t.getOverflow(),n.font=d,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.textBaseline=t.getTextBaseline()||xn,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||rr,n.scale=v===void 0?[1,1]:v;var _=t.getOffsetX(),p=t.getOffsetY(),y=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=_===void 0?0:_,this.textOffsetY_=p===void 0?0:p,this.textRotateWithView_=y===void 0?!1:y,this.textRotation_=g===void 0?0:g,this.strokeKey_=o?(typeof o.strokeStyle=="string"?o.strokeStyle:tt(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.textBaseline||"?"),this.fillKey_=a?typeof a.fillStyle=="string"?a.fillStyle:"|"+tt(a.fillStyle):""}this.declutterImageWithText_=r},e}(Ei),i_=r_,n_={Circle:Wh,Default:Ei,Image:Hv,LineString:qv,Polygon:Wh,Text:i_},a_=function(){function i(e,t,r,n){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=r,this.buildersByZIndex_={}}return i.prototype.finish=function(){var e={};for(var t in this.buildersByZIndex_){e[t]=e[t]||{};var r=this.buildersByZIndex_[t];for(var n in r){var a=r[n].finish();e[t][n]=a}}return e},i.prototype.getBuilder=function(e,t){var r=e!==void 0?e.toString():"0",n=this.buildersByZIndex_[r];n===void 0&&(n={},this.buildersByZIndex_[r]=n);var a=n[t];if(a===void 0){var o=n_[t];a=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=a}return a},i}(),$h=a_,o_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),s_=function(i){o_(e,i);function e(t){var r=i.call(this)||this;return r.boundHandleImageChange_=r.handleImageChange_.bind(r),r.layer_=t,r.declutterExecutorGroup=null,r}return e.prototype.getFeatures=function(t){return G()},e.prototype.prepareFrame=function(t){return G()},e.prototype.renderFrame=function(t,r){return G()},e.prototype.loadedTileCallback=function(t,r,n){t[r]||(t[r]={}),t[r][n.tileCoord.toString()]=n},e.prototype.createLoadedTileFinder=function(t,r,n){return function(a,o){var s=this.loadedTileCallback.bind(this,n,a);return t.forEachLoadedTile(r,a,o,s)}.bind(this)},e.prototype.forEachFeatureAtCoordinate=function(t,r,n,a,o){},e.prototype.getDataAtPixel=function(t,r,n){return null},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleFontsChanged=function(){},e.prototype.handleImageChange_=function(t){var r=t.target;r.getState()===ot.LOADED&&this.renderIfReadyAndVisible()},e.prototype.loadImage=function(t){var r=t.getState();return r!=ot.LOADED&&r!=ot.ERROR&&t.addEventListener(D.CHANGE,this.boundHandleImageChange_),r==ot.IDLE&&(t.load(),r=t.getState()),r==ot.LOADED},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==Oe.READY&&t.changed()},e}(ts),Vh=s_,h_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),l_=function(i){h_(e,i);function e(t){var r=i.call(this,t)||this;return r.container=null,r.renderedResolution,r.tempTransform=bt(),r.pixelTransform=bt(),r.inversePixelTransform=bt(),r.context=null,r.containerReused=!1,r.pixelContext_=null,r}return e.prototype.getBackground=function(t){var r=this.getLayer(),n=r.getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0},e.prototype.useContainer=function(t,r,n,a){var o=this.getLayer().getClassName(),s,h;if(t&&t.className===o&&t.style.opacity===""&&n===1&&(!a||t.style.backgroundColor&&$e(ni(t.style.backgroundColor),ni(a)))){var l=t.firstElementChild;l instanceof HTMLCanvasElement&&(h=l.getContext("2d"))}if(h&&h.canvas.style.transform===r?(this.container=t,this.context=h,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){s=document.createElement("div"),s.className=o;var u=s.style;u.position="absolute",u.width="100%",u.height="100%",a&&(u.backgroundColor=a),h=jt();var l=h.canvas;s.appendChild(l),u=l.style,u.position="absolute",u.left="0",u.transformOrigin="top left",this.container=s,this.context=h}},e.prototype.clipUnrotated=function(t,r,n){var a=Tr(n),o=pn(n),s=_n(n),h=vn(n);pt(r.coordinateToPixelTransform,a),pt(r.coordinateToPixelTransform,o),pt(r.coordinateToPixelTransform,s),pt(r.coordinateToPixelTransform,h);var l=this.inversePixelTransform;pt(l,a),pt(l,o),pt(l,s),pt(l,h),t.save(),t.beginPath(),t.moveTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(h[0]),Math.round(h[1])),t.clip()},e.prototype.dispatchRenderEvent_=function(t,r,n){var a=this.getLayer();if(a.hasListener(t)){var o=new ai(t,this.inversePixelTransform,n,r);a.dispatchEvent(o)}},e.prototype.preRender=function(t,r){this.dispatchRenderEvent_(Lt.PRERENDER,t,r)},e.prototype.postRender=function(t,r){this.dispatchRenderEvent_(Lt.POSTRENDER,t,r)},e.prototype.getRenderTransform=function(t,r,n,a,o,s,h){var l=o/2,u=s/2,f=a/r,c=-f,d=-t[0]+h,v=-t[1];return re(this.tempTransform,l,u,f,c,-n,d,v)},e.prototype.getDataAtPixel=function(t,r,n){var a=pt(this.inversePixelTransform,t.slice()),o=this.context,s=this.getLayer(),h=s.getExtent();if(h){var l=pt(r.pixelToCoordinateTransform,t.slice());if(!ve(h,l))return null}var u=Math.round(a[0]),f=Math.round(a[1]),c=this.pixelContext_;if(!c){var d=document.createElement("canvas");d.width=1,d.height=1,c=d.getContext("2d"),this.pixelContext_=c}c.clearRect(0,0,1,1);var v;try{c.drawImage(o.canvas,u,f,1,1,0,0,1,1),v=c.getImageData(0,0,1,1).data}catch(_){return _.name==="SecurityError"?(this.pixelContext_=null,new Uint8Array):v}return v[3]===0?null:v},e}(Vh),u_=l_,ut={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function f_(i,e,t,r,n,a,o,s,h,l,u,f){var c=i[e],d=i[e+1],v=0,_=0,p=0,y=0;function g(){v=c,_=d,e+=r,c=i[e],d=i[e+1],y+=p,p=Math.sqrt((c-v)*(c-v)+(d-_)*(d-_))}do g();while(e<t-r&&y+p<a);for(var m=p===0?0:(a-y)/p,x=de(v,c,m),E=de(_,d,m),T=e-r,M=y,C=a+s*h(l,n,u);e<t-r&&y+p<C;)g();m=p===0?0:(C-y)/p;var O=de(v,c,m),P=de(_,d,m),I;if(f){var F=[x,E,O,P];fh(F,0,4,2,f,F,F),I=F[0]>F[2]}else I=x>O;var B=Math.PI,Z=[],$=T+r===e;e=T,p=0,y=M,c=i[e],d=i[e+1];var H;if($){g(),H=Math.atan2(d-_,c-v),I&&(H+=H>0?-B:B);var V=(O+x)/2,K=(P+E)/2;return Z[0]=[V,K,(C-a)/2,H,n],Z}for(var q=0,J=n.length;q<J;){g();var lt=Math.atan2(d-_,c-v);if(I&&(lt+=lt>0?-B:B),H!==void 0){var S=lt-H;if(S+=S>B?-2*B:S<-B?2*B:0,Math.abs(S)>o)return null}H=lt;for(var Gt=q,gt=0;q<J;++q){var wt=I?J-q-1:q,Kt=s*h(l,n[wt],u);if(e+r<t&&y+p<a+gt+Kt/2)break;gt+=Kt}if(q!==Gt){var Me=I?n.substring(J-Gt,J-q):n.substring(Gt,q);m=p===0?0:(a+gt/2-y)/p;var V=de(v,c,m),K=de(_,d,m);Z.push([V,K,gt/2,lt,Me]),a+=gt}}return Z}var Lr=$t(),Fe=[],ye=[],me=[],De=[];function Hh(i){return i[3].declutterBox}var c_=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Kh(i,e){return(e==="start"||e==="end")&&!c_.test(i)&&(e=e==="start"?"left":"right"),bn[e]}var d_=function(){function i(e,t,r,n){this.overlaps=r,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=bt(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return i.prototype.createLabel=function(e,t,r,n){var a=e+t+r+n;if(this.labels_[a])return this.labels_[a];var o=n?this.strokeStates[n]:null,s=r?this.fillStates[r]:null,h=this.textStates[t],l=this.pixelRatio,u=[h.scale[0]*l,h.scale[1]*l],f=Kh(e,h.textAlign||ui),c=n&&o.lineWidth?o.lineWidth:0,d=e.split(`
`),v=d.length,_=[],p=Zc(h.font,d,_),y=Kc(h.font),g=y*v,m=p+c,x=[],E=(m+2)*u[0],T=(g+c)*u[1],M={width:E<0?Math.floor(E):Math.ceil(E),height:T<0?Math.floor(T):Math.ceil(T),contextInstructions:x};if((u[0]!=1||u[1]!=1)&&x.push("scale",u),x.push("font",h.font),n){x.push("strokeStyle",o.strokeStyle),x.push("lineWidth",c),x.push("lineCap",o.lineCap),x.push("lineJoin",o.lineJoin),x.push("miterLimit",o.miterLimit);var C=nn?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D;C.prototype.setLineDash&&(x.push("setLineDash",[o.lineDash]),x.push("lineDashOffset",o.lineDashOffset))}r&&x.push("fillStyle",s.fillStyle),x.push("textBaseline","middle"),x.push("textAlign","center");var O=.5-f,P=f*m+O*c,I;if(n)for(I=0;I<v;++I)x.push("strokeText",[d[I],P+O*_[I],.5*(c+y)+I*y]);if(r)for(I=0;I<v;++I)x.push("fillText",[d[I],P+O*_[I],.5*(c+y)+I*y]);return this.labels_[a]=M,M},i.prototype.replayTextBackground_=function(e,t,r,n,a,o,s){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,r),e.lineTo.apply(e,n),e.lineTo.apply(e,a),e.lineTo.apply(e,t),o&&(this.alignFill_=o[2],this.fill_(e)),s&&(this.setStrokeStyle_(e,s),e.stroke())},i.prototype.calculateImageOrLabelDimensions_=function(e,t,r,n,a,o,s,h,l,u,f,c,d,v,_,p){s*=c[0],h*=c[1];var y=r-s,g=n-h,m=a+l>e?e-l:a,x=o+u>t?t-u:o,E=v[3]+m*c[0]+v[1],T=v[0]+x*c[1]+v[2],M=y-v[3],C=g-v[0];(_||f!==0)&&(Fe[0]=M,De[0]=M,Fe[1]=C,ye[1]=C,ye[0]=M+E,me[0]=ye[0],me[1]=C+T,De[1]=me[1]);var O;return f!==0?(O=re(bt(),r,n,1,1,f,-r,-n),pt(O,Fe),pt(O,ye),pt(O,me),pt(O,De),te(Math.min(Fe[0],ye[0],me[0],De[0]),Math.min(Fe[1],ye[1],me[1],De[1]),Math.max(Fe[0],ye[0],me[0],De[0]),Math.max(Fe[1],ye[1],me[1],De[1]),Lr)):te(Math.min(M,M+E),Math.min(C,C+T),Math.max(M,M+E),Math.max(C,C+T),Lr),d&&(y=Math.round(y),g=Math.round(g)),{drawImageX:y,drawImageY:g,drawImageW:m,drawImageH:x,originX:l,originY:u,declutterBox:{minX:Lr[0],minY:Lr[1],maxX:Lr[2],maxY:Lr[3],value:p},canvasTransform:O,scale:c}},i.prototype.replayImageOrLabel_=function(e,t,r,n,a,o,s){var h=!!(o||s),l=n.declutterBox,u=e.canvas,f=s?s[2]*n.scale[0]/2:0,c=l.minX-f<=u.width/t&&l.maxX+f>=0&&l.minY-f<=u.height/t&&l.maxY+f>=0;return c&&(h&&this.replayTextBackground_(e,Fe,ye,me,De,o,s),qc(e,n.canvasTransform,a,r,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0},i.prototype.fill_=function(e){if(this.alignFill_){var t=pt(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;e.save(),e.translate(t[0]%r,t[1]%r),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()},i.prototype.setStrokeStyle_=function(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.setLineDash&&(e.lineDashOffset=t[7],e.setLineDash(t[6]))},i.prototype.drawLabelWithPointPlacement_=function(e,t,r,n){var a=this.textStates[t],o=this.createLabel(e,t,n,r),s=this.strokeStates[r],h=this.pixelRatio,l=Kh(e,a.textAlign||ui),u=bn[a.textBaseline||xn],f=s&&s.lineWidth?s.lineWidth:0,c=o.width/h-2*a.scale[0],d=l*c+2*(.5-l)*f,v=u*o.height/h+2*(.5-u)*f;return{label:o,anchorX:d,anchorY:v}},i.prototype.execute_=function(e,t,r,n,a,o,s,h){var l;this.pixelCoordinates_&&$e(r,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=ir(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),bc(this.renderedTransform_,r));for(var u=0,f=n.length,c=0,d,v,_,p,y,g,m,x,E,T,M,C,O=0,P=0,I=null,F=null,B=this.coordinateCache_,Z=this.viewRotation_,$=Math.round(Math.atan2(-r[1],r[0])*1e12)/1e12,H={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:Z},V=this.instructions!=n||this.overlaps?0:200,K,q,J,lt;u<f;){var S=n[u],Gt=S[0];switch(Gt){case U.BEGIN_GEOMETRY:K=S[1],lt=S[3],K.getGeometry()?s!==void 0&&!Rt(s,lt.getExtent())?u=S[2]+1:++u:u=S[2];break;case U.BEGIN_PATH:O>V&&(this.fill_(e),O=0),P>V&&(e.stroke(),P=0),!O&&!P&&(e.beginPath(),p=NaN,y=NaN),++u;break;case U.CIRCLE:c=S[1];var gt=l[c],wt=l[c+1],Kt=l[c+2],Me=l[c+3],kt=Kt-gt,Bt=Me-wt,ji=Math.sqrt(kt*kt+Bt*Bt);e.moveTo(gt+ji,wt),e.arc(gt,wt,ji,0,2*Math.PI,!0),++u;break;case U.CLOSE_PATH:e.closePath(),++u;break;case U.CUSTOM:c=S[1],d=S[2];var na=S[3],jr=S[4],Yr=S.length==6?S[5]:void 0;H.geometry=na,H.feature=K,u in B||(B[u]=[]);var ze=B[u];Yr?Yr(l,c,d,2,ze):(ze[0]=l[c],ze[1]=l[c+1],ze.length=2),jr(ze,H),++u;break;case U.DRAW_IMAGE:c=S[1],d=S[2],x=S[3],v=S[4],_=S[5];var zr=S[6],Yi=S[7],aa=S[8],jo=S[9],zi=S[10],oa=S[11],zu=S[12],Wi=S[13],Wr=S[14];if(!x&&S.length>=19){E=S[18],T=S[19],M=S[20],C=S[21];var sa=this.drawLabelWithPointPlacement_(E,T,M,C);x=sa.label,S[3]=x;var Wu=S[22];v=(sa.anchorX-Wu)*this.pixelRatio,S[4]=v;var $u=S[23];_=(sa.anchorY-$u)*this.pixelRatio,S[5]=_,zr=x.height,S[6]=zr,Wi=x.width,S[13]=Wi}var ha=void 0;S.length>24&&(ha=S[24]);var la=void 0,$i=void 0,Vi=void 0;S.length>16?(la=S[15],$i=S[16],Vi=S[17]):(la=rr,$i=!1,Vi=!1),zi&&$?oa+=Z:!zi&&!$&&(oa-=Z);for(var Vu=0;c<d;c+=2)if(!(ha&&ha[Vu++]<Wi/this.pixelRatio)){var ue=this.calculateImageOrLabelDimensions_(x.width,x.height,l[c],l[c+1],Wi,zr,v,_,aa,jo,oa,zu,a,la,$i||Vi,K),Yo=[e,t,x,ue,Yi,$i?I:null,Vi?F:null],Hi=void 0,ua=void 0;if(h&&Wr){var Ki=d-c;if(!Wr[Ki]){Wr[Ki]=Yo;continue}if(Hi=Wr[Ki],delete Wr[Ki],ua=Hh(Hi),h.collides(ua))continue}h&&h.collides(ue.declutterBox)||(Hi&&(h&&h.insert(ua),this.replayImageOrLabel_.apply(this,Hi)),h&&h.insert(ue.declutterBox),this.replayImageOrLabel_.apply(this,Yo))}++u;break;case U.DRAW_CHARS:var zo=S[1],Wo=S[2],fa=S[3],Hu=S[4];C=S[5];var Ku=S[6],$o=S[7],Vo=S[8];M=S[9];var ca=S[10];E=S[11],T=S[12];var Ho=[S[13],S[13]],da=this.textStates[T],$r=da.font,Vr=[da.scale[0]*$o,da.scale[1]*$o],Hr=void 0;$r in this.widths_?Hr=this.widths_[$r]:(Hr={},this.widths_[$r]=Hr);var Ko=Ah(l,zo,Wo,2),Zo=Math.abs(Vr[0])*oh($r,E,Hr);if(Hu||Zo<=Ko){var Zu=this.textStates[T].textAlign,qu=(Ko-Zo)*bn[Zu],Kr=f_(l,zo,Wo,2,E,qu,Ku,Math.abs(Vr[0]),oh,$r,Hr,$?0:this.viewRotation_);t:if(Kr){var Zr=[],Ce=void 0,Zi=void 0,qi=void 0,It=void 0,Xt=void 0;if(M)for(Ce=0,Zi=Kr.length;Ce<Zi;++Ce){Xt=Kr[Ce],qi=Xt[4],It=this.createLabel(qi,T,"",M),v=Xt[2]+(Vr[0]<0?-ca:ca),_=fa*It.height+(.5-fa)*2*ca*Vr[1]/Vr[0]-Vo;var ue=this.calculateImageOrLabelDimensions_(It.width,It.height,Xt[0],Xt[1],It.width,It.height,v,_,0,0,Xt[3],Ho,!1,rr,!1,K);if(h&&h.collides(ue.declutterBox))break t;Zr.push([e,t,It,ue,1,null,null])}if(C)for(Ce=0,Zi=Kr.length;Ce<Zi;++Ce){Xt=Kr[Ce],qi=Xt[4],It=this.createLabel(qi,T,C,""),v=Xt[2],_=fa*It.height-Vo;var ue=this.calculateImageOrLabelDimensions_(It.width,It.height,Xt[0],Xt[1],It.width,It.height,v,_,0,0,Xt[3],Ho,!1,rr,!1,K);if(h&&h.collides(ue.declutterBox))break t;Zr.push([e,t,It,ue,1,null,null])}h&&h.load(Zr.map(Hh));for(var va=0,Ju=Zr.length;va<Ju;++va)this.replayImageOrLabel_.apply(this,Zr[va])}}++u;break;case U.END_GEOMETRY:if(o!==void 0){K=S[1];var qo=o(K,lt);if(qo)return qo}++u;break;case U.FILL:V?O++:this.fill_(e),++u;break;case U.MOVE_TO_LINE_TO:for(c=S[1],d=S[2],q=l[c],J=l[c+1],g=q+.5|0,m=J+.5|0,(g!==p||m!==y)&&(e.moveTo(q,J),p=g,y=m),c+=2;c<d;c+=2)q=l[c],J=l[c+1],g=q+.5|0,m=J+.5|0,(c==d-2||g!==p||m!==y)&&(e.lineTo(q,J),p=g,y=m);++u;break;case U.SET_FILL_STYLE:I=S,this.alignFill_=S[2],O&&(this.fill_(e),O=0,P&&(e.stroke(),P=0)),e.fillStyle=S[1],++u;break;case U.SET_STROKE_STYLE:F=S,P&&(e.stroke(),P=0),this.setStrokeStyle_(e,S),++u;break;case U.STROKE:V?P++:e.stroke(),++u;break;default:++u;break}}O&&this.fill_(e),P&&e.stroke()},i.prototype.execute=function(e,t,r,n,a,o){this.viewRotation_=n,this.execute_(e,t,r,this.instructions,a,void 0,void 0,o)},i.prototype.executeHitDetection=function(e,t,r,n,a){return this.viewRotation_=r,this.execute_(e,1,t,this.hitDetectionInstructions,!0,n,a)},i}(),v_=d_,io=[ut.POLYGON,ut.CIRCLE,ut.LINE_STRING,ut.IMAGE,ut.TEXT,ut.DEFAULT],__=function(){function i(e,t,r,n,a,o){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=r,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=bt(),this.createExecutors_(a)}return i.prototype.clip=function(e,t){var r=this.getClipCoords(t);e.beginPath(),e.moveTo(r[0],r[1]),e.lineTo(r[2],r[3]),e.lineTo(r[4],r[5]),e.lineTo(r[6],r[7]),e.clip()},i.prototype.createExecutors_=function(e){for(var t in e){var r=this.executorsByZIndex_[t];r===void 0&&(r={},this.executorsByZIndex_[t]=r);var n=e[t];for(var a in n){var o=n[a];r[a]=new v_(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}},i.prototype.hasExecutors=function(e){for(var t in this.executorsByZIndex_)for(var r=this.executorsByZIndex_[t],n=0,a=e.length;n<a;++n)if(e[n]in r)return!0;return!1},i.prototype.forEachFeatureAtCoordinate=function(e,t,r,n,a,o){n=Math.round(n);var s=n*2+1,h=re(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-r,-e[0],-e[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=jt(s,s));var u=this.hitDetectionContext_;u.canvas.width!==s||u.canvas.height!==s?(u.canvas.width=s,u.canvas.height=s):l||u.clearRect(0,0,s,s);var f;this.renderBuffer_!==void 0&&(f=$t(),ei(f,e),ma(f,t*(this.renderBuffer_+n),f));var c=p_(n),d;function v(T,M){for(var C=u.getImageData(0,0,s,s).data,O=0,P=c.length;O<P;O++)if(C[c[O]]>0){if(!o||d!==ut.IMAGE&&d!==ut.TEXT||o.indexOf(T)!==-1){var I=(c[O]-3)/4,F=n-I%s,B=n-(I/s|0),Z=a(T,M,F*F+B*B);if(Z)return Z}u.clearRect(0,0,s,s);break}}var _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(We);var p,y,g,m,x;for(p=_.length-1;p>=0;--p){var E=_[p].toString();for(g=this.executorsByZIndex_[E],y=io.length-1;y>=0;--y)if(d=io[y],m=g[d],m!==void 0&&(x=m.executeHitDetection(u,h,r,v,f),x))return x}},i.prototype.getClipCoords=function(e){var t=this.maxExtent_;if(!t)return null;var r=t[0],n=t[1],a=t[2],o=t[3],s=[r,n,r,o,a,o,a,n];return ir(s,0,8,2,e,s),s},i.prototype.isEmpty=function(){return vr(this.executorsByZIndex_)},i.prototype.execute=function(e,t,r,n,a,o,s){var h=Object.keys(this.executorsByZIndex_).map(Number);h.sort(We),this.maxExtent_&&(e.save(),this.clip(e,r));var l=o||io,u,f,c,d,v,_;for(s&&h.reverse(),u=0,f=h.length;u<f;++u){var p=h[u].toString();for(v=this.executorsByZIndex_[p],c=0,d=l.length;c<d;++c){var y=l[c];_=v[y],_!==void 0&&_.execute(e,t,r,n,a,s)}}this.maxExtent_&&e.restore()},i}(),no={};function p_(i){if(no[i]!==void 0)return no[i];for(var e=i*2+1,t=i*i,r=new Array(t+1),n=0;n<=i;++n)for(var a=0;a<=i;++a){var o=n*n+a*a;if(o>t)break;var s=r[o];s||(s=[],r[o]=s),s.push(((i+n)*e+(i+a))*4+3),n>0&&s.push(((i-n)*e+(i+a))*4+3),a>0&&(s.push(((i+n)*e+(i-a))*4+3),n>0&&s.push(((i-n)*e+(i-a))*4+3))}for(var h=[],n=0,l=r.length;n<l;++n)r[n]&&h.push.apply(h,r[n]);return no[i]=h,h}var Zh=__,g_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),y_=function(i){g_(e,i);function e(t,r,n,a,o,s,h){var l=i.call(this)||this;return l.context_=t,l.pixelRatio_=r,l.extent_=n,l.transform_=a,l.viewRotation_=o,l.squaredTolerance_=s,l.userTransform_=h,l.contextFillState_=null,l.contextStrokeState_=null,l.contextTextState_=null,l.fillState_=null,l.strokeState_=null,l.image_=null,l.imageAnchorX_=0,l.imageAnchorY_=0,l.imageHeight_=0,l.imageOpacity_=0,l.imageOriginX_=0,l.imageOriginY_=0,l.imageRotateWithView_=!1,l.imageRotation_=0,l.imageScale_=[0,0],l.imageWidth_=0,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=!1,l.textRotation_=0,l.textScale_=[0,0],l.textFillState_=null,l.textStrokeState_=null,l.textState_=null,l.pixelCoordinates_=[],l.tmpLocalTransform_=bt(),l}return e.prototype.drawImages_=function(t,r,n,a){if(!!this.image_){var o=ir(t,r,n,a,this.transform_,this.pixelCoordinates_),s=this.context_,h=this.tmpLocalTransform_,l=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=l*this.imageOpacity_);var u=this.imageRotation_;this.imageRotateWithView_&&(u+=this.viewRotation_);for(var f=0,c=o.length;f<c;f+=2){var d=o[f]-this.imageAnchorX_,v=o[f+1]-this.imageAnchorY_;if(u!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){var _=d+this.imageAnchorX_,p=v+this.imageAnchorY_;re(h,_,p,1,1,u,-_,-p),s.setTransform.apply(s,h),s.translate(_,p),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.setTransform(1,0,0,1,0,0)}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,v,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=l)}},e.prototype.drawText_=function(t,r,n,a){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var o=ir(t,r,n,a,this.transform_,this.pixelCoordinates_),s=this.context_,h=this.textRotation_;for(this.textRotateWithView_&&(h+=this.viewRotation_);r<n;r+=a){var l=o[r]+this.textOffsetX_,u=o[r+1]+this.textOffsetY_;if(h!==0||this.textScale_[0]!=1||this.textScale_[1]!=1){var f=re(this.tmpLocalTransform_,l,u,1,1,h,-l,-u);s.setTransform.apply(s,f),s.translate(l,u),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&s.strokeText(this.text_,l,u),this.textFillState_&&s.fillText(this.text_,l,u)}}},e.prototype.moveToLineTo_=function(t,r,n,a,o){var s=this.context_,h=ir(t,r,n,a,this.transform_,this.pixelCoordinates_);s.moveTo(h[0],h[1]);var l=h.length;o&&(l-=2);for(var u=2;u<l;u+=2)s.lineTo(h[u],h[u+1]);return o&&s.closePath(),n},e.prototype.drawRings_=function(t,r,n,a){for(var o=0,s=n.length;o<s;++o)r=this.moveToLineTo_(t,r,n[o],a,!0);return r},e.prototype.drawCircle=function(t){if(!!Rt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var r=Id(t,this.transform_,this.pixelCoordinates_),n=r[2]-r[0],a=r[3]-r[1],o=Math.sqrt(n*n+a*a),s=this.context_;s.beginPath(),s.arc(r[0],r[1],o,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.setTransform=function(t){this.transform_=t},e.prototype.drawGeometry=function(t){var r=t.getType();switch(r){case A.POINT:this.drawPoint(t);break;case A.LINE_STRING:this.drawLineString(t);break;case A.POLYGON:this.drawPolygon(t);break;case A.MULTI_POINT:this.drawMultiPoint(t);break;case A.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case A.MULTI_POLYGON:this.drawMultiPolygon(t);break;case A.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case A.CIRCLE:this.drawCircle(t);break}},e.prototype.drawFeature=function(t,r){var n=r.getGeometryFunction()(t);!n||!Rt(this.extent_,n.getExtent())||(this.setStyle(r),this.drawGeometry(n))},e.prototype.drawGeometryCollection=function(t){for(var r=t.getGeometriesArray(),n=0,a=r.length;n<a;++n)this.drawGeometry(r[n])},e.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var r=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(r,0,r.length,n),this.text_!==""&&this.drawText_(r,0,r.length,n)},e.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var r=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(r,0,r.length,n),this.text_!==""&&this.drawText_(r,0,r.length,n)},e.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Rt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var r=this.context_,n=t.getFlatCoordinates();r.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),r.stroke()}if(this.text_!==""){var a=t.getFlatMidpoint();this.drawText_(a,0,2,2)}}},e.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var r=t.getExtent();if(!!Rt(this.extent_,r)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var n=this.context_,a=t.getFlatCoordinates(),o=0,s=t.getEnds(),h=t.getStride();n.beginPath();for(var l=0,u=s.length;l<u;++l)o=this.moveToLineTo_(a,o,s[l],h,!1);n.stroke()}if(this.text_!==""){var f=t.getFlatMidpoints();this.drawText_(f,0,f.length,2)}}},e.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Rt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var r=this.context_;r.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}if(this.text_!==""){var n=t.getFlatInteriorPoint();this.drawText_(n,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Rt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var r=this.context_,n=t.getOrientedFlatCoordinates(),a=0,o=t.getEndss(),s=t.getStride();r.beginPath();for(var h=0,l=o.length;h<l;++h){var u=o[h];a=this.drawRings_(n,a,u,s)}this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}if(this.text_!==""){var f=t.getFlatInteriorPoints();this.drawText_(f,0,f.length,2)}}},e.prototype.setContextFillState_=function(t){var r=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,r.fillStyle=t.fillStyle):(r.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var r=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,r.lineCap=t.lineCap),r.setLineDash&&($e(n.lineDash,t.lineDash)||r.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,r.lineDashOffset=t.lineDashOffset)),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,r.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,r.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,r.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,r.strokeStyle=t.strokeStyle)):(r.lineCap=t.lineCap,r.setLineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.lineJoin=t.lineJoin,r.lineWidth=t.lineWidth,r.miterLimit=t.miterLimit,r.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var r=this.context_,n=this.contextTextState_,a=t.textAlign?t.textAlign:ui;n?(n.font!=t.font&&(n.font=t.font,r.font=t.font),n.textAlign!=a&&(n.textAlign=a,r.textAlign=a),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,r.textBaseline=t.textBaseline)):(r.font=t.font,r.textAlign=a,r.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:a,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,r){var n=this;if(!t)this.fillState_=null;else{var a=t.getColor();this.fillState_={fillStyle:ie(a||pe)}}if(!r)this.strokeState_=null;else{var o=r.getColor(),s=r.getLineCap(),h=r.getLineDash(),l=r.getLineDashOffset(),u=r.getLineJoin(),f=r.getWidth(),c=r.getMiterLimit(),d=h||oi;this.strokeState_={lineCap:s!==void 0?s:mn,lineDash:this.pixelRatio_===1?d:d.map(function(v){return v*n.pixelRatio_}),lineDashOffset:(l||si)*this.pixelRatio_,lineJoin:u!==void 0?u:Cr,lineWidth:(f!==void 0?f:fi)*this.pixelRatio_,miterLimit:c!==void 0?c:hi,strokeStyle:ie(o||li)}}},e.prototype.setImageStyle=function(t){var r;if(!t||!(r=t.getSize())){this.image_=null;return}var n=t.getAnchor(),a=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*this.pixelRatio_,this.imageAnchorY_=n[1]*this.pixelRatio_,this.imageHeight_=r[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=a[0],this.imageOriginY_=a[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=r[0]*this.pixelRatio_},e.prototype.setTextStyle=function(t){if(!t)this.text_="";else{var r=t.getFill();if(!r)this.textFillState_=null;else{var n=r.getColor();this.textFillState_={fillStyle:ie(n||pe)}}var a=t.getStroke();if(!a)this.textStrokeState_=null;else{var o=a.getColor(),s=a.getLineCap(),h=a.getLineDash(),l=a.getLineDashOffset(),u=a.getLineJoin(),f=a.getWidth(),c=a.getMiterLimit();this.textStrokeState_={lineCap:s!==void 0?s:mn,lineDash:h||oi,lineDashOffset:l||si,lineJoin:u!==void 0?u:Cr,lineWidth:f!==void 0?f:fi,miterLimit:c!==void 0?c:hi,strokeStyle:ie(o||li)}}var d=t.getFont(),v=t.getOffsetX(),_=t.getOffsetY(),p=t.getRotateWithView(),y=t.getRotation(),g=t.getScaleArray(),m=t.getText(),x=t.getTextAlign(),E=t.getTextBaseline();this.textState_={font:d!==void 0?d:nh,textAlign:x!==void 0?x:ui,textBaseline:E!==void 0?E:xn},this.text_=m!==void 0?m:"",this.textOffsetX_=v!==void 0?this.pixelRatio_*v:0,this.textOffsetY_=_!==void 0?this.pixelRatio_*_:0,this.textRotateWithView_=p!==void 0?p:!1,this.textRotation_=y!==void 0?y:0,this.textScale_=[this.pixelRatio_*g[0],this.pixelRatio_*g[1]]}},e}(zh),qh=y_,Ge={FRACTION:"fraction",PIXELS:"pixels"},zt={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},m_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),x_=function(i){m_(e,i);function e(t,r,n,a){var o=i.call(this)||this;return o.extent=t,o.pixelRatio_=n,o.resolution=r,o.state=a,o}return e.prototype.changed=function(){this.dispatchEvent(D.CHANGE)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return G()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){G()},e}(He),E_=x_,T_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();(function(i){T_(e,i);function e(t,r,n,a,o,s){var h=i.call(this,t,r,n,ot.IDLE)||this;return h.src_=a,h.image_=new Image,o!==null&&(h.image_.crossOrigin=o),h.unlisten_=null,h.state=ot.IDLE,h.imageLoadFunction_=s,h}return e.prototype.getImage=function(){return this.image_},e.prototype.handleImageError_=function(){this.state=ot.ERROR,this.unlistenImage_(),this.changed()},e.prototype.handleImageLoad_=function(){this.resolution===void 0&&(this.resolution=Yt(this.extent)/this.image_.height),this.state=ot.LOADED,this.unlistenImage_(),this.changed()},e.prototype.load=function(){(this.state==ot.IDLE||this.state==ot.ERROR)&&(this.state=ot.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=ao(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.setImage=function(t){this.image_=t,this.resolution=Yt(this.extent)/this.image_.height},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e})(E_);function ao(i,e,t){var r=i,n=!0,a=!1,o=!1,s=[tn(r,D.LOAD,function(){o=!0,a||e()})];return r.src&&Rf?(a=!0,r.decode().then(function(){n&&e()}).catch(function(h){n&&(o?e():t())})):s.push(tn(r,D.ERROR,t)),function(){n=!1,s.forEach(at)}}var M_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ti=null,C_=function(i){M_(e,i);function e(t,r,n,a,o,s){var h=i.call(this)||this;return h.hitDetectionImage_=null,h.image_=t||new Image,a!==null&&(h.image_.crossOrigin=a),h.canvas_={},h.color_=s,h.unlisten_=null,h.imageState_=o,h.size_=n,h.src_=r,h.tainted_,h}return e.prototype.isTainted_=function(){if(this.tainted_===void 0&&this.imageState_===ot.LOADED){Ti||(Ti=jt(1,1)),Ti.drawImage(this.image_,0,0);try{Ti.getImageData(0,0,1,1),this.tainted_=!1}catch{Ti=null,this.tainted_=!0}}return this.tainted_===!0},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(D.CHANGE)},e.prototype.handleImageError_=function(){this.imageState_=ot.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=ot.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},e.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],r=this.size_[1],n=jt(t,r);n.fillRect(0,0,t,r),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(this.imageState_==ot.IDLE){this.imageState_=ot.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=ao(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},e.prototype.replaceColor_=function(t){if(!(!this.color_||this.canvas_[t]||this.imageState_!==ot.LOADED)){var r=document.createElement("canvas");this.canvas_[t]=r,r.width=Math.ceil(this.image_.width*t),r.height=Math.ceil(this.image_.height*t);var n=r.getContext("2d");if(n.scale(t,t),n.drawImage(this.image_,0,0),n.globalCompositeOperation="multiply",n.globalCompositeOperation==="multiply"||this.isTainted_())n.fillStyle=Js(this.color_),n.fillRect(0,0,r.width/t,r.height/t),n.globalCompositeOperation="destination-in",n.drawImage(this.image_,0,0);else{for(var a=n.getImageData(0,0,r.width,r.height),o=a.data,s=this.color_[0]/255,h=this.color_[1]/255,l=this.color_[2]/255,u=this.color_[3],f=0,c=o.length;f<c;f+=4)o[f]*=s,o[f+1]*=h,o[f+2]*=l,o[f+3]*=u;n.putImageData(a,0,0)}}},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(He);function R_(i,e,t,r,n,a){var o=yn.get(e,r,a);return o||(o=new C_(i,e,t,r,n,a),yn.set(e,r,a,o)),o}var O_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),S_=function(i){O_(e,i);function e(t){var r=this,n=t||{},a=n.opacity!==void 0?n.opacity:1,o=n.rotation!==void 0?n.rotation:0,s=n.scale!==void 0?n.scale:1,h=n.rotateWithView!==void 0?n.rotateWithView:!1;r=i.call(this,{opacity:a,rotation:o,scale:s,displacement:n.displacement!==void 0?n.displacement:[0,0],rotateWithView:h})||this,r.anchor_=n.anchor!==void 0?n.anchor:[.5,.5],r.normalizedAnchor_=null,r.anchorOrigin_=n.anchorOrigin!==void 0?n.anchorOrigin:zt.TOP_LEFT,r.anchorXUnits_=n.anchorXUnits!==void 0?n.anchorXUnits:Ge.FRACTION,r.anchorYUnits_=n.anchorYUnits!==void 0?n.anchorYUnits:Ge.FRACTION,r.crossOrigin_=n.crossOrigin!==void 0?n.crossOrigin:null;var l=n.img!==void 0?n.img:null,u=n.imgSize!==void 0?n.imgSize:null,f=n.src;z(!(f!==void 0&&l),4),z(!l||l&&u,5),(f===void 0||f.length===0)&&l&&(f=l.src||tt(l)),z(f!==void 0&&f.length>0,6);var c=n.src!==void 0?ot.IDLE:ot.LOADED;return r.color_=n.color!==void 0?ni(n.color):null,r.iconImage_=R_(l,f,u,r.crossOrigin_,c,r.color_),r.offset_=n.offset!==void 0?n.offset:[0,0],r.offsetOrigin_=n.offsetOrigin!==void 0?n.offsetOrigin:zt.TOP_LEFT,r.origin_=null,r.size_=n.size!==void 0?n.size:null,r}return e.prototype.clone=function(){var t=this.getScale();return new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:this.size_!==null?this.size_.slice():void 0,opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},e.prototype.getAnchor=function(){var t=this.normalizedAnchor_;if(!t){t=this.anchor_;var r=this.getSize();if(this.anchorXUnits_==Ge.FRACTION||this.anchorYUnits_==Ge.FRACTION){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_==Ge.FRACTION&&(t[0]*=r[0]),this.anchorYUnits_==Ge.FRACTION&&(t[1]*=r[1])}if(this.anchorOrigin_!=zt.TOP_LEFT){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_==zt.TOP_RIGHT||this.anchorOrigin_==zt.BOTTOM_RIGHT)&&(t[0]=-t[0]+r[0]),(this.anchorOrigin_==zt.BOTTOM_LEFT||this.anchorOrigin_==zt.BOTTOM_RIGHT)&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}var n=this.getDisplacement();return[t[0]-n[0],t[1]+n[1]]},e.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},e.prototype.getColor=function(){return this.color_},e.prototype.getImage=function(t){return this.iconImage_.getImage(t)},e.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},e.prototype.getImageSize=function(){return this.iconImage_.getSize()},e.prototype.getImageState=function(){return this.iconImage_.getImageState()},e.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},e.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=zt.TOP_LEFT){var r=this.getSize(),n=this.iconImage_.getSize();if(!r||!n)return null;t=t.slice(),(this.offsetOrigin_==zt.TOP_RIGHT||this.offsetOrigin_==zt.BOTTOM_RIGHT)&&(t[0]=n[0]-r[0]-t[0]),(this.offsetOrigin_==zt.BOTTOM_LEFT||this.offsetOrigin_==zt.BOTTOM_RIGHT)&&(t[1]=n[1]-r[1]-t[1])}return this.origin_=t,this.origin_},e.prototype.getSrc=function(){return this.iconImage_.getSrc()},e.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},e.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(D.CHANGE,t)},e.prototype.load=function(){this.iconImage_.load()},e.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(D.CHANGE,t)},e}(Nh),w_=S_,ne=.5;function I_(i,e,t,r,n,a,o){var s=i[0]*ne,h=i[1]*ne,l=jt(s,h);l.imageSmoothingEnabled=!1;for(var u=l.canvas,f=new qh(l,ne,n,null,o),c=t.length,d=Math.floor((256*256*256-1)/c),v={},_=1;_<=c;++_){var p=t[_-1],y=p.getStyleFunction()||r;if(!!r){var g=y(p,a);if(!!g){Array.isArray(g)||(g=[g]);for(var m=_*d,x="#"+("000000"+m.toString(16)).slice(-6),E=0,T=g.length;E<T;++E){var M=g[E],C=M.getGeometryFunction()(p);if(!(!C||!Rt(n,C.getExtent()))){var O=M.clone(),P=O.getFill();P&&P.setColor(x);var I=O.getStroke();I&&(I.setColor(x),I.setLineDash(null)),O.setText(void 0);var F=M.getImage();if(F&&F.getOpacity()!==0){var B=F.getImageSize();if(!B)continue;var Z=jt(B[0],B[1],void 0,{alpha:!1}),$=Z.canvas;Z.fillStyle=x,Z.fillRect(0,0,$.width,$.height),O.setImage(new w_({img:$,imgSize:B,anchor:F.getAnchor(),anchorXUnits:Ge.PIXELS,anchorYUnits:Ge.PIXELS,offset:F.getOrigin(),opacity:1,size:F.getSize(),scale:F.getScale(),rotation:F.getRotation(),rotateWithView:F.getRotateWithView()}))}var H=O.getZIndex()||0,V=v[H];V||(V={},v[H]=V,V[A.POLYGON]=[],V[A.CIRCLE]=[],V[A.LINE_STRING]=[],V[A.POINT]=[]),V[C.getType().replace("Multi","")].push(C,O)}}}}}for(var K=Object.keys(v).map(Number).sort(We),_=0,q=K.length;_<q;++_){var V=v[K[_]];for(var J in V)for(var lt=V[J],E=0,T=lt.length;E<T;E+=2){f.setStyle(lt[E+1]);for(var S=0,Gt=e.length;S<Gt;++S)f.setTransform(e[S]),f.drawGeometry(lt[E])}}return l.getImageData(0,0,u.width,u.height)}function L_(i,e,t){var r=[];if(t){var n=Math.floor(Math.round(i[0])*ne),a=Math.floor(Math.round(i[1])*ne),o=(X(n,0,t.width-1)+X(a,0,t.height-1)*t.width)*4,s=t.data[o],h=t.data[o+1],l=t.data[o+2],u=l+256*(h+256*s),f=Math.floor((256*256*256-1)/e.length);u&&u%f==0&&r.push(e[u/f-1])}return r}var P_=.5,Jh={Point:k_,LineString:D_,Polygon:X_,MultiPoint:B_,MultiLineString:G_,MultiPolygon:U_,GeometryCollection:F_,Circle:A_};function b_(i,e){return parseInt(tt(i),10)-parseInt(tt(e),10)}function Qh(i,e){var t=oo(i,e);return t*t}function oo(i,e){return P_*i/e}function A_(i,e,t,r,n){var a=t.getFill(),o=t.getStroke();if(a||o){var s=i.getBuilder(t.getZIndex(),ut.CIRCLE);s.setFillStrokeStyle(a,o),s.drawCircle(e,r)}var h=t.getText();if(h&&h.getText()){var l=(n||i).getBuilder(t.getZIndex(),ut.TEXT);l.setTextStyle(h),l.drawText(e,r)}}function tl(i,e,t,r,n,a,o){var s=!1,h=t.getImage();if(h){var l=h.getImageState();l==ot.LOADED||l==ot.ERROR?h.unlistenImageChange(n):(l==ot.IDLE&&h.load(),l=h.getImageState(),h.listenImageChange(n),s=!0)}return N_(i,e,t,r,a,o),s}function N_(i,e,t,r,n,a){var o=t.getGeometryFunction()(e);if(!!o){var s=o.simplifyTransformed(r,n),h=t.getRenderer();if(h)el(i,s,t,e);else{var l=Jh[s.getType()];l(i,s,t,e,a)}}}function el(i,e,t,r){if(e.getType()==A.GEOMETRY_COLLECTION){for(var n=e.getGeometries(),a=0,o=n.length;a<o;++a)el(i,n[a],t,r);return}var s=i.getBuilder(t.getZIndex(),ut.DEFAULT);s.drawCustom(e,r,t.getRenderer(),t.getHitDetectionRenderer())}function F_(i,e,t,r,n){var a=e.getGeometriesArray(),o,s;for(o=0,s=a.length;o<s;++o){var h=Jh[a[o].getType()];h(i,a[o],t,r,n)}}function D_(i,e,t,r,n){var a=t.getStroke();if(a){var o=i.getBuilder(t.getZIndex(),ut.LINE_STRING);o.setFillStrokeStyle(null,a),o.drawLineString(e,r)}var s=t.getText();if(s&&s.getText()){var h=(n||i).getBuilder(t.getZIndex(),ut.TEXT);h.setTextStyle(s),h.drawText(e,r)}}function G_(i,e,t,r,n){var a=t.getStroke();if(a){var o=i.getBuilder(t.getZIndex(),ut.LINE_STRING);o.setFillStrokeStyle(null,a),o.drawMultiLineString(e,r)}var s=t.getText();if(s&&s.getText()){var h=(n||i).getBuilder(t.getZIndex(),ut.TEXT);h.setTextStyle(s),h.drawText(e,r)}}function U_(i,e,t,r,n){var a=t.getFill(),o=t.getStroke();if(o||a){var s=i.getBuilder(t.getZIndex(),ut.POLYGON);s.setFillStrokeStyle(a,o),s.drawMultiPolygon(e,r)}var h=t.getText();if(h&&h.getText()){var l=(n||i).getBuilder(t.getZIndex(),ut.TEXT);l.setTextStyle(h),l.drawText(e,r)}}function k_(i,e,t,r,n){var a=t.getImage(),o=t.getText(),s;if(n&&(i=n,s=a&&o&&o.getText()?{}:void 0),a){if(a.getImageState()!=ot.LOADED)return;var h=i.getBuilder(t.getZIndex(),ut.IMAGE);h.setImageStyle(a,s),h.drawPoint(e,r)}if(o&&o.getText()){var l=i.getBuilder(t.getZIndex(),ut.TEXT);l.setTextStyle(o,s),l.drawText(e,r)}}function B_(i,e,t,r,n){var a=t.getImage(),o=t.getText(),s;if(n&&(i=n,s=a&&o&&o.getText()?{}:void 0),a){if(a.getImageState()!=ot.LOADED)return;var h=i.getBuilder(t.getZIndex(),ut.IMAGE);h.setImageStyle(a,s),h.drawMultiPoint(e,r)}if(o&&o.getText()){var l=(n||i).getBuilder(t.getZIndex(),ut.TEXT);l.setTextStyle(o,s),l.drawText(e,r)}}function X_(i,e,t,r,n){var a=t.getFill(),o=t.getStroke();if(a||o){var s=i.getBuilder(t.getZIndex(),ut.POLYGON);s.setFillStrokeStyle(a,o),s.drawPolygon(e,r)}var h=t.getText();if(h&&h.getText()){var l=(n||i).getBuilder(t.getZIndex(),ut.TEXT);l.setTextStyle(h),l.drawText(e,r)}}var j_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Y_=function(i){j_(e,i);function e(t){var r=i.call(this,t)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.animatingOrInteracting_,r.dirty_=!1,r.hitDetectionImageData_=null,r.renderedFeatures_=null,r.renderedRevision_=-1,r.renderedResolution_=NaN,r.renderedExtent_=$t(),r.wrappedRenderedExtent_=$t(),r.renderedRotation_,r.renderedCenter_=null,r.renderedProjection_=null,r.renderedRenderOrder_=null,r.replayGroup_=null,r.replayGroupChanged=!0,r.declutterExecutorGroup=null,r.clipping=!0,r}return e.prototype.renderWorlds=function(t,r,n){var a=r.extent,o=r.viewState,s=o.center,h=o.resolution,l=o.projection,u=o.rotation,f=l.getExtent(),c=this.getLayer().getSource(),d=r.pixelRatio,v=r.viewHints,_=!(v[Mt.ANIMATING]||v[Mt.INTERACTING]),p=this.context,y=Math.round(r.size[0]*d),g=Math.round(r.size[1]*d),m=c.getWrapX()&&l.canWrapX(),x=m?it(f):null,E=m?Math.ceil((a[2]-f[2])/x)+1:1,T=m?Math.floor((a[0]-f[0])/x):0;do{var M=this.getRenderTransform(s,h,u,d,y,g,T*x);t.execute(p,1,M,u,_,void 0,n)}while(++T<E)},e.prototype.renderDeclutter=function(t){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree)},e.prototype.renderFrame=function(t,r){var n=t.pixelRatio,a=t.layerStatesArray[t.layerIndex];Fc(this.pixelTransform,1/n,1/n),Hs(this.inversePixelTransform,this.pixelTransform);var o=Gc(this.pixelTransform);this.useContainer(r,o,a.opacity,this.getBackground(t));var s=this.context,h=s.canvas,l=this.replayGroup_,u=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!u||u.isEmpty()))return null;var f=Math.round(t.size[0]*n),c=Math.round(t.size[1]*n);h.width!=f||h.height!=c?(h.width=f,h.height=c,h.style.transform!==o&&(h.style.transform=o)):this.containerReused||s.clearRect(0,0,f,c),this.preRender(s,t);var d=t.viewState;d.projection;var v=!1,_=!0;if(a.extent&&this.clipping){var p=Mr(a.extent);_=Rt(p,t.extent),v=_&&!Se(p,t.extent),v&&this.clipUnrotated(s,t,p)}_&&this.renderWorlds(l,t),v&&s.restore(),this.postRender(s,t);var y=Pf(a.opacity),g=this.container;return y!==g.style.opacity&&(g.style.opacity=y),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container},e.prototype.getFeatures=function(t){return new Promise(function(r){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var n=[this.context.canvas.width,this.context.canvas.height];pt(this.pixelTransform,n);var a=this.renderedCenter_,o=this.renderedResolution_,s=this.renderedRotation_,h=this.renderedProjection_,l=this.wrappedRenderedExtent_,u=this.getLayer(),f=[],c=n[0]*ne,d=n[1]*ne;f.push(this.getRenderTransform(a,o,s,ne,c,d,0).slice());var v=u.getSource(),_=h.getExtent();if(v.getWrapX()&&h.canWrapX()&&!Se(_,l)){for(var p=l[0],y=it(_),g=0,m=void 0;p<_[0];)--g,m=y*g,f.push(this.getRenderTransform(a,o,s,ne,c,d,m).slice()),p+=y;for(g=0,p=l[2];p>_[2];)++g,m=y*g,f.push(this.getRenderTransform(a,o,s,ne,c,d,m).slice()),p-=y}this.hitDetectionImageData_=I_(n,f,this.renderedFeatures_,u.getStyleFunction(),l,o,s)}r(L_(t,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},e.prototype.forEachFeatureAtCoordinate=function(t,r,n,a,o){var s=this;if(!!this.replayGroup_){var h=r.viewState.resolution,l=r.viewState.rotation,u=this.getLayer(),f={},c=function(_,p,y){var g=tt(_),m=f[g];if(m){if(m!==!0&&y<m.distanceSq){if(y===0)return f[g]=!0,o.splice(o.lastIndexOf(m),1),a(_,u,p);m.geometry=p,m.distanceSq=y}}else{if(y===0)return f[g]=!0,a(_,u,p);o.push(f[g]={feature:_,layer:u,geometry:p,distanceSq:y,callback:a})}},d,v=[this.replayGroup_];return this.declutterExecutorGroup&&v.push(this.declutterExecutorGroup),v.some(function(_){return d=_.forEachFeatureAtCoordinate(t,h,l,n,c,_===s.declutterExecutorGroup&&r.declutterTree?r.declutterTree.all().map(function(p){return p.value}):null)}),d}},e.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.prepareFrame=function(t){var r=this.getLayer(),n=r.getSource();if(!n)return!1;var a=t.viewHints[Mt.ANIMATING],o=t.viewHints[Mt.INTERACTING],s=r.getUpdateWhileAnimating(),h=r.getUpdateWhileInteracting();if(!this.dirty_&&!s&&a||!h&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var l=t.extent,u=t.viewState,f=u.projection,c=u.resolution,d=t.pixelRatio,v=r.getRevision(),_=r.getRenderBuffer(),p=r.getRenderOrder();p===void 0&&(p=b_);var y=u.center.slice(),g=ma(l,_*c),m=g.slice(),x=[g.slice()],E=f.getExtent();if(n.getWrapX()&&f.canWrapX()&&!Se(E,t.extent)){var T=it(E),M=Math.max(it(g)/2,T);g[0]=E[0]-M,g[2]=E[2]+M,Gs(y,f);var C=As(x[0],f);C[0]<E[0]&&C[2]<E[2]?x.push([C[0]+T,C[1],C[2]+T,C[3]]):C[0]>E[0]&&C[2]>E[2]&&x.push([C[0]-T,C[1],C[2]-T,C[3]])}if(!this.dirty_&&this.renderedResolution_==c&&this.renderedRevision_==v&&this.renderedRenderOrder_==p&&Se(this.wrappedRenderedExtent_,g))return $e(this.renderedExtent_,m)||(this.hitDetectionImageData_=null,this.renderedExtent_=m),this.renderedCenter_=y,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var O=new $h(oo(c,d),g,c,d),P;this.getLayer().getDeclutter()&&(P=new $h(oo(c,d),g,c,d));for(var I,F,B,F=0,B=x.length;F<B;++F)n.loadFeatures(x[F],c,f);var Z=Qh(c,d),$=function(J){var lt,S=J.getStyleFunction()||r.getStyleFunction();if(S&&(lt=S(J,c)),lt){var Gt=this.renderFeature(J,Z,lt,O,I,P);this.dirty_=this.dirty_||Gt}}.bind(this),H=zs(g),V=n.getFeaturesInExtent(H);p&&V.sort(p);for(var F=0,B=V.length;F<B;++F)$(V[F]);this.renderedFeatures_=V;var K=O.finish(),q=new Zh(g,c,d,n.getOverlaps(),K,r.getRenderBuffer());return P&&(this.declutterExecutorGroup=new Zh(g,c,d,n.getOverlaps(),P.finish(),r.getRenderBuffer())),this.renderedResolution_=c,this.renderedRevision_=v,this.renderedRenderOrder_=p,this.renderedExtent_=m,this.wrappedRenderedExtent_=g,this.renderedCenter_=y,this.renderedProjection_=f,this.replayGroup_=q,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},e.prototype.renderFeature=function(t,r,n,a,o,s){if(!n)return!1;var h=!1;if(Array.isArray(n))for(var l=0,u=n.length;l<u;++l)h=tl(a,t,n[l],r,this.boundHandleStyleImageChange_,o,s)||h;else h=tl(a,t,n,r,this.boundHandleStyleImageChange_,o,s);return h},e}(u_),z_=Y_,W_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),$_=function(i){W_(e,i);function e(t){return i.call(this,t)||this}return e.prototype.createRenderer=function(){return new z_(this)},e}(jv),so=$_,V_=function(){function i(e){this.rbush_=new Bh(e),this.items_={}}return i.prototype.insert=function(e,t){var r={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(r),this.items_[tt(t)]=r},i.prototype.load=function(e,t){for(var r=new Array(t.length),n=0,a=t.length;n<a;n++){var o=e[n],s=t[n],h={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:s};r[n]=h,this.items_[tt(s)]=h}this.rbush_.load(r)},i.prototype.remove=function(e){var t=tt(e),r=this.items_[t];return delete this.items_[t],this.rbush_.remove(r)!==null},i.prototype.update=function(e,t){var r=this.items_[tt(t)],n=[r.minX,r.minY,r.maxX,r.maxY];ti(n,e)||(this.remove(t),this.insert(e,t))},i.prototype.getAll=function(){var e=this.rbush_.all();return e.map(function(t){return t.value})},i.prototype.getInExtent=function(e){var t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]},r=this.rbush_.search(t);return r.map(function(n){return n.value})},i.prototype.forEach=function(e){return this.forEach_(this.getAll(),e)},i.prototype.forEachInExtent=function(e,t){return this.forEach_(this.getInExtent(e),t)},i.prototype.forEach_=function(e,t){for(var r,n=0,a=e.length;n<a;n++)if(r=t(e[n]),r)return r;return r},i.prototype.isEmpty=function(){return vr(this.items_)},i.prototype.clear=function(){this.rbush_.clear(),this.items_={}},i.prototype.getExtent=function(e){var t=this.rbush_.toJSON();return te(t.minX,t.minY,t.maxX,t.maxY,e)},i.prototype.concat=function(e){this.rbush_.load(e.rbush_.all());for(var t in e.items_)this.items_[t]=e.items_[t]},i}(),rl=V_,H_=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),K_=function(i){H_(e,i);function e(t){var r=i.call(this)||this;r.projection=nt(t.projection),r.attributions_=il(t.attributions),r.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,r.loading=!1,r.state_=t.state!==void 0?t.state:Oe.READY,r.wrapX_=t.wrapX!==void 0?t.wrapX:!1,r.interpolate_=!!t.interpolate,r.viewResolver=null,r.viewRejector=null;var n=r;return r.viewPromise_=new Promise(function(a,o){n.viewResolver=a,n.viewRejector=o}),r}return e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection},e.prototype.getResolutions=function(){return G()},e.prototype.getView=function(){return this.viewPromise_},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.getInterpolate=function(){return this.interpolate_},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=il(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(Zt);function il(i){return i?Array.isArray(i)?function(e){return i}:typeof i=="function"?i:function(e){return[i]}:null}var nl=K_,ae={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function Z_(i,e){return[[-1/0,-1/0,1/0,1/0]]}var Pr={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"},q_=!1;function J_(i,e,t,r,n,a,o){var s=new XMLHttpRequest;s.open("GET",typeof i=="function"?i(t,r,n):i,!0),e.getType()==Pr.ARRAY_BUFFER&&(s.responseType="arraybuffer"),s.withCredentials=q_,s.onload=function(h){if(!s.status||s.status>=200&&s.status<300){var l=e.getType(),u=void 0;l==Pr.JSON||l==Pr.TEXT?u=s.responseText:l==Pr.XML?(u=s.responseXML,u||(u=new DOMParser().parseFromString(s.responseText,"application/xml"))):l==Pr.ARRAY_BUFFER&&(u=s.response),u?a(e.readFeatures(u,{extent:t,featureProjection:n}),e.readProjection(u)):o()}else o()},s.onerror=o,s.send()}function al(i,e){return function(t,r,n,a,o){var s=this;J_(i,e,t,r,n,function(h,l){s.addFeatures(h),a!==void 0&&a(h)},o||Ve)}}var ol=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ue=function(i){ol(e,i);function e(t,r,n){var a=i.call(this,t)||this;return a.feature=r,a.features=n,a}return e}(fe),Q_=function(i){ol(e,i);function e(t){var r=this,n=t||{};r=i.call(this,{attributions:n.attributions,interpolate:!0,projection:void 0,state:Oe.READY,wrapX:n.wrapX!==void 0?n.wrapX:!0})||this,r.on,r.once,r.un,r.loader_=Ve,r.format_=n.format,r.overlaps_=n.overlaps===void 0?!0:n.overlaps,r.url_=n.url,n.loader!==void 0?r.loader_=n.loader:r.url_!==void 0&&(z(r.format_,7),r.loader_=al(r.url_,r.format_)),r.strategy_=n.strategy!==void 0?n.strategy:Z_;var a=n.useSpatialIndex!==void 0?n.useSpatialIndex:!0;r.featuresRtree_=a?new rl:null,r.loadedExtentsRtree_=new rl,r.loadingExtentsCount_=0,r.nullGeometryFeatures_={},r.idIndex_={},r.uidIndex_={},r.featureChangeKeys_={},r.featuresCollection_=null;var o,s;return Array.isArray(n.features)?s=n.features:n.features&&(o=n.features,s=o.getArray()),!a&&o===void 0&&(o=new Ut(s)),s!==void 0&&r.addFeaturesInternal(s),o!==void 0&&r.bindFeaturesCollection_(o),r}return e.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},e.prototype.addFeatureInternal=function(t){var r=tt(t);if(!this.addToIndex_(r,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(r,t);var n=t.getGeometry();if(n){var a=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(a,t)}else this.nullGeometryFeatures_[r]=t;this.dispatchEvent(new Ue(ae.ADDFEATURE,t))},e.prototype.setupChangeEvents_=function(t,r){this.featureChangeKeys_[t]=[Y(r,D.CHANGE,this.handleFeatureChange_,this),Y(r,fr.PROPERTYCHANGE,this.handleFeatureChange_,this)]},e.prototype.addToIndex_=function(t,r){var n=!0,a=r.getId();return a!==void 0&&(a.toString()in this.idIndex_?n=!1:this.idIndex_[a.toString()]=r),n&&(z(!(t in this.uidIndex_),30),this.uidIndex_[t]=r),n},e.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},e.prototype.addFeaturesInternal=function(t){for(var r=[],n=[],a=[],o=0,s=t.length;o<s;o++){var h=t[o],l=tt(h);this.addToIndex_(l,h)&&n.push(h)}for(var o=0,u=n.length;o<u;o++){var h=n[o],l=tt(h);this.setupChangeEvents_(l,h);var f=h.getGeometry();if(f){var c=f.getExtent();r.push(c),a.push(h)}else this.nullGeometryFeatures_[l]=h}this.featuresRtree_&&this.featuresRtree_.load(r,a);for(var o=0,d=n.length;o<d;o++)this.dispatchEvent(new Ue(ae.ADDFEATURE,n[o]))},e.prototype.bindFeaturesCollection_=function(t){var r=!1;this.addEventListener(ae.ADDFEATURE,function(n){r||(r=!0,t.push(n.feature),r=!1)}),this.addEventListener(ae.REMOVEFEATURE,function(n){r||(r=!0,t.remove(n.feature),r=!1)}),t.addEventListener(Pt.ADD,function(n){r||(r=!0,this.addFeature(n.element),r=!1)}.bind(this)),t.addEventListener(Pt.REMOVE,function(n){r||(r=!0,this.removeFeature(n.element),r=!1)}.bind(this)),this.featuresCollection_=t},e.prototype.clear=function(t){if(t){for(var r in this.featureChangeKeys_){var n=this.featureChangeKeys_[r];n.forEach(at)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var a=function(h){this.removeFeatureInternal(h)}.bind(this);this.featuresRtree_.forEach(a);for(var o in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[o])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var s=new Ue(ae.CLEAR);this.dispatchEvent(s),this.changed()},e.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},e.prototype.forEachFeatureAtCoordinateDirect=function(t,r){var n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(a){var o=a.getGeometry();if(o.intersectsCoordinate(t))return r(a)})},e.prototype.forEachFeatureInExtent=function(t,r){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,r);this.featuresCollection_&&this.featuresCollection_.forEach(r)},e.prototype.forEachFeatureIntersectingExtent=function(t,r){return this.forEachFeatureInExtent(t,function(n){var a=n.getGeometry();if(a.intersectsExtent(t)){var o=r(n);if(o)return o}})},e.prototype.getFeaturesCollection=function(){return this.featuresCollection_},e.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),vr(this.nullGeometryFeatures_)||ce(t,Qo(this.nullGeometryFeatures_))),t},e.prototype.getFeaturesAtCoordinate=function(t){var r=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){r.push(n)}),r},e.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_?this.featuresRtree_.getInExtent(t):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},e.prototype.getClosestFeatureToCoordinate=function(t,r){var n=t[0],a=t[1],o=null,s=[NaN,NaN],h=1/0,l=[-1/0,-1/0,1/0,1/0],u=r||cr;return this.featuresRtree_.forEachInExtent(l,function(f){if(u(f)){var c=f.getGeometry(),d=h;if(h=c.closestPointXY(n,a,s,h),h<d){o=f;var v=Math.sqrt(h);l[0]=n-v,l[1]=a-v,l[2]=n+v,l[3]=a+v}}}),o},e.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},e.prototype.getFeatureById=function(t){var r=this.idIndex_[t.toString()];return r!==void 0?r:null},e.prototype.getFeatureByUid=function(t){var r=this.uidIndex_[t];return r!==void 0?r:null},e.prototype.getFormat=function(){return this.format_},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.getUrl=function(){return this.url_},e.prototype.handleFeatureChange_=function(t){var r=t.target,n=tt(r),a=r.getGeometry();if(!a)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(r),this.nullGeometryFeatures_[n]=r);else{var o=a.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,r)):this.featuresRtree_&&this.featuresRtree_.update(o,r)}var s=r.getId();if(s!==void 0){var h=s.toString();this.idIndex_[h]!==r&&(this.removeFromIdIndex_(r),this.idIndex_[h]=r)}else this.removeFromIdIndex_(r),this.uidIndex_[n]=r;this.changed(),this.dispatchEvent(new Ue(ae.CHANGEFEATURE,r))},e.prototype.hasFeature=function(t){var r=t.getId();return r!==void 0?r in this.idIndex_:tt(t)in this.uidIndex_},e.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&vr(this.nullGeometryFeatures_)},e.prototype.loadFeatures=function(t,r,n){for(var a=this.loadedExtentsRtree_,o=this.strategy_(t,r,n),s=function(f,c){var d=o[f],v=a.forEachInExtent(d,function(_){return Se(_.extent,d)});v||(++h.loadingExtentsCount_,h.dispatchEvent(new Ue(ae.FEATURESLOADSTART)),h.loader_.call(h,d,r,n,function(_){--this.loadingExtentsCount_,this.dispatchEvent(new Ue(ae.FEATURESLOADEND,void 0,_))}.bind(h),function(){--this.loadingExtentsCount_,this.dispatchEvent(new Ue(ae.FEATURESLOADERROR))}.bind(h)),a.insert(d,{extent:d.slice()}))},h=this,l=0,u=o.length;l<u;++l)s(l);this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0},e.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),i.prototype.refresh.call(this)},e.prototype.removeLoadedExtent=function(t){var r=this.loadedExtentsRtree_,n;r.forEachInExtent(t,function(a){if(ti(a.extent,t))return n=a,!0}),n&&r.remove(n)},e.prototype.removeFeature=function(t){if(!!t){var r=tt(t);r in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[r]:this.featuresRtree_&&this.featuresRtree_.remove(t);var n=this.removeFeatureInternal(t);n&&this.changed()}},e.prototype.removeFeatureInternal=function(t){var r=tt(t),n=this.featureChangeKeys_[r];if(!!n){n.forEach(at),delete this.featureChangeKeys_[r];var a=t.getId();return a!==void 0&&delete this.idIndex_[a.toString()],delete this.uidIndex_[r],this.dispatchEvent(new Ue(ae.REMOVEFEATURE,t)),t}},e.prototype.removeFromIdIndex_=function(t){var r=!1;for(var n in this.idIndex_)if(this.idIndex_[n]===t){delete this.idIndex_[n],r=!0;break}return r},e.prototype.setLoader=function(t){this.loader_=t},e.prototype.setUrl=function(t){z(this.format_,7),this.url_=t,this.setLoader(al(t,this.format_))},e}(nl),ho=Q_;function tp(i){if(!(i.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");var e=i.inversePixelTransform[0],t=i.frameState,r=Aa(i.inversePixelTransform.slice(),t.coordinateToPixelTransform),n=Qh(t.viewState.resolution,e),a;return new qh(i.context,e,t.extent,r,t.viewState.rotation,n,a)}function sl(i,e,t){for(var r=[],n=i(0),a=i(1),o=e(n),s=e(a),h=[a,n],l=[s,o],u=[1,0],f={},c=1e5,d,v,_,p,y,g;--c>0&&u.length>0;)_=u.pop(),n=h.pop(),o=l.pop(),g=_.toString(),g in f||(r.push(o[0],o[1]),f[g]=!0),p=u.pop(),a=h.pop(),s=l.pop(),y=(_+p)/2,d=i(y),v=e(d),fs(v[0],v[1],o[0],o[1],s[0],s[1])<t?(r.push(s[0],s[1]),g=p.toString(),f[g]=!0):(u.push(p,y,y,_),l.push(s,v,v,o),h.push(a,d,d,n));return r}function ep(i,e,t,r,n){var a=nt("EPSG:4326");return sl(function(o){return[i,e+(t-e)*o]},Ie(a,r),n)}function rp(i,e,t,r,n){var a=nt("EPSG:4326");return sl(function(o){return[e+(t-e)*o,i]},Ie(a,r),n)}var ip=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),np=new Sr({color:"rgba(0,0,0,0.2)"}),ap=[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],op=function(i){ip(e,i);function e(t){var r=this,n=t||{},a=vt({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},n);return delete a.maxLines,delete a.strokeStyle,delete a.targetSize,delete a.showLabels,delete a.lonLabelFormatter,delete a.latLabelFormatter,delete a.lonLabelPosition,delete a.latLabelPosition,delete a.lonLabelStyle,delete a.latLabelStyle,delete a.intervals,r=i.call(this,a)||this,r.projection_=null,r.maxLat_=1/0,r.maxLon_=1/0,r.minLat_=-1/0,r.minLon_=-1/0,r.maxX_=1/0,r.maxY_=1/0,r.minX_=-1/0,r.minY_=-1/0,r.targetSize_=n.targetSize!==void 0?n.targetSize:100,r.maxLines_=n.maxLines!==void 0?n.maxLines:100,r.meridians_=[],r.parallels_=[],r.strokeStyle_=n.strokeStyle!==void 0?n.strokeStyle:np,r.fromLonLatTransform_=void 0,r.toLonLatTransform_=void 0,r.projectionCenterLonLat_=null,r.bottomLeft_=null,r.bottomRight_=null,r.topLeft_=null,r.topRight_=null,r.meridiansLabels_=null,r.parallelsLabels_=null,n.showLabels&&(r.lonLabelFormatter_=n.lonLabelFormatter==null?Ds.bind(r,"EW"):n.lonLabelFormatter,r.latLabelFormatter_=n.latLabelFormatter==null?Ds.bind(r,"NS"):n.latLabelFormatter,r.lonLabelPosition_=n.lonLabelPosition==null?0:n.lonLabelPosition,r.latLabelPosition_=n.latLabelPosition==null?1:n.latLabelPosition,r.lonLabelStyleBase_=new pi({text:n.lonLabelStyle!==void 0?n.lonLabelStyle.clone():new Uh({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new vi({color:"rgba(0,0,0,1)"}),stroke:new Sr({color:"rgba(255,255,255,1)",width:3})})}),r.lonLabelStyle_=function(o){var s=o.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(s),this.lonLabelStyleBase_}.bind(r),r.latLabelStyleBase_=new pi({text:n.latLabelStyle!==void 0?n.latLabelStyle.clone():new Uh({font:"12px Calibri,sans-serif",textAlign:"right",fill:new vi({color:"rgba(0,0,0,1)"}),stroke:new Sr({color:"rgba(255,255,255,1)",width:3})})}),r.latLabelStyle_=function(o){var s=o.get("graticule_label");return this.latLabelStyleBase_.getText().setText(s),this.latLabelStyleBase_}.bind(r),r.meridiansLabels_=[],r.parallelsLabels_=[],r.addEventListener(Lt.POSTRENDER,r.drawLabels_.bind(r))),r.intervals_=n.intervals!==void 0?n.intervals:ap,r.setSource(new ho({loader:r.loaderFunction.bind(r),strategy:r.strategyFunction.bind(r),features:new Ut,overlaps:!1,useSpatialIndex:!1,wrapX:n.wrapX})),r.featurePool_=[],r.lineStyle_=new pi({stroke:r.strokeStyle_}),r.loadedExtent_=null,r.renderedExtent_=null,r.setRenderOrder(null),r}return e.prototype.strategyFunction=function(t,r){var n=t.slice();return this.projection_&&this.getSource().getWrapX()&&As(n,this.projection_),this.loadedExtent_&&(pc(this.loadedExtent_,n,r)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]},e.prototype.loaderFunction=function(t,r,n){this.loadedExtent_=t;var a=this.getSource(),o=this.getExtent()||[-1/0,-1/0,1/0,1/0],s=er(o,t);if(!(this.renderedExtent_&&ti(this.renderedExtent_,s))&&(this.renderedExtent_=s,!ri(s))){var h=ee(s),l=r*r/4,u=!this.projection_||!we(this.projection_,n);u&&this.updateProjectionInfo_(n),this.createGraticule_(s,h,r,l);var f=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(f+=this.meridians_.length),this.parallelsLabels_&&(f+=this.parallels_.length);for(var c;f>this.featurePool_.length;)c=new Ph,this.featurePool_.push(c);var d=a.getFeaturesCollection();d.clear();var v=0,_,p;for(_=0,p=this.meridians_.length;_<p;++_)c=this.featurePool_[v++],c.setGeometry(this.meridians_[_]),c.setStyle(this.lineStyle_),d.push(c);for(_=0,p=this.parallels_.length;_<p;++_)c=this.featurePool_[v++],c.setGeometry(this.parallels_[_]),c.setStyle(this.lineStyle_),d.push(c)}},e.prototype.addMeridian_=function(t,r,n,a,o,s){var h=this.getMeridian_(t,r,n,a,s);if(Rt(h.getExtent(),o)){if(this.meridiansLabels_){var l=this.lonLabelFormatter_(t);s in this.meridiansLabels_?this.meridiansLabels_[s].text=l:this.meridiansLabels_[s]={geom:new Or([]),text:l}}this.meridians_[s++]=h}return s},e.prototype.addParallel_=function(t,r,n,a,o,s){var h=this.getParallel_(t,r,n,a,s);if(Rt(h.getExtent(),o)){if(this.parallelsLabels_){var l=this.latLabelFormatter_(t);s in this.parallelsLabels_?this.parallelsLabels_[s].text=l:this.parallelsLabels_[s]={geom:new Or([]),text:l}}this.parallels_[s++]=h}return s},e.prototype.drawLabels_=function(t){var r=t.frameState.viewState.rotation,n=t.frameState.extent,a=ee(n),o=n;if(r){var s=it(n),h=Yt(n),l=Math.abs(Math.cos(r)),u=Math.abs(Math.sin(r)),f=(u*h-l*s)/(u*u-l*l),c=(u*s-l*h)/(u*u-l*l);o=[a[0]-f/2,a[1]-c/2,a[0]+f/2,a[1]+c/2]}var d=0,v=0,_=this.latLabelPosition_<.5,p=this.projection_.getExtent(),y=it(p);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Se(p,n)){d=Math.floor((n[0]-p[0])/y),v=Math.ceil((n[2]-p[2])/y);var g=Math.abs(r)>Math.PI/2;_=_!==g}for(var m=tp(t),x=d;x<=v;++x){var E=this.meridians_.length+this.parallels_.length,T=void 0,M=void 0,C=void 0,O=void 0;if(this.meridiansLabels_)for(M=0,C=this.meridiansLabels_.length;M<C;++M){var P=this.meridians_[M];if(!r&&x===0)O=this.getMeridianPoint_(P,n,M);else{var I=P.clone();I.translate(x*y,0),I.rotate(-r,a),O=this.getMeridianPoint_(I,o,M),O.rotate(r,a)}T=this.featurePool_[E++],T.setGeometry(O),T.set("graticule_label",this.meridiansLabels_[M].text),m.drawFeature(T,this.lonLabelStyle_(T))}if(this.parallelsLabels_&&(x===d&&_||x===v&&!_))for(M=0,C=this.parallels_.length;M<C;++M){var P=this.parallels_[M];if(!r&&x===0)O=this.getParallelPoint_(P,n,M);else{var I=P.clone();I.translate(x*y,0),I.rotate(-r,a),O=this.getParallelPoint_(I,o,M),O.rotate(r,a)}T=this.featurePool_[E++],T.setGeometry(O),T.set("graticule_label",this.parallelsLabels_[M].text),m.drawFeature(T,this.latLabelStyle_(T))}}},e.prototype.createGraticule_=function(t,r,n,a){var o=this.getInterval_(n);if(o==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}var s=!1,h=this.projection_.getExtent(),l=it(h);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Se(h,t)&&(it(t)>=l?(t[0]=h[0],t[2]=h[2]):s=!0);var u=[X(r[0],this.minX_,this.maxX_),X(r[1],this.minY_,this.maxY_)],f=this.toLonLatTransform_(u);isNaN(f[1])&&(f[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);var c=X(f[0],this.minLon_,this.maxLon_),d=X(f[1],this.minLat_,this.maxLat_),v=this.maxLines_,_,p,y,g,m=t;s||(m=[X(t[0],this.minX_,this.maxX_),X(t[1],this.minY_,this.maxY_),X(t[2],this.minX_,this.maxX_),X(t[3],this.minY_,this.maxY_)]);var x=bs(m,this.toLonLatTransform_,void 0,8),E=x[3],T=x[2],M=x[1],C=x[0];if(s||(ve(m,this.bottomLeft_)&&(C=this.minLon_,M=this.minLat_),ve(m,this.bottomRight_)&&(T=this.maxLon_,M=this.minLat_),ve(m,this.topLeft_)&&(C=this.minLon_,E=this.maxLat_),ve(m,this.topRight_)&&(T=this.maxLon_,E=this.maxLat_),E=X(E,d,this.maxLat_),T=X(T,c,this.maxLon_),M=X(M,this.minLat_,d),C=X(C,this.minLon_,c)),c=Math.floor(c/o)*o,g=X(c,this.minLon_,this.maxLon_),p=this.addMeridian_(g,M,E,a,t,0),_=0,s)for(;(g-=o)>=C&&_++<v;)p=this.addMeridian_(g,M,E,a,t,p);else for(;g!=this.minLon_&&_++<v;)g=Math.max(g-o,this.minLon_),p=this.addMeridian_(g,M,E,a,t,p);if(g=X(c,this.minLon_,this.maxLon_),_=0,s)for(;(g+=o)<=T&&_++<v;)p=this.addMeridian_(g,M,E,a,t,p);else for(;g!=this.maxLon_&&_++<v;)g=Math.min(g+o,this.maxLon_),p=this.addMeridian_(g,M,E,a,t,p);for(this.meridians_.length=p,this.meridiansLabels_&&(this.meridiansLabels_.length=p),d=Math.floor(d/o)*o,y=X(d,this.minLat_,this.maxLat_),p=this.addParallel_(y,C,T,a,t,0),_=0;y!=this.minLat_&&_++<v;)y=Math.max(y-o,this.minLat_),p=this.addParallel_(y,C,T,a,t,p);for(y=X(d,this.minLat_,this.maxLat_),_=0;y!=this.maxLat_&&_++<v;)y=Math.min(y+o,this.maxLat_),p=this.addParallel_(y,C,T,a,t,p);this.parallels_.length=p,this.parallelsLabels_&&(this.parallelsLabels_.length=p)},e.prototype.getInterval_=function(t){for(var r=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1],a=-1,o=Math.pow(this.targetSize_*t,2),s=[],h=[],l=0,u=this.intervals_.length;l<u;++l){var f=X(this.intervals_[l]/2,0,90),c=X(n,-90+f,90-f);s[0]=r-f,s[1]=c-f,h[0]=r+f,h[1]=c+f,this.fromLonLatTransform_(s,s),this.fromLonLatTransform_(h,h);var d=Math.pow(h[0]-s[0],2)+Math.pow(h[1]-s[1],2);if(d<=o)break;a=this.intervals_[l]}return a},e.prototype.getMeridian_=function(t,r,n,a,o){var s=ep(t,r,n,this.projection_,a),h=this.meridians_[o];return h?(h.setFlatCoordinates(ht.XY,s),h.changed()):(h=new _i(s,ht.XY),this.meridians_[o]=h),h},e.prototype.getMeridianPoint_=function(t,r,n){var a=t.getFlatCoordinates(),o=1,s=a.length-1;a[o]>a[s]&&(o=s,s=1);var h=Math.max(r[1],a[o]),l=Math.min(r[3],a[s]),u=X(r[1]+Math.abs(r[1]-r[3])*this.lonLabelPosition_,h,l),f=a[o-1]+(a[s-1]-a[o-1])*(u-a[o])/(a[s]-a[o]),c=[f,u],d=this.meridiansLabels_[n].geom;return d.setCoordinates(c),d},e.prototype.getMeridians=function(){return this.meridians_},e.prototype.getParallel_=function(t,r,n,a,o){var s=rp(t,r,n,this.projection_,a),h=this.parallels_[o];return h?(h.setFlatCoordinates(ht.XY,s),h.changed()):h=new _i(s,ht.XY),h},e.prototype.getParallelPoint_=function(t,r,n){var a=t.getFlatCoordinates(),o=0,s=a.length-2;a[o]>a[s]&&(o=s,s=0);var h=Math.max(r[0],a[o]),l=Math.min(r[2],a[s]),u=X(r[0]+Math.abs(r[0]-r[2])*this.latLabelPosition_,h,l),f=a[o+1]+(a[s+1]-a[o+1])*(u-a[o])/(a[s]-a[o]),c=[u,f],d=this.parallelsLabels_[n].geom;return d.setCoordinates(c),d},e.prototype.getParallels=function(){return this.parallels_},e.prototype.updateProjectionInfo_=function(t){var r=nt("EPSG:4326"),n=t.getWorldExtent();this.maxLat_=n[3],this.maxLon_=n[2],this.minLat_=n[1],this.minLon_=n[0];var a=Ie(t,r);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=a;else{var o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(h,l,u){for(var f=u||2,c=a(h,l,f),d=0,v=c.length;d<v;d+=f)c[d]<o&&(c[d]+=360);return c}}this.fromLonLatTransform_=Ie(r,t);var s=bs([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(ee(t.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=t},e}(so),sp=op,An={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},hp=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),lp=function(i){hp(e,i);function e(t){var r=this,n=t||{},a=vt({},n);return delete a.preload,delete a.useInterimTilesOnError,r=i.call(this,a)||this,r.on,r.once,r.un,r.setPreload(n.preload!==void 0?n.preload:0),r.setUseInterimTilesOnError(n.useInterimTilesOnError!==void 0?n.useInterimTilesOnError:!0),r}return e.prototype.getPreload=function(){return this.get(An.PRELOAD)},e.prototype.setPreload=function(t){this.set(An.PRELOAD,t)},e.prototype.getUseInterimTilesOnError=function(){return this.get(An.USE_INTERIM_TILES_ON_ERROR)},e.prototype.setUseInterimTilesOnError=function(t){this.set(An.USE_INTERIM_TILES_ON_ERROR,t)},e}(fn),up=lp,fp=function(){function i(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return i.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},i.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},i.prototype.containsKey=function(e){return this.entries_.hasOwnProperty(e)},i.prototype.forEach=function(e){for(var t=this.oldest_;t;)e(t.value_,t.key_,this),t=t.newer},i.prototype.get=function(e,t){var r=this.entries_[e];return z(r!==void 0,15),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_},i.prototype.remove=function(e){var t=this.entries_[e];return z(t!==void 0,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_},i.prototype.getCount=function(){return this.count_},i.prototype.getKeys=function(){var e=new Array(this.count_),t=0,r;for(r=this.newest_;r;r=r.older)e[t++]=r.key_;return e},i.prototype.getValues=function(){var e=new Array(this.count_),t=0,r;for(r=this.newest_;r;r=r.older)e[t++]=r.value_;return e},i.prototype.peekLast=function(){return this.oldest_.value_},i.prototype.peekLastKey=function(){return this.oldest_.key_},i.prototype.peekFirstKey=function(){return this.newest_.key_},i.prototype.pop=function(){var e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_},i.prototype.replace=function(e,t){this.get(e),this.entries_[e].value_=t},i.prototype.set=function(e,t){z(!(e in this.entries_),16);var r={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[e]=r,++this.count_},i.prototype.setSize=function(e){this.highWaterMark=e},i}(),hl=fp,ll=function(){function i(e,t,r,n){this.minX=e,this.maxX=t,this.minY=r,this.maxY=n}return i.prototype.contains=function(e){return this.containsXY(e[1],e[2])},i.prototype.containsTileRange=function(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY},i.prototype.containsXY=function(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY},i.prototype.equals=function(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY},i.prototype.extend=function(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)},i.prototype.getHeight=function(){return this.maxY-this.minY+1},i.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},i.prototype.getWidth=function(){return this.maxX-this.minX+1},i.prototype.intersects=function(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY},i}();function br(i,e,t,r,n){return n!==void 0?(n.minX=i,n.maxX=e,n.minY=t,n.maxY=r,n):new ll(i,e,t,r)}var ul=ll,cp=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),dp=function(i){cp(e,i);function e(t,r,n){var a=i.call(this)||this,o=n||{};return a.tileCoord=t,a.state=r,a.interimTile=null,a.key="",a.transition_=o.transition===void 0?250:o.transition,a.transitionStarts_={},a.interpolate=!!o.interpolate,a}return e.prototype.changed=function(){this.dispatchEvent(D.CHANGE)},e.prototype.release=function(){},e.prototype.getKey=function(){return this.key+"/"+this.tileCoord},e.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==k.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this},e.prototype.refreshInterimChain=function(){if(!!this.interimTile){var t=this.interimTile,r=this;do{if(t.getState()==k.LOADED){t.interimTile=null;break}else t.getState()==k.LOADING?r=t:t.getState()==k.IDLE?r.interimTile=t.interimTile:r=t;t=r.interimTile}while(t)}},e.prototype.getTileCoord=function(){return this.tileCoord},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){if(this.state!==k.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},e.prototype.load=function(){G()},e.prototype.getAlpha=function(t,r){if(!this.transition_)return 1;var n=this.transitionStarts_[t];if(!n)n=r,this.transitionStarts_[t]=n;else if(n===-1)return 1;var a=r-n+1e3/60;return a>=this.transition_?1:ps(a/this.transition_)},e.prototype.inTransition=function(t){return this.transition_?this.transitionStarts_[t]!==-1:!1},e.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},e}(He),fl=dp,vp=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),_p=function(i){vp(e,i);function e(t,r,n,a,o,s){var h=i.call(this,t,r,s)||this;return h.crossOrigin_=a,h.src_=n,h.key=n,h.image_=new Image,a!==null&&(h.image_.crossOrigin=a),h.unlisten_=null,h.tileLoadFunction_=o,h}return e.prototype.getImage=function(){return this.image_},e.prototype.setImage=function(t){this.image_=t,this.state=k.LOADED,this.unlistenImage_(),this.changed()},e.prototype.handleImageError_=function(){this.state=k.ERROR,this.unlistenImage_(),this.image_=pp(),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=k.LOADED:this.state=k.EMPTY,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state==k.ERROR&&(this.state=k.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==k.IDLE&&(this.state=k.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=ao(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(fl);function pp(){var i=jt(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}var lo=_p,gp=.5,xe=!0,yp=10,cl=.25,mp=function(){function i(e,t,r,n,a,o){this.sourceProj_=e,this.targetProj_=t;var s={},h=Ie(this.targetProj_,this.sourceProj_);this.transformInv_=function(m){var x=m[0]+"/"+m[1];return s[x]||(s[x]=h(m)),s[x]},this.maxSourceExtent_=n,this.errorThresholdSquared_=a*a,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&it(n)==it(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?it(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?it(this.targetProj_.getExtent()):null;var l=Tr(r),u=pn(r),f=_n(r),c=vn(r),d=this.transformInv_(l),v=this.transformInv_(u),_=this.transformInv_(f),p=this.transformInv_(c),y=yp+(o?Math.max(0,Math.ceil(us(Ta(r)/(o*o*256*256)))):0);if(this.addQuad_(l,u,f,c,d,v,_,p,y),this.wrapsXInSource_){var g=1/0;this.triangles_.forEach(function(m,x,E){g=Math.min(g,m.source[0][0],m.source[1][0],m.source[2][0])}),this.triangles_.forEach(function(m){if(Math.max(m.source[0][0],m.source[1][0],m.source[2][0])-g>this.sourceWorldWidth_/2){var x=[[m.source[0][0],m.source[0][1]],[m.source[1][0],m.source[1][1]],[m.source[2][0],m.source[2][1]]];x[0][0]-g>this.sourceWorldWidth_/2&&(x[0][0]-=this.sourceWorldWidth_),x[1][0]-g>this.sourceWorldWidth_/2&&(x[1][0]-=this.sourceWorldWidth_),x[2][0]-g>this.sourceWorldWidth_/2&&(x[2][0]-=this.sourceWorldWidth_);var E=Math.min(x[0][0],x[1][0],x[2][0]),T=Math.max(x[0][0],x[1][0],x[2][0]);T-E<this.sourceWorldWidth_/2&&(m.source=x)}}.bind(this))}s={}}return i.prototype.addTriangle_=function(e,t,r,n,a,o){this.triangles_.push({source:[n,a,o],target:[e,t,r]})},i.prototype.addQuad_=function(e,t,r,n,a,o,s,h,l){var u=Os([a,o,s,h]),f=this.sourceWorldWidth_?it(u)/this.sourceWorldWidth_:null,c=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&f>.5&&f<1,v=!1;if(l>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var _=Os([e,t,r,n]),p=it(_)/this.targetWorldWidth_;v=p>cl||v}!d&&this.sourceProj_.isGlobal()&&f&&(v=f>cl||v)}if(!(!v&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!Rt(u,this.maxSourceExtent_))){var y=0;if(!v&&(!isFinite(a[0])||!isFinite(a[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(h[0])||!isFinite(h[1]))){if(l>0)v=!0;else if(y=(!isFinite(a[0])||!isFinite(a[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(s[0])||!isFinite(s[1])?2:0)+(!isFinite(h[0])||!isFinite(h[1])?1:0),y!=1&&y!=2&&y!=4&&y!=8)return}if(l>0){if(!v){var g=[(e[0]+r[0])/2,(e[1]+r[1])/2],m=this.transformInv_(g),x=void 0;if(d){var E=(qe(a[0],c)+qe(s[0],c))/2;x=E-qe(m[0],c)}else x=(a[0]+s[0])/2-m[0];var T=(a[1]+s[1])/2-m[1],M=x*x+T*T;v=M>this.errorThresholdSquared_}if(v){if(Math.abs(e[0]-r[0])<=Math.abs(e[1]-r[1])){var C=[(t[0]+r[0])/2,(t[1]+r[1])/2],O=this.transformInv_(C),P=[(n[0]+e[0])/2,(n[1]+e[1])/2],I=this.transformInv_(P);this.addQuad_(e,t,C,P,a,o,O,I,l-1),this.addQuad_(P,C,r,n,I,O,s,h,l-1)}else{var F=[(e[0]+t[0])/2,(e[1]+t[1])/2],B=this.transformInv_(F),Z=[(r[0]+n[0])/2,(r[1]+n[1])/2],$=this.transformInv_(Z);this.addQuad_(e,F,Z,n,a,B,$,h,l-1),this.addQuad_(F,t,r,Z,B,o,s,$,l-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(y&11)==0&&this.addTriangle_(e,r,n,a,s,h),(y&14)==0&&this.addTriangle_(e,r,t,a,s,o),y&&((y&13)==0&&this.addTriangle_(t,n,e,o,h,a),(y&7)==0&&this.addTriangle_(t,n,r,o,h,s))}},i.prototype.calculateSourceExtent=function(){var e=$t();return this.triangles_.forEach(function(t,r,n){var a=t.source;ei(e,a[0]),ei(e,a[1]),ei(e,a[2])}),e},i.prototype.getTriangles=function(){return this.triangles_},i}(),xp=mp,dl={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},uo;function vl(i,e,t,r,n){i.beginPath(),i.moveTo(0,0),i.lineTo(e,t),i.lineTo(r,n),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(e,r)+1,Math.max(t,n)),i.restore()}function fo(i,e){return Math.abs(i[e*4]-210)>2||Math.abs(i[e*4+3]-.75*255)>2}function Ep(){if(uo===void 0){var i=document.createElement("canvas").getContext("2d");i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",vl(i,4,5,4,0),vl(i,4,5,0,5);var e=i.getImageData(0,0,3,3).data;uo=fo(e,0)||fo(e,4)||fo(e,8)}return uo}function _l(i,e,t,r){var n=js(t,e,i),a=Bs(e,r,t),o=e.getMetersPerUnit();o!==void 0&&(a*=o);var s=i.getMetersPerUnit();s!==void 0&&(a/=s);var h=i.getExtent();if(!h||ve(h,n)){var l=Bs(i,a,n)/a;isFinite(l)&&l>0&&(a/=l)}return a}function Tp(i,e,t,r){var n=ee(t),a=_l(i,e,n,r);return(!isFinite(a)||a<=0)&&Ps(t,function(o){return a=_l(i,e,o,r),isFinite(a)&&a>0}),a}function Mp(i,e,t,r,n,a,o,s,h,l,u,f){var c=jt(Math.round(t*i),Math.round(t*e));if(f||vt(c,dl),h.length===0)return c.canvas;c.scale(t,t);function d(x){return Math.round(x*t)/t}c.globalCompositeOperation="lighter";var v=$t();h.forEach(function(x,E,T){Is(v,x.extent)});var _=it(v),p=Yt(v),y=jt(Math.round(t*_/r),Math.round(t*p/r));f||vt(y,dl);var g=t/r;h.forEach(function(x,E,T){var M=x.extent[0]-v[0],C=-(x.extent[3]-v[3]),O=it(x.extent),P=Yt(x.extent);x.image.width>0&&x.image.height>0&&y.drawImage(x.image,l,l,x.image.width-2*l,x.image.height-2*l,M*g,C*g,O*g,P*g)});var m=Tr(o);return s.getTriangles().forEach(function(x,E,T){var M=x.source,C=x.target,O=M[0][0],P=M[0][1],I=M[1][0],F=M[1][1],B=M[2][0],Z=M[2][1],$=d((C[0][0]-m[0])/a),H=d(-(C[0][1]-m[1])/a),V=d((C[1][0]-m[0])/a),K=d(-(C[1][1]-m[1])/a),q=d((C[2][0]-m[0])/a),J=d(-(C[2][1]-m[1])/a),lt=O,S=P;O=0,P=0,I-=lt,F-=S,B-=lt,Z-=S;var Gt=[[I,F,0,0,V-$],[B,Z,0,0,q-$],[0,0,I,F,K-H],[0,0,B,Z,J-H]],gt=Ff(Gt);if(!!gt){if(c.save(),c.beginPath(),Ep()||!f){c.moveTo(V,K);for(var wt=4,Kt=$-V,Me=H-K,kt=0;kt<wt;kt++)c.lineTo(V+d((kt+1)*Kt/wt),K+d(kt*Me/(wt-1))),kt!=wt-1&&c.lineTo(V+d((kt+1)*Kt/wt),K+d((kt+1)*Me/(wt-1)));c.lineTo(q,J)}else c.moveTo(V,K),c.lineTo($,H),c.lineTo(q,J);c.clip(),c.transform(gt[0],gt[2],gt[1],gt[3],$,H),c.translate(v[0]-lt,v[3]-S),c.scale(r/t,-r/t),c.drawImage(y.canvas,0,0),c.restore()}}),u&&(c.save(),c.globalCompositeOperation="source-over",c.strokeStyle="black",c.lineWidth=1,s.getTriangles().forEach(function(x,E,T){var M=x.target,C=(M[0][0]-m[0])/a,O=-(M[0][1]-m[1])/a,P=(M[1][0]-m[0])/a,I=-(M[1][1]-m[1])/a,F=(M[2][0]-m[0])/a,B=-(M[2][1]-m[1])/a;c.beginPath(),c.moveTo(P,I),c.lineTo(C,O),c.lineTo(F,B),c.closePath(),c.stroke()}),c.restore()),c.canvas}var Cp=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Rp=function(i){Cp(e,i);function e(t,r,n,a,o,s,h,l,u,f,c,d){var v=i.call(this,o,k.IDLE,{interpolate:!!d})||this;v.renderEdges_=c!==void 0?c:!1,v.pixelRatio_=h,v.gutter_=l,v.canvas_=null,v.sourceTileGrid_=r,v.targetTileGrid_=a,v.wrappedTileCoord_=s||o,v.sourceTiles_=[],v.sourcesListenerKeys_=null,v.sourceZ_=0;var _=a.getTileCoordExtent(v.wrappedTileCoord_),p=v.targetTileGrid_.getExtent(),y=v.sourceTileGrid_.getExtent(),g=p?er(_,p):_;if(Ta(g)===0)return v.state=k.EMPTY,v;var m=t.getExtent();m&&(y?y=er(y,m):y=m);var x=a.getResolution(v.wrappedTileCoord_[0]),E=Tp(t,n,g,x);if(!isFinite(E)||E<=0)return v.state=k.EMPTY,v;var T=f!==void 0?f:gp;if(v.triangulation_=new xp(t,n,g,y,E*T,x),v.triangulation_.getTriangles().length===0)return v.state=k.EMPTY,v;v.sourceZ_=r.getZForResolution(E);var M=v.triangulation_.calculateSourceExtent();if(y&&(t.canWrapX()?(M[1]=X(M[1],y[1],y[3]),M[3]=X(M[3],y[1],y[3])):M=er(M,y)),!Ta(M))v.state=k.EMPTY;else{for(var C=r.getTileRangeForExtentAndZ(M,v.sourceZ_),O=C.minX;O<=C.maxX;O++)for(var P=C.minY;P<=C.maxY;P++){var I=u(v.sourceZ_,O,P,h);I&&v.sourceTiles_.push(I)}v.sourceTiles_.length===0&&(v.state=k.EMPTY)}return v}return e.prototype.getImage=function(){return this.canvas_},e.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(u,f,c){u&&u.getState()==k.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(u.tileCoord),image:u.getImage()})}.bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=k.ERROR;else{var r=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(r),a=typeof n=="number"?n:n[0],o=typeof n=="number"?n:n[1],s=this.targetTileGrid_.getResolution(r),h=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Mp(a,o,this.pixelRatio_,h,this.sourceTileGrid_.getExtent(),s,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=k.LOADED}this.changed()},e.prototype.load=function(){if(this.state==k.IDLE){this.state=k.LOADING,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(r,n,a){var o=r.getState();if(o==k.IDLE||o==k.LOADING){t++;var s=Y(r,D.CHANGE,function(h){var l=r.getState();(l==k.LOADED||l==k.ERROR||l==k.EMPTY)&&(at(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}.bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(r,n,a){var o=r.getState();o==k.IDLE&&r.load()})}},e.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(at),this.sourcesListenerKeys_=null},e}(fl),pl=Rp,co=34962,vo=34963,Op=35040,_o=35044,Sp=35048,wp=5121,Ip=5123,Lp=5125,gl=5126,yl=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function ml(i,e){for(var t=vt({preserveDrawingBuffer:!0},e),r=yl.length,n=0;n<r;++n)try{var a=i.getContext(yl[n],t);if(a)return a}catch{}return null}var Pp={STATIC_DRAW:_o,STREAM_DRAW:Op,DYNAMIC_DRAW:Sp},bp=function(){function i(e,t){this.array=null,this.type=e,z(e===co||e===vo,62),this.usage=t!==void 0?t:Pp.STATIC_DRAW}return i.prototype.ofSize=function(e){this.array=new(po(this.type))(e)},i.prototype.fromArray=function(e){var t=po(this.type);this.array=t.from?t.from(e):new t(e)},i.prototype.fromArrayBuffer=function(e){this.array=new(po(this.type))(e)},i.prototype.getType=function(){return this.type},i.prototype.getArray=function(){return this.array},i.prototype.getUsage=function(){return this.usage},i.prototype.getSize=function(){return this.array?this.array.length:0},i}();function po(i){switch(i){case co:return Float32Array;case vo:return Uint32Array;default:return Float32Array}}var xl=bp,Ap=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function El(i,e,t){var r=t?i.LINEAR:i.NEAREST;i.bindTexture(i.TEXTURE_2D,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,r)}function Np(i,e,t,r){El(i,e,r),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)}function Tl(i,e,t,r,n,a){var o=i.getGL();El(o,e,a);var s=t.byteLength/r[1],h=1;s%8==0?h=8:s%4==0?h=4:s%2==0&&(h=2);var l;switch(n){case 1:{l=o.LUMINANCE;break}case 2:{l=o.LUMINANCE_ALPHA;break}case 3:{l=o.RGB;break}case 4:{l=o.RGBA;break}default:throw new Error("Unsupported number of bands: "+n)}var u;t instanceof Float32Array?(u=o.FLOAT,i.getExtension("OES_texture_float"),i.getExtension("OES_texture_float_linear")):u=o.UNSIGNED_BYTE;var f=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,h),o.texImage2D(o.TEXTURE_2D,0,l,r[0],r[1],0,l,u,t),o.pixelStorei(o.UNPACK_ALIGNMENT,f)}var Fp=function(i){Ap(e,i);function e(t,r,n){var a=i.call(this)||this;a.tile,a.textures=[],a.handleTileChange_=a.handleTileChange_.bind(a),a.size=At(r.getTileSize(t.tileCoord[0])),a.bandCount=NaN,a.helper_=n;var o=new xl(co,_o);return o.fromArray([0,1,1,1,1,0,0,0]),n.flushBufferData(o),a.coords=o,a.setTile(t),a}return e.prototype.setTile=function(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(D.CHANGE,this.handleTileChange_),this.tile=t,this.textures.length=0,this.loaded=t.getState()===k.LOADED,this.loaded)this.uploadTile_();else{if(t instanceof lo){var r=t.getImage();r instanceof Image&&!r.crossOrigin&&(r.crossOrigin="anonymous")}t.addEventListener(D.CHANGE,this.handleTileChange_)}},e.prototype.uploadTile_=function(){var t=this.helper_,r=t.getGL(),n=this.tile;if(n instanceof lo||n instanceof pl){var a=r.createTexture();this.textures.push(a),this.bandCount=4,Np(r,a,n.getImage(),n.interpolate);return}var o=n.getData(),s=o instanceof Float32Array,h=this.size[0]*this.size[1],l=s?Float32Array:Uint8Array,u=l.BYTES_PER_ELEMENT,f=o.byteLength/this.size[1];this.bandCount=Math.floor(f/u/this.size[0]);var c=Math.ceil(this.bandCount/4);if(c===1){var a=r.createTexture();this.textures.push(a),Tl(t,a,o,this.size,this.bandCount,n.interpolate);return}for(var d=new Array(c),v=0;v<c;++v){var a=r.createTexture();this.textures.push(a);var _=v<c-1?4:this.bandCount%4;d[v]=new l(h*_)}for(var p=0,y=0,g=this.size[0]*this.bandCount,m=0;m<this.size[1];++m){for(var x=0;x<g;++x){var E=o[y+x],T=Math.floor(p/this.bandCount),M=x%this.bandCount,v=Math.floor(M/4),C=d[v],_=C.length/h,O=M%4;C[T*_+O]=E,++p}y+=f/u}for(var v=0;v<c;++v){var a=this.textures[v],C=d[v],_=C.length/h;Tl(t,a,C,this.size,_,n.interpolate)}},e.prototype.handleTileChange_=function(){this.tile.getState()===k.LOADED&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent(D.CHANGE))},e.prototype.disposeInternal=function(){var t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(var r=0;r<this.textures.length;++r)t.deleteTexture(this.textures[r]);this.tile.removeEventListener(D.CHANGE,this.handleTileChange_)},e}(He),Dp=Fp,Nn={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Gp=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Up=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`,kp=function(){function i(e){this.gl_=e.webGlContext;var t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer();var r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||Gp),t.compileShader(r);var n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e.fragmentShader||Up),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();var a=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(a),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(function(o){this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})}.bind(this))}return i.prototype.getGL=function(){return this.gl_},i.prototype.init=function(e){var t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;var n=0,a=t.RGBA,o=0,s=t.RGBA,h=t.UNSIGNED_BYTE,l=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,n,a,r[0],r[1],o,s,h,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0)}},i.prototype.apply=function(e,t,r,n){var a=this.getGL(),o=e.size;if(a.bindFramebuffer(a.FRAMEBUFFER,t?t.getFrameBuffer():null),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.renderTargetTexture_),!t){var s=tt(a.canvas);if(!e.renderTargets[s]){var h=a.getContextAttributes();h&&h.preserveDrawingBuffer&&(a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT)),e.renderTargets[s]=!0}}a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight),a.bindBuffer(a.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),a.useProgram(this.renderTargetProgram_),a.enableVertexAttribArray(this.renderTargetAttribLocation_),a.vertexAttribPointer(this.renderTargetAttribLocation_,2,a.FLOAT,!1,0,0),a.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),a.uniform1i(this.renderTargetTextureLocation_,0);var l=e.layerStatesArray[e.layerIndex].opacity;a.uniform1f(this.renderTargetOpacityLocation_,l),this.applyUniforms(e),r&&r(a,e),a.drawArrays(a.TRIANGLES,0,6),n&&n(a,e)},i.prototype.getFrameBuffer=function(){return this.frameBuffer_},i.prototype.applyUniforms=function(e){var t=this.getGL(),r,n=1;this.uniforms_.forEach(function(a){if(r=typeof a.value=="function"?a.value(e):a.value,r instanceof HTMLCanvasElement||r instanceof ImageData)a.texture||(a.texture=t.createTexture()),t.activeTexture(t["TEXTURE"+n]),t.bindTexture(t.TEXTURE_2D,a.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,r.width,r.height,0,t.UNSIGNED_BYTE,new Uint8Array(r.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.uniform1i(a.location,n++);else if(Array.isArray(r))switch(r.length){case 2:t.uniform2f(a.location,r[0],r[1]);return;case 3:t.uniform3f(a.location,r[0],r[1],r[2]);return;case 4:t.uniform4f(a.location,r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(a.location,r)})},i}(),Ml=kp;function Cl(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Fn(i,e){return i[0]=e[0],i[1]=e[1],i[4]=e[2],i[5]=e[3],i[12]=e[4],i[13]=e[5],i}var Bp=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Mi={PROJECTION_MATRIX:"u_projectionMatrix",OFFSET_SCALE_MATRIX:"u_offsetScaleMatrix",OFFSET_ROTATION_MATRIX:"u_offsetRotateMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution"},Ci={UNSIGNED_BYTE:wp,UNSIGNED_SHORT:Ip,UNSIGNED_INT:Lp,FLOAT:gl},Dn={};function Rl(i){return"shared/"+i}var Ol=0;function Xp(){var i="unique/"+Ol;return Ol+=1,i}function jp(i){var e=Dn[i];if(!e){var t=document.createElement("canvas");t.style.position="absolute",t.style.left="0",e={users:0,canvas:t},Dn[i]=e}return e.users+=1,e.canvas}function Yp(i){var e=Dn[i];if(!!e&&(e.users-=1,!(e.users>0))){var t=e.canvas,r=ml(t),n=r.getExtension("WEBGL_lose_context");n&&n.loseContext(),delete Dn[i]}}var zp=function(i){Bp(e,i);function e(t){var r=i.call(this)||this,n=t||{};r.boundHandleWebGLContextLost_=r.handleWebGLContextLost.bind(r),r.boundHandleWebGLContextRestored_=r.handleWebGLContextRestored.bind(r),r.canvasCacheKey_=n.canvasCacheKey?Rl(n.canvasCacheKey):Xp(),r.canvas_=jp(r.canvasCacheKey_),r.gl_=ml(r.canvas_),r.bufferCache_={},r.extensionCache_={},r.currentProgram_=null,r.canvas_.addEventListener(Nn.LOST,r.boundHandleWebGLContextLost_),r.canvas_.addEventListener(Nn.RESTORED,r.boundHandleWebGLContextRestored_),r.offsetRotateMatrix_=bt(),r.offsetScaleMatrix_=bt(),r.tmpMat4_=Cl(),r.uniformLocations_={},r.attribLocations_={},r.uniforms_=[],n.uniforms&&r.setUniforms(n.uniforms);var a=r.getGL();return r.postProcessPasses_=n.postProcesses?n.postProcesses.map(function(o){return new Ml({webGlContext:a,scaleRatio:o.scaleRatio,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,uniforms:o.uniforms})}):[new Ml({webGlContext:a})],r.shaderCompileErrors_=null,r.startTime_=Date.now(),r}return e.prototype.setUniforms=function(t){this.uniforms_=[];for(var r in t)this.uniforms_.push({name:r,value:t[r]});this.uniformLocations_={}},e.prototype.canvasCacheKeyMatches=function(t){return this.canvasCacheKey_===Rl(t)},e.prototype.getExtension=function(t){if(t in this.extensionCache_)return this.extensionCache_[t];var r=this.gl_.getExtension(t);return this.extensionCache_[t]=r,r},e.prototype.bindBuffer=function(t){var r=this.getGL(),n=tt(t),a=this.bufferCache_[n];if(!a){var o=r.createBuffer();a={buffer:t,webGlBuffer:o},this.bufferCache_[n]=a}r.bindBuffer(t.getType(),a.webGlBuffer)},e.prototype.flushBufferData=function(t){var r=this.getGL();this.bindBuffer(t),r.bufferData(t.getType(),t.getArray(),t.getUsage())},e.prototype.deleteBuffer=function(t){var r=this.getGL(),n=tt(t),a=this.bufferCache_[n];a&&!r.isContextLost()&&r.deleteBuffer(a.webGlBuffer),delete this.bufferCache_[n]},e.prototype.disposeInternal=function(){this.canvas_.removeEventListener(Nn.LOST,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(Nn.RESTORED,this.boundHandleWebGLContextRestored_),Yp(this.canvasCacheKey_),delete this.gl_,delete this.canvas_},e.prototype.prepareDraw=function(t,r){var n=this.getGL(),a=this.getCanvas(),o=t.size,s=t.pixelRatio;a.width=o[0]*s,a.height=o[1]*s,a.style.width=o[0]+"px",a.style.height=o[1]+"px",n.useProgram(this.currentProgram_);for(var h=this.postProcessPasses_.length-1;h>=0;h--)this.postProcessPasses_[h].init(t);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,r?n.ZERO:n.ONE_MINUS_SRC_ALPHA),n.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},e.prototype.prepareDrawToRenderTarget=function(t,r,n){var a=this.getGL(),o=r.getSize();a.bindFramebuffer(a.FRAMEBUFFER,r.getFramebuffer()),a.viewport(0,0,o[0],o[1]),a.bindTexture(a.TEXTURE_2D,r.getTexture()),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.BLEND),a.blendFunc(a.ONE,n?a.ZERO:a.ONE_MINUS_SRC_ALPHA),a.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},e.prototype.drawElements=function(t,r){var n=this.getGL();this.getExtension("OES_element_index_uint");var a=n.UNSIGNED_INT,o=4,s=r-t,h=t*o;n.drawElements(n.TRIANGLES,s,a,h)},e.prototype.finalizeDraw=function(t,r,n){for(var a=0,o=this.postProcessPasses_.length;a<o;a++)a===o-1?this.postProcessPasses_[a].apply(t,null,r,n):this.postProcessPasses_[a].apply(t,this.postProcessPasses_[a+1])},e.prototype.getCanvas=function(){return this.canvas_},e.prototype.getGL=function(){return this.gl_},e.prototype.applyFrameState=function(t){var r=t.size,n=t.viewState.rotation,a=ba(this.offsetScaleMatrix_);Nc(a,2/r[0],2/r[1]);var o=ba(this.offsetRotateMatrix_);n!==0&&Ac(o,-n),this.setUniformMatrixValue(Mi.OFFSET_SCALE_MATRIX,Fn(this.tmpMat4_,a)),this.setUniformMatrixValue(Mi.OFFSET_ROTATION_MATRIX,Fn(this.tmpMat4_,o)),this.setUniformFloatValue(Mi.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Mi.ZOOM,t.viewState.zoom),this.setUniformFloatValue(Mi.RESOLUTION,t.viewState.resolution)},e.prototype.applyUniforms=function(t){var r=this.getGL(),n,a=0;this.uniforms_.forEach(function(o){if(n=typeof o.value=="function"?o.value(t):o.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData){o.texture||(o.prevValue=void 0,o.texture=r.createTexture()),r.activeTexture(r["TEXTURE"+a]),r.bindTexture(r.TEXTURE_2D,o.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);var s=!(n instanceof HTMLImageElement)||n.complete;s&&o.prevValue!==n&&(o.prevValue=n,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)),r.uniform1i(this.getUniformLocation(o.name),a++)}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(o.name,Fn(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:r.uniform2f(this.getUniformLocation(o.name),n[0],n[1]);return;case 3:r.uniform3f(this.getUniformLocation(o.name),n[0],n[1],n[2]);return;case 4:r.uniform4f(this.getUniformLocation(o.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&r.uniform1f(this.getUniformLocation(o.name),n)}.bind(this))},e.prototype.useProgram=function(t){if(t==this.currentProgram_)return!1;var r=this.getGL();return r.useProgram(t),this.currentProgram_=t,this.uniformLocations_={},this.attribLocations_={},!0},e.prototype.compileShader=function(t,r){var n=this.getGL(),a=n.createShader(r);return n.shaderSource(a,t),n.compileShader(a),a},e.prototype.getProgram=function(t,r){var n=this.getGL(),a=this.compileShader(t,n.FRAGMENT_SHADER),o=this.compileShader(r,n.VERTEX_SHADER),s=n.createProgram();if(n.attachShader(s,a),n.attachShader(s,o),n.linkProgram(s),!n.getShaderParameter(a,n.COMPILE_STATUS)){var h="Fragment shader compliation failed: "+n.getShaderInfoLog(a);throw new Error(h)}if(n.deleteShader(a),!n.getShaderParameter(o,n.COMPILE_STATUS)){var h="Vertex shader compilation failed: "+n.getShaderInfoLog(o);throw new Error(h)}if(n.deleteShader(o),!n.getProgramParameter(s,n.LINK_STATUS)){var h="GL program linking failed: "+n.getShaderInfoLog(o);throw new Error(h)}return s},e.prototype.getUniformLocation=function(t){return this.uniformLocations_[t]===void 0&&(this.uniformLocations_[t]=this.getGL().getUniformLocation(this.currentProgram_,t)),this.uniformLocations_[t]},e.prototype.getAttributeLocation=function(t){return this.attribLocations_[t]===void 0&&(this.attribLocations_[t]=this.getGL().getAttribLocation(this.currentProgram_,t)),this.attribLocations_[t]},e.prototype.makeProjectionTransform=function(t,r){var n=t.size,a=t.viewState.rotation,o=t.viewState.resolution,s=t.viewState.center;return ba(r),re(r,0,0,2/(o*n[0]),2/(o*n[1]),-a,-s[0],-s[1]),r},e.prototype.setUniformFloatValue=function(t,r){this.getGL().uniform1f(this.getUniformLocation(t),r)},e.prototype.setUniformMatrixValue=function(t,r){this.getGL().uniformMatrix4fv(this.getUniformLocation(t),!1,r)},e.prototype.enableAttributeArray_=function(t,r,n,a,o){var s=this.getAttributeLocation(t);s<0||(this.getGL().enableVertexAttribArray(s),this.getGL().vertexAttribPointer(s,r,n,!1,a,o))},e.prototype.enableAttributes=function(t){for(var r=Wp(t),n=0,a=0;a<t.length;a++){var o=t[a];this.enableAttributeArray_(o.name,o.size,o.type||gl,r,n),n+=o.size*Sl(o.type)}},e.prototype.handleWebGLContextLost=function(){dr(this.bufferCache_),this.currentProgram_=null},e.prototype.handleWebGLContextRestored=function(){},e.prototype.createTexture=function(t,r,n){var a=this.getGL(),o=n||a.createTexture(),s=0,h=a.RGBA,l=0,u=a.RGBA,f=a.UNSIGNED_BYTE;return a.bindTexture(a.TEXTURE_2D,o),r?a.texImage2D(a.TEXTURE_2D,s,h,u,f,r):a.texImage2D(a.TEXTURE_2D,s,h,t[0],t[1],l,u,f,null),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),o},e}(Ji);function Wp(i){for(var e=0,t=0;t<i.length;t++){var r=i[t];e+=r.size*Sl(r.type)}return e}function Sl(i){switch(i){case Ci.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Ci.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Ci.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Ci.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var $p=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Vp=function(i){$p(e,i);function e(t,r){var n=i.call(this,t)||this,a=r||{};return n.inversePixelTransform_=bt(),n.pixelContext_=null,n.postProcesses_=a.postProcesses,n.uniforms_=a.uniforms,n.helper,t.addChangeListener(Q.MAP,n.removeHelper_.bind(n)),n.dispatchPreComposeEvent=n.dispatchPreComposeEvent.bind(n),n.dispatchPostComposeEvent=n.dispatchPostComposeEvent.bind(n),n}return e.prototype.dispatchPreComposeEvent=function(t,r){var n=this.getLayer();if(n.hasListener(Lt.PRECOMPOSE)){var a=new ai(Lt.PRECOMPOSE,void 0,r,t);n.dispatchEvent(a)}},e.prototype.dispatchPostComposeEvent=function(t,r){var n=this.getLayer();if(n.hasListener(Lt.POSTCOMPOSE)){var a=new ai(Lt.POSTCOMPOSE,void 0,r,t);n.dispatchEvent(a)}},e.prototype.reset=function(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)},e.prototype.removeHelper_=function(){this.helper&&(this.helper.dispose(),delete this.helper)},e.prototype.prepareFrame=function(t){if(this.getLayer().getSource()){for(var r=!0,n=-1,a=void 0,o=0,s=t.layerStatesArray.length;o<s;o++){var h=t.layerStatesArray[o].layer,l=h.getRenderer();if(!(l instanceof e)){r=!0;continue}var u=h.getClassName();if((r||u!==a)&&(n+=1,r=!1),a=u,l===this)break}var f="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(f))&&(this.helper&&this.helper.dispose(),this.helper=new zp({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:f}),a&&(this.helper.getCanvas().className=a),this.afterHelperCreated())}return this.prepareFrameInternal(t)},e.prototype.afterHelperCreated=function(){},e.prototype.prepareFrameInternal=function(t){return!0},e.prototype.disposeInternal=function(){this.removeHelper_(),i.prototype.disposeInternal.call(this)},e.prototype.dispatchRenderEvent_=function(t,r,n){var a=this.getLayer();if(a.hasListener(t)){re(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);var o=new ai(t,this.inversePixelTransform_,n,r);a.dispatchEvent(o)}},e.prototype.preRender=function(t,r){this.dispatchRenderEvent_(Lt.PRERENDER,t,r)},e.prototype.postRender=function(t,r){this.dispatchRenderEvent_(Lt.POSTRENDER,t,r)},e.prototype.getDataAtPixel=function(t,r,n){var a=pt([r.pixelRatio,0,0,r.pixelRatio,0,0],t.slice()),o=this.helper.getGL();if(!o)return null;var s=this.getLayer(),h=s.getExtent();if(h){var l=pt(r.pixelToCoordinateTransform,t.slice());if(!ve(h,l))return null}var u=o.getContextAttributes();if(!u||!u.preserveDrawingBuffer)return new Uint8Array;var f=Math.round(a[0]),c=Math.round(a[1]),d=this.pixelContext_;if(!d){var v=document.createElement("canvas");v.width=1,v.height=1,d=v.getContext("2d"),this.pixelContext_=d}d.clearRect(0,0,1,1);var _;try{d.drawImage(o.canvas,f,c,1,1,0,0,1,1),_=d.getImageData(0,0,1,1).data}catch{return _}return _[3]===0?null:_},e}(Vh),Hp=Vp;function Gn(i,e,t,r){return r!==void 0?(r[0]=i,r[1]=e,r[2]=t,r):[i,e,t]}function Ri(i,e,t){return i+"/"+e+"/"+t}function Oi(i){return Ri(i[0],i[1],i[2])}function Kp(i){return i.split("/").map(Number)}function Zp(i){return(i[1]<<i[0])+i[2]}function qp(i,e){var t=i[0],r=i[1],n=i[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;var a=e.getFullTileRange(t);return a?a.containsXY(r,n):!0}var Jp=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ft={TILE_TEXTURE_ARRAY:"u_tileTextures",TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",RESOLUTION:"u_resolution",ZOOM:"u_zoom"},Un={TEXTURE_COORD:"a_textureCoord"},Qp=[{name:Un.TEXTURE_COORD,size:2,type:Ci.FLOAT}],tg={};function eg(i){return 2*(1-1/(i+1))-1}function wl(i,e,t){t in i||(i[t]=[]),i[t].push(e)}function go(i,e){var t=i.layerStatesArray[i.layerIndex];t.extent&&(e=er(e,Mr(t.extent,i.viewState.projection)));var r=t.layer.getSource();if(!r.getWrapX()){var n=r.getTileGridForProjection(i.viewState.projection).getExtent();n&&(e=er(e,n))}return e}var Il=function(i){Jp(e,i);function e(t,r){var n=i.call(this,t,{uniforms:r.uniforms})||this;n.tileTransform_=bt(),n.tempMat4_=Cl(),n.tempTileRange_=new ul(0,0,0,0),n.tempTileCoord_=Gn(0,0,0),n.tempSize_=[0,0],n.program_,n.vertexShader_=r.vertexShader,n.fragmentShader_=r.fragmentShader,n.indices_=new xl(vo,_o),n.indices_.fromArray([0,1,3,1,2,3]);var a=r.cacheSize!==void 0?r.cacheSize:512;return n.tileTextureCache_=new hl(a),n.paletteTextures_=r.paletteTextures||[],n}return e.prototype.reset=function(t){i.prototype.reset.call(this,{uniforms:t.uniforms}),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))},e.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)},e.prototype.isDrawableTile_=function(t){var r=this.getLayer(),n=t.getState(),a=r.getUseInterimTilesOnError();return n==k.LOADED||n==k.EMPTY||n==k.ERROR&&!a},e.prototype.prepareFrameInternal=function(t){var r=this.getLayer(),n=r.getSource();return!n||ri(go(t,t.extent))?!1:n.getState()===Oe.READY},e.prototype.enqueueTiles=function(t,r,n,a){var o=t.viewState,s=this.getLayer(),h=s.getSource(),l=h.getTileGridForProjection(o.projection),u=this.tileTextureCache_,f=l.getTileRangeForExtentAndZ(r,n,this.tempTileRange_),c=tt(h);c in t.wantedTiles||(t.wantedTiles[c]={});for(var d=t.wantedTiles[c],v=l.getResolution(n),_=f.minX;_<=f.maxX;++_)for(var p=f.minY;p<=f.maxY;++p){var y=Gn(n,_,p,this.tempTileCoord_),g=Oi(y),m=void 0,x=void 0;if(u.containsKey(g)&&(m=u.get(g),x=m.tile),!m||m.tile.key!==h.getKey())if(x=h.getTile(n,_,p,t.pixelRatio,o.projection),!m)m=new Dp(x,l,this.helper),u.set(g,m);else if(this.isDrawableTile_(x))m.setTile(x);else{var E=x.getInterimTile();m.setTile(E)}wl(a,m,n);var T=x.getKey();d[T]=!0,x.getState()===k.IDLE&&(t.tileQueue.isKeyQueued(T)||t.tileQueue.enqueue([x,c,l.getTileCoordCenter(y),v]))}},e.prototype.renderFrame=function(t){var r=this.helper.getGL();this.preRender(r,t);var n=t.viewState,a=this.getLayer(),o=a.getSource(),s=o.getTileGridForProjection(n.projection),h=go(t,t.extent),l=s.getZForResolution(n.resolution,o.zDirection),u={};if(t.nextExtent){var f=s.getZForResolution(n.nextResolution,o.zDirection),c=go(t,t.nextExtent);this.enqueueTiles(t,c,f,u)}this.enqueueTiles(t,h,l,u);for(var d={},v=tt(this),_=t.time,p=!1,y=u[l],g=0,m=y.length;g<m;++g){var x=y[g],E=x.tile,T=E.tileCoord;if(x.loaded){var M=E.getAlpha(v,_);if(M===1){E.endTransition(v);continue}p=!0;var C=Oi(T);d[C]=M}var O=this.findAltTiles_(s,T,l+1,u);if(!O)for(var P=s.getMinZoom(),I=l-1;I>=P;--I){var F=this.findAltTiles_(s,T,I,u);if(F)break}}this.helper.useProgram(this.program_),this.helper.prepareDraw(t,!p);for(var B=Object.keys(u).map(Number).sort(We),Z=n.center[0],$=n.center[1],H=0,V=B.length;H<V;++H)for(var K=B[H],q=s.getResolution(K),J=At(s.getTileSize(K),this.tempSize_),lt=s.getOrigin(K),S=(Z-lt[0])/(J[0]*q),Gt=(lt[1]-$)/(J[1]*q),gt=n.resolution/q,wt=eg(K),Kt=u[K],g=0,m=Kt.length;g<m;++g){var x=Kt[g];if(!!x.loaded){var E=x.tile,T=E.tileCoord,C=Oi(T),Me=T[1],kt=T[2];re(this.tileTransform_,0,0,2/(t.size[0]*gt/J[0]),-2/(t.size[1]*gt/J[1]),n.rotation,-(S-Me),-(Gt-kt)),this.helper.setUniformMatrixValue(ft.TILE_TRANSFORM,Fn(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer(x.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Qp);for(var Bt=0;Bt<x.textures.length;){var ji="TEXTURE"+Bt,na=ft.TILE_TEXTURE_ARRAY+"["+Bt+"]";r.activeTexture(r[ji]),r.bindTexture(r.TEXTURE_2D,x.textures[Bt]),r.uniform1i(this.helper.getUniformLocation(na),Bt),++Bt}for(var jr=0;jr<this.paletteTextures_.length;++jr){var Yr=this.paletteTextures_[jr];r.activeTexture(r["TEXTURE"+Bt]);var ze=Yr.getTexture(r);r.bindTexture(r.TEXTURE_2D,ze),r.uniform1i(this.helper.getUniformLocation(Yr.name),Bt),++Bt}var M=C in d?d[C]:1;M<1&&(t.animate=!0),this.helper.setUniformFloatValue(ft.TRANSITION_ALPHA,M),this.helper.setUniformFloatValue(ft.DEPTH,wt),this.helper.setUniformFloatValue(ft.TEXTURE_PIXEL_WIDTH,J[0]),this.helper.setUniformFloatValue(ft.TEXTURE_PIXEL_HEIGHT,J[1]),this.helper.setUniformFloatValue(ft.RESOLUTION,n.resolution),this.helper.setUniformFloatValue(ft.ZOOM,n.zoom),this.helper.drawElements(0,this.indices_.getSize())}}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);for(var zr=this.helper.getCanvas(),Yi=this.tileTextureCache_;Yi.canExpireCache();){var x=Yi.pop();x.dispose()}var aa=function(jo,zi){o.expireCache(zi.viewState.projection,tg)};return t.postRenderFunctions.push(aa),this.postRender(r,t),zr},e.prototype.findAltTiles_=function(t,r,n,a){var o=t.getTileRangeForTileCoordAndZ(r,n,this.tempTileRange_);if(!o)return!1;for(var s=!0,h=this.tileTextureCache_,l=o.minX;l<=o.maxX;++l)for(var u=o.minY;u<=o.maxY;++u){var f=Ri(n,l,u),c=!1;if(h.containsKey(f)){var d=h.get(f);d.loaded&&(wl(a,d,n),c=!0)}c||(s=!1)}return s},e.prototype.disposeInternal=function(){var t=this.helper,r=t.getGL();t.deleteBuffer(this.indices_),delete this.indices_,r.deleteProgram(this.program_),delete this.program_;var n=this.tileTextureCache_;n.forEach(function(a){a.dispose()}),n.clear(),delete this.tileTextureCache_,i.prototype.disposeInternal.call(this)},e}(Hp);Il.prototype.getLayer;var rg=Il,ig=function(){function i(e,t){this.name=e,this.data=t,this.texture_=null}return i.prototype.getTexture=function(e){if(!this.texture_){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_},i}(),ng=ig,b={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0},W={};function oe(i){if(typeof i=="number")return b.NUMBER;if(typeof i=="boolean")return b.BOOLEAN;if(typeof i=="string")return kc(i)?b.COLOR|b.STRING:b.STRING;if(!Array.isArray(i))throw new Error("Unhandled value type: "+JSON.stringify(i));var e=i,t=e.every(function(n){return typeof n=="number"});if(t)return e.length===3||e.length===4?b.COLOR|b.NUMBER_ARRAY:b.NUMBER_ARRAY;if(typeof e[0]!="string")throw new Error("Expected an expression operator but received: "+JSON.stringify(e));var r=W[e[0]];if(r===void 0)throw new Error("Unrecognized expression operator: "+JSON.stringify(e));return r.getReturnType(e.slice(1))}function ag(i){return us(i)%1==0}function kn(i){var e=i.toString();return e.indexOf(".")===-1?e+".0":e}function Ll(i){if(i.length<2||i.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return"vec"+i.length+"("+i.map(kn).join(", ")+")"}function og(i){var e=ni(i).slice();return e.length<4&&e.push(1),Ll(e.map(function(t,r){return r<3?t/255:t}))}function Pl(i,e){return i.stringLiteralsMap[e]===void 0&&(i.stringLiteralsMap[e]=Object.keys(i.stringLiteralsMap).length),i.stringLiteralsMap[e]}function sg(i,e){return kn(Pl(i,e))}function N(i,e,t){if(Array.isArray(e)&&typeof e[0]=="string"){var r=W[e[0]];if(r===void 0)throw new Error("Unrecognized expression operator: "+JSON.stringify(e));return r.toGlsl(i,e.slice(1),t)}var n=oe(e);if((n&b.NUMBER)>0)return kn(e);if((n&b.BOOLEAN)>0)return e.toString();if((n&b.STRING)>0&&(t===void 0||t==b.STRING))return sg(i,e.toString());if((n&b.COLOR)>0&&(t===void 0||t==b.COLOR))return og(e);if((n&b.NUMBER_ARRAY)>0)return Ll(e);throw new Error("Unexpected expression "+e+" (expected type "+t+")")}function bl(i){if(!(oe(i)&b.NUMBER))throw new Error("A numeric value was expected, got "+JSON.stringify(i)+" instead")}function xt(i){for(var e=0;e<i.length;e++)bl(i[e])}function Al(i){if(!(oe(i)&b.STRING))throw new Error("A string value was expected, got "+JSON.stringify(i)+" instead")}function yo(i){if(!(oe(i)&b.BOOLEAN))throw new Error("A boolean value was expected, got "+JSON.stringify(i)+" instead")}function ct(i,e){if(i.length!==e)throw new Error("Exactly "+e+" arguments were expected, got "+i.length+" instead")}function ke(i,e){if(i.length<e)throw new Error("At least "+e+" arguments were expected, got "+i.length+" instead")}function Bn(i,e){if(i.length>e)throw new Error("At most "+e+" arguments were expected, got "+i.length+" instead")}function Nl(i){if(i.length%2!=0)throw new Error("An even amount of arguments was expected, got "+i+" instead")}function hg(i){if(i.length%2==0)throw new Error("An odd amount of arguments was expected, got "+i+" instead")}function mo(i,e){if(!ag(e))throw new Error("Could not infer only one type from the following expression: "+JSON.stringify(i))}W.get={getReturnType:function(i){return b.ANY},toGlsl:function(i,e){ct(e,1),Al(e[0]);var t=e[0].toString();i.attributes.indexOf(t)===-1&&i.attributes.push(t);var r=i.inFragmentShader?"v_":"a_";return r+t}};function Fl(i){return"u_var_"+i}W.var={getReturnType:function(i){return b.ANY},toGlsl:function(i,e){ct(e,1),Al(e[0]);var t=e[0].toString();return i.variables.indexOf(t)===-1&&i.variables.push(t),Fl(t)}};var Dl="u_paletteTextures";W.palette={getReturnType:function(i){return b.COLOR},toGlsl:function(i,e){ct(e,2),bl(e[0]);var t=N(i,e[0]),r=e[1];if(!Array.isArray(r))throw new Error("The second argument of palette must be an array");for(var n=r.length,a=new Uint8Array(n*4),o=0;o<n;o++){var s=r[o],h=void 0;if(typeof s=="string")h=th(s);else{if(!Array.isArray(s))throw new Error("The second argument of palette must be an array of strings or colors");var l=s.length;if(l===4)h=s;else{if(l!==3)throw new Error("Expected palette color to have 3 or 4 values, got "+l);h=[s[0],s[1],s[2],1]}}var u=o*4;a[u]=h[0],a[u+1]=h[1],a[u+2]=h[2],a[u+3]=h[3]*255}i.paletteTextures||(i.paletteTextures=[]);var f=Dl+"["+i.paletteTextures.length+"]",c=new ng(f,a);return i.paletteTextures.push(c),"texture2D("+f+", vec2(("+t+" + 0.5) / "+n+".0, 0.5))"}};var xo="getBandValue";W.band={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){ke(e,1),Bn(e,3);var t=e[0];if(!(xo in i.functions)){for(var r="",n=i.bandCount||1,a=0;a<n;a++){var o=Math.floor(a/4),s=a%4;s===n-1&&s===1&&(s=3);var h=ft.TILE_TEXTURE_ARRAY+"["+o+"]";r+=`
          if (band == `+(a+1)+`.0) {
            return texture2D(`+h+", v_textureCoord + vec2(dx, dy))["+s+`];
          }
        `}i.functions[xo]=`
        float getBandValue(float band, float xOffset, float yOffset) {
          float dx = xOffset / `+ft.TEXTURE_PIXEL_WIDTH+`;
          float dy = yOffset / `+ft.TEXTURE_PIXEL_HEIGHT+`;
          `+r+`
        }
      `}var l=N(i,t),u=N(i,e[1]||0),f=N(i,e[2]||0);return xo+"("+l+", "+u+", "+f+")"}};W.time={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,0),"u_time"}};W.zoom={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,0),"u_zoom"}};W.resolution={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,0),"u_resolution"}};W["*"]={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,2),xt(e),"("+N(i,e[0])+" * "+N(i,e[1])+")"}};W["/"]={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,2),xt(e),"("+N(i,e[0])+" / "+N(i,e[1])+")"}};W["+"]={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,2),xt(e),"("+N(i,e[0])+" + "+N(i,e[1])+")"}};W["-"]={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,2),xt(e),"("+N(i,e[0])+" - "+N(i,e[1])+")"}};W.clamp={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){ct(e,3),xt(e);var t=N(i,e[1]),r=N(i,e[2]);return"clamp("+N(i,e[0])+", "+t+", "+r+")"}};W["%"]={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,2),xt(e),"mod("+N(i,e[0])+", "+N(i,e[1])+")"}};W["^"]={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,2),xt(e),"pow("+N(i,e[0])+", "+N(i,e[1])+")"}};W.abs={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,1),xt(e),"abs("+N(i,e[0])+")"}};W.sin={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,1),xt(e),"sin("+N(i,e[0])+")"}};W.cos={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ct(e,1),xt(e),"cos("+N(i,e[0])+")"}};W.atan={getReturnType:function(i){return b.NUMBER},toGlsl:function(i,e){return ke(e,1),Bn(e,2),xt(e),e.length===2?"atan("+N(i,e[0])+", "+N(i,e[1])+")":"atan("+N(i,e[0])+")"}};W[">"]={getReturnType:function(i){return b.BOOLEAN},toGlsl:function(i,e){return ct(e,2),xt(e),"("+N(i,e[0])+" > "+N(i,e[1])+")"}};W[">="]={getReturnType:function(i){return b.BOOLEAN},toGlsl:function(i,e){return ct(e,2),xt(e),"("+N(i,e[0])+" >= "+N(i,e[1])+")"}};W["<"]={getReturnType:function(i){return b.BOOLEAN},toGlsl:function(i,e){return ct(e,2),xt(e),"("+N(i,e[0])+" < "+N(i,e[1])+")"}};W["<="]={getReturnType:function(i){return b.BOOLEAN},toGlsl:function(i,e){return ct(e,2),xt(e),"("+N(i,e[0])+" <= "+N(i,e[1])+")"}};function Gl(i){return{getReturnType:function(e){return b.BOOLEAN},toGlsl:function(e,t){ct(t,2);for(var r=b.ANY,n=0;n<t.length;n++)r&=oe(t[n]);if(r===b.NONE)throw new Error("All arguments should be of compatible type, got "+JSON.stringify(t)+" instead");return r&=~b.COLOR,"("+N(e,t[0],r)+" "+i+" "+N(e,t[1],r)+")"}}}W["=="]=Gl("==");W["!="]=Gl("!=");W["!"]={getReturnType:function(i){return b.BOOLEAN},toGlsl:function(i,e){return ct(e,1),yo(e[0]),"(!"+N(i,e[0])+")"}};function Ul(i){return{getReturnType:function(e){return b.BOOLEAN},toGlsl:function(e,t){ke(t,2);for(var r=0;r<t.length;r++)yo(t[r]);var n="";return n=t.map(function(a){return N(e,a)}).join(" "+i+" "),n="("+n+")",n}}}W.all=Ul("&&");W.any=Ul("||");W.between={getReturnType:function(i){return b.BOOLEAN},toGlsl:function(i,e){ct(e,3),xt(e);var t=N(i,e[1]),r=N(i,e[2]),n=N(i,e[0]);return"("+n+" >= "+t+" && "+n+" <= "+r+")"}};W.array={getReturnType:function(i){return b.NUMBER_ARRAY},toGlsl:function(i,e){ke(e,2),Bn(e,4),xt(e);var t=e.map(function(r){return N(i,r,b.NUMBER)});return"vec"+e.length+"("+t.join(", ")+")"}};W.color={getReturnType:function(i){return b.COLOR},toGlsl:function(i,e){ke(e,3),Bn(e,4),xt(e);var t=e;e.length===3&&t.push(1);var r=e.map(function(n,a){return N(i,n,b.NUMBER)+(a<3?" / 255.0":"")});return"vec"+e.length+"("+r.join(", ")+")"}};W.interpolate={getReturnType:function(i){for(var e=b.COLOR|b.NUMBER,t=3;t<i.length;t+=2)e=e&oe(i[t]);return e},toGlsl:function(i,e,t){Nl(e),ke(e,6);var r=e[0],n;switch(r[0]){case"linear":n=1;break;case"exponential":n=r[1];break;default:n=null}if(!n)throw new Error('Invalid interpolation type for "interpolate" operator, received: '+JSON.stringify(r));var a=t!==void 0?t:b.ANY,o=W.interpolate.getReturnType(e)&a;mo(e,o);for(var s=N(i,e[1]),h=kn(n),l="",u=2;u<e.length-2;u+=2){var f=N(i,e[u]),c=l||N(i,e[u+1],o),d=N(i,e[u+2]),v=N(i,e[u+3],o);l="mix("+c+", "+v+", pow(clamp(("+s+" - "+f+") / ("+d+" - "+f+"), 0.0, 1.0), "+h+"))"}return l}};W.match={getReturnType:function(i){for(var e=b.ANY,t=2;t<i.length;t+=2)e=e&oe(i[t]);return e=e&oe(i[i.length-1]),e},toGlsl:function(i,e,t){Nl(e),ke(e,4);var r=t!==void 0?t:b.ANY,n=W.match.getReturnType(e)&r;mo(e,n);for(var a=N(i,e[0]),o=N(i,e[e.length-1],n),s=null,h=e.length-3;h>=1;h-=2){var l=N(i,e[h]),u=N(i,e[h+1],n);s="("+a+" == "+l+" ? "+u+" : "+(s||o)+")"}return s}};W.case={getReturnType:function(i){for(var e=b.ANY,t=1;t<i.length;t+=2)e=e&oe(i[t]);return e=e&oe(i[i.length-1]),e},toGlsl:function(i,e,t){hg(e),ke(e,3);var r=t!==void 0?t:b.ANY,n=W.case.getReturnType(e)&r;mo(e,n);for(var a=0;a<e.length-1;a+=2)yo(e[a]);for(var o=N(i,e[e.length-1],n),s=null,a=e.length-3;a>=0;a-=2){var h=N(i,e[a]),l=N(i,e[a+1],n);s="("+h+" ? "+l+" : "+(s||o)+")"}return s}};var lg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();function kl(i,e){var t=`
    attribute vec2 `+Un.TEXTURE_COORD+`;
    uniform mat4 `+ft.TILE_TRANSFORM+`;
    uniform float `+ft.DEPTH+`;

    varying vec2 v_textureCoord;

    void main() {
      v_textureCoord = `+Un.TEXTURE_COORD+`;
      gl_Position = `+ft.TILE_TRANSFORM+" * vec4("+Un.TEXTURE_COORD+", "+ft.DEPTH+`, 1.0);
    }
  `,r={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},functions:{},bandCount:e},n=[];if(i.color!==void 0){var a=N(r,i.color,b.COLOR);n.push("color = "+a+";")}if(i.contrast!==void 0){var o=N(r,i.contrast,b.NUMBER);n.push("color.rgb = clamp(("+o+" + 1.0) * color.rgb - ("+o+" / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}if(i.exposure!==void 0){var s=N(r,i.exposure,b.NUMBER);n.push("color.rgb = clamp(("+s+" + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}if(i.saturation!==void 0){var h=N(r,i.saturation,b.NUMBER);n.push(`
      float saturation = `+h+` + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(i.gamma!==void 0){var l=N(r,i.gamma,b.NUMBER);n.push("color.rgb = pow(color.rgb, vec3(1.0 / "+l+"));")}if(i.brightness!==void 0){var u=N(r,i.brightness,b.NUMBER);n.push("color.rgb = clamp(color.rgb + "+u+", vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}var f={},c=r.variables.length;if(c>1&&!i.variables)throw new Error("Missing variables in style (expected "+r.variables+")");for(var d=function(m){var x=r.variables[m];if(!(x in i.variables))throw new Error("Missing '"+x+"' in style variables");var E=Fl(x);f[E]=function(){var T=i.variables[x];return typeof T=="string"&&(T=Pl(r,T)),T!==void 0?T:-9999999}},v=0;v<c;++v)d(v);var _=Object.keys(f).map(function(m){return"uniform float "+m+";"}),p=Math.ceil(e/4);_.push("uniform sampler2D "+ft.TILE_TEXTURE_ARRAY+"["+p+"];"),r.paletteTextures&&_.push("uniform sampler2D "+Dl+"["+r.paletteTextures.length+"];");var y=Object.keys(r.functions).map(function(m){return r.functions[m]}),g=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    uniform float `+ft.TRANSITION_ALPHA+`;
    uniform float `+ft.TEXTURE_PIXEL_WIDTH+`;
    uniform float `+ft.TEXTURE_PIXEL_HEIGHT+`;
    uniform float `+ft.RESOLUTION+`;
    uniform float `+ft.ZOOM+`;

    `+_.join(`
`)+`

    `+y.join(`
`)+`

    void main() {
      vec4 color = texture2D(`+ft.TILE_TEXTURE_ARRAY+`[0],  v_textureCoord);

      `+n.join(`
`)+`

      if (color.a == 0.0) {
        discard;
      }

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= `+ft.TRANSITION_ALPHA+`;
    }`;return{vertexShader:t,fragmentShader:g,uniforms:f,paletteTextures:r.paletteTextures}}var Bl=function(i){lg(e,i);function e(t){var r=this,n=t?vt({},t):{},a=n.style||{};delete n.style;var o=n.cacheSize;return delete n.cacheSize,r=i.call(this,n)||this,r.style_=a,r.cacheSize_=o,r.styleVariables_=r.style_.variables||{},r.addChangeListener(Q.SOURCE,r.handleSourceUpdate_),r}return e.prototype.handleSourceUpdate_=function(){this.setStyle(this.style_)},e.prototype.getSourceBandCount_=function(){var t=this.getSource();return t&&"bandCount"in t?t.bandCount:4},e.prototype.createRenderer=function(){var t=kl(this.style_,this.getSourceBandCount_());return new rg(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})},e.prototype.setStyle=function(t){this.style_=t;var r=kl(this.style_,this.getSourceBandCount_()),n=this.getRenderer();n.reset({vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms,paletteTextures:r.paletteTextures}),this.changed()},e.prototype.updateStyleVariables=function(t){vt(this.styleVariables_,t),this.changed()},e}(up);Bl.prototype.dispose;var ug=Bl,Xl={ACTIVE:"active"},fg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),cg=function(i){fg(e,i);function e(t){var r=i.call(this)||this;return r.on,r.once,r.un,t&&t.handleEvent&&(r.handleEvent=t.handleEvent),r.map_=null,r.setActive(!0),r}return e.prototype.getActive=function(){return this.get(Xl.ACTIVE)},e.prototype.getMap=function(){return this.map_},e.prototype.handleEvent=function(t){return!0},e.prototype.setActive=function(t){this.set(Xl.ACTIVE,t)},e.prototype.setMap=function(t){this.map_=t},e}(Zt);function dg(i,e,t){var r=i.getCenterInternal();if(r){var n=[r[0]+e[0],r[1]+e[1]];i.animateInternal({duration:t!==void 0?t:250,easing:Wf,center:i.getConstrainedCenter(n)})}}function Eo(i,e,t,r){var n=i.getZoom();if(n!==void 0){var a=i.getConstrainedZoom(n+e),o=i.getResolutionForZoom(a);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:t,duration:r!==void 0?r:250,easing:Je})}}var Si=cg,vg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),_g=function(i){vg(e,i);function e(t){var r=i.call(this)||this,n=t||{};return r.delta_=n.delta?n.delta:1,r.duration_=n.duration!==void 0?n.duration:250,r}return e.prototype.handleEvent=function(t){var r=!1;if(t.type==st.DBLCLICK){var n=t.originalEvent,a=t.map,o=t.coordinate,s=n.shiftKey?-this.delta_:this.delta_,h=a.getView();Eo(h,s,o,this.duration_),n.preventDefault(),r=!0}return!r},e}(Si),pg=_g,gg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),yg=function(i){gg(e,i);function e(t){var r=this,n=t||{};return r=i.call(this,n)||this,n.handleDownEvent&&(r.handleDownEvent=n.handleDownEvent),n.handleDragEvent&&(r.handleDragEvent=n.handleDragEvent),n.handleMoveEvent&&(r.handleMoveEvent=n.handleMoveEvent),n.handleUpEvent&&(r.handleUpEvent=n.handleUpEvent),n.stopDown&&(r.stopDown=n.stopDown),r.handlingDownUpSequence=!1,r.trackedPointers_={},r.targetPointers=[],r}return e.prototype.getPointerCount=function(){return this.targetPointers.length},e.prototype.handleDownEvent=function(t){return!1},e.prototype.handleDragEvent=function(t){},e.prototype.handleEvent=function(t){if(!t.originalEvent)return!0;var r=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==st.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==st.POINTERUP){var n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==st.POINTERDOWN){var a=this.handleDownEvent(t);this.handlingDownUpSequence=a,r=this.stopDown(a)}else t.type==st.POINTERMOVE&&this.handleMoveEvent(t);return!r},e.prototype.handleMoveEvent=function(t){},e.prototype.handleUpEvent=function(t){return!1},e.prototype.stopDown=function(t){return t},e.prototype.updateTrackedPointers_=function(t){if(mg(t)){var r=t.originalEvent,n=r.pointerId.toString();t.type==st.POINTERUP?delete this.trackedPointers_[n]:t.type==st.POINTERDOWN?this.trackedPointers_[n]=r:n in this.trackedPointers_&&(this.trackedPointers_[n]=r),this.targetPointers=Qo(this.trackedPointers_)}},e}(Si);function To(i){for(var e=i.length,t=0,r=0,n=0;n<e;n++)t+=i[n].clientX,r+=i[n].clientY;return[t/e,r/e]}function mg(i){var e=i.type;return e===st.POINTERDOWN||e===st.POINTERDRAG||e===st.POINTERUP}var wi=yg;function Mo(i){var e=arguments;return function(t){for(var r=!0,n=0,a=e.length;n<a&&(r=r&&e[n](t),!!r);++n);return r}}var xg=function(i){var e=i.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Eg=function(i){var e=i.map.getTargetElement(),t=i.map.getOwnerDocument().activeElement;return e.contains(t)},jl=function(i){return i.map.getTargetElement().hasAttribute("tabindex")?Eg(i):!0},Tg=cr,Yl=function(i){var e=i.originalEvent;return e.button==0&&!(Mf&&Cf&&e.ctrlKey)},zl=function(i){var e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Mg=function(i){var e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Wl=function(i){var e=i.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"},Co=function(i){var e=i.originalEvent;return z(e!==void 0,56),e.pointerType=="mouse"},Cg=function(i){var e=i.originalEvent;return z(e!==void 0,56),e.isPrimary&&e.button===0},Rg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Og=function(i){Rg(e,i);function e(t){var r=i.call(this,{stopDown:Qi})||this,n=t||{};r.kinetic_=n.kinetic,r.lastCentroid=null,r.lastPointersCount_,r.panning_=!1;var a=n.condition?n.condition:Mo(zl,Cg);return r.condition_=n.onFocusOnly?Mo(jl,a):a,r.noKinetic_=!1,r}return e.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var r=this.targetPointers,n=To(r);if(r.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){var a=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],o=t.map,s=o.getView();Mc(a,s.getResolution()),Ra(a,s.getRotation()),s.adjustCenterInternal(a)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=r.length,t.originalEvent.preventDefault()},e.prototype.handleUpEvent=function(t){var r=t.map,n=r.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var a=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),s=n.getCenterInternal(),h=r.getPixelFromCoordinateInternal(s),l=r.getCoordinateFromPixelInternal([h[0]-a*Math.cos(o),h[1]-a*Math.sin(o)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:Je})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var r=t.map,n=r.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1},e}(wi),Sg=Og,wg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ig=function(i){wg(e,i);function e(t){var r=this,n=t||{};return r=i.call(this,{stopDown:Qi})||this,r.condition_=n.condition?n.condition:xg,r.lastAngle_=void 0,r.duration_=n.duration!==void 0?n.duration:250,r}return e.prototype.handleDragEvent=function(t){if(!!Co(t)){var r=t.map,n=r.getView();if(n.getConstraints().rotation!==Ba){var a=r.getSize(),o=t.pixel,s=Math.atan2(a[1]/2-o[1],o[0]-a[0]/2);if(this.lastAngle_!==void 0){var h=s-this.lastAngle_;n.adjustRotationInternal(-h)}this.lastAngle_=s}}},e.prototype.handleUpEvent=function(t){if(!Co(t))return!0;var r=t.map,n=r.getView();return n.endInteraction(this.duration_),!1},e.prototype.handleDownEvent=function(t){if(!Co(t))return!1;if(Yl(t)&&this.condition_(t)){var r=t.map;return r.getView().beginInteraction(),this.lastAngle_=void 0,!0}else return!1},e}(wi),Lg=Ig,Pg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),bg=function(i){Pg(e,i);function e(t){var r=i.call(this)||this;return r.geometry_=null,r.element_=document.createElement("div"),r.element_.style.position="absolute",r.element_.style.pointerEvents="auto",r.element_.className="ol-box "+t,r.map_=null,r.startPixel_=null,r.endPixel_=null,r}return e.prototype.disposeInternal=function(){this.setMap(null)},e.prototype.render_=function(){var t=this.startPixel_,r=this.endPixel_,n="px",a=this.element_.style;a.left=Math.min(t[0],r[0])+n,a.top=Math.min(t[1],r[1])+n,a.width=Math.abs(r[0]-t[0])+n,a.height=Math.abs(r[1]-t[1])+n},e.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var r=this.element_.style;r.left="inherit",r.top="inherit",r.width="inherit",r.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},e.prototype.setPixels=function(t,r){this.startPixel_=t,this.endPixel_=r,this.createOrUpdateGeometry(),this.render_()},e.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,r=this.endPixel_,n=[t,[t[0],r[1]],r,[r[0],t[1]]],a=n.map(this.map_.getCoordinateFromPixelInternal,this.map_);a[4]=a[0].slice(),this.geometry_?this.geometry_.setCoordinates([a]):this.geometry_=new Sn([a])},e.prototype.getGeometry=function(){return this.geometry_},e}(Ji),Ag=bg,$l=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Xn={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},Ro=function(i){$l(e,i);function e(t,r,n){var a=i.call(this,t)||this;return a.coordinate=r,a.mapBrowserEvent=n,a}return e}(fe),Ng=function(i){$l(e,i);function e(t){var r=i.call(this)||this;r.on,r.once,r.un;var n=t||{};return r.box_=new Ag(n.className||"ol-dragbox"),r.minArea_=n.minArea!==void 0?n.minArea:64,n.onBoxEnd&&(r.onBoxEnd=n.onBoxEnd),r.startPixel_=null,r.condition_=n.condition?n.condition:Yl,r.boxEndCondition_=n.boxEndCondition?n.boxEndCondition:r.defaultBoxEndCondition,r}return e.prototype.defaultBoxEndCondition=function(t,r,n){var a=n[0]-r[0],o=n[1]-r[1];return a*a+o*o>=this.minArea_},e.prototype.getGeometry=function(){return this.box_.getGeometry()},e.prototype.handleDragEvent=function(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Ro(Xn.BOXDRAG,t.coordinate,t))},e.prototype.handleUpEvent=function(t){this.box_.setMap(null);var r=this.boxEndCondition_(t,this.startPixel_,t.pixel);return r&&this.onBoxEnd(t),this.dispatchEvent(new Ro(r?Xn.BOXEND:Xn.BOXCANCEL,t.coordinate,t)),!1},e.prototype.handleDownEvent=function(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ro(Xn.BOXSTART,t.coordinate,t)),!0):!1},e.prototype.onBoxEnd=function(t){},e}(wi),Fg=Ng,Dg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Gg=function(i){Dg(e,i);function e(t){var r=this,n=t||{},a=n.condition?n.condition:Mg;return r=i.call(this,{condition:a,className:n.className||"ol-dragzoom",minArea:n.minArea})||this,r.duration_=n.duration!==void 0?n.duration:200,r.out_=n.out!==void 0?n.out:!1,r}return e.prototype.onBoxEnd=function(t){var r=this.getMap(),n=r.getView(),a=this.getGeometry();if(this.out_){var o=n.rotatedExtentForGeometry(a),s=n.getResolutionForExtentInternal(o),h=n.getResolution()/s;a=a.clone(),a.scale(h*h)}n.fitInternal(a,{duration:this.duration_,easing:Je})},e}(Fg),Ug=Gg,hr={LEFT:37,UP:38,RIGHT:39,DOWN:40},kg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Bg=function(i){kg(e,i);function e(t){var r=i.call(this)||this,n=t||{};return r.defaultCondition_=function(a){return zl(a)&&Wl(a)},r.condition_=n.condition!==void 0?n.condition:r.defaultCondition_,r.duration_=n.duration!==void 0?n.duration:100,r.pixelDelta_=n.pixelDelta!==void 0?n.pixelDelta:128,r}return e.prototype.handleEvent=function(t){var r=!1;if(t.type==D.KEYDOWN){var n=t.originalEvent,a=n.keyCode;if(this.condition_(t)&&(a==hr.DOWN||a==hr.LEFT||a==hr.RIGHT||a==hr.UP)){var o=t.map,s=o.getView(),h=s.getResolution()*this.pixelDelta_,l=0,u=0;a==hr.DOWN?u=-h:a==hr.LEFT?l=-h:a==hr.RIGHT?l=h:u=h;var f=[l,u];Ra(f,s.getRotation()),dg(s,f,this.duration_),n.preventDefault(),r=!0}}return!r},e}(Si),Xg=Bg,jg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Yg=function(i){jg(e,i);function e(t){var r=i.call(this)||this,n=t||{};return r.condition_=n.condition?n.condition:Wl,r.delta_=n.delta?n.delta:1,r.duration_=n.duration!==void 0?n.duration:100,r}return e.prototype.handleEvent=function(t){var r=!1;if(t.type==D.KEYDOWN||t.type==D.KEYPRESS){var n=t.originalEvent,a=n.charCode;if(this.condition_(t)&&(a=="+".charCodeAt(0)||a=="-".charCodeAt(0))){var o=t.map,s=a=="+".charCodeAt(0)?this.delta_:-this.delta_,h=o.getView();Eo(h,s,void 0,this.duration_),n.preventDefault(),r=!0}}return!r},e}(Si),zg=Yg,Wg=function(){function i(e,t,r){this.decay_=e,this.minVelocity_=t,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0}return i.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},i.prototype.update=function(e,t){this.points_.push(e,t,Date.now())},i.prototype.end=function(){if(this.points_.length<6)return!1;var e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;for(var r=t-3;r>0&&this.points_[r+2]>e;)r-=3;var n=this.points_[t+2]-this.points_[r+2];if(n<1e3/60)return!1;var a=this.points_[t]-this.points_[r],o=this.points_[t+1]-this.points_[r+1];return this.angle_=Math.atan2(o,a),this.initialVelocity_=Math.sqrt(a*a+o*o)/n,this.initialVelocity_>this.minVelocity_},i.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},i.prototype.getAngle=function(){return this.angle_},i}(),$g=Wg,Vg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Oo={TRACKPAD:"trackpad",WHEEL:"wheel"},Hg=function(i){Vg(e,i);function e(t){var r=this,n=t||{};r=i.call(this,n)||this,r.totalDelta_=0,r.lastDelta_=0,r.maxDelta_=n.maxDelta!==void 0?n.maxDelta:1,r.duration_=n.duration!==void 0?n.duration:250,r.timeout_=n.timeout!==void 0?n.timeout:80,r.useAnchor_=n.useAnchor!==void 0?n.useAnchor:!0,r.constrainResolution_=n.constrainResolution!==void 0?n.constrainResolution:!1;var a=n.condition?n.condition:Tg;return r.condition_=n.onFocusOnly?Mo(jl,a):a,r.lastAnchor_=null,r.startTime_=void 0,r.timeoutId_,r.mode_=void 0,r.trackpadEventGap_=400,r.trackpadTimeoutId_,r.deltaPerZoom_=300,r}return e.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0;var t=this.getMap().getView();t.endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},e.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;var r=t.type;if(r!==D.WHEEL)return!0;var n=t.map,a=t.originalEvent;a.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);var o;if(t.type==D.WHEEL&&(o=a.deltaY,Tf&&a.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(o/=is),a.deltaMode===WheelEvent.DOM_DELTA_LINE&&(o*=40)),o===0)return!1;this.lastDelta_=o;var s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(o)<4?Oo.TRACKPAD:Oo.WHEEL);var h=n.getView();if(this.mode_===Oo.TRACKPAD&&!(h.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(h.getAnimating()&&h.cancelAnimations(),h.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),h.adjustZoom(-o/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=s,!1;this.totalDelta_+=o;var l=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1},e.prototype.handleWheelZoom_=function(t){var r=t.getView();r.getAnimating()&&r.cancelAnimations();var n=-X(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(r.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Eo(r,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},e.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},e}(Si),Kg=Hg,Zg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),qg=function(i){Zg(e,i);function e(t){var r=this,n=t||{},a=n;return a.stopDown||(a.stopDown=Qi),r=i.call(this,a)||this,r.anchor_=null,r.lastAngle_=void 0,r.rotating_=!1,r.rotationDelta_=0,r.threshold_=n.threshold!==void 0?n.threshold:.3,r.duration_=n.duration!==void 0?n.duration:250,r}return e.prototype.handleDragEvent=function(t){var r=0,n=this.targetPointers[0],a=this.targetPointers[1],o=Math.atan2(a.clientY-n.clientY,a.clientX-n.clientX);if(this.lastAngle_!==void 0){var s=o-this.lastAngle_;this.rotationDelta_+=s,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),r=s}this.lastAngle_=o;var h=t.map,l=h.getView();if(l.getConstraints().rotation!==Ba){var u=h.getViewport().getBoundingClientRect(),f=To(this.targetPointers);f[0]-=u.left,f[1]-=u.top,this.anchor_=h.getCoordinateFromPixelInternal(f),this.rotating_&&(h.render(),l.adjustRotationInternal(r,this.anchor_))}},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var r=t.map,n=r.getView();return n.endInteraction(this.duration_),!1}else return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var r=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||r.getView().beginInteraction(),!0}else return!1},e}(wi),Jg=qg,Qg=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),t0=function(i){Qg(e,i);function e(t){var r=this,n=t||{},a=n;return a.stopDown||(a.stopDown=Qi),r=i.call(this,a)||this,r.anchor_=null,r.duration_=n.duration!==void 0?n.duration:400,r.lastDistance_=void 0,r.lastScaleDelta_=1,r}return e.prototype.handleDragEvent=function(t){var r=1,n=this.targetPointers[0],a=this.targetPointers[1],o=n.clientX-a.clientX,s=n.clientY-a.clientY,h=Math.sqrt(o*o+s*s);this.lastDistance_!==void 0&&(r=this.lastDistance_/h),this.lastDistance_=h;var l=t.map,u=l.getView();r!=1&&(this.lastScaleDelta_=r);var f=l.getViewport().getBoundingClientRect(),c=To(this.targetPointers);c[0]-=f.left,c[1]-=f.top,this.anchor_=l.getCoordinateFromPixelInternal(c),l.render(),u.adjustResolutionInternal(r,this.anchor_)},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var r=t.map,n=r.getView(),a=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,a),!1}else return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var r=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||r.getView().beginInteraction(),!0}else return!1},e}(wi),e0=t0,r0=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),i0=function(i){r0(e,i);function e(t,r,n){var a=i.call(this)||this;if(a.ends_=[],a.maxDelta_=-1,a.maxDeltaRevision_=-1,Array.isArray(t[0]))a.setCoordinates(t,r);else if(r!==void 0&&n)a.setFlatCoordinates(r,t),a.ends_=n;else{for(var o=a.getLayout(),s=t,h=[],l=[],u=0,f=s.length;u<f;++u){var c=s[u];u===0&&(o=c.getLayout()),ce(h,c.getFlatCoordinates()),l.push(h.length)}a.setFlatCoordinates(o,h),a.ends_=l}return a}return e.prototype.appendLineString=function(t){this.flatCoordinates?ce(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,r,n,a){return a<tr(this.getExtent(),t,r)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ja(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),za(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,r,n,a))},e.prototype.getCoordinateAtM=function(t,r,n){if(this.layout!=ht.XYM&&this.layout!=ht.XYZM||this.flatCoordinates.length===0)return null;var a=r!==void 0?r:!1,o=n!==void 0?n:!1;return yv(this.flatCoordinates,0,this.ends_,this.stride,t,a,o)},e.prototype.getCoordinates=function(){return ci(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new _i(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,r=this.ends_,n=this.layout,a=[],o=0,s=0,h=r.length;s<h;++s){var l=r[s],u=new _i(t.slice(o,l),n);a.push(u),o=l}return a},e.prototype.getFlatMidpoints=function(){for(var t=[],r=this.flatCoordinates,n=0,a=this.ends_,o=this.stride,s=0,h=a.length;s<h;++s){var l=a[s],u=bh(r,n,l,o,.5);ce(t,u),n=l}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=Nd(this.flatCoordinates,0,this.ends_,this.stride,t,r,0,n),new e(r,ht.XY,n)},e.prototype.getType=function(){return A.MULTI_LINE_STRING},e.prototype.intersectsExtent=function(t){return Wd(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,r){this.setLayout(r,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=Wa(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()},e}(nr),n0=i0,a0=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),o0=function(i){a0(e,i);function e(t,r){var n=i.call(this)||this;return r&&!Array.isArray(t[0])?n.setFlatCoordinates(r,t):n.setCoordinates(t,r),n}return e.prototype.appendPoint=function(t){this.flatCoordinates?ce(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,r,n,a){if(a<tr(this.getExtent(),t,r))return a;for(var o=this.flatCoordinates,s=this.stride,h=0,l=o.length;h<l;h+=s){var u=Ze(t,r,o[h],o[h+1]);if(u<a){a=u;for(var f=0;f<s;++f)n[f]=o[h+f];n.length=s}}return a},e.prototype.getCoordinates=function(){return be(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){var r=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||r<=t?null:new Or(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,r=this.layout,n=this.stride,a=[],o=0,s=t.length;o<s;o+=n){var h=new Or(t.slice(o,o+n),r);a.push(h)}return a},e.prototype.getType=function(){return A.MULTI_POINT},e.prototype.intersectsExtent=function(t){for(var r=this.flatCoordinates,n=this.stride,a=0,o=r.length;a<o;a+=n){var s=r[a],h=r[a+1];if(xa(t,s,h))return!0}return!1},e.prototype.setCoordinates=function(t,r){this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Rn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(nr),Vl=o0;function s0(i,e,t,r){for(var n=[],a=$t(),o=0,s=t.length;o<s;++o){var h=t[o];a=ws(i,e,h[0],r),n.push((a[0]+a[2])/2,(a[1]+a[3])/2),e=h[h.length-1]}return n}var h0=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),l0=function(i){h0(e,i);function e(t,r,n){var a=i.call(this)||this;if(a.endss_=[],a.flatInteriorPointsRevision_=-1,a.flatInteriorPoints_=null,a.maxDelta_=-1,a.maxDeltaRevision_=-1,a.orientedRevision_=-1,a.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){for(var o=a.getLayout(),s=t,h=[],l=[],u=0,f=s.length;u<f;++u){var c=s[u];u===0&&(o=c.getLayout());for(var d=h.length,v=c.getEnds(),_=0,p=v.length;_<p;++_)v[_]+=d;ce(h,c.getFlatCoordinates()),l.push(v)}r=o,t=h,n=l}return r!==void 0&&n?(a.setFlatCoordinates(r,t),a.endss_=n):a.setCoordinates(t,r),a}return e.prototype.appendPolygon=function(t){var r;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),r=t.getEnds().slice(),this.endss_.push();else{var n=this.flatCoordinates.length;ce(this.flatCoordinates,t.getFlatCoordinates()),r=t.getEnds().slice();for(var a=0,o=r.length;a<o;++a)r[a]+=n}this.endss_.push(r),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,r=new Array(t),n=0;n<t;++n)r[n]=this.endss_[n].slice();var a=new e(this.flatCoordinates.slice(),this.layout,r);return a.applyProperties(this),a},e.prototype.closestPointXY=function(t,r,n,a){return a<tr(this.getExtent(),t,r)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ld(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Pd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,r,n,a))},e.prototype.containsXY=function(t,r){return Yd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,r)},e.prototype.getArea=function(){return Gd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var r;return t!==void 0?(r=this.getOrientedFlatCoordinates().slice(),Rh(r,0,this.endss_,this.stride,t)):r=this.flatCoordinates,Va(r,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=s0(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=zd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new Vl(this.getFlatInteriorPoints().slice(),ht.XYM)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Kd(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Rh(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=Dd(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),r,0,n),new e(r,ht.XY,n)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var r;if(t===0)r=0;else{var n=this.endss_[t-1];r=n[n.length-1]}var a=this.endss_[t].slice(),o=a[a.length-1];if(r!==0)for(var s=0,h=a.length;s<h;++s)a[s]-=r;return new Sn(this.flatCoordinates.slice(r,o),this.layout,a)},e.prototype.getPolygons=function(){for(var t=this.layout,r=this.flatCoordinates,n=this.endss_,a=[],o=0,s=0,h=n.length;s<h;++s){var l=n[s].slice(),u=l[l.length-1];if(o!==0)for(var f=0,c=l.length;f<c;++f)l[f]-=o;var d=new Sn(r.slice(o,u),t,l);a.push(d),o=u}return a},e.prototype.getType=function(){return A.MULTI_POLYGON},e.prototype.intersectsExtent=function(t){return Vd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,r){this.setLayout(r,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var n=Ad(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{var a=n[n.length-1];this.flatCoordinates.length=a.length===0?0:a[a.length-1]}this.changed()},e}(nr),u0=l0;function f0(i){var e=i||{},t=new Ut,r=new $g(-.005,.05,100),n=e.altShiftDragRotate!==void 0?e.altShiftDragRotate:!0;n&&t.push(new Lg);var a=e.doubleClickZoom!==void 0?e.doubleClickZoom:!0;a&&t.push(new pg({delta:e.zoomDelta,duration:e.zoomDuration}));var o=e.dragPan!==void 0?e.dragPan:!0;o&&t.push(new Sg({onFocusOnly:e.onFocusOnly,kinetic:r}));var s=e.pinchRotate!==void 0?e.pinchRotate:!0;s&&t.push(new Jg);var h=e.pinchZoom!==void 0?e.pinchZoom:!0;h&&t.push(new e0({duration:e.zoomDuration}));var l=e.keyboard!==void 0?e.keyboard:!0;l&&(t.push(new Xg),t.push(new zg({delta:e.zoomDelta,duration:e.zoomDuration})));var u=e.mouseWheelZoom!==void 0?e.mouseWheelZoom:!0;u&&t.push(new Kg({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration}));var f=e.shiftDragZoom!==void 0?e.shiftDragZoom:!0;return f&&t.push(new Ug({duration:e.zoomDuration})),t}var c0=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),d0=function(i){c0(e,i);function e(t){var r=this;return t=vt({},t),t.controls||(t.controls=Lh()),t.interactions||(t.interactions=f0({onFocusOnly:!0})),r=i.call(this,t)||this,r}return e.prototype.createRenderer=function(){return new ed(this)},e}(sv),v0=d0;function _0(i){var e=Object.keys(i.defs),t=e.length,r,n;for(r=0;r<t;++r){var a=e[r];if(!nt(a)){var o=i.defs(a),s=o.units;!s&&o.projName==="longlat"&&(s=Qt.DEGREES),ks(new ga({code:a,axisOrientation:o.axis,metersPerUnit:o.to_meter,units:s}))}}for(r=0;r<t;++r){var h=e[r],l=nt(h);for(n=0;n<t;++n){var u=e[n],f=nt(u);if(!Rs(h,u))if(i.defs[h]===i.defs[u])wa([l,f]);else{var c=i(h,u);Oc(l,f,Ws(l,f,c.forward),Ws(f,l,c.inverse))}}}}function p0(i){i("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"]}var lr=1,ur=2,jn=3,g0=4,So=5,Hl=6378137,y0=6356752314e-3,Kl=.0066943799901413165,Ii=484813681109536e-20,R=Math.PI/2,m0=.16666666666666666,x0=.04722222222222222,E0=.022156084656084655,w=1e-10,Tt=.017453292519943295,se=57.29577951308232,et=Math.PI/4,Li=Math.PI*2,_t=3.14159265359,Nt={};Nt.greenwich=0;Nt.lisbon=-9.131906111111;Nt.paris=2.337229166667;Nt.bogota=-74.080916666667;Nt.madrid=-3.687938888889;Nt.rome=12.452333333333;Nt.bern=7.439583333333;Nt.jakarta=106.807719444444;Nt.ferro=-17.666666666667;Nt.brussels=4.367975;Nt.stockholm=18.058277777778;Nt.athens=23.7163375;Nt.oslo=10.722916666667;var T0={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Zl=/[\s_\-\/\(\)]/g;function Be(i,e){if(i[e])return i[e];for(var t=Object.keys(i),r=e.toLowerCase().replace(Zl,""),n=-1,a,o;++n<t.length;)if(a=t[n],o=a.toLowerCase().replace(Zl,""),o===r)return i[a]}function wo(i){var e={},t=i.split("+").map(function(s){return s.trim()}).filter(function(s){return s}).reduce(function(s,h){var l=h.split("=");return l.push(!0),s[l[0].toLowerCase()]=l[1],s},{}),r,n,a,o={proj:"projName",datum:"datumCode",rf:function(s){e.rf=parseFloat(s)},lat_0:function(s){e.lat0=s*Tt},lat_1:function(s){e.lat1=s*Tt},lat_2:function(s){e.lat2=s*Tt},lat_ts:function(s){e.lat_ts=s*Tt},lon_0:function(s){e.long0=s*Tt},lon_1:function(s){e.long1=s*Tt},lon_2:function(s){e.long2=s*Tt},alpha:function(s){e.alpha=parseFloat(s)*Tt},gamma:function(s){e.rectified_grid_angle=parseFloat(s)},lonc:function(s){e.longc=s*Tt},x_0:function(s){e.x0=parseFloat(s)},y_0:function(s){e.y0=parseFloat(s)},k_0:function(s){e.k0=parseFloat(s)},k:function(s){e.k0=parseFloat(s)},a:function(s){e.a=parseFloat(s)},b:function(s){e.b=parseFloat(s)},r_a:function(){e.R_A=!0},zone:function(s){e.zone=parseInt(s,10)},south:function(){e.utmSouth=!0},towgs84:function(s){e.datum_params=s.split(",").map(function(h){return parseFloat(h)})},to_meter:function(s){e.to_meter=parseFloat(s)},units:function(s){e.units=s;var h=Be(T0,s);h&&(e.to_meter=h.to_meter)},from_greenwich:function(s){e.from_greenwich=s*Tt},pm:function(s){var h=Be(Nt,s);e.from_greenwich=(h||parseFloat(s))*Tt},nadgrids:function(s){s==="@null"?e.datumCode="none":e.nadgrids=s},axis:function(s){var h="ewnsud";s.length===3&&h.indexOf(s.substr(0,1))!==-1&&h.indexOf(s.substr(1,1))!==-1&&h.indexOf(s.substr(2,1))!==-1&&(e.axis=s)},approx:function(){e.approx=!0}};for(r in t)n=t[r],r in o?(a=o[r],typeof a=="function"?a(n):e[a]=n):e[r]=n;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}var Pi=1,ql=2,Jl=3,Yn=4,Ql=5,Io=-1,M0=/\s/,C0=/[A-Za-z]/,R0=/[A-Za-z84_]/,zn=/[,\]]/,tu=/[\d\.E\-\+]/;function Ee(i){if(typeof i!="string")throw new Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Pi}Ee.prototype.readCharicter=function(){var i=this.text[this.place++];if(this.state!==Yn)for(;M0.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case Pi:return this.neutral(i);case ql:return this.keyword(i);case Yn:return this.quoted(i);case Ql:return this.afterquote(i);case Jl:return this.number(i);case Io:return}};Ee.prototype.afterquote=function(i){if(i==='"'){this.word+='"',this.state=Yn;return}if(zn.test(i)){this.word=this.word.trim(),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in afterquote yet, index '+this.place)};Ee.prototype.afterItem=function(i){if(i===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Pi;return}if(i==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Pi,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Io);return}};Ee.prototype.number=function(i){if(tu.test(i)){this.word+=i;return}if(zn.test(i)){this.word=parseFloat(this.word),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in number yet, index '+this.place)};Ee.prototype.quoted=function(i){if(i==='"'){this.state=Ql;return}this.word+=i};Ee.prototype.keyword=function(i){if(R0.test(i)){this.word+=i;return}if(i==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=Pi;return}if(zn.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in keyword yet, index '+this.place)};Ee.prototype.neutral=function(i){if(C0.test(i)){this.word=i,this.state=ql;return}if(i==='"'){this.word="",this.state=Yn;return}if(tu.test(i)){this.word=i,this.state=Jl;return}if(zn.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in neutral yet, index '+this.place)};Ee.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Io)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function O0(i){var e=new Ee(i);return e.output()}function eu(i,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var r=e?{}:i,n=t.reduce(function(a,o){return Ar(o,a),a},r);e&&(i[e]=n)}function Ar(i,e){if(!Array.isArray(i)){e[i]=!0;return}var t=i.shift();if(t==="PARAMETER"&&(t=i.shift()),i.length===1){if(Array.isArray(i[0])){e[t]={},Ar(i[0],e[t]);return}e[t]=i[0];return}if(!i.length){e[t]=!0;return}if(t==="TOWGS84"){e[t]=i;return}if(t==="AXIS"){t in e||(e[t]=[]),e[t].push(i);return}Array.isArray(t)||(e[t]={});var r;switch(t){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[t]={name:i[0].toLowerCase(),convert:i[1]},i.length===3&&Ar(i[2],e[t]);return;case"SPHEROID":case"ELLIPSOID":e[t]={name:i[0],a:i[1],rf:i[2]},i.length===4&&Ar(i[3],e[t]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":i[0]=["name",i[0]],eu(e,t,i);return;default:for(r=-1;++r<i.length;)if(!Array.isArray(i[r]))return Ar(i,e[t]);return eu(e,t,i)}}var S0=.017453292519943295;function w0(i,e){var t=e[0],r=e[1];!(t in i)&&r in i&&(i[t]=i[r],e.length===3&&(i[t]=e[2](i[t])))}function Te(i){return i*S0}function I0(i){if(i.type==="GEOGCS"?i.projName="longlat":i.type==="LOCAL_CS"?(i.projName="identity",i.local=!0):typeof i.PROJECTION=="object"?i.projName=Object.keys(i.PROJECTION)[0]:i.projName=i.PROJECTION,i.AXIS){for(var e="",t=0,r=i.AXIS.length;t<r;++t){var n=[i.AXIS[t][0].toLowerCase(),i.AXIS[t][1].toLowerCase()];n[0].indexOf("north")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="north"?e+="n":n[0].indexOf("south")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="south"?e+="s":n[0].indexOf("east")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="east"?e+="e":(n[0].indexOf("west")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(i.axis=e)}i.UNIT&&(i.units=i.UNIT.name.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.UNIT.convert&&(i.type==="GEOGCS"?i.DATUM&&i.DATUM.SPHEROID&&(i.to_meter=i.UNIT.convert*i.DATUM.SPHEROID.a):i.to_meter=i.UNIT.convert));var a=i.GEOGCS;i.type==="GEOGCS"&&(a=i),a&&(a.DATUM?i.datumCode=a.DATUM.name.toLowerCase():i.datumCode=a.name.toLowerCase(),i.datumCode.slice(0,2)==="d_"&&(i.datumCode=i.datumCode.slice(2)),(i.datumCode==="new_zealand_geodetic_datum_1949"||i.datumCode==="new_zealand_1949")&&(i.datumCode="nzgd49"),(i.datumCode==="wgs_1984"||i.datumCode==="world_geodetic_system_1984")&&(i.PROJECTION==="Mercator_Auxiliary_Sphere"&&(i.sphere=!0),i.datumCode="wgs84"),i.datumCode.slice(-6)==="_ferro"&&(i.datumCode=i.datumCode.slice(0,-6)),i.datumCode.slice(-8)==="_jakarta"&&(i.datumCode=i.datumCode.slice(0,-8)),~i.datumCode.indexOf("belge")&&(i.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(i.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),i.ellps.toLowerCase().slice(0,13)==="international"&&(i.ellps="intl"),i.a=a.DATUM.SPHEROID.a,i.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(i.datum_params=a.DATUM.TOWGS84),~i.datumCode.indexOf("osgb_1936")&&(i.datumCode="osgb36"),~i.datumCode.indexOf("osni_1952")&&(i.datumCode="osni52"),(~i.datumCode.indexOf("tm65")||~i.datumCode.indexOf("geodetic_datum_of_1965"))&&(i.datumCode="ire65"),i.datumCode==="ch1903+"&&(i.datumCode="ch1903"),~i.datumCode.indexOf("israel")&&(i.datumCode="isr93")),i.b&&!isFinite(i.b)&&(i.b=i.a);function o(l){var u=i.to_meter||1;return l*u}var s=function(l){return w0(i,l)},h=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Te],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Te],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Te],["lat0","latitude_of_origin",Te],["lat0","standard_parallel_1",Te],["lat1","standard_parallel_1",Te],["lat2","standard_parallel_2",Te],["azimuth","Azimuth"],["alpha","azimuth",Te],["srsCode","name"]];h.forEach(s),!i.long0&&i.longc&&(i.projName==="Albers_Conic_Equal_Area"||i.projName==="Lambert_Azimuthal_Equal_Area")&&(i.long0=i.longc),!i.lat_ts&&i.lat1&&(i.projName==="Stereographic_South_Pole"||i.projName==="Polar Stereographic (variant B)")&&(i.lat0=Te(i.lat1>0?90:-90),i.lat_ts=i.lat1)}function ru(i){var e=O0(i),t=e.shift(),r=e.shift();e.unshift(["name",r]),e.unshift(["type",t]);var n={};return Ar(e,n),I0(n),n}function Ot(i){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?Ot[i]=wo(arguments[1]):Ot[i]=ru(arguments[1]):Ot[i]=t}else if(arguments.length===1){if(Array.isArray(i))return i.map(function(r){Array.isArray(r)?Ot.apply(e,r):Ot(r)});if(typeof i=="string"){if(i in Ot)return Ot[i]}else"EPSG"in i?Ot["EPSG:"+i.EPSG]=i:"ESRI"in i?Ot["ESRI:"+i.ESRI]=i:"IAU2000"in i?Ot["IAU2000:"+i.IAU2000]=i:console.log(i);return}}p0(Ot);function L0(i){return typeof i=="string"}function P0(i){return i in Ot}var b0=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function A0(i){return b0.some(function(e){return i.indexOf(e)>-1})}var N0=["3857","900913","3785","102113"];function F0(i){var e=Be(i,"authority");if(!!e){var t=Be(e,"epsg");return t&&N0.indexOf(t)>-1}}function D0(i){var e=Be(i,"extension");if(!!e)return Be(e,"proj4")}function G0(i){return i[0]==="+"}function U0(i){if(L0(i)){if(P0(i))return Ot[i];if(A0(i)){var e=ru(i);if(F0(e))return Ot["EPSG:3857"];var t=D0(e);return t?wo(t):e}if(G0(i))return wo(i)}else return i}function iu(i,e){i=i||{};var t,r;if(!e)return i;for(r in e)t=e[r],t!==void 0&&(i[r]=t);return i}function he(i,e,t){var r=i*e;return t/Math.sqrt(1-r*r)}function bi(i){return i<0?-1:1}function L(i){return Math.abs(i)<=_t?i:i-bi(i)*Li}function Ht(i,e,t){var r=i*t,n=.5*i;return r=Math.pow((1-r)/(1+r),n),Math.tan(.5*(R-e))/r}function Ai(i,e){for(var t=.5*i,r,n,a=R-2*Math.atan(e),o=0;o<=15;o++)if(r=i*Math.sin(a),n=R-2*Math.atan(e*Math.pow((1-r)/(1+r),t))-a,a+=n,Math.abs(n)<=1e-10)return a;return-9999}function k0(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=he(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function B0(i){var e=i.x,t=i.y;if(t*se>90&&t*se<-90&&e*se>180&&e*se<-180)return null;var r,n;if(Math.abs(Math.abs(t)-R)<=w)return null;if(this.sphere)r=this.x0+this.a*this.k0*L(e-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(et+.5*t));else{var a=Math.sin(t),o=Ht(this.e,t,a);r=this.x0+this.a*this.k0*L(e-this.long0),n=this.y0-this.a*this.k0*Math.log(o)}return i.x=r,i.y=n,i}function X0(i){var e=i.x-this.x0,t=i.y-this.y0,r,n;if(this.sphere)n=R-2*Math.atan(Math.exp(-t/(this.a*this.k0)));else{var a=Math.exp(-t/(this.a*this.k0));if(n=Ai(this.e,a),n===-9999)return null}return r=L(this.long0+e/(this.a*this.k0)),i.x=r,i.y=n,i}var j0=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"],Y0={init:k0,forward:B0,inverse:X0,names:j0};function z0(){}function nu(i){return i}var W0=["longlat","identity"],$0={init:z0,forward:nu,inverse:nu,names:W0},V0=[Y0,$0],Wn={},$n=[];function au(i,e){var t=$n.length;return i.names?($n[t]=i,i.names.forEach(function(r){Wn[r.toLowerCase()]=t}),this):(console.log(e),!0)}function H0(i){if(!i)return!1;var e=i.toLowerCase();if(typeof Wn[e]!="undefined"&&$n[Wn[e]])return $n[Wn[e]]}function K0(){V0.forEach(au)}var Z0={start:K0,add:au,get:H0},j={};j.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};j.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};j.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};j.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};j.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};j.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};j.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};j.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};j.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};j.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};j.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};j.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};j.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};j.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};j.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};j.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};j.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};j.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};j.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};j.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};j.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};j.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};j.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};j.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};j.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};j.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};j.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};j.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};j.hough={a:6378270,rf:297,ellipseName:"Hough"};j.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};j.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};j.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};j.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};j.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};j.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};j.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};j.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};j.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};j.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};j.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};j.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var q0=j.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};j.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function J0(i,e,t,r){var n=i*i,a=e*e,o=(n-a)/n,s=0;r?(i*=1-o*(m0+o*(x0+o*E0)),n=i*i,o=0):s=Math.sqrt(o);var h=(n-a)/a;return{es:o,e:s,ep2:h}}function Q0(i,e,t,r,n){if(!i){var a=Be(j,r);a||(a=q0),i=a.a,e=a.b,t=a.rf}return t&&!e&&(e=(1-1/t)*i),(t===0||Math.abs(i-e)<w)&&(n=!0,e=i),{a:i,b:e,rf:t,sphere:n}}var Et={};Et.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Et.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Et.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Et.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Et.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Et.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Et.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Et.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Et.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Et.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Et.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Et.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Et.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Et.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Et.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Et.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Et.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function ty(i,e,t,r,n,a,o){var s={};return i===void 0||i==="none"?s.datum_type=So:s.datum_type=g0,e&&(s.datum_params=e.map(parseFloat),(s.datum_params[0]!==0||s.datum_params[1]!==0||s.datum_params[2]!==0)&&(s.datum_type=lr),s.datum_params.length>3&&(s.datum_params[3]!==0||s.datum_params[4]!==0||s.datum_params[5]!==0||s.datum_params[6]!==0)&&(s.datum_type=ur,s.datum_params[3]*=Ii,s.datum_params[4]*=Ii,s.datum_params[5]*=Ii,s.datum_params[6]=s.datum_params[6]/1e6+1)),o&&(s.datum_type=jn,s.grids=o),s.a=t,s.b=r,s.es=n,s.ep2=a,s}var ou={};function ey(i,e){var t=new DataView(e),r=ny(t),n=ay(t,r);n.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var a=oy(t,n,r),o={header:n,subgrids:a};return ou[i]=o,o}function ry(i){if(i===void 0)return null;var e=i.split(",");return e.map(iy)}function iy(i){if(i.length===0)return null;var e=i[0]==="@";return e&&(i=i.slice(1)),i==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:i,mandatory:!e,grid:ou[i]||null,isNull:!1}}function Nr(i){return i/3600*Math.PI/180}function ny(i){var e=i.getInt32(8,!1);return e===11?!1:(e=i.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function ay(i,e){return{nFields:i.getInt32(8,e),nSubgridFields:i.getInt32(24,e),nSubgrids:i.getInt32(40,e),shiftType:Lo(i,56,56+8).trim(),fromSemiMajorAxis:i.getFloat64(120,e),fromSemiMinorAxis:i.getFloat64(136,e),toSemiMajorAxis:i.getFloat64(152,e),toSemiMinorAxis:i.getFloat64(168,e)}}function Lo(i,e,t){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(e,t)))}function oy(i,e,t){for(var r=176,n=[],a=0;a<e.nSubgrids;a++){var o=hy(i,r,t),s=ly(i,r,o,t),h=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),l=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);n.push({ll:[Nr(o.lowerLongitude),Nr(o.lowerLatitude)],del:[Nr(o.longitudeInterval),Nr(o.latitudeInterval)],lim:[h,l],count:o.gridNodeCount,cvs:sy(s)})}return n}function sy(i){return i.map(function(e){return[Nr(e.longitudeShift),Nr(e.latitudeShift)]})}function hy(i,e,t){return{name:Lo(i,e+8,e+16).trim(),parent:Lo(i,e+24,e+24+8).trim(),lowerLatitude:i.getFloat64(e+72,t),upperLatitude:i.getFloat64(e+88,t),lowerLongitude:i.getFloat64(e+104,t),upperLongitude:i.getFloat64(e+120,t),latitudeInterval:i.getFloat64(e+136,t),longitudeInterval:i.getFloat64(e+152,t),gridNodeCount:i.getInt32(e+168,t)}}function ly(i,e,t,r){for(var n=e+176,a=16,o=[],s=0;s<t.gridNodeCount;s++){var h={latitudeShift:i.getFloat32(n+s*a,r),longitudeShift:i.getFloat32(n+s*a+4,r),latitudeAccuracy:i.getFloat32(n+s*a+8,r),longitudeAccuracy:i.getFloat32(n+s*a+12,r)};o.push(h)}return o}function le(i,e){if(!(this instanceof le))return new le(i);e=e||function(l){if(l)throw l};var t=U0(i);if(typeof t!="object"){e(i);return}var r=le.projections.get(t.projName);if(!r){e(i);return}if(t.datumCode&&t.datumCode!=="none"){var n=Be(Et,t.datumCode);n&&(t.datum_params=t.datum_params||(n.towgs84?n.towgs84.split(","):null),t.ellps=n.ellipse,t.datumName=n.datumName?n.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var a=Q0(t.a,t.b,t.rf,t.ellps,t.sphere),o=J0(a.a,a.b,a.rf,t.R_A),s=ry(t.nadgrids),h=t.datum||ty(t.datumCode,t.datum_params,a.a,a.b,o.es,o.ep2,s);iu(this,t),iu(this,r),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=h,this.init(),e(null,this)}le.projections=Z0;le.projections.start();function uy(i,e){return i.datum_type!==e.datum_type||i.a!==e.a||Math.abs(i.es-e.es)>5e-11?!1:i.datum_type===lr?i.datum_params[0]===e.datum_params[0]&&i.datum_params[1]===e.datum_params[1]&&i.datum_params[2]===e.datum_params[2]:i.datum_type===ur?i.datum_params[0]===e.datum_params[0]&&i.datum_params[1]===e.datum_params[1]&&i.datum_params[2]===e.datum_params[2]&&i.datum_params[3]===e.datum_params[3]&&i.datum_params[4]===e.datum_params[4]&&i.datum_params[5]===e.datum_params[5]&&i.datum_params[6]===e.datum_params[6]:!0}function su(i,e,t){var r=i.x,n=i.y,a=i.z?i.z:0,o,s,h,l;if(n<-R&&n>-1.001*R)n=-R;else if(n>R&&n<1.001*R)n=R;else{if(n<-R)return{x:-1/0,y:-1/0,z:i.z};if(n>R)return{x:1/0,y:1/0,z:i.z}}return r>Math.PI&&(r-=2*Math.PI),s=Math.sin(n),l=Math.cos(n),h=s*s,o=t/Math.sqrt(1-e*h),{x:(o+a)*l*Math.cos(r),y:(o+a)*l*Math.sin(r),z:(o*(1-e)+a)*s}}function hu(i,e,t,r){var n=1e-12,a=n*n,o=30,s,h,l,u,f,c,d,v,_,p,y,g,m,x=i.x,E=i.y,T=i.z?i.z:0,M,C,O;if(s=Math.sqrt(x*x+E*E),h=Math.sqrt(x*x+E*E+T*T),s/t<n){if(M=0,h/t<n)return C=R,O=-r,{x:i.x,y:i.y,z:i.z}}else M=Math.atan2(E,x);l=T/h,u=s/h,f=1/Math.sqrt(1-e*(2-e)*u*u),v=u*(1-e)*f,_=l*f,m=0;do m++,d=t/Math.sqrt(1-e*_*_),O=s*v+T*_-d*(1-e*_*_),c=e*d/(d+O),f=1/Math.sqrt(1-c*(2-c)*u*u),p=u*(1-c)*f,y=l*f,g=y*v-p*_,v=p,_=y;while(g*g>a&&m<o);return C=Math.atan(y/Math.abs(p)),{x:M,y:C,z:O}}function fy(i,e,t){if(e===lr)return{x:i.x+t[0],y:i.y+t[1],z:i.z+t[2]};if(e===ur){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],h=t[5],l=t[6];return{x:l*(i.x-h*i.y+s*i.z)+r,y:l*(h*i.x+i.y-o*i.z)+n,z:l*(-s*i.x+o*i.y+i.z)+a}}}function cy(i,e,t){if(e===lr)return{x:i.x-t[0],y:i.y-t[1],z:i.z-t[2]};if(e===ur){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],h=t[5],l=t[6],u=(i.x-r)/l,f=(i.y-n)/l,c=(i.z-a)/l;return{x:u+h*f-s*c,y:-h*u+f+o*c,z:s*u-o*f+c}}}function Vn(i){return i===lr||i===ur}function dy(i,e,t){if(uy(i,e)||i.datum_type===So||e.datum_type===So)return t;var r=i.a,n=i.es;if(i.datum_type===jn){var a=lu(i,!1,t);if(a!==0)return;r=Hl,n=Kl}var o=e.a,s=e.b,h=e.es;if(e.datum_type===jn&&(o=Hl,s=y0,h=Kl),n===h&&r===o&&!Vn(i.datum_type)&&!Vn(e.datum_type))return t;if(t=su(t,n,r),Vn(i.datum_type)&&(t=fy(t,i.datum_type,i.datum_params)),Vn(e.datum_type)&&(t=cy(t,e.datum_type,e.datum_params)),t=hu(t,h,o,s),e.datum_type===jn){var l=lu(e,!0,t);if(l!==0)return}return t}function lu(i,e,t){if(i.grids===null||i.grids.length===0)return console.log("Grid shift grids not found"),-1;for(var r={x:-t.x,y:t.y},n={x:Number.NaN,y:Number.NaN},a=[],o=0;o<i.grids.length;o++){var s=i.grids[o];if(a.push(s.name),s.isNull){n=r;break}if(s.grid===null){if(s.mandatory)return console.log("Unable to find mandatory grid '"+s.name+"'"),-1;continue}var h=s.grid.subgrids[0],l=(Math.abs(h.del[1])+Math.abs(h.del[0]))/1e4,u=h.ll[0]-l,f=h.ll[1]-l,c=h.ll[0]+(h.lim[0]-1)*h.del[0]+l,d=h.ll[1]+(h.lim[1]-1)*h.del[1]+l;if(!(f>r.y||u>r.x||d<r.y||c<r.x)&&(n=vy(r,e,h),!isNaN(n.x)))break}return isNaN(n.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*se+" "+r.y*se+" tried: '"+a+"'"),-1):(t.x=-n.x,t.y=n.y,0)}function vy(i,e,t){var r={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return r;var n={x:i.x,y:i.y};n.x-=t.ll[0],n.y-=t.ll[1],n.x=L(n.x-Math.PI)+Math.PI;var a=uu(n,t);if(e){if(isNaN(a.x))return r;a.x=n.x-a.x,a.y=n.y-a.y;var o=9,s=1e-12,h,l;do{if(l=uu(a,t),isNaN(l.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}h={x:n.x-(l.x+a.x),y:n.y-(l.y+a.y)},a.x+=h.x,a.y+=h.y}while(o--&&Math.abs(h.x)>s&&Math.abs(h.y)>s);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=L(a.x+t.ll[0]),r.y=a.y+t.ll[1]}else isNaN(a.x)||(r.x=i.x+a.x,r.y=i.y+a.y);return r}function uu(i,e){var t={x:i.x/e.del[0],y:i.y/e.del[1]},r={x:Math.floor(t.x),y:Math.floor(t.y)},n={x:t.x-1*r.x,y:t.y-1*r.y},a={x:Number.NaN,y:Number.NaN},o;if(r.x<0||r.x>=e.lim[0]||r.y<0||r.y>=e.lim[1])return a;o=r.y*e.lim[0]+r.x;var s={x:e.cvs[o][0],y:e.cvs[o][1]};o++;var h={x:e.cvs[o][0],y:e.cvs[o][1]};o+=e.lim[0];var l={x:e.cvs[o][0],y:e.cvs[o][1]};o--;var u={x:e.cvs[o][0],y:e.cvs[o][1]},f=n.x*n.y,c=n.x*(1-n.y),d=(1-n.x)*(1-n.y),v=(1-n.x)*n.y;return a.x=d*s.x+c*h.x+v*u.x+f*l.x,a.y=d*s.y+c*h.y+v*u.y+f*l.y,a}function fu(i,e,t){var r=t.x,n=t.y,a=t.z||0,o,s,h,l={};for(h=0;h<3;h++)if(!(e&&h===2&&t.z===void 0))switch(h===0?(o=r,"ew".indexOf(i.axis[h])!==-1?s="x":s="y"):h===1?(o=n,"ns".indexOf(i.axis[h])!==-1?s="y":s="x"):(o=a,s="z"),i.axis[h]){case"e":l[s]=o;break;case"w":l[s]=-o;break;case"n":l[s]=o;break;case"s":l[s]=-o;break;case"u":t[s]!==void 0&&(l.z=o);break;case"d":t[s]!==void 0&&(l.z=-o);break;default:return null}return l}function cu(i){var e={x:i[0],y:i[1]};return i.length>2&&(e.z=i[2]),i.length>3&&(e.m=i[3]),e}function _y(i){du(i.x),du(i.y)}function du(i){if(typeof Number.isFinite=="function"){if(Number.isFinite(i))return;throw new TypeError("coordinates must be finite numbers")}if(typeof i!="number"||i!==i||!isFinite(i))throw new TypeError("coordinates must be finite numbers")}function py(i,e){return(i.datum.datum_type===lr||i.datum.datum_type===ur)&&e.datumCode!=="WGS84"||(e.datum.datum_type===lr||e.datum.datum_type===ur)&&i.datumCode!=="WGS84"}function Hn(i,e,t,r){var n;if(Array.isArray(t)&&(t=cu(t)),_y(t),i.datum&&e.datum&&py(i,e)&&(n=new le("WGS84"),t=Hn(i,n,t,r),i=n),r&&i.axis!=="enu"&&(t=fu(i,!1,t)),i.projName==="longlat")t={x:t.x*Tt,y:t.y*Tt,z:t.z||0};else if(i.to_meter&&(t={x:t.x*i.to_meter,y:t.y*i.to_meter,z:t.z||0}),t=i.inverse(t),!t)return;if(i.from_greenwich&&(t.x+=i.from_greenwich),t=dy(i.datum,e.datum,t),!!t)return e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*se,y:t.y*se,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),r&&e.axis!=="enu"?fu(e,!0,t):t}var vu=le("WGS84");function Po(i,e,t,r){var n,a,o;return Array.isArray(t)?(n=Hn(i,e,t,r)||{x:NaN,y:NaN},t.length>2?typeof i.name!="undefined"&&i.name==="geocent"||typeof e.name!="undefined"&&e.name==="geocent"?typeof n.z=="number"?[n.x,n.y,n.z].concat(t.splice(3)):[n.x,n.y,t[2]].concat(t.splice(3)):[n.x,n.y].concat(t.splice(2)):[n.x,n.y]):(a=Hn(i,e,t,r),o=Object.keys(t),o.length===2||o.forEach(function(s){if(typeof i.name!="undefined"&&i.name==="geocent"||typeof e.name!="undefined"&&e.name==="geocent"){if(s==="x"||s==="y"||s==="z")return}else if(s==="x"||s==="y")return;a[s]=t[s]}),a)}function _u(i){return i instanceof le?i:i.oProj?i.oProj:le(i)}function Ft(i,e,t){i=_u(i);var r=!1,n;return typeof e=="undefined"?(e=i,i=vu,r=!0):(typeof e.x!="undefined"||Array.isArray(e))&&(t=e,e=i,i=vu,r=!0),e=_u(e),t?Po(i,e,t):(n={forward:function(a,o){return Po(i,e,a,o)},inverse:function(a,o){return Po(e,i,a,o)}},r&&(n.oProj=e),n)}var pu=6,gu="AJSAJS",yu="AFAFAF",Fr=65,Dt=73,Wt=79,Ni=86,Fi=90,gy={forward:mu,inverse:yy,toPoint:xu};function mu(i,e){return e=e||5,Ey(my({lat:i[1],lon:i[0]}),e)}function yy(i){var e=Ao(Mu(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function xu(i){var e=Ao(Mu(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function bo(i){return i*(Math.PI/180)}function Eu(i){return 180*(i/Math.PI)}function my(i){var e=i.lat,t=i.lon,r=6378137,n=.00669438,a=.9996,o,s,h,l,u,f,c,d=bo(e),v=bo(t),_,p;p=Math.floor((t+180)/6)+1,t===180&&(p=60),e>=56&&e<64&&t>=3&&t<12&&(p=32),e>=72&&e<84&&(t>=0&&t<9?p=31:t>=9&&t<21?p=33:t>=21&&t<33?p=35:t>=33&&t<42&&(p=37)),o=(p-1)*6-180+3,_=bo(o),s=n/(1-n),h=r/Math.sqrt(1-n*Math.sin(d)*Math.sin(d)),l=Math.tan(d)*Math.tan(d),u=s*Math.cos(d)*Math.cos(d),f=Math.cos(d)*(v-_),c=r*((1-n/4-3*n*n/64-5*n*n*n/256)*d-(3*n/8+3*n*n/32+45*n*n*n/1024)*Math.sin(2*d)+(15*n*n/256+45*n*n*n/1024)*Math.sin(4*d)-35*n*n*n/3072*Math.sin(6*d));var y=a*h*(f+(1-l+u)*f*f*f/6+(5-18*l+l*l+72*u-58*s)*f*f*f*f*f/120)+5e5,g=a*(c+h*Math.tan(d)*(f*f/2+(5-l+9*u+4*u*u)*f*f*f*f/24+(61-58*l+l*l+600*u-330*s)*f*f*f*f*f*f/720));return e<0&&(g+=1e7),{northing:Math.round(g),easting:Math.round(y),zoneNumber:p,zoneLetter:xy(e)}}function Ao(i){var e=i.northing,t=i.easting,r=i.zoneLetter,n=i.zoneNumber;if(n<0||n>60)return null;var a=.9996,o=6378137,s=.00669438,h,l=(1-Math.sqrt(1-s))/(1+Math.sqrt(1-s)),u,f,c,d,v,_,p,y,g,m=t-5e5,x=e;r<"N"&&(x-=1e7),p=(n-1)*6-180+3,h=s/(1-s),_=x/a,y=_/(o*(1-s/4-3*s*s/64-5*s*s*s/256)),g=y+(3*l/2-27*l*l*l/32)*Math.sin(2*y)+(21*l*l/16-55*l*l*l*l/32)*Math.sin(4*y)+151*l*l*l/96*Math.sin(6*y),u=o/Math.sqrt(1-s*Math.sin(g)*Math.sin(g)),f=Math.tan(g)*Math.tan(g),c=h*Math.cos(g)*Math.cos(g),d=o*(1-s)/Math.pow(1-s*Math.sin(g)*Math.sin(g),1.5),v=m/(u*a);var E=g-u*Math.tan(g)/d*(v*v/2-(5+3*f+10*c-4*c*c-9*h)*v*v*v*v/24+(61+90*f+298*c+45*f*f-252*h-3*c*c)*v*v*v*v*v*v/720);E=Eu(E);var T=(v-(1+2*f+c)*v*v*v/6+(5-2*c+28*f-3*c*c+8*h+24*f*f)*v*v*v*v*v/120)/Math.cos(g);T=p+Eu(T);var M;if(i.accuracy){var C=Ao({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});M={top:C.lat,right:C.lon,bottom:E,left:T}}else M={lat:E,lon:T};return M}function xy(i){var e="Z";return 84>=i&&i>=72?e="X":72>i&&i>=64?e="W":64>i&&i>=56?e="V":56>i&&i>=48?e="U":48>i&&i>=40?e="T":40>i&&i>=32?e="S":32>i&&i>=24?e="R":24>i&&i>=16?e="Q":16>i&&i>=8?e="P":8>i&&i>=0?e="N":0>i&&i>=-8?e="M":-8>i&&i>=-16?e="L":-16>i&&i>=-24?e="K":-24>i&&i>=-32?e="J":-32>i&&i>=-40?e="H":-40>i&&i>=-48?e="G":-48>i&&i>=-56?e="F":-56>i&&i>=-64?e="E":-64>i&&i>=-72?e="D":-72>i&&i>=-80&&(e="C"),e}function Ey(i,e){var t="00000"+i.easting,r="00000"+i.northing;return i.zoneNumber+i.zoneLetter+Ty(i.easting,i.northing,i.zoneNumber)+t.substr(t.length-5,e)+r.substr(r.length-5,e)}function Ty(i,e,t){var r=Tu(t),n=Math.floor(i/1e5),a=Math.floor(e/1e5)%20;return My(n,a,r)}function Tu(i){var e=i%pu;return e===0&&(e=pu),e}function My(i,e,t){var r=t-1,n=gu.charCodeAt(r),a=yu.charCodeAt(r),o=n+i-1,s=a+e,h=!1;o>Fi&&(o=o-Fi+Fr-1,h=!0),(o===Dt||n<Dt&&o>Dt||(o>Dt||n<Dt)&&h)&&o++,(o===Wt||n<Wt&&o>Wt||(o>Wt||n<Wt)&&h)&&(o++,o===Dt&&o++),o>Fi&&(o=o-Fi+Fr-1),s>Ni?(s=s-Ni+Fr-1,h=!0):h=!1,(s===Dt||a<Dt&&s>Dt||(s>Dt||a<Dt)&&h)&&s++,(s===Wt||a<Wt&&s>Wt||(s>Wt||a<Wt)&&h)&&(s++,s===Dt&&s++),s>Ni&&(s=s-Ni+Fr-1);var l=String.fromCharCode(o)+String.fromCharCode(s);return l}function Mu(i){if(i&&i.length===0)throw"MGRSPoint coverting from nothing";for(var e=i.length,t=null,r="",n,a=0;!/[A-Z]/.test(n=i.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+i;r+=n,a++}var o=parseInt(r,10);if(a===0||a+3>e)throw"MGRSPoint bad conversion from: "+i;var s=i.charAt(a++);if(s<="A"||s==="B"||s==="Y"||s>="Z"||s==="I"||s==="O")throw"MGRSPoint zone letter "+s+" not handled: "+i;t=i.substring(a,a+=2);for(var h=Tu(o),l=Cy(t.charAt(0),h),u=Ry(t.charAt(1),h);u<Oy(s);)u+=2e6;var f=e-a;if(f%2!=0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+i;var c=f/2,d=0,v=0,_,p,y,g,m;return c>0&&(_=1e5/Math.pow(10,c),p=i.substring(a,a+c),d=parseFloat(p)*_,y=i.substring(a+c),v=parseFloat(y)*_),g=d+l,m=v+u,{easting:g,northing:m,zoneLetter:s,zoneNumber:o,accuracy:_}}function Cy(i,e){for(var t=gu.charCodeAt(e-1),r=1e5,n=!1;t!==i.charCodeAt(0);){if(t++,t===Dt&&t++,t===Wt&&t++,t>Fi){if(n)throw"Bad character: "+i;t=Fr,n=!0}r+=1e5}return r}function Ry(i,e){if(i>"V")throw"MGRSPoint given invalid Northing "+i;for(var t=yu.charCodeAt(e-1),r=0,n=!1;t!==i.charCodeAt(0);){if(t++,t===Dt&&t++,t===Wt&&t++,t>Ni){if(n)throw"Bad character: "+i;t=Fr,n=!0}r+=1e5}return r}function Oy(i){var e;switch(i){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+i}function Dr(i,e,t){if(!(this instanceof Dr))return new Dr(i,e,t);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if(typeof i=="object")this.x=i.x,this.y=i.y,this.z=i.z||0;else if(typeof i=="string"&&typeof e=="undefined"){var r=i.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=i,this.y=e,this.z=t||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Dr.fromMGRS=function(i){return new Dr(xu(i))};Dr.prototype.toMGRS=function(i){return mu([this.x,this.y],i)};var Sy=1,wy=.25,Cu=.046875,Ru=.01953125,Ou=.01068115234375,Iy=.75,Ly=.46875,Py=.013020833333333334,by=.007120768229166667,Ay=.3645833333333333,Ny=.005696614583333333,Fy=.3076171875;function Su(i){var e=[];e[0]=Sy-i*(wy+i*(Cu+i*(Ru+i*Ou))),e[1]=i*(Iy-i*(Cu+i*(Ru+i*Ou)));var t=i*i;return e[2]=t*(Ly-i*(Py+i*by)),t*=i,e[3]=t*(Ay-i*Ny),e[4]=t*i*Fy,e}function Kn(i,e,t,r){return t*=e,e*=e,r[0]*i-t*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}var Dy=20;function wu(i,e,t){for(var r=1/(1-e),n=i,a=Dy;a;--a){var o=Math.sin(n),s=1-e*o*o;if(s=(Kn(n,o,Math.cos(n),t)-i)*(s*Math.sqrt(s))*r,n-=s,Math.abs(s)<w)return n}return n}function Gy(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Su(this.es),this.ml0=Kn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function Uy(i){var e=i.x,t=i.y,r=L(e-this.long0),n,a,o,s=Math.sin(t),h=Math.cos(t);if(this.es){var u=h*r,f=Math.pow(u,2),c=this.ep2*Math.pow(h,2),d=Math.pow(c,2),v=Math.abs(h)>w?Math.tan(t):0,_=Math.pow(v,2),p=Math.pow(_,2);n=1-this.es*Math.pow(s,2),u=u/Math.sqrt(n);var y=Kn(t,s,h,this.en);a=this.a*(this.k0*u*(1+f/6*(1-_+c+f/20*(5-18*_+p+14*c-58*_*c+f/42*(61+179*p-p*_-479*_)))))+this.x0,o=this.a*(this.k0*(y-this.ml0+s*r*u/2*(1+f/12*(5-_+9*c+4*d+f/30*(61+p-58*_+270*c-330*_*c+f/56*(1385+543*p-p*_-3111*_))))))+this.y0}else{var l=h*Math.sin(r);if(Math.abs(Math.abs(l)-1)<w)return 93;if(a=.5*this.a*this.k0*Math.log((1+l)/(1-l))+this.x0,o=h*Math.cos(r)/Math.sqrt(1-Math.pow(l,2)),l=Math.abs(o),l>=1){if(l-1>w)return 93;o=0}else o=Math.acos(o);t<0&&(o=-o),o=this.a*this.k0*(o-this.lat0)+this.y0}return i.x=a,i.y=o,i}function ky(i){var e,t,r,n,a=(i.x-this.x0)*(1/this.a),o=(i.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+o/this.k0,t=wu(e,this.es,this.en),Math.abs(t)<R){var f=Math.sin(t),c=Math.cos(t),d=Math.abs(c)>w?Math.tan(t):0,v=this.ep2*Math.pow(c,2),_=Math.pow(v,2),p=Math.pow(d,2),y=Math.pow(p,2);e=1-this.es*Math.pow(f,2);var g=a*Math.sqrt(e)/this.k0,m=Math.pow(g,2);e=e*d,r=t-e*m/(1-this.es)*.5*(1-m/12*(5+3*p-9*v*p+v-4*_-m/30*(61+90*p-252*v*p+45*y+46*v-m/56*(1385+3633*p+4095*y+1574*y*p)))),n=L(this.long0+g*(1-m/6*(1+2*p+v-m/20*(5+28*p+24*y+8*v*p+6*v-m/42*(61+662*p+1320*y+720*y*p))))/c)}else r=R*bi(o),n=0;else{var s=Math.exp(a/this.k0),h=.5*(s-1/s),l=this.lat0+o/this.k0,u=Math.cos(l);e=Math.sqrt((1-Math.pow(u,2))/(1+Math.pow(h,2))),r=Math.asin(e),o<0&&(r=-r),h===0&&u===0?n=0:n=L(Math.atan2(h,u)+this.long0)}return i.x=n,i.y=r,i}var By=["Fast_Transverse_Mercator","Fast Transverse Mercator"],Zn={init:Gy,forward:Uy,inverse:ky,names:By};function Iu(i){var e=Math.exp(i);return e=(e-1/e)/2,e}function qn(i,e){i=Math.abs(i),e=Math.abs(e);var t=Math.max(i,e),r=Math.min(i,e)/(t||1);return t*Math.sqrt(1+Math.pow(r,2))}function Xy(i){var e=1+i,t=e-1;return t===0?i:i*Math.log(e)/t}function jy(i){var e=Math.abs(i);return e=Xy(e*(1+e/(qn(1,e)+1))),i<0?-e:e}function No(i,e){for(var t=2*Math.cos(2*e),r=i.length-1,n=i[r],a=0,o;--r>=0;)o=-a+t*n+i[r],a=n,n=o;return e+o*Math.sin(2*e)}function Yy(i,e){for(var t=2*Math.cos(e),r=i.length-1,n=i[r],a=0,o;--r>=0;)o=-a+t*n+i[r],a=n,n=o;return Math.sin(e)*o}function zy(i){var e=Math.exp(i);return e=(e+1/e)/2,e}function Lu(i,e,t){for(var r=Math.sin(e),n=Math.cos(e),a=Iu(t),o=zy(t),s=2*n*o,h=-2*r*a,l=i.length-1,u=i[l],f=0,c=0,d=0,v,_;--l>=0;)v=c,_=f,c=u,f=d,u=-v+s*c-h*f+i[l],d=-_+h*c+s*f;return s=r*o,h=n*a,[s*u-h*d,s*d+h*u]}function Wy(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Zn.init.apply(this),this.forward=Zn.forward,this.inverse=Zn.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),e=i/(2-i),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),t=t*e,this.cgb[1]=t*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t=t*e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),t=t*e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(-12/5+e*(-24832/14175))),t=t*e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t=t*e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),t=t*e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t=t*e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t=t*e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t=t*e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=t*(212378941/319334400);var r=No(this.cbg,this.lat0);this.Zb=-this.Qn*(r+Yy(this.gtu,2*r))}function $y(i){var e=L(i.x-this.long0),t=i.y;t=No(this.cbg,t);var r=Math.sin(t),n=Math.cos(t),a=Math.sin(e),o=Math.cos(e);t=Math.atan2(r,o*n),e=Math.atan2(a*n,qn(r,n*o)),e=jy(Math.tan(e));var s=Lu(this.gtu,2*t,2*e);t=t+s[0],e=e+s[1];var h,l;return Math.abs(e)<=2.623395162778?(h=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*t+this.Zb)+this.y0):(h=1/0,l=1/0),i.x=h,i.y=l,i}function Vy(i){var e=(i.x-this.x0)*(1/this.a),t=(i.y-this.y0)*(1/this.a);t=(t-this.Zb)/this.Qn,e=e/this.Qn;var r,n;if(Math.abs(e)<=2.623395162778){var a=Lu(this.utg,2*t,2*e);t=t+a[0],e=e+a[1],e=Math.atan(Iu(e));var o=Math.sin(t),s=Math.cos(t),h=Math.sin(e),l=Math.cos(e);t=Math.atan2(o*l,qn(h,l*s)),e=Math.atan2(h,l*s),r=L(e+this.long0),n=No(this.cgb,t)}else r=1/0,n=1/0;return i.x=r,i.y=n,i}var Hy=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"],Jn={init:Wy,forward:$y,inverse:Vy,names:Hy};function Ky(i,e){if(i===void 0){if(i=Math.floor((L(e)+Math.PI)*30/Math.PI)+1,i<0)return 0;if(i>60)return 60}return i}var Zy="etmerc";function qy(){var i=Ky(this.zone,this.long0);if(i===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*Tt,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Jn.init.apply(this),this.forward=Jn.forward,this.inverse=Jn.inverse}var Jy=["Universal Transverse Mercator System","utm"],Qy={init:qy,names:Jy,dependsOn:Zy};function Fo(i,e){return Math.pow((1-i)/(1+i),e)}var tm=20;function em(){var i=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+et)/(Math.pow(Math.tan(.5*this.lat0+et),this.C)*Fo(this.e*i,this.ratexp))}function rm(i){var e=i.x,t=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+et),this.C)*Fo(this.e*Math.sin(t),this.ratexp))-R,i.x=this.C*e,i}function im(i){for(var e=1e-14,t=i.x/this.C,r=i.y,n=Math.pow(Math.tan(.5*r+et)/this.K,1/this.C),a=tm;a>0&&(r=2*Math.atan(n*Fo(this.e*Math.sin(i.y),-.5*this.e))-R,!(Math.abs(r-i.y)<e));--a)i.y=r;return a?(i.x=t,i.y=r,i):null}var nm=["gauss"],Do={init:em,forward:rm,inverse:im,names:nm};function am(){Do.init.apply(this),!!this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function om(i){var e,t,r,n;return i.x=L(i.x-this.long0),Do.forward.apply(this,[i]),e=Math.sin(i.y),t=Math.cos(i.y),r=Math.cos(i.x),n=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*r),i.x=n*t*Math.sin(i.x),i.y=n*(this.cosc0*e-this.sinc0*t*r),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function sm(i){var e,t,r,n,a;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,a=Math.sqrt(i.x*i.x+i.y*i.y)){var o=2*Math.atan2(a,this.R2);e=Math.sin(o),t=Math.cos(o),n=Math.asin(t*this.sinc0+i.y*e*this.cosc0/a),r=Math.atan2(i.x*e,a*this.cosc0*t-i.y*this.sinc0*e)}else n=this.phic0,r=0;return i.x=r,i.y=n,Do.inverse.apply(this,[i]),i.x=L(i.x+this.long0),i}var hm=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"],lm={init:am,forward:om,inverse:sm,names:hm};function um(i,e,t){return e*=t,Math.tan(.5*(R+i))*Math.pow((1-e)/(1+e),.5*t)}function fm(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=w&&(this.k0=.5*(1+bi(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=w&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=w&&(this.k0=.5*this.cons*he(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ht(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=he(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-R,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function cm(i){var e=i.x,t=i.y,r=Math.sin(t),n=Math.cos(t),a,o,s,h,l,u,f=L(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=w&&Math.abs(t+this.lat0)<=w?(i.x=NaN,i.y=NaN,i):this.sphere?(a=2*this.k0/(1+this.sinlat0*r+this.coslat0*n*Math.cos(f)),i.x=this.a*a*n*Math.sin(f)+this.x0,i.y=this.a*a*(this.coslat0*r-this.sinlat0*n*Math.cos(f))+this.y0,i):(o=2*Math.atan(this.ssfn_(t,r,this.e))-R,h=Math.cos(o),s=Math.sin(o),Math.abs(this.coslat0)<=w?(l=Ht(this.e,t*this.con,this.con*r),u=2*this.a*this.k0*l/this.cons,i.x=this.x0+u*Math.sin(e-this.long0),i.y=this.y0-this.con*u*Math.cos(e-this.long0),i):(Math.abs(this.sinlat0)<w?(a=2*this.a*this.k0/(1+h*Math.cos(f)),i.y=a*s):(a=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*s+this.cosX0*h*Math.cos(f))),i.y=a*(this.cosX0*s-this.sinX0*h*Math.cos(f))+this.y0),i.x=a*h*Math.sin(f)+this.x0,i))}function dm(i){i.x-=this.x0,i.y-=this.y0;var e,t,r,n,a,o=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var s=2*Math.atan(o/(2*this.a*this.k0));return e=this.long0,t=this.lat0,o<=w?(i.x=e,i.y=t,i):(t=Math.asin(Math.cos(s)*this.sinlat0+i.y*Math.sin(s)*this.coslat0/o),Math.abs(this.coslat0)<w?this.lat0>0?e=L(this.long0+Math.atan2(i.x,-1*i.y)):e=L(this.long0+Math.atan2(i.x,i.y)):e=L(this.long0+Math.atan2(i.x*Math.sin(s),o*this.coslat0*Math.cos(s)-i.y*this.sinlat0*Math.sin(s))),i.x=e,i.y=t,i)}else if(Math.abs(this.coslat0)<=w){if(o<=w)return t=this.lat0,e=this.long0,i.x=e,i.y=t,i;i.x*=this.con,i.y*=this.con,r=o*this.cons/(2*this.a*this.k0),t=this.con*Ai(this.e,r),e=this.con*L(this.con*this.long0+Math.atan2(i.x,-1*i.y))}else n=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,o<=w?a=this.X0:(a=Math.asin(Math.cos(n)*this.sinX0+i.y*Math.sin(n)*this.cosX0/o),e=L(this.long0+Math.atan2(i.x*Math.sin(n),o*this.cosX0*Math.cos(n)-i.y*this.sinX0*Math.sin(n)))),t=-1*Ai(this.e,Math.tan(.5*(R+a)));return i.x=e,i.y=t,i}var vm=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],_m={init:fm,forward:cm,inverse:dm,names:vm,ssfn_:um};function pm(){var i=this.lat0;this.lambda0=this.long0;var e=Math.sin(i),t=this.a,r=this.rf,n=1/r,a=2*n-Math.pow(n,2),o=this.e=Math.sqrt(a);this.R=this.k0*t*Math.sqrt(1-a)/(1-a*Math.pow(e,2)),this.alpha=Math.sqrt(1+a/(1-a)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(e/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+i/2)),l=Math.log((1+o*e)/(1-o*e));this.K=s-this.alpha*h+this.alpha*o/2*l}function gm(i){var e=Math.log(Math.tan(Math.PI/4-i.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),r=-this.alpha*(e+t)+this.K,n=2*(Math.atan(Math.exp(r))-Math.PI/4),a=this.alpha*(i.x-this.lambda0),o=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(a))),s=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(a));return i.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,i.x=this.R*o+this.x0,i}function ym(i){for(var e=i.x-this.x0,t=i.y-this.y0,r=e/this.R,n=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(r)),o=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(n))),s=this.lambda0+o/this.alpha,h=0,l=a,u=-1e3,f=0;Math.abs(l-u)>1e-7;){if(++f>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),u=l,l=2*Math.atan(Math.exp(h))-Math.PI/2}return i.x=s,i.y=l,i}var mm=["somerc"],xm={init:pm,forward:gm,inverse:ym,names:mm},Gr=1e-7;function Em(i){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],t=typeof i.PROJECTION=="object"?Object.keys(i.PROJECTION)[0]:i.PROJECTION;return"no_uoff"in i||"no_off"in i||e.indexOf(t)!==-1}function Tm(){var i,e,t,r,n,a,o,s,h,l,u=0,f,c=0,d=0,v=0,_=0,p=0,y=0;this.no_off=Em(this),this.no_rot="no_rot"in this;var g=!1;"alpha"in this&&(g=!0);var m=!1;if("rectified_grid_angle"in this&&(m=!0),g&&(y=this.alpha),m&&(u=this.rectified_grid_angle*Tt),g||m)c=this.longc;else if(d=this.long1,_=this.lat1,v=this.long2,p=this.lat2,Math.abs(_-p)<=Gr||(i=Math.abs(_))<=Gr||Math.abs(i-R)<=Gr||Math.abs(Math.abs(this.lat0)-R)<=Gr||Math.abs(Math.abs(p)-R)<=Gr)throw new Error;var x=1-this.es;e=Math.sqrt(x),Math.abs(this.lat0)>w?(s=Math.sin(this.lat0),t=Math.cos(this.lat0),i=1-this.es*s*s,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/x),this.A=this.B*this.k0*e/i,r=this.B*e/(t*Math.sqrt(i)),n=r*r-1,n<=0?n=0:(n=Math.sqrt(n),this.lat0<0&&(n=-n)),this.E=n+=r,this.E*=Math.pow(Ht(this.e,this.lat0,s),this.B)):(this.B=1/e,this.A=this.k0,this.E=r=n=1),g||m?(g?(f=Math.asin(Math.sin(y)/r),m||(u=y)):(f=u,y=Math.asin(r*Math.sin(f))),this.lam0=c-Math.asin(.5*(n-1/n)*Math.tan(f))/this.B):(a=Math.pow(Ht(this.e,_,Math.sin(_)),this.B),o=Math.pow(Ht(this.e,p,Math.sin(p)),this.B),n=this.E/a,h=(o-a)/(o+a),l=this.E*this.E,l=(l-o*a)/(l+o*a),i=d-v,i<-Math.pi?v-=Li:i>Math.pi&&(v+=Li),this.lam0=L(.5*(d+v)-Math.atan(l*Math.tan(.5*this.B*(d-v))/h)/this.B),f=Math.atan(2*Math.sin(this.B*L(d-this.lam0))/(n-1/n)),u=y=Math.asin(r*Math.sin(f))),this.singam=Math.sin(f),this.cosgam=Math.cos(f),this.sinrot=Math.sin(u),this.cosrot=Math.cos(u),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(y))),this.lat0<0&&(this.u_0=-this.u_0)),n=.5*f,this.v_pole_n=this.ArB*Math.log(Math.tan(et-n)),this.v_pole_s=this.ArB*Math.log(Math.tan(et+n))}function Mm(i){var e={},t,r,n,a,o,s,h,l;if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-R)>w){if(o=this.E/Math.pow(Ht(this.e,i.y,Math.sin(i.y)),this.B),s=1/o,t=.5*(o-s),r=.5*(o+s),a=Math.sin(this.B*i.x),n=(t*this.singam-a*this.cosgam)/r,Math.abs(Math.abs(n)-1)<w)throw new Error;l=.5*this.ArB*Math.log((1-n)/(1+n)),s=Math.cos(this.B*i.x),Math.abs(s)<Gr?h=this.A*i.x:h=this.ArB*Math.atan2(t*this.cosgam+a*this.singam,s)}else l=i.y>0?this.v_pole_n:this.v_pole_s,h=this.ArB*i.y;return this.no_rot?(e.x=h,e.y=l):(h-=this.u_0,e.x=l*this.cosrot+h*this.sinrot,e.y=h*this.cosrot-l*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function Cm(i){var e,t,r,n,a,o,s,h={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(t=i.y,e=i.x):(t=i.x*this.cosrot-i.y*this.sinrot,e=i.y*this.cosrot+i.x*this.sinrot+this.u_0),r=Math.exp(-this.BrA*t),n=.5*(r-1/r),a=.5*(r+1/r),o=Math.sin(this.BrA*e),s=(o*this.cosgam+n*this.singam)/a,Math.abs(Math.abs(s)-1)<w)h.x=0,h.y=s<0?-R:R;else{if(h.y=this.E/Math.sqrt((1+s)/(1-s)),h.y=Ai(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw new Error;h.x=-this.rB*Math.atan2(n*this.cosgam-o*this.singam,Math.cos(this.BrA*e))}return h.x+=this.lam0,h}var Rm=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"],Om={init:Tm,forward:Mm,inverse:Cm,names:Rm};function Sm(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<w)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),r=he(this.e,e,t),n=Ht(this.e,this.lat1,e),a=Math.sin(this.lat2),o=Math.cos(this.lat2),s=he(this.e,a,o),h=Ht(this.e,this.lat2,a),l=Ht(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>w?this.ns=Math.log(r/s)/Math.log(n/h):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=r/(this.ns*Math.pow(n,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function wm(i){var e=i.x,t=i.y;Math.abs(2*Math.abs(t)-Math.PI)<=w&&(t=bi(t)*(R-2*w));var r=Math.abs(Math.abs(t)-R),n,a;if(r>w)n=Ht(this.e,t,Math.sin(t)),a=this.a*this.f0*Math.pow(n,this.ns);else{if(r=t*this.ns,r<=0)return null;a=0}var o=this.ns*L(e-this.long0);return i.x=this.k0*(a*Math.sin(o))+this.x0,i.y=this.k0*(this.rh-a*Math.cos(o))+this.y0,i}function Im(i){var e,t,r,n,a,o=(i.x-this.x0)/this.k0,s=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(o*o+s*s),t=1):(e=-Math.sqrt(o*o+s*s),t=-1);var h=0;if(e!==0&&(h=Math.atan2(t*o,t*s)),e!==0||this.ns>0){if(t=1/this.ns,r=Math.pow(e/(this.a*this.f0),t),n=Ai(this.e,r),n===-9999)return null}else n=-R;return a=L(h/this.ns+this.long0),i.x=a,i.y=n,i}var Lm=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc"],Pm={init:Sm,forward:wm,inverse:Im,names:Lm};function bm(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function Am(i){var e,t,r,n,a,o,s,h=i.x,l=i.y,u=L(h-this.long0);return e=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/e)-this.s45),r=-u*this.alfa,n=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(r)),a=Math.asin(Math.cos(t)*Math.sin(r)/Math.cos(n)),o=this.n*a,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(n/2+this.s45),this.n),i.y=s*Math.cos(o)/1,i.x=s*Math.sin(o)/1,this.czech||(i.y*=-1,i.x*=-1),i}function Nm(i){var e,t,r,n,a,o,s,h,l=i.x;i.x=i.y,i.y=l,this.czech||(i.y*=-1,i.x*=-1),o=Math.sqrt(i.x*i.x+i.y*i.y),a=Math.atan2(i.y,i.x),n=a/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),t=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(e)),i.x=this.long0-t/this.alfa,s=e,h=0;var u=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-i.y)<1e-10&&(h=1),s=i.y,u+=1;while(h===0&&u<15);return u>=15?null:i}var Fm=["Krovak","krovak"],Dm={init:bm,forward:Am,inverse:Nm,names:Fm};function St(i,e,t,r,n){return i*n-e*Math.sin(2*n)+t*Math.sin(4*n)-r*Math.sin(6*n)}function Di(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function Gi(i){return .375*i*(1+.25*i*(1+.46875*i))}function Ui(i){return .05859375*i*i*(1+.75*i)}function ki(i){return i*i*i*(35/3072)}function Ur(i,e,t){var r=e*t;return i/Math.sqrt(1-r*r)}function kr(i){return Math.abs(i)<R?i:i-bi(i)*Math.PI}function Qn(i,e,t,r,n){var a,o;a=i/e;for(var s=0;s<15;s++)if(o=(i-(e*a-t*Math.sin(2*a)+r*Math.sin(4*a)-n*Math.sin(6*a)))/(e-2*t*Math.cos(2*a)+4*r*Math.cos(4*a)-6*n*Math.cos(6*a)),a+=o,Math.abs(o)<=1e-10)return a;return NaN}function Gm(){this.sphere||(this.e0=Di(this.es),this.e1=Gi(this.es),this.e2=Ui(this.es),this.e3=ki(this.es),this.ml0=this.a*St(this.e0,this.e1,this.e2,this.e3,this.lat0))}function Um(i){var e,t,r=i.x,n=i.y;if(r=L(r-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(n)*Math.sin(r)),t=this.a*(Math.atan2(Math.tan(n),Math.cos(r))-this.lat0);else{var a=Math.sin(n),o=Math.cos(n),s=Ur(this.a,this.e,a),h=Math.tan(n)*Math.tan(n),l=r*Math.cos(n),u=l*l,f=this.es*o*o/(1-this.es),c=this.a*St(this.e0,this.e1,this.e2,this.e3,n);e=s*l*(1-u*h*(1/6-(8-h+8*f)*u/120)),t=c-this.ml0+s*a/o*u*(.5+(5-h+6*f)*u/24)}return i.x=e+this.x0,i.y=t+this.y0,i}function km(i){i.x-=this.x0,i.y-=this.y0;var e=i.x/this.a,t=i.y/this.a,r,n;if(this.sphere){var a=t+this.lat0;r=Math.asin(Math.sin(a)*Math.cos(e)),n=Math.atan2(Math.tan(e),Math.cos(a))}else{var o=this.ml0/this.a+t,s=Qn(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-R)<=w)return i.x=this.long0,i.y=R,t<0&&(i.y*=-1),i;var h=Ur(this.a,this.e,Math.sin(s)),l=h*h*h/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(s),2),f=e*this.a/h,c=f*f;r=s-h*Math.tan(s)/l*f*f*(.5-(1+3*u)*f*f/24),n=f*(1-c*(u/3+(1+3*u)*u*c/15))/Math.cos(s)}return i.x=L(n+this.long0),i.y=kr(r),i}var Bm=["Cassini","Cassini_Soldner","cass"],Xm={init:Gm,forward:Um,inverse:km,names:Bm};function Xe(i,e){var t;return i>1e-7?(t=i*e,(1-i*i)*(e/(1-t*t)-.5/i*Math.log((1-t)/(1+t)))):2*e}var jm=1,Ym=2,zm=3,Wm=4;function $m(){var i=Math.abs(this.lat0);if(Math.abs(i-R)<w?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(i)<w?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=Xe(this.e,1),this.mmf=.5/(1-this.es),this.apa=e1(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=Xe(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function Vm(i){var e,t,r,n,a,o,s,h,l,u,f=i.x,c=i.y;if(f=L(f-this.long0),this.sphere){if(a=Math.sin(c),u=Math.cos(c),r=Math.cos(f),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t=this.mode===this.EQUIT?1+u*r:1+this.sinph0*a+this.cosph0*u*r,t<=w)return null;t=Math.sqrt(2/t),e=t*u*Math.sin(f),t*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*u*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(c+this.lat0)<w)return null;t=et-c*.5,t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)),e=t*Math.sin(f),t*=r}}else{switch(s=0,h=0,l=0,r=Math.cos(f),n=Math.sin(f),a=Math.sin(c),o=Xe(this.e,a),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(s=o/this.qp,h=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:l=1+this.sinb1*s+this.cosb1*h*r;break;case this.EQUIT:l=1+h*r;break;case this.N_POLE:l=R+c,o=this.qp-o;break;case this.S_POLE:l=c-R,o=this.qp+o;break}if(Math.abs(l)<w)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),this.mode===this.OBLIQ?t=this.ymf*l*(this.cosb1*s-this.sinb1*h*r):t=(l=Math.sqrt(2/(1+h*r)))*s*this.ymf,e=this.xmf*l*h*n;break;case this.N_POLE:case this.S_POLE:o>=0?(e=(l=Math.sqrt(o))*n,t=r*(this.mode===this.S_POLE?l:-l)):e=t=0;break}}return i.x=this.a*e+this.x0,i.y=this.a*t+this.y0,i}function Hm(i){i.x-=this.x0,i.y-=this.y0;var e=i.x/this.a,t=i.y/this.a,r,n,a,o,s,h,l;if(this.sphere){var u=0,f,c=0;if(f=Math.sqrt(e*e+t*t),n=f*.5,n>1)return null;switch(n=2*Math.asin(n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(c=Math.sin(n),u=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(f)<=w?0:Math.asin(t*c/f),e*=c,t=u*f;break;case this.OBLIQ:n=Math.abs(f)<=w?this.lat0:Math.asin(u*this.sinph0+t*c*this.cosph0/f),e*=c*this.cosph0,t=(u-Math.sin(n)*this.sinph0)*f;break;case this.N_POLE:t=-t,n=R-n;break;case this.S_POLE:n-=R;break}r=t===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,t)}else{if(l=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,t*=this.dd,h=Math.sqrt(e*e+t*t),h<w)return i.x=this.long0,i.y=this.lat0,i;o=2*Math.asin(.5*h/this.rq),a=Math.cos(o),e*=o=Math.sin(o),this.mode===this.OBLIQ?(l=a*this.sinb1+t*o*this.cosb1/h,s=this.qp*l,t=h*this.cosb1*a-t*this.sinb1*o):(l=t*o/h,s=this.qp*l,t=h*a)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(t=-t),s=e*e+t*t,!s)return i.x=this.long0,i.y=this.lat0,i;l=1-s/this.qp,this.mode===this.S_POLE&&(l=-l)}r=Math.atan2(e,t),n=r1(Math.asin(l),this.apa)}return i.x=L(this.long0+r),i.y=n,i}var Km=.3333333333333333,Zm=.17222222222222222,qm=.10257936507936508,Jm=.06388888888888888,Qm=.0664021164021164,t1=.016415012942191543;function e1(i){var e,t=[];return t[0]=i*Km,e=i*i,t[0]+=e*Zm,t[1]=e*Jm,e*=i,t[0]+=e*qm,t[1]+=e*Qm,t[2]=e*t1,t}function r1(i,e){var t=i+i;return i+e[0]*Math.sin(t)+e[1]*Math.sin(t+t)+e[2]*Math.sin(t+t+t)}var i1=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],n1={init:$m,forward:Vm,inverse:Hm,names:i1,S_POLE:jm,N_POLE:Ym,EQUIT:zm,OBLIQ:Wm};function je(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}function a1(){Math.abs(this.lat1+this.lat2)<w||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=he(this.e3,this.sin_po,this.cos_po),this.qs1=Xe(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=he(this.e3,this.sin_po,this.cos_po),this.qs2=Xe(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Xe(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>w?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function o1(i){var e=i.x,t=i.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var r=Xe(this.e3,this.sin_phi,this.cos_phi),n=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,a=this.ns0*L(e-this.long0),o=n*Math.sin(a)+this.x0,s=this.rh-n*Math.cos(a)+this.y0;return i.x=o,i.y=s,i}function s1(i){var e,t,r,n,a,o;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(e=Math.sqrt(i.x*i.x+i.y*i.y),r=1):(e=-Math.sqrt(i.x*i.x+i.y*i.y),r=-1),n=0,e!==0&&(n=Math.atan2(r*i.x,r*i.y)),r=e*this.ns0/this.a,this.sphere?o=Math.asin((this.c-r*r)/(2*this.ns0)):(t=(this.c-r*r)/this.ns0,o=this.phi1z(this.e3,t)),a=L(n/this.ns0+this.long0),i.x=a,i.y=o,i}function h1(i,e){var t,r,n,a,o,s=je(.5*e);if(i<w)return s;for(var h=i*i,l=1;l<=25;l++)if(t=Math.sin(s),r=Math.cos(s),n=i*t,a=1-n*n,o=.5*a*a/r*(e/(1-h)-t/a+.5/i*Math.log((1-n)/(1+n))),s=s+o,Math.abs(o)<=1e-7)return s;return null}var l1=["Albers_Conic_Equal_Area","Albers","aea"],u1={init:a1,forward:o1,inverse:s1,names:l1,phi1z:h1};function f1(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function c1(i){var e,t,r,n,a,o,s,h,l=i.x,u=i.y;return r=L(l-this.long0),e=Math.sin(u),t=Math.cos(u),n=Math.cos(r),o=this.sin_p14*e+this.cos_p14*t*n,a=1,o>0||Math.abs(o)<=w?(s=this.x0+this.a*a*t*Math.sin(r)/o,h=this.y0+this.a*a*(this.cos_p14*e-this.sin_p14*t*n)/o):(s=this.x0+this.infinity_dist*t*Math.sin(r),h=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*n)),i.x=s,i.y=h,i}function d1(i){var e,t,r,n,a,o;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(e=Math.sqrt(i.x*i.x+i.y*i.y))?(n=Math.atan2(e,this.rc),t=Math.sin(n),r=Math.cos(n),o=je(r*this.sin_p14+i.y*t*this.cos_p14/e),a=Math.atan2(i.x*t,e*this.cos_p14*r-i.y*this.sin_p14*t),a=L(this.long0+a)):(o=this.phic0,a=0),i.x=a,i.y=o,i}var v1=["gnom"],_1={init:f1,forward:c1,inverse:d1,names:v1};function p1(i,e){var t=1-(1-i*i)/(2*i)*Math.log((1-i)/(1+i));if(Math.abs(Math.abs(e)-t)<1e-6)return e<0?-1*R:R;for(var r=Math.asin(.5*e),n,a,o,s,h=0;h<30;h++)if(a=Math.sin(r),o=Math.cos(r),s=i*a,n=Math.pow(1-s*s,2)/(2*o)*(e/(1-i*i)-a/(1-s*s)+.5/i*Math.log((1-s)/(1+s))),r+=n,Math.abs(n)<=1e-10)return r;return NaN}function g1(){this.sphere||(this.k0=he(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function y1(i){var e=i.x,t=i.y,r,n,a=L(e-this.long0);if(this.sphere)r=this.x0+this.a*a*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(t)/Math.cos(this.lat_ts);else{var o=Xe(this.e,Math.sin(t));r=this.x0+this.a*this.k0*a,n=this.y0+this.a*o*.5/this.k0}return i.x=r,i.y=n,i}function m1(i){i.x-=this.x0,i.y-=this.y0;var e,t;return this.sphere?(e=L(this.long0+i.x/this.a/Math.cos(this.lat_ts)),t=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(t=p1(this.e,2*i.y*this.k0/this.a),e=L(this.long0+i.x/(this.a*this.k0))),i.x=e,i.y=t,i}var x1=["cea"],E1={init:g1,forward:y1,inverse:m1,names:x1};function T1(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function M1(i){var e=i.x,t=i.y,r=L(e-this.long0),n=kr(t-this.lat0);return i.x=this.x0+this.a*r*this.rc,i.y=this.y0+this.a*n,i}function C1(i){var e=i.x,t=i.y;return i.x=L(this.long0+(e-this.x0)/(this.a*this.rc)),i.y=kr(this.lat0+(t-this.y0)/this.a),i}var R1=["Equirectangular","Equidistant_Cylindrical","eqc"],O1={init:T1,forward:M1,inverse:C1,names:R1},Pu=20;function S1(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Di(this.es),this.e1=Gi(this.es),this.e2=Ui(this.es),this.e3=ki(this.es),this.ml0=this.a*St(this.e0,this.e1,this.e2,this.e3,this.lat0)}function w1(i){var e=i.x,t=i.y,r,n,a,o=L(e-this.long0);if(a=o*Math.sin(t),this.sphere)Math.abs(t)<=w?(r=this.a*o,n=-1*this.a*this.lat0):(r=this.a*Math.sin(a)/Math.tan(t),n=this.a*(kr(t-this.lat0)+(1-Math.cos(a))/Math.tan(t)));else if(Math.abs(t)<=w)r=this.a*o,n=-1*this.ml0;else{var s=Ur(this.a,this.e,Math.sin(t))/Math.tan(t);r=s*Math.sin(a),n=this.a*St(this.e0,this.e1,this.e2,this.e3,t)-this.ml0+s*(1-Math.cos(a))}return i.x=r+this.x0,i.y=n+this.y0,i}function I1(i){var e,t,r,n,a,o,s,h,l;if(r=i.x-this.x0,n=i.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=w)e=L(r/this.a+this.long0),t=0;else{o=this.lat0+n/this.a,s=r*r/this.a/this.a+o*o,h=o;var u;for(a=Pu;a;--a)if(u=Math.tan(h),l=-1*(o*(h*u+1)-h-.5*(h*h+s)*u)/((h-o)/u-1),h+=l,Math.abs(l)<=w){t=h;break}e=L(this.long0+Math.asin(r*Math.tan(h)/this.a)/Math.sin(t))}else if(Math.abs(n+this.ml0)<=w)t=0,e=L(this.long0+r/this.a);else{o=(this.ml0+n)/this.a,s=r*r/this.a/this.a+o*o,h=o;var f,c,d,v,_;for(a=Pu;a;--a)if(_=this.e*Math.sin(h),f=Math.sqrt(1-_*_)*Math.tan(h),c=this.a*St(this.e0,this.e1,this.e2,this.e3,h),d=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),v=c/this.a,l=(o*(f*v+1)-v-.5*f*(v*v+s))/(this.es*Math.sin(2*h)*(v*v+s-2*o*v)/(4*f)+(o-v)*(f*d-2/Math.sin(2*h))-d),h-=l,Math.abs(l)<=w){t=h;break}f=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=L(this.long0+Math.asin(r*f/this.a)/Math.sin(t))}return i.x=e,i.y=t,i}var L1=["Polyconic","poly"],P1={init:S1,forward:w1,inverse:I1,names:L1};function b1(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function A1(i){var e,t=i.x,r=i.y,n=r-this.lat0,a=t-this.long0,o=n/Ii*1e-5,s=a,h=1,l=0;for(e=1;e<=10;e++)h=h*o,l=l+this.A[e]*h;var u=l,f=s,c=1,d=0,v,_,p=0,y=0;for(e=1;e<=6;e++)v=c*u-d*f,_=d*u+c*f,c=v,d=_,p=p+this.B_re[e]*c-this.B_im[e]*d,y=y+this.B_im[e]*c+this.B_re[e]*d;return i.x=y*this.a+this.x0,i.y=p*this.a+this.y0,i}function N1(i){var e,t=i.x,r=i.y,n=t-this.x0,a=r-this.y0,o=a/this.a,s=n/this.a,h=1,l=0,u,f,c=0,d=0;for(e=1;e<=6;e++)u=h*o-l*s,f=l*o+h*s,h=u,l=f,c=c+this.C_re[e]*h-this.C_im[e]*l,d=d+this.C_im[e]*h+this.C_re[e]*l;for(var v=0;v<this.iterations;v++){var _=c,p=d,y,g,m=o,x=s;for(e=2;e<=6;e++)y=_*c-p*d,g=p*c+_*d,_=y,p=g,m=m+(e-1)*(this.B_re[e]*_-this.B_im[e]*p),x=x+(e-1)*(this.B_im[e]*_+this.B_re[e]*p);_=1,p=0;var E=this.B_re[1],T=this.B_im[1];for(e=2;e<=6;e++)y=_*c-p*d,g=p*c+_*d,_=y,p=g,E=E+e*(this.B_re[e]*_-this.B_im[e]*p),T=T+e*(this.B_im[e]*_+this.B_re[e]*p);var M=E*E+T*T;c=(m*E+x*T)/M,d=(x*E-m*T)/M}var C=c,O=d,P=1,I=0;for(e=1;e<=9;e++)P=P*C,I=I+this.D[e]*P;var F=this.lat0+I*Ii*1e5,B=this.long0+O;return i.x=B,i.y=F,i}var F1=["New_Zealand_Map_Grid","nzmg"],D1={init:b1,forward:A1,inverse:N1,names:F1};function G1(){}function U1(i){var e=i.x,t=i.y,r=L(e-this.long0),n=this.x0+this.a*r,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return i.x=n,i.y=a,i}function k1(i){i.x-=this.x0,i.y-=this.y0;var e=L(this.long0+i.x/this.a),t=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=e,i.y=t,i}var B1=["Miller_Cylindrical","mill"],X1={init:G1,forward:U1,inverse:k1,names:B1},j1=20;function Y1(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Su(this.es)}function z1(i){var e,t,r=i.x,n=i.y;if(r=L(r-this.long0),this.sphere){if(!this.m)n=this.n!==1?Math.asin(this.n*Math.sin(n)):n;else for(var a=this.n*Math.sin(n),o=j1;o;--o){var s=(this.m*n+Math.sin(n)-a)/(this.m+Math.cos(n));if(n-=s,Math.abs(s)<w)break}e=this.a*this.C_x*r*(this.m+Math.cos(n)),t=this.a*this.C_y*n}else{var h=Math.sin(n),l=Math.cos(n);t=this.a*Kn(n,h,l,this.en),e=this.a*r*l/Math.sqrt(1-this.es*h*h)}return i.x=e,i.y=t,i}function W1(i){var e,t,r,n;return i.x-=this.x0,r=i.x/this.a,i.y-=this.y0,e=i.y/this.a,this.sphere?(e/=this.C_y,r=r/(this.C_x*(this.m+Math.cos(e))),this.m?e=je((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=je(Math.sin(e)/this.n)),r=L(r+this.long0),e=kr(e)):(e=wu(i.y/this.a,this.es,this.en),n=Math.abs(e),n<R?(n=Math.sin(e),t=this.long0+i.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(e)),r=L(t)):n-w<R&&(r=this.long0)),i.x=r,i.y=e,i}var $1=["Sinusoidal","sinu"],V1={init:Y1,forward:z1,inverse:W1,names:$1};function H1(){}function K1(i){for(var e=i.x,t=i.y,r=L(e-this.long0),n=t,a=Math.PI*Math.sin(t);;){var o=-(n+Math.sin(n)-a)/(1+Math.cos(n));if(n+=o,Math.abs(o)<w)break}n/=2,Math.PI/2-Math.abs(t)<w&&(r=0);var s=.900316316158*this.a*r*Math.cos(n)+this.x0,h=1.4142135623731*this.a*Math.sin(n)+this.y0;return i.x=s,i.y=h,i}function Z1(i){var e,t;i.x-=this.x0,i.y-=this.y0,t=i.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var r=L(this.long0+i.x/(.900316316158*this.a*Math.cos(e)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var n=Math.asin(t);return i.x=r,i.y=n,i}var q1=["Mollweide","moll"],J1={init:H1,forward:K1,inverse:Z1,names:q1};function Q1(){Math.abs(this.lat1+this.lat2)<w||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Di(this.es),this.e1=Gi(this.es),this.e2=Ui(this.es),this.e3=ki(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=he(this.e,this.sinphi,this.cosphi),this.ml1=St(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<w?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=he(this.e,this.sinphi,this.cosphi),this.ml2=St(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=St(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function tx(i){var e=i.x,t=i.y,r;if(this.sphere)r=this.a*(this.g-t);else{var n=St(this.e0,this.e1,this.e2,this.e3,t);r=this.a*(this.g-n)}var a=this.ns*L(e-this.long0),o=this.x0+r*Math.sin(a),s=this.y0+this.rh-r*Math.cos(a);return i.x=o,i.y=s,i}function ex(i){i.x-=this.x0,i.y=this.rh-i.y+this.y0;var e,t,r,n;this.ns>=0?(t=Math.sqrt(i.x*i.x+i.y*i.y),e=1):(t=-Math.sqrt(i.x*i.x+i.y*i.y),e=-1);var a=0;if(t!==0&&(a=Math.atan2(e*i.x,e*i.y)),this.sphere)return n=L(this.long0+a/this.ns),r=kr(this.g-t/this.a),i.x=n,i.y=r,i;var o=this.g-t/this.a;return r=Qn(o,this.e0,this.e1,this.e2,this.e3),n=L(this.long0+a/this.ns),i.x=n,i.y=r,i}var rx=["Equidistant_Conic","eqdc"],ix={init:Q1,forward:tx,inverse:ex,names:rx};function nx(){this.R=this.a}function ax(i){var e=i.x,t=i.y,r=L(e-this.long0),n,a;Math.abs(t)<=w&&(n=this.x0+this.R*r,a=this.y0);var o=je(2*Math.abs(t/Math.PI));(Math.abs(r)<=w||Math.abs(Math.abs(t)-R)<=w)&&(n=this.x0,t>=0?a=this.y0+Math.PI*this.R*Math.tan(.5*o):a=this.y0+Math.PI*this.R*-Math.tan(.5*o));var s=.5*Math.abs(Math.PI/r-r/Math.PI),h=s*s,l=Math.sin(o),u=Math.cos(o),f=u/(l+u-1),c=f*f,d=f*(2/l-1),v=d*d,_=Math.PI*this.R*(s*(f-v)+Math.sqrt(h*(f-v)*(f-v)-(v+h)*(c-v)))/(v+h);r<0&&(_=-_),n=this.x0+_;var p=h+f;return _=Math.PI*this.R*(d*p-s*Math.sqrt((v+h)*(h+1)-p*p))/(v+h),t>=0?a=this.y0+_:a=this.y0-_,i.x=n,i.y=a,i}function ox(i){var e,t,r,n,a,o,s,h,l,u,f,c,d;return i.x-=this.x0,i.y-=this.y0,f=Math.PI*this.R,r=i.x/f,n=i.y/f,a=r*r+n*n,o=-Math.abs(n)*(1+a),s=o-2*n*n+r*r,h=-2*o+1+2*n*n+a*a,d=n*n/h+(2*s*s*s/h/h/h-9*o*s/h/h)/27,l=(o-s*s/3/h)/h,u=2*Math.sqrt(-l/3),f=3*d/l/u,Math.abs(f)>1&&(f>=0?f=1:f=-1),c=Math.acos(f)/3,i.y>=0?t=(-u*Math.cos(c+Math.PI/3)-s/3/h)*Math.PI:t=-(-u*Math.cos(c+Math.PI/3)-s/3/h)*Math.PI,Math.abs(r)<w?e=this.long0:e=L(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(r*r-n*n)+a*a))/2/r),i.x=e,i.y=t,i}var sx=["Van_der_Grinten_I","VanDerGrinten","vandg"],hx={init:nx,forward:ax,inverse:ox,names:sx};function lx(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function ux(i){var e=i.x,t=i.y,r=Math.sin(i.y),n=Math.cos(i.y),a=L(e-this.long0),o,s,h,l,u,f,c,d,v,_,p,y,g,m,x,E,T,M,C,O,P,I,F;return this.sphere?Math.abs(this.sin_p12-1)<=w?(i.x=this.x0+this.a*(R-t)*Math.sin(a),i.y=this.y0-this.a*(R-t)*Math.cos(a),i):Math.abs(this.sin_p12+1)<=w?(i.x=this.x0+this.a*(R+t)*Math.sin(a),i.y=this.y0+this.a*(R+t)*Math.cos(a),i):(M=this.sin_p12*r+this.cos_p12*n*Math.cos(a),E=Math.acos(M),T=E?E/Math.sin(E):1,i.x=this.x0+this.a*T*n*Math.sin(a),i.y=this.y0+this.a*T*(this.cos_p12*r-this.sin_p12*n*Math.cos(a)),i):(o=Di(this.es),s=Gi(this.es),h=Ui(this.es),l=ki(this.es),Math.abs(this.sin_p12-1)<=w?(u=this.a*St(o,s,h,l,R),f=this.a*St(o,s,h,l,t),i.x=this.x0+(u-f)*Math.sin(a),i.y=this.y0-(u-f)*Math.cos(a),i):Math.abs(this.sin_p12+1)<=w?(u=this.a*St(o,s,h,l,R),f=this.a*St(o,s,h,l,t),i.x=this.x0+(u+f)*Math.sin(a),i.y=this.y0+(u+f)*Math.cos(a),i):(c=r/n,d=Ur(this.a,this.e,this.sin_p12),v=Ur(this.a,this.e,r),_=Math.atan((1-this.es)*c+this.es*d*this.sin_p12/(v*n)),p=Math.atan2(Math.sin(a),this.cos_p12*Math.tan(_)-this.sin_p12*Math.cos(a)),p===0?C=Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):Math.abs(Math.abs(p)-Math.PI)<=w?C=-Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):C=Math.asin(Math.sin(a)*Math.cos(_)/Math.sin(p)),y=this.e*this.sin_p12/Math.sqrt(1-this.es),g=this.e*this.cos_p12*Math.cos(p)/Math.sqrt(1-this.es),m=y*g,x=g*g,O=C*C,P=O*C,I=P*C,F=I*C,E=d*C*(1-O*x*(1-x)/6+P/8*m*(1-2*x)+I/120*(x*(4-7*x)-3*y*y*(1-7*x))-F/48*m),i.x=this.x0+E*Math.sin(p),i.y=this.y0+E*Math.cos(p),i))}function fx(i){i.x-=this.x0,i.y-=this.y0;var e,t,r,n,a,o,s,h,l,u,f,c,d,v,_,p,y,g,m,x,E,T,M,C;return this.sphere?(e=Math.sqrt(i.x*i.x+i.y*i.y),e>2*R*this.a?void 0:(t=e/this.a,r=Math.sin(t),n=Math.cos(t),a=this.long0,Math.abs(e)<=w?o=this.lat0:(o=je(n*this.sin_p12+i.y*r*this.cos_p12/e),s=Math.abs(this.lat0)-R,Math.abs(s)<=w?this.lat0>=0?a=L(this.long0+Math.atan2(i.x,-i.y)):a=L(this.long0-Math.atan2(-i.x,i.y)):a=L(this.long0+Math.atan2(i.x*r,e*this.cos_p12*n-i.y*this.sin_p12*r))),i.x=a,i.y=o,i)):(h=Di(this.es),l=Gi(this.es),u=Ui(this.es),f=ki(this.es),Math.abs(this.sin_p12-1)<=w?(c=this.a*St(h,l,u,f,R),e=Math.sqrt(i.x*i.x+i.y*i.y),d=c-e,o=Qn(d/this.a,h,l,u,f),a=L(this.long0+Math.atan2(i.x,-1*i.y)),i.x=a,i.y=o,i):Math.abs(this.sin_p12+1)<=w?(c=this.a*St(h,l,u,f,R),e=Math.sqrt(i.x*i.x+i.y*i.y),d=e-c,o=Qn(d/this.a,h,l,u,f),a=L(this.long0+Math.atan2(i.x,i.y)),i.x=a,i.y=o,i):(e=Math.sqrt(i.x*i.x+i.y*i.y),p=Math.atan2(i.x,i.y),v=Ur(this.a,this.e,this.sin_p12),y=Math.cos(p),g=this.e*this.cos_p12*y,m=-g*g/(1-this.es),x=3*this.es*(1-m)*this.sin_p12*this.cos_p12*y/(1-this.es),E=e/v,T=E-m*(1+m)*Math.pow(E,3)/6-x*(1+3*m)*Math.pow(E,4)/24,M=1-m*T*T/2-E*T*T*T/6,_=Math.asin(this.sin_p12*Math.cos(T)+this.cos_p12*Math.sin(T)*y),a=L(this.long0+Math.asin(Math.sin(p)*Math.sin(T)/Math.cos(_))),C=Math.sin(_),o=Math.atan2((C-this.es*M*this.sin_p12)*Math.tan(_),C*(1-this.es)),i.x=a,i.y=o,i))}var cx=["Azimuthal_Equidistant","aeqd"],dx={init:lx,forward:ux,inverse:fx,names:cx};function vx(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function _x(i){var e,t,r,n,a,o,s,h,l=i.x,u=i.y;return r=L(l-this.long0),e=Math.sin(u),t=Math.cos(u),n=Math.cos(r),o=this.sin_p14*e+this.cos_p14*t*n,a=1,(o>0||Math.abs(o)<=w)&&(s=this.a*a*t*Math.sin(r),h=this.y0+this.a*a*(this.cos_p14*e-this.sin_p14*t*n)),i.x=s,i.y=h,i}function px(i){var e,t,r,n,a,o,s;return i.x-=this.x0,i.y-=this.y0,e=Math.sqrt(i.x*i.x+i.y*i.y),t=je(e/this.a),r=Math.sin(t),n=Math.cos(t),o=this.long0,Math.abs(e)<=w?(s=this.lat0,i.x=o,i.y=s,i):(s=je(n*this.sin_p14+i.y*r*this.cos_p14/e),a=Math.abs(this.lat0)-R,Math.abs(a)<=w?(this.lat0>=0?o=L(this.long0+Math.atan2(i.x,-i.y)):o=L(this.long0-Math.atan2(-i.x,i.y)),i.x=o,i.y=s,i):(o=L(this.long0+Math.atan2(i.x*r,e*this.cos_p14*n-i.y*this.sin_p14*r)),i.x=o,i.y=s,i))}var gx=["ortho"],yx={init:vx,forward:_x,inverse:px,names:gx},dt={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},rt={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function mx(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=R-et/2?this.face=dt.TOP:this.lat0<=-(R-et/2)?this.face=dt.BOTTOM:Math.abs(this.long0)<=et?this.face=dt.FRONT:Math.abs(this.long0)<=R+et?this.face=this.long0>0?dt.RIGHT:dt.LEFT:this.face=dt.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function xx(i){var e={x:0,y:0},t,r,n,a,o,s,h={value:0};if(i.x-=this.long0,this.es!==0?t=Math.atan(this.one_minus_f_squared*Math.tan(i.y)):t=i.y,r=i.x,this.face===dt.TOP)a=R-t,r>=et&&r<=R+et?(h.value=rt.AREA_0,n=r-R):r>R+et||r<=-(R+et)?(h.value=rt.AREA_1,n=r>0?r-_t:r+_t):r>-(R+et)&&r<=-et?(h.value=rt.AREA_2,n=r+R):(h.value=rt.AREA_3,n=r);else if(this.face===dt.BOTTOM)a=R+t,r>=et&&r<=R+et?(h.value=rt.AREA_0,n=-r+R):r<et&&r>=-et?(h.value=rt.AREA_1,n=-r):r<-et&&r>=-(R+et)?(h.value=rt.AREA_2,n=-r-R):(h.value=rt.AREA_3,n=r>0?-r+_t:-r-_t);else{var l,u,f,c,d,v,_;this.face===dt.RIGHT?r=Br(r,+R):this.face===dt.BACK?r=Br(r,+_t):this.face===dt.LEFT&&(r=Br(r,-R)),c=Math.sin(t),d=Math.cos(t),v=Math.sin(r),_=Math.cos(r),l=d*_,u=d*v,f=c,this.face===dt.FRONT?(a=Math.acos(l),n=ta(a,f,u,h)):this.face===dt.RIGHT?(a=Math.acos(u),n=ta(a,f,-l,h)):this.face===dt.BACK?(a=Math.acos(-l),n=ta(a,f,-u,h)):this.face===dt.LEFT?(a=Math.acos(-u),n=ta(a,f,l,h)):(a=n=0,h.value=rt.AREA_0)}return s=Math.atan(12/_t*(n+Math.acos(Math.sin(n)*Math.cos(et))-R)),o=Math.sqrt((1-Math.cos(a))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(n))))),h.value===rt.AREA_1?s+=R:h.value===rt.AREA_2?s+=_t:h.value===rt.AREA_3&&(s+=1.5*_t),e.x=o*Math.cos(s),e.y=o*Math.sin(s),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,i.x=e.x,i.y=e.y,i}function Ex(i){var e={lam:0,phi:0},t,r,n,a,o,s,h,l,u,f={value:0};if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,r=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),t=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?f.value=rt.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(f.value=rt.AREA_1,t-=R):i.x<0&&-i.x>=Math.abs(i.y)?(f.value=rt.AREA_2,t=t<0?t+_t:t-_t):(f.value=rt.AREA_3,t+=R),u=_t/12*Math.tan(t),o=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),s=Math.atan(o),n=Math.cos(t),a=Math.tan(r),h=1-n*n*a*a*(1-Math.cos(Math.atan(1/Math.cos(s)))),h<-1?h=-1:h>1&&(h=1),this.face===dt.TOP)l=Math.acos(h),e.phi=R-l,f.value===rt.AREA_0?e.lam=s+R:f.value===rt.AREA_1?e.lam=s<0?s+_t:s-_t:f.value===rt.AREA_2?e.lam=s-R:e.lam=s;else if(this.face===dt.BOTTOM)l=Math.acos(h),e.phi=l-R,f.value===rt.AREA_0?e.lam=-s+R:f.value===rt.AREA_1?e.lam=-s:f.value===rt.AREA_2?e.lam=-s-R:e.lam=s<0?-s-_t:-s+_t;else{var c,d,v;c=h,u=c*c,u>=1?v=0:v=Math.sqrt(1-u)*Math.sin(s),u+=v*v,u>=1?d=0:d=Math.sqrt(1-u),f.value===rt.AREA_1?(u=d,d=-v,v=u):f.value===rt.AREA_2?(d=-d,v=-v):f.value===rt.AREA_3&&(u=d,d=v,v=-u),this.face===dt.RIGHT?(u=c,c=-d,d=u):this.face===dt.BACK?(c=-c,d=-d):this.face===dt.LEFT&&(u=c,c=d,d=-u),e.phi=Math.acos(-v)-R,e.lam=Math.atan2(d,c),this.face===dt.RIGHT?e.lam=Br(e.lam,-R):this.face===dt.BACK?e.lam=Br(e.lam,-_t):this.face===dt.LEFT&&(e.lam=Br(e.lam,+R))}if(this.es!==0){var _,p,y;_=e.phi<0?1:0,p=Math.tan(e.phi),y=this.b/Math.sqrt(p*p+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-y*y)/(this.one_minus_f*y)),_&&(e.phi=-e.phi)}return e.lam+=this.long0,i.x=e.lam,i.y=e.phi,i}function ta(i,e,t,r){var n;return i<w?(r.value=rt.AREA_0,n=0):(n=Math.atan2(e,t),Math.abs(n)<=et?r.value=rt.AREA_0:n>et&&n<=R+et?(r.value=rt.AREA_1,n-=R):n>R+et||n<=-(R+et)?(r.value=rt.AREA_2,n=n>=0?n-_t:n+_t):(r.value=rt.AREA_3,n+=R)),n}function Br(i,e){var t=i+e;return t<-_t?t+=Li:t>+_t&&(t-=Li),t}var Tx=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"],Mx={init:mx,forward:xx,inverse:Ex,names:Tx},Go=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Bi=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],bu=.8487,Au=1.3523,Nu=se/5,Cx=1/Nu,Xr=18,ea=function(i,e){return i[0]+e*(i[1]+e*(i[2]+e*i[3]))},Rx=function(i,e){return i[1]+e*(2*i[2]+e*3*i[3])};function Ox(i,e,t,r){for(var n=e;r;--r){var a=i(n);if(n-=a,Math.abs(a)<t)break}return n}function Sx(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function wx(i){var e=L(i.x-this.long0),t=Math.abs(i.y),r=Math.floor(t*Nu);r<0?r=0:r>=Xr&&(r=Xr-1),t=se*(t-Cx*r);var n={x:ea(Go[r],t)*e,y:ea(Bi[r],t)};return i.y<0&&(n.y=-n.y),n.x=n.x*this.a*bu+this.x0,n.y=n.y*this.a*Au+this.y0,n}function Ix(i){var e={x:(i.x-this.x0)/(this.a*bu),y:Math.abs(i.y-this.y0)/(this.a*Au)};if(e.y>=1)e.x/=Go[Xr][0],e.y=i.y<0?-R:R;else{var t=Math.floor(e.y*Xr);for(t<0?t=0:t>=Xr&&(t=Xr-1);;)if(Bi[t][0]>e.y)--t;else if(Bi[t+1][0]<=e.y)++t;else break;var r=Bi[t],n=5*(e.y-r[0])/(Bi[t+1][0]-r[0]);n=Ox(function(a){return(ea(r,a)-e.y)/Rx(r,a)},n,w,100),e.x/=ea(Go[t],n),e.y=(5*t+n)*Tt,i.y<0&&(e.y=-e.y)}return e.x=L(e.x+this.long0),e}var Lx=["Robinson","robin"],Px={init:Sx,forward:wx,inverse:Ix,names:Lx};function bx(){this.name="geocent"}function Ax(i){var e=su(i,this.es,this.a);return e}function Nx(i){var e=hu(i,this.es,this.a,this.b);return e}var Fx=["Geocentric","geocentric","geocent","Geocent"],Dx={init:bx,forward:Ax,inverse:Nx,names:Fx},Ct={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Xi={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function Gx(){if(Object.keys(Xi).forEach(function(t){if(typeof this[t]=="undefined")this[t]=Xi[t].def;else{if(Xi[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Xi[t].num&&(this[t]=parseFloat(this[t]))}Xi[t].degrees&&(this[t]=this[t]*Tt)}.bind(this)),Math.abs(Math.abs(this.lat0)-R)<w?this.mode=this.lat0<0?Ct.S_POLE:Ct.N_POLE:Math.abs(this.lat0)<w?this.mode=Ct.EQUIT:(this.mode=Ct.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(i),this.sw=Math.sin(i)}function Ux(i){i.x-=this.long0;var e=Math.sin(i.y),t=Math.cos(i.y),r=Math.cos(i.x),n,a;switch(this.mode){case Ct.OBLIQ:a=this.sinph0*e+this.cosph0*t*r;break;case Ct.EQUIT:a=t*r;break;case Ct.S_POLE:a=-e;break;case Ct.N_POLE:a=e;break}switch(a=this.pn1/(this.p-a),n=a*t*Math.sin(i.x),this.mode){case Ct.OBLIQ:a*=this.cosph0*e-this.sinph0*t*r;break;case Ct.EQUIT:a*=e;break;case Ct.N_POLE:a*=-(t*r);break;case Ct.S_POLE:a*=t*r;break}var o,s;return o=a*this.cg+n*this.sg,s=1/(o*this.sw*this.h1+this.cw),n=(n*this.cg-a*this.sg)*this.cw*s,a=o*s,i.x=n*this.a,i.y=a*this.a,i}function kx(i){i.x/=this.a,i.y/=this.a;var e={x:i.x,y:i.y},t,r,n;n=1/(this.pn1-i.y*this.sw),t=this.pn1*i.x*n,r=this.pn1*i.y*this.cw*n,i.x=t*this.cg+r*this.sg,i.y=r*this.cg-t*this.sg;var a=qn(i.x,i.y);if(Math.abs(a)<w)e.x=0,e.y=i.y;else{var o,s;switch(s=1-a*a*this.pfact,s=(this.p-Math.sqrt(s))/(this.pn1/a+a/this.pn1),o=Math.sqrt(1-s*s),this.mode){case Ct.OBLIQ:e.y=Math.asin(o*this.sinph0+i.y*s*this.cosph0/a),i.y=(o-this.sinph0*Math.sin(e.y))*a,i.x*=s*this.cosph0;break;case Ct.EQUIT:e.y=Math.asin(i.y*s/a),i.y=o*a,i.x*=s;break;case Ct.N_POLE:e.y=Math.asin(o),i.y=-i.y;break;case Ct.S_POLE:e.y=-Math.asin(o);break}e.x=Math.atan2(i.x,i.y)}return i.x=e.x+this.long0,i.y=e.y,i}var Bx=["Tilted_Perspective","tpers"],Xx={init:Gx,forward:Ux,inverse:kx,names:Bx};function jx(i){i.Proj.projections.add(Zn),i.Proj.projections.add(Jn),i.Proj.projections.add(Qy),i.Proj.projections.add(lm),i.Proj.projections.add(_m),i.Proj.projections.add(xm),i.Proj.projections.add(Om),i.Proj.projections.add(Pm),i.Proj.projections.add(Dm),i.Proj.projections.add(Xm),i.Proj.projections.add(n1),i.Proj.projections.add(u1),i.Proj.projections.add(_1),i.Proj.projections.add(E1),i.Proj.projections.add(O1),i.Proj.projections.add(P1),i.Proj.projections.add(D1),i.Proj.projections.add(X1),i.Proj.projections.add(V1),i.Proj.projections.add(J1),i.Proj.projections.add(ix),i.Proj.projections.add(hx),i.Proj.projections.add(dx),i.Proj.projections.add(yx),i.Proj.projections.add(Mx),i.Proj.projections.add(Px),i.Proj.projections.add(Dx),i.Proj.projections.add(Xx)}Ft.defaultDatum="WGS84";Ft.Proj=le;Ft.WGS84=new Ft.Proj("WGS84");Ft.Point=Dr;Ft.toPoint=cu;Ft.defs=Ot;Ft.nadgrid=ey;Ft.transform=Hn;Ft.mgrs=gy;Ft.version="__VERSION__";jx(Ft);var Yx=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),zx=function(i){Yx(e,i);function e(t){var r=i.call(this)||this;return r.geometries_=t||null,r.changeEventsKeys_=[],r.listenGeometriesChange_(),r}return e.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(at),this.changeEventsKeys_.length=0},e.prototype.listenGeometriesChange_=function(){if(!!this.geometries_)for(var t=0,r=this.geometries_.length;t<r;++t)this.changeEventsKeys_.push(Y(this.geometries_[t],D.CHANGE,this.changed,this))},e.prototype.clone=function(){var t=new e(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t},e.prototype.closestPointXY=function(t,r,n,a){if(a<tr(this.getExtent(),t,r))return a;for(var o=this.geometries_,s=0,h=o.length;s<h;++s)a=o[s].closestPointXY(t,r,n,a);return a},e.prototype.containsXY=function(t,r){for(var n=this.geometries_,a=0,o=n.length;a<o;++a)if(n[a].containsXY(t,r))return!0;return!1},e.prototype.computeExtent=function(t){Qr(t);for(var r=this.geometries_,n=0,a=r.length;n<a;++n)Is(t,r[n].getExtent());return t},e.prototype.getGeometries=function(){return Fu(this.geometries_)},e.prototype.getGeometriesArray=function(){return this.geometries_},e.prototype.getGeometriesArrayRecursive=function(){for(var t=[],r=this.geometries_,n=0,a=r.length;n<a;++n)r[n].getType()===this.getType()?t=t.concat(r[n].getGeometriesArrayRecursive()):t.push(r[n]);return t},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var r=[],n=this.geometries_,a=!1,o=0,s=n.length;o<s;++o){var h=n[o],l=h.getSimplifiedGeometry(t);r.push(l),l!==h&&(a=!0)}if(a){var u=new e(null);return u.setGeometriesArray(r),u}else return this.simplifiedGeometryMaxMinSquaredTolerance=t,this},e.prototype.getType=function(){return A.GEOMETRY_COLLECTION},e.prototype.intersectsExtent=function(t){for(var r=this.geometries_,n=0,a=r.length;n<a;++n)if(r[n].intersectsExtent(t))return!0;return!1},e.prototype.isEmpty=function(){return this.geometries_.length===0},e.prototype.rotate=function(t,r){for(var n=this.geometries_,a=0,o=n.length;a<o;++a)n[a].rotate(t,r);this.changed()},e.prototype.scale=function(t,r,n){var a=n;a||(a=ee(this.getExtent()));for(var o=this.geometries_,s=0,h=o.length;s<h;++s)o[s].scale(t,r,a);this.changed()},e.prototype.setGeometries=function(t){this.setGeometriesArray(Fu(t))},e.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()},e.prototype.applyTransform=function(t){for(var r=this.geometries_,n=0,a=r.length;n<a;++n)r[n].applyTransform(t);this.changed()},e.prototype.translate=function(t,r){for(var n=this.geometries_,a=0,o=n.length;a<o;++a)n[a].translate(t,r);this.changed()},e.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),i.prototype.disposeInternal.call(this)},e}(dh);function Fu(i){for(var e=[],t=0,r=i.length;t<r;++t)e.push(i[t].clone());return e}var Wx=zx,$x=function(){function i(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}return i.prototype.getReadOptions=function(e,t){var r;if(t){var n=t.dataProjection?nt(t.dataProjection):this.readProjection(e);t.extent&&n&&n.getUnits()===Qt.TILE_PIXELS&&(n=nt(n),n.setWorldExtent(t.extent)),r={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(r)},i.prototype.adaptOptions=function(e){return vt({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)},i.prototype.getType=function(){return G()},i.prototype.readFeature=function(e,t){return G()},i.prototype.readFeatures=function(e,t){return G()},i.prototype.readGeometry=function(e,t){return G()},i.prototype.readProjection=function(e){return G()},i.prototype.writeFeature=function(e,t){return G()},i.prototype.writeFeatures=function(e,t){return G()},i.prototype.writeGeometry=function(e,t){return G()},i}();function Du(i,e,t){var r=t?nt(t.featureProjection):null,n=t?nt(t.dataProjection):null,a;if(r&&n&&!we(r,n)?a=(e?i.clone():i).transform(e?r:n,e?n:r):a=i,e&&t&&t.decimals!==void 0){var o=Math.pow(10,t.decimals),s=function(h){for(var l=0,u=h.length;l<u;++l)h[l]=Math.round(h[l]*o)/o;return h};a===i&&(a=i.clone()),a.applyTransform(s)}return a}var Vx=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Hx=function(i){Vx(e,i);function e(){return i.call(this)||this}return e.prototype.getType=function(){return Pr.JSON},e.prototype.readFeature=function(t,r){return this.readFeatureFromObject(ra(t),this.getReadOptions(t,r))},e.prototype.readFeatures=function(t,r){return this.readFeaturesFromObject(ra(t),this.getReadOptions(t,r))},e.prototype.readFeatureFromObject=function(t,r){return G()},e.prototype.readFeaturesFromObject=function(t,r){return G()},e.prototype.readGeometry=function(t,r){return this.readGeometryFromObject(ra(t),this.getReadOptions(t,r))},e.prototype.readGeometryFromObject=function(t,r){return G()},e.prototype.readProjection=function(t){return this.readProjectionFromObject(ra(t))},e.prototype.readProjectionFromObject=function(t){return G()},e.prototype.writeFeature=function(t,r){return JSON.stringify(this.writeFeatureObject(t,r))},e.prototype.writeFeatureObject=function(t,r){return G()},e.prototype.writeFeatures=function(t,r){return JSON.stringify(this.writeFeaturesObject(t,r))},e.prototype.writeFeaturesObject=function(t,r){return G()},e.prototype.writeGeometry=function(t,r){return JSON.stringify(this.writeGeometryObject(t,r))},e.prototype.writeGeometryObject=function(t,r){return G()},e}($x);function ra(i){if(typeof i=="string"){var e=JSON.parse(i);return e||null}else return i!==null?i:null}var Kx=Hx,Zx=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),qx=function(i){Zx(e,i);function e(t){var r=this,n=t||{};return r=i.call(this)||this,r.dataProjection=nt(n.dataProjection?n.dataProjection:"EPSG:4326"),n.featureProjection&&(r.defaultFeatureProjection=nt(n.featureProjection)),r.geometryName_=n.geometryName,r.extractGeometryName_=n.extractGeometryName,r.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"],r}return e.prototype.readFeatureFromObject=function(t,r){var n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};var a=Uo(n.geometry,r),o=new Ph;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in n!==void 0&&o.setGeometryName(n.geometry_name),o.setGeometry(a),"id"in n&&o.setId(n.id),n.properties&&o.setProperties(n.properties,!0),o},e.prototype.readFeaturesFromObject=function(t,r){var n=t,a=null;if(n.type==="FeatureCollection"){var o=t;a=[];for(var s=o.features,h=0,l=s.length;h<l;++h)a.push(this.readFeatureFromObject(s[h],r))}else a=[this.readFeatureFromObject(t,r)];return a},e.prototype.readGeometryFromObject=function(t,r){return Uo(t,r)},e.prototype.readProjectionFromObject=function(t){var r=t.crs,n;return r?r.type=="name"?n=nt(r.properties.name):r.type==="EPSG"?n=nt("EPSG:"+r.properties.code):z(!1,36):n=this.dataProjection,n},e.prototype.writeFeatureObject=function(t,r){r=this.adaptOptions(r);var n={type:"Feature",geometry:null,properties:null},a=t.getId();if(a!==void 0&&(n.id=a),!t.hasProperties())return n;var o=t.getProperties(),s=t.getGeometry();return s&&(n.geometry=ko(s,r),delete o[t.getGeometryName()]),vr(o)||(n.properties=o),n},e.prototype.writeFeaturesObject=function(t,r){r=this.adaptOptions(r);for(var n=[],a=0,o=t.length;a<o;++a)n.push(this.writeFeatureObject(t[a],r));return{type:"FeatureCollection",features:n}},e.prototype.writeGeometryObject=function(t,r){return ko(t,this.adaptOptions(r))},e}(Kx);function Uo(i,e){if(!i)return null;var t;switch(i.type){case A.POINT:{t=Qx(i);break}case A.LINE_STRING:{t=tE(i);break}case A.POLYGON:{t=nE(i);break}case A.MULTI_POINT:{t=rE(i);break}case A.MULTI_LINE_STRING:{t=eE(i);break}case A.MULTI_POLYGON:{t=iE(i);break}case A.GEOMETRY_COLLECTION:{t=Jx(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return Du(t,!1,e)}function Jx(i,e){var t=i.geometries.map(function(r){return Uo(r,e)});return new Wx(t)}function Qx(i){return new Or(i.coordinates)}function tE(i){return new _i(i.coordinates)}function eE(i){return new n0(i.coordinates)}function rE(i){return new Vl(i.coordinates)}function iE(i){return new u0(i.coordinates)}function nE(i){return new Sn(i.coordinates)}function ko(i,e){i=Du(i,!0,e);var t=i.getType(),r;switch(t){case A.POINT:{r=uE(i);break}case A.LINE_STRING:{r=oE(i);break}case A.POLYGON:{r=fE(i,e);break}case A.MULTI_POINT:{r=hE(i);break}case A.MULTI_LINE_STRING:{r=sE(i);break}case A.MULTI_POLYGON:{r=lE(i,e);break}case A.GEOMETRY_COLLECTION:{r=aE(i,e);break}case A.CIRCLE:{r={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return r}function aE(i,e){var t=i.getGeometriesArray().map(function(r){var n=vt({},e);return delete n.featureProjection,ko(r,n)});return{type:"GeometryCollection",geometries:t}}function oE(i,e){return{type:"LineString",coordinates:i.getCoordinates()}}function sE(i,e){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function hE(i,e){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function lE(i,e){var t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(t)}}function uE(i,e){return{type:"Point",coordinates:i.getCoordinates()}}function fE(i,e){var t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(t)}}var Gu=qx,cE=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),dE=function(i){cE(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.expireCache=function(t){for(;this.canExpireCache();){var r=this.peekLast();if(r.getKey()in t)break;this.pop().release()}},e.prototype.pruneExceptNewestZ=function(){if(this.getCount()!==0){var t=this.peekFirstKey(),r=Kp(t),n=r[0];this.forEach(function(a){a.tileCoord[0]!==n&&(this.remove(Oi(a.tileCoord)),a.release())}.bind(this))}},e}(hl),Uu=dE,Bo={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},vE=[0,0,0],Ye=5,_E=function(){function i(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,z(df(this.resolutions_,function(o,s){return s-o},!0),17);var t;if(!e.origins){for(var r=0,n=this.resolutions_.length-1;r<n;++r)if(!t)t=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,z(this.origins_.length==this.resolutions_.length,20));var a=e.extent;a!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Tr(a)),z(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,z(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Ga,z(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=a!==void 0?a:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(o,s){var h=new ul(Math.min(0,o[0]),Math.max(o[0]-1,-1),Math.min(0,o[1]),Math.max(o[1]-1,-1));if(a){var l=this.getTileRangeForExtentAndZ(a,s);h.minX=Math.max(l.minX,h.minX),h.maxX=Math.min(l.maxX,h.maxX),h.minY=Math.max(l.minY,h.minY),h.maxY=Math.min(l.maxY,h.maxY)}return h},this):a&&this.calculateTileRanges_(a)}return i.prototype.forEachTileCoord=function(e,t,r){for(var n=this.getTileRangeForExtentAndZ(e,t),a=n.minX,o=n.maxX;a<=o;++a)for(var s=n.minY,h=n.maxY;s<=h;++s)r([t,a,s])},i.prototype.forEachTileCoordParentTileRange=function(e,t,r,n){var a,o,s,h=null,l=e[0]-1;for(this.zoomFactor_===2?(o=e[1],s=e[2]):h=this.getTileCoordExtent(e,n);l>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),s=Math.floor(s/2),a=br(o,o,s,s,r)):a=this.getTileRangeForExtentAndZ(h,l,r),t(l,a))return!0;--l}return!1},i.prototype.getExtent=function(){return this.extent_},i.prototype.getMaxZoom=function(){return this.maxZoom},i.prototype.getMinZoom=function(){return this.minZoom},i.prototype.getOrigin=function(e){return this.origin_?this.origin_:this.origins_[e]},i.prototype.getResolution=function(e){return this.resolutions_[e]},i.prototype.getResolutions=function(){return this.resolutions_},i.prototype.getTileCoordChildTileRange=function(e,t,r){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){var n=e[1]*2,a=e[2]*2;return br(n,n+1,a,a+1,t)}var o=this.getTileCoordExtent(e,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e[0]+1,t)}return null},i.prototype.getTileRangeForTileCoordAndZ=function(e,t,r){if(t>this.maxZoom||t<this.minZoom)return null;var n=e[0],a=e[1],o=e[2];if(t===n)return br(a,o,a,o,r);if(this.zoomFactor_){var s=Math.pow(this.zoomFactor_,t-n),h=Math.floor(a*s),l=Math.floor(o*s);if(t<n)return br(h,h,l,l,r);var u=Math.floor(s*(a+1))-1,f=Math.floor(s*(o+1))-1;return br(h,u,l,f,r)}var c=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(c,t,r)},i.prototype.getTileRangeExtent=function(e,t,r){var n=this.getOrigin(e),a=this.getResolution(e),o=At(this.getTileSize(e),this.tmpSize_),s=n[0]+t.minX*o[0]*a,h=n[0]+(t.maxX+1)*o[0]*a,l=n[1]+t.minY*o[1]*a,u=n[1]+(t.maxY+1)*o[1]*a;return te(s,l,h,u,r)},i.prototype.getTileRangeForExtentAndZ=function(e,t,r){var n=vE;this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,n);var a=n[1],o=n[2];return this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,n),br(a,n[1],o,n[2],r)},i.prototype.getTileCoordCenter=function(e){var t=this.getOrigin(e[0]),r=this.getResolution(e[0]),n=At(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*r,t[1]-(e[2]+.5)*n[1]*r]},i.prototype.getTileCoordExtent=function(e,t){var r=this.getOrigin(e[0]),n=this.getResolution(e[0]),a=At(this.getTileSize(e[0]),this.tmpSize_),o=r[0]+e[1]*a[0]*n,s=r[1]-(e[2]+1)*a[1]*n,h=o+a[0]*n,l=s+a[1]*n;return te(o,s,h,l,t)},i.prototype.getTileCoordForCoordAndResolution=function(e,t,r){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,r)},i.prototype.getTileCoordForXYAndResolution_=function(e,t,r,n,a){var o=this.getZForResolution(r),s=r/this.getResolution(o),h=this.getOrigin(o),l=At(this.getTileSize(o),this.tmpSize_),u=s*(e-h[0])/r/l[0],f=s*(h[1]-t)/r/l[1];return n?(u=ln(u,Ye)-1,f=ln(f,Ye)-1):(u=hn(u,Ye),f=hn(f,Ye)),Gn(o,u,f,a)},i.prototype.getTileCoordForXYAndZ_=function(e,t,r,n,a){var o=this.getOrigin(r),s=this.getResolution(r),h=At(this.getTileSize(r),this.tmpSize_),l=(e-o[0])/s/h[0],u=(o[1]-t)/s/h[1];return n?(l=ln(l,Ye)-1,u=ln(u,Ye)-1):(l=hn(l,Ye),u=hn(u,Ye)),Gn(r,l,u,a)},i.prototype.getTileCoordForCoordAndZ=function(e,t,r){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,r)},i.prototype.getTileCoordResolution=function(e){return this.resolutions_[e[0]]},i.prototype.getTileSize=function(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]},i.prototype.getFullTileRange=function(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null},i.prototype.getZForResolution=function(e,t){var r=_a(this.resolutions_,e,t||0);return X(r,this.minZoom,this.maxZoom)},i.prototype.calculateTileRanges_=function(e){for(var t=this.resolutions_.length,r=new Array(t),n=this.minZoom;n<t;++n)r[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=r},i}(),ku=_E;function Bu(i){var e=i.getDefaultTileGrid();return e||(e=mE(i),i.setDefaultTileGrid(e)),e}function pE(i,e,t){var r=e[0],n=i.getTileCoordCenter(e),a=Xo(t);if(ve(a,n))return e;var o=it(a),s=Math.ceil((a[0]-n[0])/o);return n[0]+=o*s,i.getTileCoordForCoordAndZ(n,r)}function gE(i,e,t,r){var n=r!==void 0?r:Jr.TOP_LEFT,a=Xu(i,e,t);return new ku({extent:i,origin:yc(i,n),resolutions:a,tileSize:t})}function yE(i){var e=i||{},t=e.extent||nt("EPSG:3857").getExtent(),r={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Xu(t,e.maxZoom,e.tileSize,e.maxResolution)};return new ku(r)}function Xu(i,e,t,r){for(var n=e!==void 0?e:pd,a=Yt(i),o=it(i),s=At(t!==void 0?t:Ga),h=r>0?r:Math.max(o/s[0],a/s[1]),l=n+1,u=new Array(l),f=0;f<l;++f)u[f]=h/Math.pow(2,f);return u}function mE(i,e,t,r){var n=Xo(i);return gE(n,e,t,r)}function Xo(i){i=nt(i);var e=i.getExtent();if(!e){var t=180*Jt[Qt.DEGREES]/i.getMetersPerUnit();e=te(-t,-t,t,t)}return e}var ju=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),xE=function(i){ju(e,i);function e(t){var r=i.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate})||this;r.on,r.once,r.un,r.opaque_=t.opaque!==void 0?t.opaque:!1,r.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,r.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;var n=[256,256],a=t.tileGrid;return a&&At(a.getTileSize(a.getMinZoom()),n),r.tileCache=new Uu(t.cacheSize||0),r.tmpSize=[0,0],r.key_=t.key||"",r.tileOptions={transition:t.transition,interpolate:t.interpolate},r.zDirection=t.zDirection?t.zDirection:0,r}return e.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},e.prototype.expireCache=function(t,r){var n=this.getTileCacheForProjection(t);n&&n.expireCache(r)},e.prototype.forEachLoadedTile=function(t,r,n,a){var o=this.getTileCacheForProjection(t);if(!o)return!1;for(var s=!0,h,l,u,f=n.minX;f<=n.maxX;++f)for(var c=n.minY;c<=n.maxY;++c)l=Ri(r,f,c),u=!1,o.containsKey(l)&&(h=o.get(l),u=h.getState()===k.LOADED,u&&(u=a(h)!==!1)),u||(s=!1);return s},e.prototype.getGutterForProjection=function(t){return 0},e.prototype.getKey=function(){return this.key_},e.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},e.prototype.getOpaque=function(t){return this.opaque_},e.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},e.prototype.getTile=function(t,r,n,a,o){return G()},e.prototype.getTileGrid=function(){return this.tileGrid},e.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:Bu(t)},e.prototype.getTileCacheForProjection=function(t){return z(we(this.getProjection(),t),68),this.tileCache},e.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},e.prototype.getTilePixelSize=function(t,r,n){var a=this.getTileGridForProjection(n),o=this.getTilePixelRatio(r),s=At(a.getTileSize(t),this.tmpSize);return o==1?s:iv(s,o,this.tmpSize)},e.prototype.getTileCoordForTileUrlFunction=function(t,r){var n=r!==void 0?r:this.getProjection(),a=this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=pE(a,t,n)),qp(t,a)?t:null},e.prototype.clear=function(){this.tileCache.clear()},e.prototype.refresh=function(){this.clear(),i.prototype.refresh.call(this)},e.prototype.updateCacheSize=function(t,r){var n=this.getTileCacheForProjection(r);t>n.highWaterMark&&(n.highWaterMark=t)},e.prototype.useTile=function(t,r,n,a){},e}(nl),EE=function(i){ju(e,i);function e(t,r){var n=i.call(this,t)||this;return n.tile=r,n}return e}(fe),TE=xE;function ME(i,e){var t=/\{z\}/g,r=/\{x\}/g,n=/\{y\}/g,a=/\{-y\}/g;return function(o,s,h){if(o)return i.replace(t,o[0].toString()).replace(r,o[1].toString()).replace(n,o[2].toString()).replace(a,function(){var l=o[0],u=e.getFullTileRange(l);z(u,55);var f=u.getHeight()-o[2]-1;return f.toString()})}}function CE(i,e){for(var t=i.length,r=new Array(t),n=0;n<t;++n)r[n]=ME(i[n],e);return RE(r)}function RE(i){return i.length===1?i[0]:function(e,t,r){if(e){var n=Zp(e),a=qe(n,i.length);return i[a](e,t,r)}else return}}function OE(i){var e=[],t=/\{([a-z])-([a-z])\}/.exec(i);if(t){var r=t[1].charCodeAt(0),n=t[2].charCodeAt(0),a=void 0;for(a=r;a<=n;++a)e.push(i.replace(t[0],String.fromCharCode(a)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(i),t){for(var o=parseInt(t[2],10),s=parseInt(t[1],10);s<=o;s++)e.push(i.replace(t[0],s.toString()));return e}return e.push(i),e}var SE=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),wE=function(i){SE(e,i);function e(t){var r=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return r.generateTileUrlFunction_=r.tileUrlFunction===e.prototype.tileUrlFunction,r.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(r.tileUrlFunction=t.tileUrlFunction),r.urls=null,t.urls?r.setUrls(t.urls):t.url&&r.setUrl(t.url),r.tileLoadingKeys_={},r}return e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var r=t.target,n=tt(r),a=r.getState(),o;a==k.LOADING?(this.tileLoadingKeys_[n]=!0,o=Bo.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],o=a==k.ERROR?Bo.TILELOADERROR:a==k.LOADED?Bo.TILELOADEND:void 0),o!=null&&this.dispatchEvent(new EE(o,r))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,r){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof r!="undefined"?this.setKey(r):this.changed()},e.prototype.setUrl=function(t){var r=OE(t);this.urls=r,this.setUrls(r)},e.prototype.setUrls=function(t){this.urls=t;var r=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(CE(t,this.tileGrid),r):this.setKey(r)},e.prototype.tileUrlFunction=function(t,r,n){},e.prototype.useTile=function(t,r,n){var a=Ri(t,r,n);this.tileCache.containsKey(a)&&this.tileCache.get(a)},e}(TE),IE=wE,LE=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),PE=function(i){LE(e,i);function e(t){var r=this,n=t.imageSmoothing!==void 0?t.imageSmoothing:!0;return t.interpolate!==void 0&&(n=t.interpolate),r=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:bE,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:n,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this,r.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,r.tileClass=t.tileClass!==void 0?t.tileClass:lo,r.tileCacheForProjection={},r.tileGridForProjection={},r.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,r.renderReprojectionEdges_=!1,r}return e.prototype.canExpireCache=function(){if(!xe)return i.prototype.canExpireCache.call(this);if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},e.prototype.expireCache=function(t,r){if(!xe){i.prototype.expireCache.call(this,t,r);return}var n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?r:{});for(var a in this.tileCacheForProjection){var o=this.tileCacheForProjection[a];o.expireCache(o==n?r:{})}},e.prototype.getGutterForProjection=function(t){return xe&&this.getProjection()&&t&&!we(this.getProjection(),t)?0:this.getGutter()},e.prototype.getGutter=function(){return 0},e.prototype.getKey=function(){var t=i.prototype.getKey.call(this);return this.getInterpolate()||(t+=":disable-interpolation"),t},e.prototype.getOpaque=function(t){return xe&&this.getProjection()&&t&&!we(this.getProjection(),t)?!1:i.prototype.getOpaque.call(this,t)},e.prototype.getTileGridForProjection=function(t){if(!xe)return i.prototype.getTileGridForProjection.call(this,t);var r=this.getProjection();if(this.tileGrid&&(!r||we(r,t)))return this.tileGrid;var n=tt(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Bu(t)),this.tileGridForProjection[n]},e.prototype.getTileCacheForProjection=function(t){if(!xe)return i.prototype.getTileCacheForProjection.call(this,t);var r=this.getProjection();if(!r||we(r,t))return this.tileCache;var n=tt(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Uu(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]},e.prototype.createTile_=function(t,r,n,a,o,s){var h=[t,r,n],l=this.getTileCoordForTileUrlFunction(h,o),u=l?this.tileUrlFunction(l,a,o):void 0,f=new this.tileClass(h,u!==void 0?k.IDLE:k.EMPTY,u!==void 0?u:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return f.key=s,f.addEventListener(D.CHANGE,this.handleTileChange.bind(this)),f},e.prototype.getTile=function(t,r,n,a,o){var s=this.getProjection();if(!xe||!s||!o||we(s,o))return this.getTileInternal(t,r,n,a,s||o);var h=this.getTileCacheForProjection(o),l=[t,r,n],u=void 0,f=Oi(l);h.containsKey(f)&&(u=h.get(f));var c=this.getKey();if(u&&u.key==c)return u;var d=this.getTileGridForProjection(s),v=this.getTileGridForProjection(o),_=this.getTileCoordForTileUrlFunction(l,o),p=new pl(s,d,o,v,l,_,this.getTilePixelRatio(a),this.getGutter(),function(y,g,m,x){return this.getTileInternal(y,g,m,x,s)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return p.key=c,u?(p.interimTile=u,p.refreshInterimChain(),h.replace(f,p)):h.set(f,p),p},e.prototype.getTileInternal=function(t,r,n,a,o){var s=null,h=Ri(t,r,n),l=this.getKey();if(!this.tileCache.containsKey(h))s=this.createTile_(t,r,n,a,o,l),this.tileCache.set(h,s);else if(s=this.tileCache.get(h),s.key!=l){var u=s;s=this.createTile_(t,r,n,a,o,l),u.getState()==k.IDLE?s.interimTile=u.interimTile:s.interimTile=u,s.refreshInterimChain(),this.tileCache.replace(h,s)}return s},e.prototype.setRenderReprojectionEdges=function(t){if(!(!xe||this.renderReprojectionEdges_==t)){this.renderReprojectionEdges_=t;for(var r in this.tileCacheForProjection)this.tileCacheForProjection[r].clear();this.changed()}},e.prototype.setTileGridForProjection=function(t,r){if(xe){var n=nt(t);if(n){var a=tt(n);a in this.tileGridForProjection||(this.tileGridForProjection[a]=r)}}},e}(IE);function bE(i,e){i.getImage().src=e}var AE=PE,NE=globalThis&&globalThis.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),FE=function(i){NE(e,i);function e(t){var r=this,n=t||{},a=n.imageSmoothing!==void 0?n.imageSmoothing:!0;n.interpolate!==void 0&&(a=n.interpolate);var o=n.projection!==void 0?n.projection:"EPSG:3857",s=n.tileGrid!==void 0?n.tileGrid:yE({extent:Xo(o),maxResolution:n.maxResolution,maxZoom:n.maxZoom,minZoom:n.minZoom,tileSize:n.tileSize});return r=i.call(this,{attributions:n.attributions,cacheSize:n.cacheSize,crossOrigin:n.crossOrigin,interpolate:a,opaque:n.opaque,projection:o,reprojectionErrorThreshold:n.reprojectionErrorThreshold,tileGrid:s,tileLoadFunction:n.tileLoadFunction,tilePixelRatio:n.tilePixelRatio,tileUrlFunction:n.tileUrlFunction,url:n.url,urls:n.urls,wrapX:n.wrapX!==void 0?n.wrapX:!0,transition:n.transition,attributionsCollapsible:n.attributionsCollapsible,zDirection:n.zDirection})||this,r}return e}(AE),DE=FE;const GE={id:"map",ref:"mapContainer",class:"map"},UE=["innerHTML"],kE=tf({setup(i,{expose:e}){let t;const r=ef({text:"",left:"0px",top:"0px",display:"none"});return e({getMap:()=>t}),rf(async()=>{Ft.defs("ESRI:53009","+proj=moll +lon_0=100 +x_0=0 +y_0=0 +a=6371000 +b=6371000 +units=m +no_defs"),_0(Ft);const n="EPSG:3857";t=new v0({layers:[new ug({source:new DE({url:"http://t4.tianditu.com/DataServer?T=ter_w&x={x}&y={y}&l={z}&tk=5a257cd2df1b3311723bd77b0de14baf",crossOrigin:"Anonymous"})}),new sp({zIndex:100}),new so({source:new ho({url:"data/china.json",format:new Gu({dataProjection:"EPSG:4326"})}),style:new pi({stroke:new Sr({width:.5,color:"gray"}),fill:new vi({color:"#ffdd"})})}),new so({source:new ho({url:"data/coastline.json",format:new Gu({dataProjection:"EPSG:4326"}),wrapX:!0}),zIndex:100,style:new pi({stroke:new Sr({width:.5,color:"gray"})})})],target:"map",view:new Ae({projection:n,center:js([0,0],"EPSG:4326",n),zoom:1.5}),controls:Lh().extend([new uv,new dv,new rc,new Pc({projection:"EPSG:4326",coordinateFormat:a=>a?`${a[0].toFixed(4)}\xB0  ${a[1].toFixed(4)}\xB0`:""})])}),t.on("pointermove",function(a){if(a.dragging){r.display="none";return}if(!a.originalEvent.ctrlKey){r.display="none";return}const o=t.getEventPixel(a.originalEvent),s=t.forEachFeatureAtPixel(o,function(l){return l}),h=s==null?void 0:s.getProperties();if(h){const l=`\u6D4B\u8BD5<hr/><pre>${JSON.stringify(h,(u,f)=>u==="geometry"?"...":f,2)}</pre>`;r.text=l,r.left=o[0]+5+"px",r.top=o[1]+5+"px",r.display="block"}else{r.display="none";return}})}),(n,a)=>(nf(),af("div",GE,[of("div",{class:"tooltip",style:sf(Jo(r)),innerHTML:Jo(r).text},null,12,UE)],512))}});var KE=Qu(kE,[["__scopeId","data-v-79a564d2"]]),BE={jet:[{index:0,rgb:[0,0,131]},{index:.125,rgb:[0,60,170]},{index:.375,rgb:[5,255,255]},{index:.625,rgb:[255,255,0]},{index:.875,rgb:[250,0,0]},{index:1,rgb:[128,0,0]}],hsv:[{index:0,rgb:[255,0,0]},{index:.169,rgb:[253,255,2]},{index:.173,rgb:[247,255,2]},{index:.337,rgb:[0,252,4]},{index:.341,rgb:[0,252,10]},{index:.506,rgb:[1,249,255]},{index:.671,rgb:[2,0,253]},{index:.675,rgb:[8,0,253]},{index:.839,rgb:[255,0,251]},{index:.843,rgb:[255,0,245]},{index:1,rgb:[255,0,6]}],hot:[{index:0,rgb:[0,0,0]},{index:.3,rgb:[230,0,0]},{index:.6,rgb:[255,210,0]},{index:1,rgb:[255,255,255]}],spring:[{index:0,rgb:[255,0,255]},{index:1,rgb:[255,255,0]}],summer:[{index:0,rgb:[0,128,102]},{index:1,rgb:[255,255,102]}],autumn:[{index:0,rgb:[255,0,0]},{index:1,rgb:[255,255,0]}],winter:[{index:0,rgb:[0,0,255]},{index:1,rgb:[0,255,128]}],bone:[{index:0,rgb:[0,0,0]},{index:.376,rgb:[84,84,116]},{index:.753,rgb:[169,200,200]},{index:1,rgb:[255,255,255]}],copper:[{index:0,rgb:[0,0,0]},{index:.804,rgb:[255,160,102]},{index:1,rgb:[255,199,127]}],greys:[{index:0,rgb:[0,0,0]},{index:1,rgb:[255,255,255]}],yignbu:[{index:0,rgb:[8,29,88]},{index:.125,rgb:[37,52,148]},{index:.25,rgb:[34,94,168]},{index:.375,rgb:[29,145,192]},{index:.5,rgb:[65,182,196]},{index:.625,rgb:[127,205,187]},{index:.75,rgb:[199,233,180]},{index:.875,rgb:[237,248,217]},{index:1,rgb:[255,255,217]}],greens:[{index:0,rgb:[0,68,27]},{index:.125,rgb:[0,109,44]},{index:.25,rgb:[35,139,69]},{index:.375,rgb:[65,171,93]},{index:.5,rgb:[116,196,118]},{index:.625,rgb:[161,217,155]},{index:.75,rgb:[199,233,192]},{index:.875,rgb:[229,245,224]},{index:1,rgb:[247,252,245]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],bluered:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,0,0]}],rdbu:[{index:0,rgb:[5,10,172]},{index:.35,rgb:[106,137,247]},{index:.5,rgb:[190,190,190]},{index:.6,rgb:[220,170,132]},{index:.7,rgb:[230,145,90]},{index:1,rgb:[178,10,28]}],picnic:[{index:0,rgb:[0,0,255]},{index:.1,rgb:[51,153,255]},{index:.2,rgb:[102,204,255]},{index:.3,rgb:[153,204,255]},{index:.4,rgb:[204,204,255]},{index:.5,rgb:[255,255,255]},{index:.6,rgb:[255,204,255]},{index:.7,rgb:[255,153,255]},{index:.8,rgb:[255,102,204]},{index:.9,rgb:[255,102,102]},{index:1,rgb:[255,0,0]}],rainbow:[{index:0,rgb:[150,0,90]},{index:.125,rgb:[0,0,200]},{index:.25,rgb:[0,25,255]},{index:.375,rgb:[0,152,255]},{index:.5,rgb:[44,255,150]},{index:.625,rgb:[151,255,0]},{index:.75,rgb:[255,234,0]},{index:.875,rgb:[255,111,0]},{index:1,rgb:[255,0,0]}],portland:[{index:0,rgb:[12,51,131]},{index:.25,rgb:[10,136,186]},{index:.5,rgb:[242,211,56]},{index:.75,rgb:[242,143,56]},{index:1,rgb:[217,30,30]}],blackbody:[{index:0,rgb:[0,0,0]},{index:.2,rgb:[230,0,0]},{index:.4,rgb:[230,210,0]},{index:.7,rgb:[255,255,255]},{index:1,rgb:[160,200,255]}],earth:[{index:0,rgb:[0,0,130]},{index:.1,rgb:[0,180,180]},{index:.2,rgb:[40,210,40]},{index:.4,rgb:[230,230,50]},{index:.6,rgb:[120,70,20]},{index:1,rgb:[255,255,255]}],electric:[{index:0,rgb:[0,0,0]},{index:.15,rgb:[30,0,100]},{index:.4,rgb:[120,0,100]},{index:.6,rgb:[160,90,0]},{index:.8,rgb:[230,200,0]},{index:1,rgb:[255,250,220]}],alpha:[{index:0,rgb:[255,255,255,0]},{index:1,rgb:[255,255,255,1]}],viridis:[{index:0,rgb:[68,1,84]},{index:.13,rgb:[71,44,122]},{index:.25,rgb:[59,81,139]},{index:.38,rgb:[44,113,142]},{index:.5,rgb:[33,144,141]},{index:.63,rgb:[39,173,129]},{index:.75,rgb:[92,200,99]},{index:.88,rgb:[170,220,50]},{index:1,rgb:[253,231,37]}],inferno:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[31,12,72]},{index:.25,rgb:[85,15,109]},{index:.38,rgb:[136,34,106]},{index:.5,rgb:[186,54,85]},{index:.63,rgb:[227,89,51]},{index:.75,rgb:[249,140,10]},{index:.88,rgb:[249,201,50]},{index:1,rgb:[252,255,164]}],magma:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:.88,rgb:[254,194,135]},{index:1,rgb:[252,253,191]}],plasma:[{index:0,rgb:[13,8,135]},{index:.13,rgb:[75,3,161]},{index:.25,rgb:[125,3,168]},{index:.38,rgb:[168,34,150]},{index:.5,rgb:[203,70,121]},{index:.63,rgb:[229,107,93]},{index:.75,rgb:[248,148,65]},{index:.88,rgb:[253,195,40]},{index:1,rgb:[240,249,33]}],warm:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],cool:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[116,0,218]},{index:.25,rgb:[98,74,237]},{index:.38,rgb:[68,146,231]},{index:.5,rgb:[0,204,197]},{index:.63,rgb:[0,247,146]},{index:.75,rgb:[0,255,88]},{index:.88,rgb:[40,255,8]},{index:1,rgb:[147,255,0]}],"rainbow-soft":[{index:0,rgb:[125,0,179]},{index:.1,rgb:[199,0,180]},{index:.2,rgb:[255,0,121]},{index:.3,rgb:[255,108,0]},{index:.4,rgb:[222,194,0]},{index:.5,rgb:[150,255,0]},{index:.6,rgb:[0,255,55]},{index:.7,rgb:[0,246,150]},{index:.8,rgb:[50,167,222]},{index:.9,rgb:[103,51,235]},{index:1,rgb:[124,0,186]}],bathymetry:[{index:0,rgb:[40,26,44]},{index:.13,rgb:[59,49,90]},{index:.25,rgb:[64,76,139]},{index:.38,rgb:[63,110,151]},{index:.5,rgb:[72,142,158]},{index:.63,rgb:[85,174,163]},{index:.75,rgb:[120,206,163]},{index:.88,rgb:[187,230,172]},{index:1,rgb:[253,254,204]}],cdom:[{index:0,rgb:[47,15,62]},{index:.13,rgb:[87,23,86]},{index:.25,rgb:[130,28,99]},{index:.38,rgb:[171,41,96]},{index:.5,rgb:[206,67,86]},{index:.63,rgb:[230,106,84]},{index:.75,rgb:[242,149,103]},{index:.88,rgb:[249,193,135]},{index:1,rgb:[254,237,176]}],chlorophyll:[{index:0,rgb:[18,36,20]},{index:.13,rgb:[25,63,41]},{index:.25,rgb:[24,91,59]},{index:.38,rgb:[13,119,72]},{index:.5,rgb:[18,148,80]},{index:.63,rgb:[80,173,89]},{index:.75,rgb:[132,196,122]},{index:.88,rgb:[175,221,162]},{index:1,rgb:[215,249,208]}],density:[{index:0,rgb:[54,14,36]},{index:.13,rgb:[89,23,80]},{index:.25,rgb:[110,45,132]},{index:.38,rgb:[120,77,178]},{index:.5,rgb:[120,113,213]},{index:.63,rgb:[115,151,228]},{index:.75,rgb:[134,185,227]},{index:.88,rgb:[177,214,227]},{index:1,rgb:[230,241,241]}],"freesurface-blue":[{index:0,rgb:[30,4,110]},{index:.13,rgb:[47,14,176]},{index:.25,rgb:[41,45,236]},{index:.38,rgb:[25,99,212]},{index:.5,rgb:[68,131,200]},{index:.63,rgb:[114,156,197]},{index:.75,rgb:[157,181,203]},{index:.88,rgb:[200,208,216]},{index:1,rgb:[241,237,236]}],"freesurface-red":[{index:0,rgb:[60,9,18]},{index:.13,rgb:[100,17,27]},{index:.25,rgb:[142,20,29]},{index:.38,rgb:[177,43,27]},{index:.5,rgb:[192,87,63]},{index:.63,rgb:[205,125,105]},{index:.75,rgb:[216,162,148]},{index:.88,rgb:[227,199,193]},{index:1,rgb:[241,237,236]}],oxygen:[{index:0,rgb:[64,5,5]},{index:.13,rgb:[106,6,15]},{index:.25,rgb:[144,26,7]},{index:.38,rgb:[168,64,3]},{index:.5,rgb:[188,100,4]},{index:.63,rgb:[206,136,11]},{index:.75,rgb:[220,174,25]},{index:.88,rgb:[231,215,44]},{index:1,rgb:[248,254,105]}],par:[{index:0,rgb:[51,20,24]},{index:.13,rgb:[90,32,35]},{index:.25,rgb:[129,44,34]},{index:.38,rgb:[159,68,25]},{index:.5,rgb:[182,99,19]},{index:.63,rgb:[199,134,22]},{index:.75,rgb:[212,171,35]},{index:.88,rgb:[221,210,54]},{index:1,rgb:[225,253,75]}],phase:[{index:0,rgb:[145,105,18]},{index:.13,rgb:[184,71,38]},{index:.25,rgb:[186,58,115]},{index:.38,rgb:[160,71,185]},{index:.5,rgb:[110,97,218]},{index:.63,rgb:[50,123,164]},{index:.75,rgb:[31,131,110]},{index:.88,rgb:[77,129,34]},{index:1,rgb:[145,105,18]}],salinity:[{index:0,rgb:[42,24,108]},{index:.13,rgb:[33,50,162]},{index:.25,rgb:[15,90,145]},{index:.38,rgb:[40,118,137]},{index:.5,rgb:[59,146,135]},{index:.63,rgb:[79,175,126]},{index:.75,rgb:[120,203,104]},{index:.88,rgb:[193,221,100]},{index:1,rgb:[253,239,154]}],temperature:[{index:0,rgb:[4,35,51]},{index:.13,rgb:[23,51,122]},{index:.25,rgb:[85,59,157]},{index:.38,rgb:[129,79,143]},{index:.5,rgb:[175,95,130]},{index:.63,rgb:[222,112,101]},{index:.75,rgb:[249,146,66]},{index:.88,rgb:[249,196,65]},{index:1,rgb:[232,250,91]}],turbidity:[{index:0,rgb:[34,31,27]},{index:.13,rgb:[65,50,41]},{index:.25,rgb:[98,69,52]},{index:.38,rgb:[131,89,57]},{index:.5,rgb:[161,112,59]},{index:.63,rgb:[185,140,66]},{index:.75,rgb:[202,174,88]},{index:.88,rgb:[216,209,126]},{index:1,rgb:[233,246,171]}],"velocity-blue":[{index:0,rgb:[17,32,64]},{index:.13,rgb:[35,52,116]},{index:.25,rgb:[29,81,156]},{index:.38,rgb:[31,113,162]},{index:.5,rgb:[50,144,169]},{index:.63,rgb:[87,173,176]},{index:.75,rgb:[149,196,189]},{index:.88,rgb:[203,221,211]},{index:1,rgb:[254,251,230]}],"velocity-green":[{index:0,rgb:[23,35,19]},{index:.13,rgb:[24,64,38]},{index:.25,rgb:[11,95,45]},{index:.38,rgb:[39,123,35]},{index:.5,rgb:[95,146,12]},{index:.63,rgb:[152,165,18]},{index:.75,rgb:[201,186,69]},{index:.88,rgb:[233,216,137]},{index:1,rgb:[255,253,205]}],cubehelix:[{index:0,rgb:[0,0,0]},{index:.07,rgb:[22,5,59]},{index:.13,rgb:[60,4,105]},{index:.2,rgb:[109,1,135]},{index:.27,rgb:[161,0,147]},{index:.33,rgb:[210,2,142]},{index:.4,rgb:[251,11,123]},{index:.47,rgb:[255,29,97]},{index:.53,rgb:[255,54,69]},{index:.6,rgb:[255,85,46]},{index:.67,rgb:[255,120,34]},{index:.73,rgb:[255,157,37]},{index:.8,rgb:[241,191,57]},{index:.87,rgb:[224,220,93]},{index:.93,rgb:[218,241,142]},{index:1,rgb:[227,253,198]}]};function XE(i,e,t){return i*(1-t)+e*t}var jE=XE,Yu=BE,ia=jE,ZE=YE;function YE(i){var e,t,r,n,a,o,s,h,l,u,f;if(i||(i={}),h=(i.nshades||72)-1,s=i.format||"hex",o=i.colormap,o||(o="jet"),typeof o=="string"){if(o=o.toLowerCase(),!Yu[o])throw Error(o+" not a supported colorscale");a=Yu[o]}else if(Array.isArray(o))a=o.slice();else throw Error("unsupported colormap option",o);if(a.length>h+1)throw new Error(o+" map requires nshades to be at least size "+a.length);Array.isArray(i.alpha)?i.alpha.length!==2?u=[1,1]:u=i.alpha.slice():typeof i.alpha=="number"?u=[i.alpha,i.alpha]:u=[1,1],e=a.map(function(_){return Math.round(_.index*h)}),u[0]=Math.min(Math.max(u[0],0),1),u[1]=Math.min(Math.max(u[1],0),1);var c=a.map(function(_,p){var y=a[p].index,g=a[p].rgb.slice();return g.length===4&&g[3]>=0&&g[3]<=1||(g[3]=u[0]+(u[1]-u[0])*y),g}),l=[];for(f=0;f<e.length-1;++f){n=e[f+1]-e[f],t=c[f],r=c[f+1];for(var d=0;d<n;d++){var v=d/n;l.push([Math.round(ia(t[0],r[0],v)),Math.round(ia(t[1],r[1],v)),Math.round(ia(t[2],r[2],v)),ia(t[3],r[3],v)])}}return l.push(a[a.length-1].rgb.concat(u[1])),s==="hex"?l=l.map(WE):s==="rgbaString"?l=l.map($E):s==="float"&&(l=l.map(zE)),l}function zE(i){return[i[0]/255,i[1]/255,i[2]/255,i[3]]}function WE(i){for(var e,t="#",r=0;r<3;++r)e=i[r],e=e.toString(16),t+=("00"+e).substr(e.length);return t}function $E(i){return"rgba("+i.join(",")+")"}export{wv as C,vi as F,Gu as G,Tn as L,Or as P,pi as S,Uh as T,so as V,KE as W,Sr as a,ho as b,ZE as c,Pr as d,G as e,$x as f,nt as g,Ph as h,jt as i,Du as t};
